<!doctype html><html lang=en><meta charset=UTF-8><meta name=viewport content="width=device-width,shrink-to-fit=0,user-scalable=no,minimum-scale=1,maximum-scale=1"><title>2019.10.31-22.16.45.js</title><style>html{width:100%;height:100%;display:flex;justify-content:center;align-items:center;flex-direction:column}body{width:100%;height:100%;display:flex;justify-content:center;align-items:center;flex-direction:row;margin:0}canvas{margin:auto;display:block;box-shadow:0 2px 12px -2px rgba(0,0,0,.15)}</style><body><script>!function(){return function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=r[a]={exports:{}};e[a][0].call(c.exports,function(t){return i(e[a][1][t]||t)},c,c.exports,t,e,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}}()({1:[function(t,e,r){const n=t("gl-vec3"),i=t("gl-vec2"),o=t("earcut"),a=t("get-plane-normal");function s(t,e,r){const[i,o]=t,a=n.subtract([],o,i),s=n.dot(n.subtract([],r,i),e)/n.dot(a,e);return s>=0&&s<=1?n.add([],n.scale([],a,s),i):null}function u(t){const e=i.normalize([],i.subtract([],t[0],t[1])),r=i.normalize([],i.subtract([],t[0],t[2]));return i.equals(e,r)}e.exports=function(t,e,r){const l=[],c=[],h=[];for(const o of t){const t=o.map(t=>n.dot(e,n.subtract([],t,r)));if(t[0]>0&&t[1]>0&&t[2]>0||t[0]<0&&t[1]<0&&t[2]<0){t[0]>0?l.push(o):c.push(o);continue}const u=t.map((t,e)=>Math.abs(t)<1e-8&&e).filter(t=>!1!==t),p=t.map((t,e)=>!(Math.abs(t)<1e-8)&&e).filter(t=>!1!==t);if(u.length){if(3===u.length)continue;if(2===u.length){h.push(u.map(t=>o[t])),i.equals(h[h.length-1][0],h[h.length-1][1])&&console.log("segment with the same point!",h[h.length-1][0],h[h.length-1][1]),t[p[0]]>0?l.push(o):c.push(o);continue}if(t[p[0]]>0==t[p[1]]>0){t[p[0]]>0?l.push(o):c.push(o);continue}const n=s(p.map(t=>o[t]),e,r);h.push([o[u[0]],n]),i.equals(h[h.length-1][0],h[h.length-1][1])&&console.log("segment with the same point!",h[h.length-1][0],h[h.length-1][1]);const a=[],f=[];o.forEach((e,r)=>{r===u[0]&&(a.push(e),f.push(e)),t[r]>0?(a.push(e),f.push(n)):(a.push(n),f.push(e))}),l.push(a),c.push(f);continue}const f=[],d=[];t.forEach((t,e)=>{t>0?f.push(e):d.push(e)});const m=[],y=f.length>d.length?f:d,_=f.length>d.length?d:f;m.push([o[y[0]],o[_[0]]],[o[y[1]],o[_[0]]]);const g=m.map(t=>s(t,e,r));h.push(g.slice()),i.equals(h[h.length-1][0],h[h.length-1][1])&&console.log("segment with the same point!",h[h.length-1][0],h[h.length-1][1]);const v=g.slice();v.push(o[_[0]]);const x=y.map(t=>o[t]);x.push(g[0]);const b=[o[y[1]]];b.push(...g);const w=a([],...o);[v,x,b].forEach(t=>{const e=a([],...t);(Math.abs(e[0]-w[0])>.1||Math.abs(e[1]-w[1])>.1||Math.abs(e[2]-w[2])>.1)&&t.reverse()}),_===f?(l.push(v),c.push(x,b)):(c.push(v),l.push(x,b))}if(!h.length)return[l,c];const p=n.subtract([],h[0][0],r);n.normalize(p,p);const f=e,d=n.cross([],p,f),m=[p[0],p[1],p[2],d[0],d[1],d[2],f[0],f[1],f[2]],y=[p[0],d[0],f[0],p[1],d[1],f[1],p[2],d[2],f[2]],_=h.map(t=>t.map(t=>n.transformMat3([],t,y))),g=_[0][0][2],v=function(t){t=t.slice();let e=[];for(;t.length;){let r=e[e.length-1];e.length&&!i.equals(r[0][0],r[r.length-1][1])||(e.push([t.pop()]),r=e[e.length-1]);const n=r[r.length-1][1];let o=!1;for(let e=0;e<t.length;e++){const a=t[e];if(i.equals(a[0],n)){r.push(t.splice(e,1)[0]),o=!0;break}if(i.equals(a[1],n)){r.push(t.splice(e,1)[0].slice().reverse()),o=!0;break}}o||(r.pop(),r.length||e.pop())}e.length>1&&console.log("more than one loop!",e);e=e.filter(t=>t.length>2);const r=[];for(const t of e){const e=t.map(t=>t[0]),n=o(e.flat());for(let t=0;t<n.length;t+=3){const i=[e[n[t]],e[n[t+1]],e[n[t+2]]];u(i)?console.log("Degenerate triangle returned from earcut"):r.push(i)}}return r}(_.map(t=>t.map(t=>[t[0],t[1]])));for(const t of v){const e=t.map(t=>n.transformMat3([],[t[0],t[1],g],m));l.push(e.slice()),e.reverse(),c.push(e)}return[l,c]}},{earcut:22,"get-plane-normal":30,"gl-vec2":80,"gl-vec3":126}],2:[function(t,e,r){const n="0.0.10",i=t("picogl"),o=t("pico-mercator"),a=t("canvas-fit"),s=t("mapbox-gl"),u="\n";e.exports.createRico=h,e.exports.createDlite=function(t,e,r="mapbox://styles/mapbox/dark-v9",i=document.body){s.accessToken=t;const{center:a,zoom:c,bearing:p,pitch:f}=e,d=i.appendChild(document.createElement("div"));d.style.width="100vw",d.style.height="100vh",d.style.position="fixed",d.style.top=d.style.left=0;const m=document.head.appendChild(document.createElement("link"));m.rel="stylesheet",m.href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.54.0/mapbox-gl.css";const y=new s.Map({container:d,style:r,center:a,zoom:c,bearing:p,pitch:f,interactive:!0}),_=new Promise(t=>{y.on("load",t)}),g=h({container:i});g.canvas.setAttribute("id","dlite-canvas"),g.canvas.style["pointer-events"]="none";const v=o.pico_mercator_highPrecisionMat4();function x(t){let e=o.pico_mercator_injectGLSLProjection(t.vs);const r=e.startsWith("#version 300 es")?e.indexOf(u)+1:0,n=e.slice(0,r),i=e.slice(r);e=n+l+i;const a=g({...t,vs:e});return function(t){const e=function(){const t=y.getCenter().toArray(),e=y.getZoom(),r=y.getBearing(),n=y.getPitch();o.pico_mercator_mapboxViewProjectionMatrix(v,t,e,n,r,g.canvas.width,g.canvas.height);let i=null;return o.pico_mercator_uniforms(t,e,v,t=>{i=t}),{...i,pixelsPerMeter:o.pico_mercator_pixelsPerMeter(t[1],e)}}();return a({...t,uniforms:{...t.uniforms||{},...e}})}}return Object.assign(x,g,{VERSION:n,mapbox:y,onload:_}),x};const l="uniform float pixelsPerMeter;\n\n",c="#version 300 es\nprecision highp float;\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(0);\n}";function h({canvas:t,container:e=document.body}={}){const r=t||e.appendChild(document.createElement("canvas"));let n;t||(n=a(r,e));const o=i.createApp(r);function s(t){let e=null,r=null,n=null,i=null;if(t.transform){n=Object.keys(t.transform).sort(),i=n.slice(),r=o.createTransformFeedback();for(let e=0;e<n.length;e++){r.feedbackBuffer(e,t.transform[n[e]])}}const a=o.createProgram(t.vs,t.fs||c,n);let s=o.createDrawCall(a,t.vertexArray);return function(l={}){let c=null;const h="timer"in l?l.timer:"timer"in t&&t.timer;if(h){if((e=e||o.createTimer()).ready()){const{gpuTime:t,cpuTime:r}=e;c={gpuTime:t,cpuTime:r}}e.start()}let p=n;if("transform"in l){r=r||o.createTransformFeedback(),p=Object.keys(l.transform).sort();for(let t=0;t<p.length;t++){r.feedbackBuffer(t,l.transform[p[t]])}}if(!function(t,e){if(null===t&&null===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;let r=0;for(;r<t.length;){if(t[r]!==e[r])return!1;r+=1}return!0}(i,p))throw new Error("rico: Transform Feedback varyings may not change after program creation. Received a different set of Transform Feedback varyings to the render call than was given on instantation.");"vertexArray"in l&&(s=o.createDrawCall(a,l.vertexArray));const f="blend"in l?l.blend:"blend"in t?t.blend:null;null!==f&&(!1===f?o.noBlend():(o.blend(),"src"in f&&"dest"in f?o.blendFunc("string"==typeof f.src?u(f.src):f.src,"string"==typeof f.dest?u(f.dest):f.dest):"csrc"in f&&"cdest"in f&&"asrc"in f&&"adest"in f&&o.blendFuncSeparate("string"==typeof f.csrc?u(f.csrc):f.csrc,"string"==typeof f.cdest?u(f.cdest):f.cdest,"string"==typeof f.asrc?u(f.asrc):f.asrc,"string"==typeof f.adest?u(f.adest):f.adest),"equation"in f&&o.blendEquation("string"==typeof f.equation?u(f.equation):f.equation)));const d="depth"in l?l.depth:"depth"in t?t.depth:null;null!==d&&(!0===d?o.depthTest():o.noDepthTest());const m="rasterize"in l?l.rasterize:"rasterize"in t?t.rasterize:null;null!==m&&(!0===m?o.rasterize():o.noRasterize());const y="cullBackfaces"in l?l.cullBackfaces:"cullBackfaces"in t?t.cullBackfaces:null;null!==y&&(!0===y?o.cullBackfaces():o.drawBackfaces());const _="framebuffer"in l?l.framebuffer:"framebuffer"in t?t.framebuffer:null;null===_?o.defaultDrawFramebuffer():o.drawFramebuffer(_);const g="viewport"in l?l.viewport:"viewport"in t?t.viewport:null;null===g?o.defaultViewport():o.viewport(...g);const v={..."uniformBlocks"in t?t.uniformBlocks:{},..."uniformBlocks"in l?l.uniformBlocks:{}};for(const t in v)s.uniformBlock(t,v[t]);const x={..."uniforms"in t?t.uniforms:{},..."uniforms"in l?l.uniforms:{}};for(const t in x)"object"==typeof(b=x[t])&&null!==b&&"texture"in x[t]?s.texture(t,x[t]):s.uniform(t,x[t]);var b;const w="primitive"in l?l.primitive:"primitive"in t?t.primitive:null;null!==w&&s.primitive("string"==typeof w?u(w):w);const E="count"in l?l.count:"count"in t?t.count:null,A="instanceCount"in l?l.instanceCount:"instanceCount"in t?t.instanceCount:null;return null!==E&&null!==A?s.drawRanges([0,E,A]):null!==E&&s.drawRanges([0,E]),s.transformFeedback("transform"in l&&!l.transform?null:r),s.draw(),h&&e.end(),c}}function u(t){return o.gl[t.replace(" ","_").toUpperCase()]}return t||window.addEventListener("resize",function(){n(),o.viewport(0,0,o.gl.drawingBufferWidth,o.gl.drawingBufferHeight)},!1),s.picoApp=o,s.gl=o.gl,s.canvas=r,s.createVertexArray=o.createVertexArray.bind(o),s.createVertexBuffer=o.createVertexBuffer.bind(o),s.createInterleavedBuffer=o.createInterleavedBuffer.bind(o),s.createTexture2D=o.createTexture2D.bind(o),s.createTexture3D=o.createTexture3D.bind(o),s.createRenderbuffer=o.createRenderbuffer.bind(o),s.createFramebuffer=o.createFramebuffer.bind(o),s.PicoGL=i,s.viewport=o.viewport.bind(o),s.clear=function(...t){o.clearColor(...t),o.clear()},s}},{"canvas-fit":11,"mapbox-gl":180,"pico-mercator":197,picogl:198}],3:[function(t,e,r){e.exports=function(...t){const e=t.pop(),r=t,n=e.startsWith("#version 300 es")?e.indexOf("\n")+1:0,i=e.slice(0,n),o=e.slice(n);return r.unshift(i),r.push(o),r.join("\n")}},{}],4:[function(t,e,r){e.exports="\n// <www.shadertoy.com/view/XsX3zB>\n// by Nikita Miropolskiy\n\n/* discontinuous pseudorandom uniformly distributed in [-0.5, +0.5]^3 */\nvec3 random3(vec3 c) {\n  float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));\n  vec3 r;\n  r.z = fract(512.0*j);\n  j *= .125;\n  r.x = fract(512.0*j);\n  j *= .125;\n  r.y = fract(512.0*j);\n  return r-0.5;\n}\n\nconst float F3 =  0.3333333;\nconst float G3 =  0.1666667;\nfloat snoise(vec3 p) {\n  vec3 s = floor(p + dot(p, vec3(F3)));\n  vec3 x = p - s + dot(s, vec3(G3));\n   \n  vec3 e = step(vec3(0.0), x - x.yzx);\n  vec3 i1 = e*(1.0 - e.zxy);\n  vec3 i2 = 1.0 - e.zxy*(1.0 - e);\n     \n  vec3 x1 = x - i1 + G3;\n  vec3 x2 = x - i2 + 2.0*G3;\n  vec3 x3 = x - 1.0 + 3.0*G3;\n   \n  vec4 w, d;\n   \n  w.x = dot(x, x);\n  w.y = dot(x1, x1);\n  w.z = dot(x2, x2);\n  w.w = dot(x3, x3);\n   \n  w = max(0.6 - w, 0.0);\n   \n  d.x = dot(random3(s), x);\n  d.y = dot(random3(s + i1), x1);\n  d.z = dot(random3(s + i2), x2);\n  d.w = dot(random3(s + 1.0), x3);\n   \n  w *= w;\n  w *= w;\n  d *= w;\n   \n  return dot(d, vec4(52.0));\n}\n\nfloat snoiseFractal(vec3 m) {\n  return 0.5333333* snoise(m)\n        +0.2666667* snoise(2.0*m)\n        +0.1333333* snoise(4.0*m)\n        +0.0666667* snoise(8.0*m);\n}\n\nfloat noise3D(vec3 xyz, float freq, vec2 range) {\n  float value = snoise(xyz * freq) * 0.5 + 0.5;\n  return mix(range.x, range.y, value);\n}\n\nfloat noise2D(vec2 xy, float freq, vec2 range) {\n  return noise3D(vec3(xy, 0), freq, range);\n}\n\nfloat noise1D(float x, float freq, vec2 range) {\n  return noise3D(vec3(x, 0, 0), freq, range);\n}\n\nfloat noiseFractal3D(vec3 xyz, float freq, vec2 range) {\n  float value = snoiseFractal(xyz * freq) * 0.5 + 0.5;\n  return mix(range.x, range.y, value);\n}\n\nfloat noiseFractal2D(vec2 xy, float freq, vec2 range) {\n  return noiseFractal3D(vec3(xy, 0), freq, range);\n}\n\nfloat noiseFractal1D(float x, float freq, vec2 range) {\n  return noiseFractal3D(vec3(x, 0, 0), freq, range);\n}\n\nfloat noise3D(vec3 xyz, float freq) {\n  vec2 range = vec2(-1, 1);\n  float value = snoise(xyz * freq) * 0.5 + 0.5;\n  return mix(range.x, range.y, value);\n}\n\nfloat noise2D(vec2 xy, float freq) {\n  return noise3D(vec3(xy, 0), freq);\n}\n\nfloat noise1D(float x, float freq) {\n  return noise3D(vec3(x, 0, 0), freq);\n}\n\nfloat noiseFractal3D(vec3 xyz, float freq) {\n  vec2 range = vec2(-1, 1);\n  float value = snoiseFractal(xyz * freq) * 0.5 + 0.5;\n  return mix(range.x, range.y, value);\n}\n\nfloat noiseFractal2D(vec2 xy, float freq) {\n  return noiseFractal3D(vec3(xy, 0), freq);\n}\n\nfloat noiseFractal1D(float x, float freq) {\n  return noiseFractal3D(vec3(x, 0, 0), freq);\n}\n\nfloat noise3D(vec3 xyz) {\n  float freq = 1.0;\n  vec2 range = vec2(-1, 1);\n  float value = snoise(xyz * freq) * 0.5 + 0.5;\n  return mix(range.x, range.y, value);\n}\n\nfloat noise2D(vec2 xy) {\n  return noise3D(vec3(xy, 0));\n}\n\nfloat noise1D(float x) {\n  return noise3D(vec3(x, 0, 0));\n}\n\nfloat noiseFractal3D(vec3 xyz) {\n  float freq = 1.0;\n  vec2 range = vec2(-1, 1);\n  float value = snoiseFractal(xyz * freq) * 0.5 + 0.5;\n  return mix(range.x, range.y, value);\n}\n\nfloat noiseFractal2D(vec2 xy) {\n  return noiseFractal3D(vec3(xy, 0));\n}\n\nfloat noiseFractal1D(float x) {\n  return noiseFractal3D(vec3(x, 0, 0));\n}\n\n"},{}],5:[function(t,e,r){const n=t("../inject-glsl/inject-glsl-0.0.1"),{createSpring:i}=t("spring-animator");function o(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return[parseInt(e[1],16)/255,parseInt(e[2],16)/255,parseInt(e[3],16)/255]}e.exports=function(t,e=.001,r=.1,s=[1,1,1]){t=t.map(t=>t.map(o));const u=function(t,e,r){const n=i(t,e,r[0]),o=i(t,e,r[1]),a=i(t,e,r[2]),s=i(t,e,r[3]),u=i(t,e,r[4]);return{setDestination:function(t){n.setDestination(t[0]),o.setDestination(t[1]),a.setDestination(t[2]),s.setDestination(t[3]),u.setDestination(t[4])},tick:function(t,e){n.tick(t,e),o.tick(t,e),a.tick(t,e),s.tick(t,e),u.tick(t,e)},getCurrentValue:function(){return[n.getCurrentValue(),o.getCurrentValue(),a.getCurrentValue(),s.getCurrentValue(),u.getCurrentValue()]}}}(e,r,Number.isInteger(s)?t[s]:new Array(5).fill().map(()=>s));return{injectGLSL:function(t){return n(a,t)},tick:function(e){Number.isInteger(e)||(console.warn(`paletteAnimator tick() expects an integer index into the provided palettes. received ${e}. using palette 0`),e=0);u.setDestination(t[e]),u.tick()},uniforms:function(){const t=u.getCurrentValue();return{animator_color1:t[0],animator_color2:t[1],animator_color3:t[2],animator_color4:t[3],animator_color5:t[4]}},palettes:t,PALETTE_ANIMATOR_GLSL:a}};const a="\nprecision highp float;\n\nuniform vec3 animator_color1;\nuniform vec3 animator_color2;\nuniform vec3 animator_color3;\nuniform vec3 animator_color4;\nuniform vec3 animator_color5;\n\n// stretch is how much to stretch or compress the t scale from the center\n// in order to encompass more or fewer colors\nvec3 getColorFromPalette(float t) {\n  if (t < 0.25) {\n    return mix(animator_color1, animator_color2, smoothstep(0.0, 0.25, t));\n  }\n  if (t < 0.5) {\n    return mix(animator_color2, animator_color3, smoothstep(0.25, 0.5, t));\n  }\n  if (t < 0.75) {\n    return mix(animator_color3, animator_color4, smoothstep(0.5, 0.75, t));\n  }\n  return mix(animator_color4, animator_color5, smoothstep(0.75, 1.0, t));\n}\n"},{"../inject-glsl/inject-glsl-0.0.1":3,"spring-animator":208}],6:[function(t,e,r){"use strict";e.exports=function(t,e){t=t||document.body,e=e||{};var r=[.01,Infinity];"distanceLimits"in e&&(r[0]=e.distanceLimits[0],r[1]=e.distanceLimits[1]);"zoomMin"in e&&(r[0]=e.zoomMin);"zoomMax"in e&&(r[1]=e.zoomMax);var l=i({center:e.center||[0,0,0],up:e.up||[0,1,0],eye:e.eye||[0,0,10],mode:e.mode||"orbit",distanceLimits:r}),c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=0,p=t.clientWidth,f=t.clientHeight,d={view:l,element:t,delay:e.delay||16,rotateSpeed:e.rotateSpeed||1,zoomSpeed:e.zoomSpeed||1,translateSpeed:e.translateSpeed||1,flipX:!!e.flipX,flipY:!!e.flipY,modes:l.modes,tick:function(){var e=n(),r=this.delay;l.idle(e-r),l.flush(e-(100+2*r));var i=e-2*r;l.recalcMatrix(i);for(var o=!0,a=l.computedMatrix,s=0;s<16;++s)o=o&&c[s]===a[s],c[s]=a[s];var u=t.clientWidth===p&&t.clientHeight===f;return p=t.clientWidth,f=t.clientHeight,o?!u:(h=Math.exp(l.computedRadius[0]),!0)},lookAt:function(t,e,r){l.lookAt(l.lastT(),t,e,r)},rotate:function(t,e,r){l.rotate(l.lastT(),t,e,r)},pan:function(t,e,r){l.pan(l.lastT(),t,e,r)},translate:function(t,e,r){l.translate(l.lastT(),t,e,r)}};Object.defineProperties(d,{matrix:{get:function(){return l.computedMatrix},set:function(t){return l.setMatrix(l.lastT(),t),l.computedMatrix},enumerable:!0},mode:{get:function(){return l.getMode()},set:function(t){return l.setMode(t),l.getMode()},enumerable:!0},center:{get:function(){return l.computedCenter},set:function(t){return l.lookAt(l.lastT(),t),l.computedCenter},enumerable:!0},eye:{get:function(){return l.computedEye},set:function(t){return l.lookAt(l.lastT(),null,t),l.computedEye},enumerable:!0},up:{get:function(){return l.computedUp},set:function(t){return l.lookAt(l.lastT(),null,null,t),l.computedUp},enumerable:!0},distance:{get:function(){return h},set:function(t){return l.setDistance(l.lastT(),t),t},enumerable:!0},distanceLimits:{get:function(){return l.getDistanceLimits(r)},set:function(t){return l.setDistanceLimits(t),t},enumerable:!0}}),t.addEventListener("contextmenu",function(t){return t.preventDefault(),!1});var m=0,y=0,_={shift:!1,control:!1,alt:!1,meta:!1};function g(e,r,i,o){var a=1/t.clientHeight,s=a*(r-m),u=a*(i-y),c=d.flipX?1:-1,p=d.flipY?1:-1,f=Math.PI*d.rotateSpeed,g=n();if(1&e)o.shift?l.rotate(g,0,0,-s*f):l.rotate(g,c*f*s,-p*f*u,0);else if(2&e)l.pan(g,-d.translateSpeed*s*h,d.translateSpeed*u*h,0);else if(4&e){var v=d.zoomSpeed*u/window.innerHeight*(g-l.lastT())*50;l.pan(g,0,0,h*(Math.exp(v)-1))}m=r,y=i,_=o}return o(t,g),t.addEventListener("touchstart",function(e){var r=s(e.changedTouches[0],t);g(0,r[0],r[1],_),g(1,r[0],r[1],_),e.preventDefault()},!!u&&{passive:!1}),t.addEventListener("touchmove",function(e){var r=s(e.changedTouches[0],t);g(1,r[0],r[1],_),e.preventDefault()},!!u&&{passive:!1}),t.addEventListener("touchend",function(e){s(e.changedTouches[0],t),g(0,m,y,_),e.preventDefault()},!!u&&{passive:!1}),a(t,function(t,e,r){var i=d.flipX?1:-1,o=d.flipY?1:-1,a=n();if(Math.abs(t)>Math.abs(e))l.rotate(a,0,0,-t*i*Math.PI*d.rotateSpeed/window.innerWidth);else{var s=d.zoomSpeed*o*e/window.innerHeight*(a-l.lastT())/100;l.pan(a,0,0,h*(Math.exp(s)-1))}},!0),d};var n=t("right-now"),i=t("3d-view"),o=t("mouse-change"),a=t("mouse-wheel"),s=t("mouse-event-offset"),u=t("has-passive-events")},{"3d-view":7,"has-passive-events":154,"mouse-change":187,"mouse-event-offset":188,"mouse-wheel":190,"right-now":205}],7:[function(t,e,r){"use strict";e.exports=function(t){var e=(t=t||{}).eye||[0,0,1],r=t.center||[0,0,0],s=t.up||[0,1,0],u=t.distanceLimits||[0,Infinity],l=t.mode||"turntable",c=n(),h=i(),p=o();return c.setDistanceLimits(u[0],u[1]),c.lookAt(0,e,r,s),h.setDistanceLimits(u[0],u[1]),h.lookAt(0,e,r,s),p.setDistanceLimits(u[0],u[1]),p.lookAt(0,e,r,s),new a({turntable:c,orbit:h,matrix:p},l)};var n=t("turntable-camera-controller"),i=t("orbit-camera-controller"),o=t("matrix-camera-controller");function a(t,e){this._controllerNames=Object.keys(t),this._controllerList=this._controllerNames.map(function(e){return t[e]}),this._mode=e,this._active=t[e],this._active||(this._mode="turntable",this._active=t.turntable),this.modes=this._controllerNames,this.computedMatrix=this._active.computedMatrix,this.computedEye=this._active.computedEye,this.computedUp=this._active.computedUp,this.computedCenter=this._active.computedCenter,this.computedRadius=this._active.computedRadius}var s=a.prototype;[["flush",1],["idle",1],["lookAt",4],["rotate",4],["pan",4],["translate",4],["setMatrix",2],["setDistanceLimits",2],["setDistance",2]].forEach(function(t){for(var e=t[0],r=[],n=0;n<t[1];++n)r.push("a"+n);var i="var cc=this._controllerList;for(var i=0;i<cc.length;++i){cc[i]."+t[0]+"("+r.join()+")}";s[e]=Function.apply(null,r.concat(i))}),s.recalcMatrix=function(t){this._active.recalcMatrix(t)},s.getDistance=function(t){return this._active.getDistance(t)},s.getDistanceLimits=function(t){return this._active.getDistanceLimits(t)},s.lastT=function(){return this._active.lastT()},s.setMode=function(t){if(t!==this._mode){var e=this._controllerNames.indexOf(t);if(!(e<0)){var r=this._active,n=this._controllerList[e],i=Math.max(r.lastT(),n.lastT());r.recalcMatrix(i),n.setMatrix(i,r.computedMatrix),this._active=n,this._mode=t,this.computedMatrix=this._active.computedMatrix,this.computedEye=this._active.computedEye,this.computedUp=this._active.computedUp,this.computedCenter=this._active.computedCenter,this.computedRadius=this._active.computedRadius}}},s.getMode=function(){return this._mode}},{"matrix-camera-controller":185,"orbit-camera-controller":195,"turntable-camera-controller":210}],8:[function(t,e,r){"use strict";r.byteLength=function(t){var e=l(t),r=e[1];return 3*(e[0]+r)/4-r},r.toByteArray=function(t){for(var e,r=l(t),n=r[0],a=r[1],s=new o(function(t,e,r){return 3*(e+r)/4-r}(0,n,a)),u=0,c=a>0?n-4:n,h=0;h<c;h+=4)e=i[t.charCodeAt(h)]<<18|i[t.charCodeAt(h+1)]<<12|i[t.charCodeAt(h+2)]<<6|i[t.charCodeAt(h+3)],s[u++]=e>>16&255,s[u++]=e>>8&255,s[u++]=255&e;2===a&&(e=i[t.charCodeAt(h)]<<2|i[t.charCodeAt(h+1)]>>4,s[u++]=255&e);1===a&&(e=i[t.charCodeAt(h)]<<10|i[t.charCodeAt(h+1)]<<4|i[t.charCodeAt(h+2)]>>2,s[u++]=e>>8&255,s[u++]=255&e);return s},r.fromByteArray=function(t){for(var e,r=t.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(c(t,a,a+16383>s?s:a+16383));1===i?o.push(n[(e=t[r-1])>>2]+n[e<<4&63]+"=="):2===i&&o.push(n[(e=(t[r-2]<<8)+t[r-1])>>10]+n[e>>4&63]+n[e<<2&63]+"=");return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=a.length;s<u;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function c(t,e,r){for(var i,o=[],a=e;a<r;a+=3)o.push(n[(i=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]))>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},{}],9:[function(t,e,r){"use strict";function n(t,e,r,n,i,o){var a=["function ",t,"(a,l,h,",n.join(","),"){",o?"":"var i=",r?"l-1":"h+1",";while(l<=h){var m=(l+h)>>>1,x=a",i?".get(m)":"[m]"];return o?e.indexOf("c")<0?a.push(";if(x===y){return m}else if(x<=y){"):a.push(";var p=c(x,y);if(p===0){return m}else if(p<=0){"):a.push(";if(",e,"){i=m;"),a.push(r?"l=m+1}else{h=m-1}":"h=m-1}else{l=m+1}"),a.push("}"),a.push(o?"return -1};":"return i};"),a.join("")}function i(t,e,r,i){return new Function([n("A","x"+t+"y",e,["y"],!1,i),n("B","x"+t+"y",e,["y"],!0,i),n("P","c(x,y)"+t+"0",e,["y","c"],!1,i),n("Q","c(x,y)"+t+"0",e,["y","c"],!0,i),"function dispatchBsearch",r,"(a,y,c,l,h){if(a.shape){if(typeof(c)==='function'){return Q(a,(l===undefined)?0:l|0,(h===undefined)?a.shape[0]-1:h|0,y,c)}else{return B(a,(c===undefined)?0:c|0,(l===undefined)?a.shape[0]-1:l|0,y)}}else{if(typeof(c)==='function'){return P(a,(l===undefined)?0:l|0,(h===undefined)?a.length-1:h|0,y,c)}else{return A(a,(c===undefined)?0:c|0,(l===undefined)?a.length-1:l|0,y)}}}return dispatchBsearch",r].join(""))()}e.exports={ge:i(">=",!1,"GE"),gt:i(">",!1,"GT"),lt:i("<",!0,"LT"),le:i("<=",!0,"LE"),eq:i("-",!0,"EQ",!0)}},{}],10:[function(t,e,r){(function(e){"use strict";var n=t("base64-js"),i=t("ieee754");r.Buffer=e,r.SlowBuffer=function(t){+t!=t&&(t=0);return e.alloc(+t)},r.INSPECT_MAX_BYTES=50;var o=2147483647;function a(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');var r=new Uint8Array(t);return r.__proto__=e.prototype,r}function e(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return s(t,e,r)}function s(t,r,n){if("string"==typeof t)return function(t,r){"string"==typeof r&&""!==r||(r="utf8");if(!e.isEncoding(r))throw new TypeError("Unknown encoding: "+r);var n=0|p(t,r),i=a(n),o=i.write(t,r);o!==n&&(i=i.slice(0,o));return i}(t,r);if(ArrayBuffer.isView(t))return c(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(z(t,ArrayBuffer)||t&&z(t.buffer,ArrayBuffer))return function(t,r,n){if(r<0||t.byteLength<r)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<r+(n||0))throw new RangeError('"length" is outside of buffer bounds');var i;i=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n);return i.__proto__=e.prototype,i}(t,r,n);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var i=t.valueOf&&t.valueOf();if(null!=i&&i!==t)return e.from(i,r,n);var o=function(t){if(e.isBuffer(t)){var r=0|h(t.length),n=a(r);return 0===n.length?n:(t.copy(n,0,0,r),n)}if(void 0!==t.length)return"number"!=typeof t.length||U(t.length)?a(0):c(t);if("Buffer"===t.type&&Array.isArray(t.data))return c(t.data)}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return e.from(t[Symbol.toPrimitive]("string"),r,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return u(t),a(t<0?0:0|h(t))}function c(t){for(var e=t.length<0?0:0|h(t.length),r=a(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function h(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function p(t,r){if(e.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||z(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var n=t.length,i=arguments.length>2&&!0===arguments[2];if(!i&&0===n)return 0;for(var o=!1;;)switch(r){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return F(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return B(t).length;default:if(o)return i?-1:F(t).length;r=(""+r).toLowerCase(),o=!0}}function f(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function d(t,r,n,i,o){if(0===t.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),U(n=+n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof r&&(r=e.from(r,i)),e.isBuffer(r))return 0===r.length?-1:m(t,r,n,i,o);if("number"==typeof r)return r&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,r,n):Uint8Array.prototype.lastIndexOf.call(t,r,n):m(t,[r],n,i,o);throw new TypeError("val must be string, number or Buffer")}function m(t,e,r,n,i){var o,a=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,s/=2,u/=2,r/=2}function l(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var c=-1;for(o=r;o<s;o++)if(l(t,o)===l(e,-1===c?0:o-c)){if(-1===c&&(c=o),o-c+1===u)return c*a}else-1!==c&&(o-=o-c),c=-1}else for(r+u>s&&(r=s-u),o=r;o>=0;o--){for(var h=!0,p=0;p<u;p++)if(l(t,o+p)!==l(e,p)){h=!1;break}if(h)return o}return-1}function y(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(e.substr(2*a,2),16);if(U(s))return a;t[r+a]=s}return a}function _(t,e,r,n){return N(F(e,t.length-r),t,r,n)}function g(t,e,r,n){return N(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function v(t,e,r,n){return g(t,e,r,n)}function x(t,e,r,n){return N(B(e),t,r,n)}function b(t,e,r,n){return N(function(t,e){for(var r,n,i=[],o=0;o<t.length&&!((e-=2)<0);++o)r=t.charCodeAt(o),n=r>>8,i.push(r%256),i.push(n);return i}(e,t.length-r),t,r,n)}function w(t,e,r){return n.fromByteArray(0===e&&r===t.length?t:t.slice(e,r))}function E(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,a,s,u,l=t[i],c=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=r)switch(h){case 1:l<128&&(c=l);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&l)<<6|63&o)>127&&(c=u);break;case 3:a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&(u=(15&l)<<12|(63&o)<<6|63&a)>2047&&(u<55296||u>57343)&&(c=u);break;case 4:a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&(u=(15&l)<<18|(63&o)<<12|(63&a)<<6|63&s)>65535&&u<1114112&&(c=u)}null===c?(c=65533,h=1):c>65535&&(n.push((c-=65536)>>>10&1023|55296),c=56320|1023&c),n.push(c),i+=h}return function(t){var e=t.length;if(e<=A)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=A));return r}(n)}r.kMaxLength=o,(e.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(e.prototype,"parent",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.buffer}}),Object.defineProperty(e.prototype,"offset",{enumerable:!0,get:function(){if(e.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&e[Symbol.species]===e&&Object.defineProperty(e,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),e.poolSize=8192,e.from=function(t,e,r){return s(t,e,r)},e.prototype.__proto__=Uint8Array.prototype,e.__proto__=Uint8Array,e.alloc=function(t,e,r){return function(t,e,r){return u(t),t<=0?a(t):void 0!==e?"string"==typeof r?a(t).fill(e,r):a(t).fill(e):a(t)}(t,e,r)},e.allocUnsafe=function(t){return l(t)},e.allocUnsafeSlow=function(t){return l(t)},e.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==e.prototype},e.compare=function(t,r){if(z(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),z(r,Uint8Array)&&(r=e.from(r,r.offset,r.byteLength)),!e.isBuffer(t)||!e.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===r)return 0;for(var n=t.length,i=r.length,o=0,a=Math.min(n,i);o<a;++o)if(t[o]!==r[o]){n=t[o],i=r[o];break}return n<i?-1:i<n?1:0},e.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},e.concat=function(t,r){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return e.alloc(0);var n;if(void 0===r)for(r=0,n=0;n<t.length;++n)r+=t[n].length;var i=e.allocUnsafe(r),o=0;for(n=0;n<t.length;++n){var a=t[n];if(z(a,Uint8Array)&&(a=e.from(a)),!e.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,o),o+=a.length}return i},e.byteLength=p,e.prototype._isBuffer=!0,e.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)f(this,e,e+1);return this},e.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)f(this,e,e+3),f(this,e+1,e+2);return this},e.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)f(this,e,e+7),f(this,e+1,e+6),f(this,e+2,e+5),f(this,e+3,e+4);return this},e.prototype.toLocaleString=e.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?E(this,0,t):function(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return S(this,e,r);case"utf8":case"utf-8":return E(this,e,r);case"ascii":return T(this,e,r);case"latin1":case"binary":return M(this,e,r);case"base64":return w(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},e.prototype.equals=function(t){if(!e.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===e.compare(this,t)},e.prototype.inspect=function(){var t="",e=r.INSPECT_MAX_BYTES;return t=this.toString("hex",0,e).replace(/(.{2})/g,"$1 ").trim(),this.length>e&&(t+=" ... "),"<Buffer "+t+">"},e.prototype.compare=function(t,r,n,i,o){if(z(t,Uint8Array)&&(t=e.from(t,t.offset,t.byteLength)),!e.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===r&&(r=0),void 0===n&&(n=t?t.length:0),void 0===i&&(i=0),void 0===o&&(o=this.length),r<0||n>t.length||i<0||o>this.length)throw new RangeError("out of range index");if(i>=o&&r>=n)return 0;if(i>=o)return-1;if(r>=n)return 1;if(this===t)return 0;for(var a=(o>>>=0)-(i>>>=0),s=(n>>>=0)-(r>>>=0),u=Math.min(a,s),l=this.slice(i,o),c=t.slice(r,n),h=0;h<u;++h)if(l[h]!==c[h]){a=l[h],s=c[h];break}return a<s?-1:s<a?1:0},e.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},e.prototype.indexOf=function(t,e,r){return d(this,t,e,r,!0)},e.prototype.lastIndexOf=function(t,e,r){return d(this,t,e,r,!1)},e.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return y(this,t,e,r);case"utf8":case"utf-8":return _(this,t,e,r);case"ascii":return g(this,t,e,r);case"latin1":case"binary":return v(this,t,e,r);case"base64":return x(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},e.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var A=4096;function T(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function M(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function S(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=k(t[o]);return i}function R(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function I(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function C(t,r,n,i,o,a){if(!e.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(r>o||r<a)throw new RangeError('"value" argument is out of bounds');if(n+i>t.length)throw new RangeError("Index out of range")}function P(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function D(t,e,r,n,o){return e=+e,r>>>=0,o||P(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function L(t,e,r,n,o){return e=+e,r>>>=0,o||P(t,0,r,8),i.write(t,e,r,n,52,8),r+8}e.prototype.slice=function(t,r){var n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):r>n&&(r=n),r<t&&(r=t);var i=this.subarray(t,r);return i.__proto__=e.prototype,i},e.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},e.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},e.prototype.readUInt8=function(t,e){return t>>>=0,e||I(t,1,this.length),this[t]},e.prototype.readUInt16LE=function(t,e){return t>>>=0,e||I(t,2,this.length),this[t]|this[t+1]<<8},e.prototype.readUInt16BE=function(t,e){return t>>>=0,e||I(t,2,this.length),this[t]<<8|this[t+1]},e.prototype.readUInt32LE=function(t,e){return t>>>=0,e||I(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},e.prototype.readUInt32BE=function(t,e){return t>>>=0,e||I(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},e.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},e.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||I(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},e.prototype.readInt8=function(t,e){return t>>>=0,e||I(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},e.prototype.readInt16LE=function(t,e){t>>>=0,e||I(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt16BE=function(t,e){t>>>=0,e||I(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},e.prototype.readInt32LE=function(t,e){return t>>>=0,e||I(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},e.prototype.readInt32BE=function(t,e){return t>>>=0,e||I(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},e.prototype.readFloatLE=function(t,e){return t>>>=0,e||I(t,4,this.length),i.read(this,t,!0,23,4)},e.prototype.readFloatBE=function(t,e){return t>>>=0,e||I(t,4,this.length),i.read(this,t,!1,23,4)},e.prototype.readDoubleLE=function(t,e){return t>>>=0,e||I(t,8,this.length),i.read(this,t,!0,52,8)},e.prototype.readDoubleBE=function(t,e){return t>>>=0,e||I(t,8,this.length),i.read(this,t,!1,52,8)},e.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||C(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},e.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||C(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},e.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,1,255,0),this[e]=255&t,e+1},e.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},e.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},e.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},e.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},e.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,t,e,r,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<r&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},e.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);C(this,t,e,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},e.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},e.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},e.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},e.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},e.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||C(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},e.prototype.writeFloatLE=function(t,e,r){return D(this,t,e,!0,r)},e.prototype.writeFloatBE=function(t,e,r){return D(this,t,e,!1,r)},e.prototype.writeDoubleLE=function(t,e,r){return L(this,t,e,!0,r)},e.prototype.writeDoubleBE=function(t,e,r){return L(this,t,e,!1,r)},e.prototype.copy=function(t,r,n,i){if(!e.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),i||0===i||(i=this.length),r>=t.length&&(r=t.length),r||(r=0),i>0&&i<n&&(i=n),i===n)return 0;if(0===t.length||0===this.length)return 0;if(r<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-r<i-n&&(i=t.length-r+n);var o=i-n;if(this===t&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,n,i);else if(this===t&&n<r&&r<i)for(var a=o-1;a>=0;--a)t[a+r]=this[a+n];else Uint8Array.prototype.set.call(t,this.subarray(n,i),r);return o},e.prototype.fill=function(t,r,n,i){if("string"==typeof t){if("string"==typeof r?(i=r,r=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!e.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(1===t.length){var o=t.charCodeAt(0);("utf8"===i&&o<128||"latin1"===i)&&(t=o)}}else"number"==typeof t&&(t&=255);if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;var a;if(r>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(a=r;a<n;++a)this[a]=t;else{var s=e.isBuffer(t)?t:e.from(t,i),u=s.length;if(0===u)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(a=0;a<n-r;++a)this[a+r]=s[a%u]}return this};var O=/[^+/0-9A-Za-z-_]/g;function k(t){return t<16?"0"+t.toString(16):t.toString(16)}function F(t,e){var r;e=e||Infinity;for(var n=t.length,i=null,o=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function B(t){return n.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(O,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function N(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function z(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function U(t){return t!=t}}).call(this,t("buffer").Buffer)},{"base64-js":8,buffer:10,ieee754:156}],11:[function(t,e,r){var n=t("element-size");e.exports=function(t,e,r){var o="SVG"===t.nodeName.toUpperCase();return t.style.position=t.style.position||"absolute",t.style.top=0,t.style.left=0,a.scale=parseFloat(r||1),a.parent=e,a();function a(){var e=a.parent||t.parentNode;if("function"==typeof e)var r=e(i)||i,s=r[0],u=r[1];else if(e&&e!==document.body)var l=n(e),s=0|l[0],u=0|l[1];else var s=window.innerWidth,u=window.innerHeight;return o?(t.setAttribute("width",s*a.scale+"px"),t.setAttribute("height",u*a.scale+"px")):(t.width=s*a.scale,t.height=u*a.scale),t.style.width=s+"px",t.style.height=u+"px",a}};var i=new Float32Array(2)},{"element-size":23}],12:[function(t,e,r){var n=t("seed-random"),i=t("simplex-noise"),o=t("defined");e.exports=function t(e){e=o(e,null);var r,a,s,u=Math.random,l=null,c=!1;return h(e),{value:p,createRandom:function(e){return t(e)},setSeed:h,getSeed:function(){return r},getRandomSeed:function(){return String(Math.floor(1e6*Math.random()))},valueNonZero:function(){for(var t=0;0===t;)t=p();return t},permuteNoise:function(){s=f()},noise1D:function(t,e,r){if(!isFinite(t))throw new TypeError("x component for noise() must be finite");return e=o(e,1),(r=o(r,1))*s.noise2D(t*e,0)},noise2D:function(t,e,r,n){if(!isFinite(t))throw new TypeError("x component for noise() must be finite");if(!isFinite(e))throw new TypeError("y component for noise() must be finite");return r=o(r,1),(n=o(n,1))*s.noise2D(t*r,e*r)},noise3D:function(t,e,r,n,i){if(!isFinite(t))throw new TypeError("x component for noise() must be finite");if(!isFinite(e))throw new TypeError("y component for noise() must be finite");if(!isFinite(r))throw new TypeError("z component for noise() must be finite");return n=o(n,1),(i=o(i,1))*s.noise3D(t*n,e*n,r*n)},noise4D:function(t,e,r,n,i,a){if(!isFinite(t))throw new TypeError("x component for noise() must be finite");if(!isFinite(e))throw new TypeError("y component for noise() must be finite");if(!isFinite(r))throw new TypeError("z component for noise() must be finite");if(!isFinite(n))throw new TypeError("w component for noise() must be finite");return i=o(i,1),(a=o(a,1))*s.noise4D(t*i,e*i,r*i,n*i)},sign:function(){return d()?1:-1},boolean:d,chance:function(t){if("number"!=typeof(t=o(t,.5)))throw new TypeError("expected n to be a number");return p()<t},range:m,rangeFloor:y,pick:function(t){return 0===t.length?void 0:t[y(0,t.length)]},shuffle:function(t){if(!Array.isArray(t))throw new TypeError("Expected Array, got "+typeof t);for(var e,r,n=t.length,i=t.slice();n;)e=Math.floor(p()*n--),r=i[n],i[n]=i[e],i[e]=r;return i},onCircle:_,insideCircle:function(t,e){t=o(t,1),_(1,e=e||[]);var r=t*Math.sqrt(p());return e[0]*=r,e[1]*=r,e},onSphere:function(t,e){t=o(t,1),e=e||[];var r=p()*Math.PI*2,n=2*p()-1,i=r,a=Math.acos(n);return e[0]=t*Math.sin(a)*Math.cos(i),e[1]=t*Math.sin(a)*Math.sin(i),e[2]=t*Math.cos(a),e},insideSphere:function(t,e){t=o(t,1),e=e||[];var r=p()*Math.PI*2,n=2*p()-1,i=p(),a=r,s=Math.acos(n),u=t*Math.cbrt(i);return e[0]=u*Math.sin(s)*Math.cos(a),e[1]=u*Math.sin(s)*Math.sin(a),e[2]=u*Math.cos(s),e},quaternion:function(t){t=t||[];var e=p(),r=p(),n=p(),i=Math.sqrt(1-e),o=Math.sqrt(e),a=2*Math.PI*r,s=2*Math.PI*n,u=Math.sin(a)*i,l=Math.cos(a)*i,c=Math.sin(s)*o,h=Math.cos(s)*o;return t[0]=u,t[1]=l,t[2]=c,t[3]=h,t},weighted:v,weightedSet:function(t){return 0===(t=t||[]).length?null:t[g(t)].value},weightedSetIndex:g,gaussian:function(t,e){if(t=o(t,0),e=o(e,1),c){c=!1;var r=l;return l=null,t+e*r}var n=0,i=0,a=0;do{n=2*p()-1,i=2*p()-1,a=n*n+i*i}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);return l=i*s,c=!0,t+e*(n*s)}};function h(t,e){"number"==typeof t||"string"==typeof t?a=n(r=t,e):(r=void 0,a=u),s=f(),l=null,c=!1}function p(){return a()}function f(){return new i(a)}function d(){return p()>.5}function m(t,e){if(void 0===e&&(e=t,t=0),"number"!=typeof t||"number"!=typeof e)throw new TypeError("Expected all arguments to be numbers");return p()*(e-t)+t}function y(t,e){if(void 0===e&&(e=t,t=0),"number"!=typeof t||"number"!=typeof e)throw new TypeError("Expected all arguments to be numbers");return Math.floor(m(t,e))}function _(t,e){t=o(t,1),e=e||[];var r=2*p()*Math.PI;return e[0]=t*Math.cos(r),e[1]=t*Math.sin(r),e}function g(t){return 0===(t=t||[]).length?-1:v(t.map(function(t){return t.weight}))}function v(t){if(0===(t=t||[]).length)return-1;var e,r=0;for(e=0;e<t.length;e++)r+=t[e];if(r<=0)throw new Error("Weights must sum to > 0");var n=p()*r;for(e=0;e<t.length;e++){if(n<t[e])return e;n-=t[e]}return 0}}()},{defined:21,"seed-random":206,"simplex-noise":207}],13:[function(t,e,r){(function(n){!function(n,i){"object"==typeof r&&void 0!==e?e.exports=i(t("convert-length")):"function"==typeof define&&define.amd?define(["convert-length"],i):n.canvasSketch=i(null)}(this,function(t){t=t&&t.hasOwnProperty("default")?t.default:t;var e=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;var o=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(t){n[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,n){for(var o,a,s=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),u=1;u<arguments.length;u++){for(var l in o=Object(arguments[u]))r.call(o,l)&&(s[l]=o[l]);if(e){a=e(o);for(var c=0;c<a.length;c++)i.call(o,a[c])&&(s[a[c]]=o[a[c]])}}return s},a="undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{};function s(t,e){return t(e={exports:{}},e.exports),e.exports}var u=a.performance&&a.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},l=function(t){return!!t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof t.then};var c=function(t){return!(!t||"object"!=typeof t)&&("object"==typeof window&&"object"==typeof window.Node?t instanceof window.Node:"number"==typeof t.nodeType&&"string"==typeof t.nodeName)};function h(){return"undefined"!=typeof window&&window["canvas-sketch-cli"]}function p(){for(var t=arguments,e=0;e<arguments.length;e++)if(null!=t[e])return t[e]}function f(){return"undefined"!=typeof document}var d,m=s(function(t,e){function r(t){var e=[];for(var r in t)e.push(r);return e}(t.exports="function"==typeof Object.keys?Object.keys:r).shim=r}),y=s(function(t,e){var r="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function n(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function i(t){return t&&"object"==typeof t&&"number"==typeof t.length&&Object.prototype.hasOwnProperty.call(t,"callee")&&!Object.prototype.propertyIsEnumerable.call(t,"callee")||!1}(e=t.exports=r?n:i).supported=n,e.unsupported=i}),_=s(function(t){var e=Array.prototype.slice,r=t.exports=function(t,o,a){return a||(a={}),t===o||(t instanceof Date&&o instanceof Date?t.getTime()===o.getTime():!t||!o||"object"!=typeof t&&"object"!=typeof o?a.strict?t===o:t==o:function(t,o,a){var s,u;if(n(t)||n(o))return!1;if(t.prototype!==o.prototype)return!1;if(y(t))return!!y(o)&&(t=e.call(t),o=e.call(o),r(t,o,a));if(i(t)){if(!i(o))return!1;if(t.length!==o.length)return!1;for(s=0;s<t.length;s++)if(t[s]!==o[s])return!1;return!0}try{var l=m(t),c=m(o)}catch(t){return!1}if(l.length!=c.length)return!1;for(l.sort(),c.sort(),s=l.length-1;s>=0;s--)if(l[s]!=c[s])return!1;for(s=l.length-1;s>=0;s--)if(!r(t[u=l[s]],o[u],a))return!1;return typeof t==typeof o}(t,o,a))};function n(t){return null==t}function i(t){return!(!t||"object"!=typeof t||"number"!=typeof t.length)&&("function"==typeof t.copy&&"function"==typeof t.slice&&!(t.length>0&&"number"!=typeof t[0]))}}),g=s(function(t,e){!function(e){var r,n,i,o=(r=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,function(t,e,s,u){if(1!==arguments.length||"string"!==(null===(l=t)?"null":void 0===l?"undefined":"object"!=typeof l?typeof l:Array.isArray(l)?"array":{}.toString.call(l).slice(8,-1).toLowerCase())||/\d/.test(t)||(e=t,t=void 0),(t=t||new Date)instanceof Date||(t=new Date(t)),isNaN(t))throw TypeError("Invalid date");var l,c=(e=String(o.masks[e]||e||o.masks.default)).slice(0,4);"UTC:"!==c&&"GMT:"!==c||(e=e.slice(4),s=!0,"GMT:"===c&&(u=!0));var h=s?"getUTC":"get",p=t[h+"Date"](),f=t[h+"Day"](),d=t[h+"Month"](),m=t[h+"FullYear"](),y=t[h+"Hours"](),_=t[h+"Minutes"](),g=t[h+"Seconds"](),v=t[h+"Milliseconds"](),x=s?0:t.getTimezoneOffset(),b=function(t){var e=new Date(t.getFullYear(),t.getMonth(),t.getDate());e.setDate(e.getDate()-(e.getDay()+6)%7+3);var r=new Date(e.getFullYear(),0,4);r.setDate(r.getDate()-(r.getDay()+6)%7+3);var n=e.getTimezoneOffset()-r.getTimezoneOffset();return e.setHours(e.getHours()-n),1+Math.floor((e-r)/6048e5)}(t),w=function(t){var e=t.getDay();return 0===e&&(e=7),e}(t),E={d:p,dd:a(p),ddd:o.i18n.dayNames[f],dddd:o.i18n.dayNames[f+7],m:d+1,mm:a(d+1),mmm:o.i18n.monthNames[d],mmmm:o.i18n.monthNames[d+12],yy:String(m).slice(2),yyyy:m,h:y%12||12,hh:a(y%12||12),H:y,HH:a(y),M:_,MM:a(_),s:g,ss:a(g),l:a(v,3),L:a(Math.round(v/10)),t:y<12?o.i18n.timeNames[0]:o.i18n.timeNames[1],tt:y<12?o.i18n.timeNames[2]:o.i18n.timeNames[3],T:y<12?o.i18n.timeNames[4]:o.i18n.timeNames[5],TT:y<12?o.i18n.timeNames[6]:o.i18n.timeNames[7],Z:u?"GMT":s?"UTC":(String(t).match(n)||[""]).pop().replace(i,""),o:(x>0?"-":"+")+a(100*Math.floor(Math.abs(x)/60)+Math.abs(x)%60,4),S:["th","st","nd","rd"][p%10>3?0:(p%100-p%10!=10)*p%10],W:b,N:w};return e.replace(r,function(t){return t in E?E[t]:t.slice(1,t.length-1)})});function a(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t}o.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},o.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},t.exports=o}()}),v="",x=function(t,e){if("string"!=typeof t)throw new TypeError("expected a string");if(1===e)return t;if(2===e)return t+t;var r=t.length*e;if(d!==t||void 0===d)d=t,v="";else if(v.length>=r)return v.substr(0,r);for(;r>v.length&&e>1;)1&e&&(v+=t),e>>=1,t+=t;return v=(v+=t).substr(0,r)};var b,w=function(t,e,r){return t=t.toString(),void 0===e?t:(r=0===r?"0":r?r.toString():" ",x(r,e-t.length)+t)},E=function(){},A={extension:"",prefix:"",suffix:""},T=["image/png","image/jpeg","image/webp"];function M(t,e){return void 0===e&&(e={}),new Promise(function(r,n){e=o({},A,e);var i=I(Object.assign({},e,{frame:void 0})),a=t?"streamStart":"streamEnd",s=h();return s&&s.output&&"function"==typeof s[a]?s[a](o({},e,{filename:i})).then(function(t){return r(t)}):r({filename:i,client:!1})})}function S(t,e){return void 0===e&&(e={}),function(t){return new Promise(function(e){var r=t.indexOf(",");if(-1!==r){for(var n=t.slice(r+1),i=window.atob(n),o=t.slice(0,r),a=/data:([^;]+)/.exec(o),s=(a?a[1]:"")||void 0,u=new ArrayBuffer(i.length),l=new Uint8Array(u),c=0;c<i.length;c++)l[c]=i.charCodeAt(c);e(new window.Blob([u],{type:s}))}else e(new window.Blob)})}(t).then(function(t){return R(t,e)})}function R(t,e){return void 0===e&&(e={}),new Promise(function(r){var n=(e=o({},A,e)).filename,i=h();if(i&&"function"==typeof i.saveBlob&&i.output)return i.saveBlob(t,o({},e,{filename:n})).then(function(t){return r(t)});b||((b=document.createElement("a")).style.visibility="hidden",b.target="_blank"),b.download=n,b.href=window.URL.createObjectURL(t),document.body.appendChild(b),b.onclick=function(){b.onclick=E,setTimeout(function(){window.URL.revokeObjectURL(t),b.parentElement&&b.parentElement.removeChild(b),b.removeAttribute("href"),r({filename:n,client:!1})})},b.click()})}function I(t){if(void 0===t&&(t={}),"function"==typeof(t=o({},t)).file)return t.file(t);if(t.file)return t.file;var e,r=null,n="";("string"==typeof t.extension&&(n=t.extension),"number"==typeof t.frame)&&(e="number"==typeof t.totalFrames?t.totalFrames:Math.max(1e3,t.frame),r=w(String(t.frame),String(e).length,"0"));var i=isFinite(t.totalLayers)&&isFinite(t.layer)&&t.totalLayers>1?""+t.layer:"";return null!=r?[i,r].filter(Boolean).join("-")+n:[t.prefix,t.name||t.timeStamp,i,t.hash,t.suffix].filter(Boolean).join("-")+n}var C={dimension:"dimensions",animated:"animate",animating:"animate",unit:"units",P5:"p5",pixellated:"pixelated",looping:"loop",pixelPerInch:"pixels"},P=["dimensions","units","pixelsPerInch","orientation","scaleToFit","scaleToView","bleed","pixelRatio","exportPixelRatio","maxPixelRatio","scaleContext","resizeCanvas","styleCanvas","canvas","context","attributes","parent","file","name","prefix","suffix","animate","playing","loop","duration","totalFrames","fps","playbackRate","timeScale","frame","time","flush","pixelated","hotkeys","p5","id","scaleToFitPadding","data","params","encoding","encodingQuality"],D=function(t){Object.keys(t).forEach(function(t){t in C?console.warn('[canvas-sketch] Could not recognize the setting "'+t+'", did you mean "'+C[t]+'"?'):P.includes(t)||console.warn('[canvas-sketch] Could not recognize the setting "'+t+'"')})};var L=[["postcard",101.6,152.4],["poster-small",280,430],["poster",460,610],["poster-large",610,910],["business-card",50.8,88.9],["2r",64,89],["3r",89,127],["4r",102,152],["5r",127,178],["6r",152,203],["8r",203,254],["10r",254,305],["11r",279,356],["12r",305,381],["a0",841,1189],["a1",594,841],["a2",420,594],["a3",297,420],["a4",210,297],["a5",148,210],["a6",105,148],["a7",74,105],["a8",52,74],["a9",37,52],["a10",26,37],["2a0",1189,1682],["4a0",1682,2378],["b0",1e3,1414],["b1",707,1e3],["b1+",720,1020],["b2",500,707],["b2+",520,720],["b3",353,500],["b4",250,353],["b5",176,250],["b6",125,176],["b7",88,125],["b8",62,88],["b9",44,62],["b10",31,44],["b11",22,32],["b12",16,22],["c0",917,1297],["c1",648,917],["c2",458,648],["c3",324,458],["c4",229,324],["c5",162,229],["c6",114,162],["c7",81,114],["c8",57,81],["c9",40,57],["c10",28,40],["c11",22,32],["c12",16,22],["half-letter",5.5,8.5,"in"],["letter",8.5,11,"in"],["legal",8.5,14,"in"],["junior-legal",5,8,"in"],["ledger",11,17,"in"],["tabloid",11,17,"in"],["ansi-a",8.5,11,"in"],["ansi-b",11,17,"in"],["ansi-c",17,22,"in"],["ansi-d",22,34,"in"],["ansi-e",34,44,"in"],["arch-a",9,12,"in"],["arch-b",12,18,"in"],["arch-c",18,24,"in"],["arch-d",24,36,"in"],["arch-e",36,48,"in"],["arch-e1",30,42,"in"],["arch-e2",26,38,"in"],["arch-e3",27,39,"in"]].reduce(function(t,e){var r={units:e[3]||"mm",dimensions:[e[1],e[2]]};return t[e[0]]=r,t[e[0].replace(/-/g," ")]=r,t},{});function O(e,r,n,i){return void 0===r&&(r="px"),void 0===n&&(n="px"),void 0===i&&(i=72),t(e,r,n,{pixelsPerInch:i,precision:4,roundPixel:!0})}function k(t,e){var r,n,i,o,a,s,u=f(),l=e.dimensions,c=function(t){return!(!t.dimensions||"string"!=typeof t.dimensions&&!(Array.isArray(t.dimensions)&&t.dimensions.length>=2))}(e),h=t.exporting,d=!!c&&!1!==e.scaleToFit,m=!(!h&&c)||e.scaleToView;u||(d=m=!1);var y,_,g=e.units,v="number"==typeof e.pixelsPerInch&&isFinite(e.pixelsPerInch)?e.pixelsPerInch:72,x=p(e.bleed,0),b=u?window.devicePixelRatio:1,w=m?b:1;"number"==typeof e.pixelRatio&&isFinite(e.pixelRatio)?_=p(e.exportPixelRatio,y=e.pixelRatio):c?(y=w,_=p(e.exportPixelRatio,1)):_=p(e.exportPixelRatio,y=b),"number"==typeof e.maxPixelRatio&&isFinite(e.maxPixelRatio)&&(y=Math.min(e.maxPixelRatio,y)),h&&(y=_);var E,A,T=function(t,e){if(!f())return[300,150];var r=e.parent||window;if(r===window||r===document||r===document.body)return[window.innerWidth,window.innerHeight];var n=r.getBoundingClientRect();return[n.width,n.height]}(0,e),M=T[0],S=T[1];if(c){var R=function(t,e,r){if(void 0===e&&(e="px"),void 0===r&&(r=72),"string"==typeof t){var n=t.toLowerCase();if(!(n in L))throw new Error('The dimension preset "'+t+'" is not supported or could not be found; try using a4, a3, postcard, letter, etc.');var i=L[n];return i.dimensions.map(function(t){return O(t,i.units,e,r)})}return t}(l,g,v),I=Math.max(R[0],R[1]),C=Math.min(R[0],R[1]);if(e.orientation){var P="landscape"===e.orientation;r=P?I:C,n=P?C:I}else r=R[0],n=R[1];E=r,A=n,r+=2*x,n+=2*x}else E=r=M,A=n=S;var D=r,k=n;if(c&&g&&(D=O(r,g,"px",v),k=O(n,g,"px",v)),i=Math.round(D),o=Math.round(k),d&&!h&&c){var F=r/n,B=M/S,N=p(e.scaleToFitPadding,40),z=Math.round(M-2*N),U=Math.round(S-2*N);(i>z||o>U)&&(B>F?(o=U,i=Math.round(o*F)):(i=z,o=Math.round(i/F)))}return{bleed:x,pixelRatio:y,width:r,height:n,dimensions:[r,n],units:g||"px",scaleX:(a=m?Math.round(y*i):Math.round(y*D))/r,scaleY:(s=m?Math.round(y*o):Math.round(y*k))/n,viewportWidth:m?Math.round(i):Math.round(D),viewportHeight:m?Math.round(o):Math.round(k),canvasWidth:a,canvasHeight:s,trimWidth:E,trimHeight:A,styleWidth:i,styleHeight:o}}var F=function(t,e){if("string"!=typeof t)throw new TypeError("must specify type string");if(e=e||{},"undefined"==typeof document&&!e.canvas)return null;var r=e.canvas||document.createElement("canvas");"number"==typeof e.width&&(r.width=e.width);"number"==typeof e.height&&(r.height=e.height);var n,i=e;try{var o=[t];0===t.indexOf("webgl")&&o.push("experimental-"+t);for(var a=0;a<o.length;a++)if(n=r.getContext(o[a],i))return n}catch(t){n=null}return n||null};function B(t){var e,r;void 0===t&&(t={});var n=!1;if(!1!==t.canvas){if(!(e=t.context)||"string"==typeof e){var i=t.canvas;i||(i=function(){if(!f())throw new Error("It appears you are runing from Node.js or a non-browser environment. Try passing in an existing { canvas } interface instead.");return document.createElement("canvas")}(),n=!0);var a=e||"2d";if("function"!=typeof i.getContext)throw new Error("The specified { canvas } element does not have a getContext() function, maybe it is not a <canvas> tag?");if(!(e=F(a,o({},t.attributes,{canvas:i}))))throw new Error("Failed at canvas.getContext('"+a+"') - the browser may not support this context, or a different context may already be in use with this canvas.")}if(r=e.canvas,t.canvas&&r!==t.canvas)throw new Error("The { canvas } and { context } settings must point to the same underlying canvas element");t.pixelated&&(e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,e.oImageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.msImageSmoothingEnabled=!1,r.style["image-rendering"]="pixelated")}return{canvas:r,context:e,ownsCanvas:n}}var N=function(){var t=this;this._settings={},this._props={},this._sketch=void 0,this._raf=null,this._lastRedrawResult=void 0,this._isP5Resizing=!1,this._keyboardShortcuts=function(t){void 0===t&&(t={});var e=function(e){if(t.enabled()){var r=h();83!==e.keyCode||e.altKey||!e.metaKey&&!e.ctrlKey?32===e.keyCode?t.togglePlay(e):r&&!e.altKey&&75===e.keyCode&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),t.commit(e)):(e.preventDefault(),t.save(e))}};return{attach:function(){window.addEventListener("keydown",e)},detach:function(){window.removeEventListener("keydown",e)}}}({enabled:function(){return!1!==t.settings.hotkeys},save:function(e){e.shiftKey?t.props.recording?(t.endRecord(),t.run()):t.record():t.props.recording||t.exportFrame()},togglePlay:function(){t.props.playing?t.pause():t.play()},commit:function(e){t.exportFrame({commit:!0})}}),this._animateHandler=function(){return t.animate()},this._resizeHandler=function(){t.resize()&&t.render()}},z={sketch:{configurable:!0},settings:{configurable:!0},props:{configurable:!0}};z.sketch.get=function(){return this._sketch},z.settings.get=function(){return this._settings},z.props.get=function(){return this._props},N.prototype._computePlayhead=function(t,e){return"number"==typeof e&&isFinite(e)?t/e:0},N.prototype._computeFrame=function(t,e,r,n){return isFinite(r)&&r>1?Math.floor(t*(r-1)):Math.floor(n*e)},N.prototype._computeCurrentFrame=function(){return this._computeFrame(this.props.playhead,this.props.time,this.props.totalFrames,this.props.fps)},N.prototype._getSizeProps=function(){var t=this.props;return{width:t.width,height:t.height,pixelRatio:t.pixelRatio,canvasWidth:t.canvasWidth,canvasHeight:t.canvasHeight,viewportWidth:t.viewportWidth,viewportHeight:t.viewportHeight}},N.prototype.run=function(){if(!this.sketch)throw new Error("should wait until sketch is loaded before trying to play()");return!1!==this.settings.playing&&this.play(),"function"==typeof this.sketch.dispose&&console.warn("In canvas-sketch@0.0.23 the dispose() event has been renamed to unload()"),this.props.started||(this._signalBegin(),this.props.started=!0),this.tick(),this.render(),this},N.prototype.play=function(){var t=this.settings.animate;"animation"in this.settings&&(t=!0,console.warn("[canvas-sketch] { animation } has been renamed to { animate }")),t&&(f()?this.props.playing||(this.props.started||(this._signalBegin(),this.props.started=!0),this.props.playing=!0,null!=this._raf&&window.cancelAnimationFrame(this._raf),this._lastTime=u(),this._raf=window.requestAnimationFrame(this._animateHandler)):console.error("[canvas-sketch] WARN: Using { animate } in Node.js is not yet supported"))},N.prototype.pause=function(){this.props.recording&&this.endRecord(),this.props.playing=!1,null!=this._raf&&f()&&window.cancelAnimationFrame(this._raf)},N.prototype.togglePlay=function(){this.props.playing?this.pause():this.play()},N.prototype.stop=function(){this.pause(),this.props.frame=0,this.props.playhead=0,this.props.time=0,this.props.deltaTime=0,this.props.started=!1,this.render()},N.prototype.record=function(){var t=this;if(!this.props.recording)if(f()){this.stop(),this.props.playing=!0,this.props.recording=!0;var e=this._createExportOptions({sequence:!0}),r=1/this.props.fps;null!=this._raf&&window.cancelAnimationFrame(this._raf);var n,i=function(){return t.props.recording?(t.props.deltaTime=r,t.tick(),t.exportFrame(e).then(function(){t.props.recording&&(t.props.deltaTime=0,t.props.frame++,t.props.frame<t.props.totalFrames?(t.props.time+=r,t.props.playhead=t._computePlayhead(t.props.time,t.props.duration),t._raf=window.requestAnimationFrame(i)):(console.log("Finished recording"),t._signalEnd(),t.endRecord(),t.stop(),t.run()))})):Promise.resolve()};this.props.started||(this._signalBegin(),this.props.started=!0),(n=e,void 0===n&&(n={}),M(!0,n)).catch(function(t){console.error(t)}).then(function(e){t._raf=window.requestAnimationFrame(i)})}else console.error("[canvas-sketch] WARN: Recording from Node.js is not yet supported")},N.prototype._signalBegin=function(){var t=this;this.sketch&&"function"==typeof this.sketch.begin&&this._wrapContextScale(function(e){return t.sketch.begin(e)})},N.prototype._signalEnd=function(){var t=this;this.sketch&&"function"==typeof this.sketch.end&&this._wrapContextScale(function(e){return t.sketch.end(e)})},N.prototype.endRecord=function(){var t;null!=this._raf&&f()&&window.cancelAnimationFrame(this._raf),this.props.recording=!1,this.props.deltaTime=0,this.props.playing=!1,(void 0===t&&(t={}),M(!1,t)).catch(function(t){console.error(t)})},N.prototype._createExportOptions=function(t){return void 0===t&&(t={}),{sequence:t.sequence,save:t.save,fps:this.props.fps,frame:t.sequence?this.props.frame:void 0,file:this.settings.file,name:this.settings.name,prefix:this.settings.prefix,suffix:this.settings.suffix,encoding:this.settings.encoding,encodingQuality:this.settings.encodingQuality,timeStamp:t.timeStamp||g(new Date,"yyyy.mm.dd-HH.MM.ss"),totalFrames:isFinite(this.props.totalFrames)?Math.max(100,this.props.totalFrames):1e3}},N.prototype.exportFrame=function(t){var e=this;if(void 0===t&&(t={}),!this.sketch)return Promise.all([]);"function"==typeof this.sketch.preExport&&this.sketch.preExport();var r=this._createExportOptions(t),n=h(),i=Promise.resolve();if(n&&t.commit&&"function"==typeof n.commit){var a=o({},r),s=n.commit(a);i=l(s)?s:Promise.resolve(s)}return i.then(function(t){return e._doExportFrame(o({},r,{hash:t||""}))}).then(function(t){return 1===t.length?t[0]:t})},N.prototype._doExportFrame=function(t){var e=this;void 0===t&&(t={}),this._props.exporting=!0,this.resize();var r=this.render();return void 0===r&&(r=[this.props.canvas]),r=(r=[].concat(r).filter(Boolean)).map(function(e){var r,n="object"==typeof e&&e&&("data"in e||"dataURL"in e),i=n?e.data:e,a=n?o({},e,{data:i}):{data:i};if(c(r=i)&&/canvas/i.test(r.nodeName)&&"function"==typeof r.getContext){var s=function(t,e){void 0===e&&(e={});var r=e.encoding||"image/png";if(!T.includes(r))throw new Error("Invalid canvas encoding "+r);var n=(r.split("/")[1]||"").replace(/jpeg/i,"jpg");return n&&(n=("."+n).toLowerCase()),{extension:n,type:r,dataURL:t.toDataURL(r,e.encodingQuality)}}(i,{encoding:a.encoding||t.encoding,encodingQuality:p(a.encodingQuality,t.encodingQuality,.95)});return Object.assign(a,{dataURL:s.dataURL,extension:s.extension,type:s.type})}return a}),this._props.exporting=!1,this.resize(),this.render(),Promise.all(r.map(function(e,r,n){var i=o({extension:"",prefix:"",suffix:""},t,e,{layer:r,totalLayers:n.length}),a=!1!==t.save&&e.save;for(var s in i.save=!1!==a,i.filename=I(i),delete i.encoding,delete i.encodingQuality,i)void 0===i[s]&&delete i[s];var u=Promise.resolve({});if(i.save){var l=i.data;if(i.dataURL)u=S(i.dataURL,i);else u=function(t,e){void 0===e&&(e={});var r=Array.isArray(t)?t:[t];return R(new window.Blob(r,{type:e.type||""}),e)}(l,i)}return u.then(function(t){return Object.assign({},i,t)})})).then(function(r){var n=r.filter(function(t){return t.save});if(n.length>0){var i,o=n.find(function(t){return t.outputName}),a=n.some(function(t){return t.client}),s=n.some(function(t){return t.stream});i=n.length>1?n.length:o?o.outputName+"/"+n[0].filename:""+n[0].filename;var u="";if(t.sequence)u=isFinite(e.props.totalFrames)?" (frame "+(t.frame+1)+" / "+e.props.totalFrames+")":" (frame "+t.frame+")";else n.length>1&&(u=" files");console.log("%c["+(a?"canvas-sketch-cli":"canvas-sketch")+"]%c "+(s?"Streaming into":"Exported")+" %c"+i+"%c"+u,"color: #8e8e8e;","color: initial;","font-weight: bold;","font-weight: initial;")}return"function"==typeof e.sketch.postExport&&e.sketch.postExport(),r})},N.prototype._wrapContextScale=function(t){this._preRender(),t(this.props),this._postRender()},N.prototype._preRender=function(){var t=this.props;this.props.gl||!t.context||t.p5?t.p5&&t.p5.scale(t.scaleX/t.pixelRatio,t.scaleY/t.pixelRatio):(t.context.save(),!1!==this.settings.scaleContext&&t.context.scale(t.scaleX,t.scaleY))},N.prototype._postRender=function(){var t=this.props;this.props.gl||!t.context||t.p5||t.context.restore(),t.gl&&!1!==this.settings.flush&&!t.p5&&t.gl.flush()},N.prototype.tick=function(){this.sketch&&"function"==typeof this.sketch.tick&&(this._preRender(),this.sketch.tick(this.props),this._postRender())},N.prototype.render=function(){return this.props.p5?(this._lastRedrawResult=void 0,this.props.p5.redraw(),this._lastRedrawResult):this.submitDrawCall()},N.prototype.submitDrawCall=function(){if(this.sketch){var t,e=this.props;return this._preRender(),"function"==typeof this.sketch?t=this.sketch(e):"function"==typeof this.sketch.render&&(t=this.sketch.render(e)),this._postRender(),t}},N.prototype.update=function(t){var e=this;void 0===t&&(t={});var r=["animate"];Object.keys(t).forEach(function(t){if(r.indexOf(t)>=0)throw new Error("Sorry, the { "+t+" } option is not yet supported with update().")});var n=this._settings.canvas,i=this._settings.context;for(var o in t){var a=t[o];void 0!==a&&(e._settings[o]=a)}var s=Object.assign({},this._settings,t);if("time"in t&&"frame"in t)throw new Error("You should specify { time } or { frame } but not both");if("time"in t?delete s.frame:"frame"in t&&delete s.time,"duration"in t&&"totalFrames"in t)throw new Error("You should specify { duration } or { totalFrames } but not both");"duration"in t?delete s.totalFrames:"totalFrames"in t&&delete s.duration,"data"in t&&(this._props.data=t.data);var u=this.getTimeProps(s);if(Object.assign(this._props,u),n!==this._settings.canvas||i!==this._settings.context){var l=B(this._settings),c=l.context;this.props.canvas=l.canvas,this.props.context=c,this._setupGLKey(),this._appendCanvasIfNeeded()}return t.p5&&"function"!=typeof t.p5&&(this.props.p5=t.p5,this.props.p5.draw=function(){e._isP5Resizing||(e._lastRedrawResult=e.submitDrawCall())}),"playing"in t&&(t.playing?this.play():this.pause()),D(this._settings),this.resize(),this.render(),this.props},N.prototype.resize=function(){var t=this._getSizeProps(),e=this.settings,r=this.props,n=k(r,e);Object.assign(this._props,n);var i=this.props,o=i.pixelRatio,a=i.canvasWidth,s=i.canvasHeight,u=i.styleWidth,l=i.styleHeight,c=this.props.canvas;c&&!1!==e.resizeCanvas&&(r.p5?c.width===a&&c.height===s||(this._isP5Resizing=!0,r.p5.pixelDensity(o),r.p5.resizeCanvas(a/o,s/o,!1),this._isP5Resizing=!1):(c.width!==a&&(c.width=a),c.height!==s&&(c.height=s)),f()&&!1!==e.styleCanvas&&(c.style.width=u+"px",c.style.height=l+"px"));var h=this._getSizeProps(),p=!_(t,h);return p&&this._sizeChanged(),p},N.prototype._sizeChanged=function(){this.sketch&&"function"==typeof this.sketch.resize&&this.sketch.resize(this.props)},N.prototype.animate=function(){if(this.props.playing)if(f()){this._raf=window.requestAnimationFrame(this._animateHandler);var t=u(),e=1e3/this.props.fps,r=t-this._lastTime,n=this.props.duration,i="number"==typeof n&&isFinite(n),o=!0,a=this.settings.playbackRate;"fixed"===a?r=e:"throttle"===a?r>e?this._lastTime=t-=r%e:o=!1:this._lastTime=t;var s=r/1e3,l=this.props.time+s*this.props.timeScale;l<0&&i&&(l=n+l);var c=!1,h=!1;if(i&&l>=n&&(!1!==this.settings.loop?(o=!0,l%=n,h=!0):(o=!1,l=n,c=!0),this._signalEnd()),o){this.props.deltaTime=s,this.props.time=l,this.props.playhead=this._computePlayhead(l,n);var p=this.props.frame;this.props.frame=this._computeCurrentFrame(),h&&this._signalBegin(),p!==this.props.frame&&this.tick(),this.render(),this.props.deltaTime=0}c&&this.pause()}else console.error("[canvas-sketch] WARN: Animation in Node.js is not yet supported")},N.prototype.dispatch=function(t){if("function"!=typeof t)throw new Error("must pass function into dispatch()");t(this.props),this.render()},N.prototype.mount=function(){this._appendCanvasIfNeeded()},N.prototype.unmount=function(){f()&&(window.removeEventListener("resize",this._resizeHandler),this._keyboardShortcuts.detach()),this.props.canvas.parentElement&&this.props.canvas.parentElement.removeChild(this.props.canvas)},N.prototype._appendCanvasIfNeeded=function(){f()&&(!1!==this.settings.parent&&this.props.canvas&&!this.props.canvas.parentElement&&(this.settings.parent||document.body).appendChild(this.props.canvas))},N.prototype._setupGLKey=function(){var t;this.props.context&&("function"==typeof(t=this.props.context).clear&&"function"==typeof t.clearColor&&"function"==typeof t.bufferData?this._props.gl=this.props.context:delete this._props.gl)},N.prototype.getTimeProps=function(t){void 0===t&&(t={});var e=t.duration,r=t.totalFrames,n=p(t.timeScale,1),i=p(t.fps,24),o="number"==typeof e&&isFinite(e),a="number"==typeof r&&isFinite(r),s=o?Math.floor(i*e):void 0,u=a?r/i:void 0;if(o&&a&&s!==r)throw new Error("You should specify either duration or totalFrames, but not both. Or, they must match exactly.");void 0===t.dimensions&&void 0!==t.units&&console.warn("You've specified a { units } setting but no { dimension }, so the units will be ignored."),r=p(r,s,Infinity),e=p(e,u,Infinity);var l=t.time,c=t.frame,h="number"==typeof l&&isFinite(l),f="number"==typeof c&&isFinite(c),d=0,m=0,y=0;if(h&&f)throw new Error("You should specify either start frame or time, but not both.");return h?(y=this._computePlayhead(d=l,e),m=this._computeFrame(y,d,r,i)):f&&(y=this._computePlayhead(d=(m=c)/i,e)),{playhead:y,time:d,frame:m,duration:e,totalFrames:r,fps:i,timeScale:n}},N.prototype.setup=function(t){var e=this;if(void 0===t&&(t={}),this.sketch)throw new Error("Multiple setup() calls not yet supported.");this._settings=Object.assign({},t,this._settings),D(this._settings);var r=B(this._settings),n=r.context,i=r.canvas,o=this.getTimeProps(this._settings);this._props=Object.assign({},o,{canvas:i,context:n,deltaTime:0,started:!1,exporting:!1,playing:!1,recording:!1,settings:this.settings,data:this.settings.data,render:function(){return e.render()},togglePlay:function(){return e.togglePlay()},dispatch:function(t){return e.dispatch(t)},tick:function(){return e.tick()},resize:function(){return e.resize()},update:function(t){return e.update(t)},exportFrame:function(t){return e.exportFrame(t)},record:function(){return e.record()},play:function(){return e.play()},pause:function(){return e.pause()},stop:function(){return e.stop()}}),this._setupGLKey(),this.resize()},N.prototype.loadAndRun=function(t,e){var r=this;return this.load(t,e).then(function(){return r.run(),r})},N.prototype.unload=function(){var t=this;this.pause(),this.sketch&&("function"==typeof this.sketch.unload&&this._wrapContextScale(function(e){return t.sketch.unload(e)}),this._sketch=null)},N.prototype.destroy=function(){this.unload(),this.unmount()},N.prototype.load=function(t,e){var r=this;if("function"!=typeof t)throw new Error("The function must take in a function as the first parameter. Example:\n  canvasSketcher(() => { ... }, settings)");this.sketch&&this.unload(),void 0!==e&&this.update(e),this._preRender();var n=Promise.resolve();if(this.settings.p5){if(!f())throw new Error("[canvas-sketch] ERROR: Using p5.js in Node.js is not supported");n=new Promise(function(t){var e,n=r.settings.p5;n.p5&&(e=n.preload,n=n.p5);var i=function(n){e&&(n.preload=function(){return e(n)}),n.setup=function(){var e=r.props,i="webgl"===r.settings.context,o=i?n.WEBGL:n.P2D;n.noLoop(),n.pixelDensity(e.pixelRatio),n.createCanvas(e.viewportWidth,e.viewportHeight,o),i&&r.settings.attributes&&n.setAttributes(r.settings.attributes),r.update({p5:n,canvas:n.canvas,context:n._renderer.drawingContext}),t()}};if("function"==typeof n)new n(i);else{if("function"!=typeof window.createCanvas)throw new Error("{ p5 } setting is passed but can't find p5.js in global (window) scope. Maybe you did not create it globally?\nnew p5(); // <-- attaches to global scope");i(window)}})}return n.then(function(){var e=t(r.props);return l(e)||(e=Promise.resolve(e)),e}).then(function(t){return t||(t={}),r._sketch=t,f()&&(r._keyboardShortcuts.attach(),window.addEventListener("resize",r._resizeHandler)),r._postRender(),r._sizeChanged(),r}).catch(function(t){throw console.warn("Could not start sketch, the async loading function rejected with an error:\n    Error: "+t.message),t})},Object.defineProperties(N.prototype,z);var U="hot-id-cache",V=[];function j(t,e){if(void 0===e&&(e={}),e.p5){if(e.canvas||e.context&&"string"!=typeof e.context)throw new Error('In { p5 } mode, you can\'t pass your own canvas or context, unless the context is a "webgl" or "2d" string');e=Object.assign({},e,{canvas:!1,context:"string"==typeof e.context&&e.context})}var r,n,i=(r=h())&&r.hot;i&&(n=p(e.id,"$__DEFAULT_CANVAS_SKETCH_ID__$"));var o=i&&"string"==typeof n;o&&V.includes(n)&&(console.warn("Warning: You have multiple calls to canvasSketch() in --hot mode. You must pass unique { id } strings in settings to enable hot reload across multiple sketches. ",n),o=!1);var a=Promise.resolve();if(o){V.push(n);var s=function(t){var e=h();if(e)return e[U]=e[U]||{},e[U][t]}(n);if(s){var u=function(){var t,r=(t=s.manager,e.animate?{time:t.props.time}:void 0);return s.manager.destroy(),r};a=s.load.then(u).catch(u)}}return a.then(function(r){var i,a,s,u,l=new N;return t?(e=Object.assign({},e,r),l.setup(e),l.mount(),i=l.loadAndRun(t)):i=Promise.resolve(l),o&&(a=n,s={load:i,manager:l},(u=h())&&(u[U]=u[U]||{},u[U][a]=s)),i})}return j.canvasSketch=j,j.PaperSizes=L,j})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"convert-length":15}],14:[function(t,e,r){(function(t){var r=function(){"use strict";function e(r,i,o,a){"object"==typeof i&&(o=i.depth,a=i.prototype,i.filter,i=i.circular);var s=[],u=[],l=void 0!==t;return void 0===i&&(i=!0),void 0===o&&(o=Infinity),function r(o,c){if(null===o)return null;if(0==c)return o;var h,p;if("object"!=typeof o)return o;if(e.__isArray(o))h=[];else if(e.__isRegExp(o))h=new RegExp(o.source,n(o)),o.lastIndex&&(h.lastIndex=o.lastIndex);else if(e.__isDate(o))h=new Date(o.getTime());else{if(l&&t.isBuffer(o))return h=t.allocUnsafe?t.allocUnsafe(o.length):new t(o.length),o.copy(h),h;void 0===a?(p=Object.getPrototypeOf(o),h=Object.create(p)):(h=Object.create(a),p=a)}if(i){var f=s.indexOf(o);if(-1!=f)return u[f];s.push(o),u.push(h)}for(var d in o){var m;p&&(m=Object.getOwnPropertyDescriptor(p,d)),m&&null==m.set||(h[d]=r(o[d],c-1))}return h}(r,o)}function r(t){return Object.prototype.toString.call(t)}function n(t){var e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),e}return e.clonePrototype=function(t){if(null===t)return null;var e=function(){};return e.prototype=t,new e},e.__objToStr=r,e.__isDate=function(t){return"object"==typeof t&&"[object Date]"===r(t)},e.__isArray=function(t){return"object"==typeof t&&"[object Array]"===r(t)},e.__isRegExp=function(t){return"object"==typeof t&&"[object RegExp]"===r(t)},e.__getRegExpFlags=n,e}();"object"==typeof e&&e.exports&&(e.exports=r)}).call(this,t("buffer").Buffer)},{buffer:10}],15:[function(t,e,r){var n=t("defined"),i=["mm","cm","m","pc","pt","in","ft","px"],o={m:{system:"metric",factor:1},cm:{system:"metric",factor:.01},mm:{system:"metric",factor:.001},pt:{system:"imperial",factor:1/72},pc:{system:"imperial",factor:1/6},in:{system:"imperial",factor:1},ft:{system:"imperial",factor:12}};const a={metric:{unit:"m",ratio:1/.0254},imperial:{unit:"in",ratio:.0254}};e.exports=function(t,e,r,s){if("number"!=typeof t||!isFinite(t))throw new Error("Value must be a finite number");if(!e||!r)throw new Error("Must specify from and to units");var u=n((s=s||{}).pixelsPerInch,96),l=s.precision,c=!1!==s.roundPixel;if(e=e.toLowerCase(),r=r.toLowerCase(),-1===i.indexOf(e))throw new Error('Invalid from unit "'+e+'", must be one of: '+i.join(", "));if(-1===i.indexOf(r))throw new Error('Invalid from unit "'+r+'", must be one of: '+i.join(", "));if(e===r)return t;var h=1,p=1,f=!1;"px"===e&&(p=1/u,e="in"),"px"===r&&(f=!0,h=u,r="in");var d=o[e],m=o[r],y=t*d.factor*p;d.system!==m.system&&(y*=a[d.system].ratio);var _=y/m.factor*h;return f&&c?_=Math.round(_):"number"==typeof l&&isFinite(l)&&(_=function(t,e){return Number(Math.round(t+"e"+e)+"e-"+e)}(_,l)),_},e.exports.units=i},{defined:21}],16:[function(t,e,r){"use strict";e.exports=function(t,e,r,n,i,o){var a=i-1,s=i*i,u=a*a,l=(1+2*i)*u,c=i*u,h=s*(3-2*i),p=s*a;if(t.length){o||(o=new Array(t.length));for(var f=t.length-1;f>=0;--f)o[f]=l*t[f]+c*e[f]+h*r[f]+p*n[f];return o}return l*t+c*e+h*r+p*n},e.exports.derivative=function(t,e,r,n,i,o){var a=6*i*i-6*i,s=3*i*i-4*i+1,u=-6*i*i+6*i,l=3*i*i-2*i;if(t.length){o||(o=new Array(t.length));for(var c=t.length-1;c>=0;--c)o[c]=a*t[c]+s*e[c]+u*r[c]+l*n[c];return o}return a*t+s*e+u*r[c]+l*n}},{}],17:[function(t,e,r){e.exports=t("./vendor/dat.gui"),e.exports.color=t("./vendor/dat.color")},{"./vendor/dat.color":18,"./vendor/dat.gui":19}],18:[function(t,e,r){var n,i,o,a,s=e.exports=s||{};s.color=s.color||{},s.utils=s.utils||{},s.utils.common=(n=Array.prototype.forEach,i=Array.prototype.slice,{BREAK:{},extend:function(t){return this.each(i.call(arguments,1),function(e){for(var r in e)this.isUndefined(e[r])||(t[r]=e[r])},this),t},defaults:function(t){return this.each(i.call(arguments,1),function(e){for(var r in e)this.isUndefined(t[r])&&(t[r]=e[r])},this),t},compose:function(){var t=i.call(arguments);return function(){for(var e=i.call(arguments),r=t.length-1;r>=0;r--)e=[t[r].apply(this,e)];return e[0]}},each:function(t,e,r){if(n&&t.forEach===n)t.forEach(e,r);else if(t.length===t.length+0){for(var i=0,o=t.length;i<o;i++)if(i in t&&e.call(r,t[i],i)===this.BREAK)return}else for(var i in t)if(e.call(r,t[i],i)===this.BREAK)return},defer:function(t){setTimeout(t,0)},toArray:function(t){return t.toArray?t.toArray():i.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){return t!=t},isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)}}),s.color.toString=(o=s.utils.common,function(t){if(1==t.a||o.isUndefined(t.a)){for(var e=t.hex.toString(16);e.length<6;)e="0"+e;return"#"+e}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}),s.Color=s.color.Color=function(t,e,r,n){var i=function(){if(this.__state=t.apply(this,arguments),!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};function o(t,e,r){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space?this.__state[e]:(s(this,e,r),this.__state[e])},set:function(t){"RGB"!==this.__state.space&&(s(this,e,r),this.__state.space="RGB"),this.__state[e]=t}})}function a(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space?this.__state[e]:(u(this),this.__state[e])},set:function(t){"HSV"!==this.__state.space&&(u(this),this.__state.space="HSV"),this.__state[e]=t}})}function s(t,r,i){if("HEX"===t.__state.space)t.__state[r]=e.component_from_hex(t.__state.hex,i);else{if("HSV"!==t.__state.space)throw"Corrupted color state";n.extend(t.__state,e.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}}function u(t){var r=e.rgb_to_hsv(t.r,t.g,t.b);n.extend(t.__state,{s:r.s,v:r.v}),n.isNaN(r.h)?n.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=r.h}return i.COMPONENTS=["r","g","b","h","s","v","hex","a"],n.extend(i.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),o(i.prototype,"r",2),o(i.prototype,"g",1),o(i.prototype,"b",0),a(i.prototype,"h"),a(i.prototype,"s"),a(i.prototype,"v"),Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(i.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=e.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}}),i}(s.color.interpret=function(t,e){var r,n,i=[{litmus:e.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString())}},write:t},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString())}},write:t},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:e.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:e.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3==t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4==t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:e.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(e.isNumber(t.r)&&e.isNumber(t.g)&&e.isNumber(t.b)&&e.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(e.isNumber(t.r)&&e.isNumber(t.g)&&e.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(e.isNumber(t.h)&&e.isNumber(t.s)&&e.isNumber(t.v)&&e.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(e.isNumber(t.h)&&e.isNumber(t.s)&&e.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}];return function(){n=!1;var t=arguments.length>1?e.toArray(arguments):arguments[0];return e.each(i,function(i){if(i.litmus(t))return e.each(i.conversions,function(i,o){if(r=i.read(t),!1===n&&!1!==r)return n=r,r.conversionName=o,r.conversion=i,e.BREAK}),e.BREAK}),n}}(s.color.toString,s.utils.common),s.color.math={hsv_to_rgb:function(t,e,r){var n=Math.floor(t/60)%6,i=t/60-Math.floor(t/60),o=r*(1-e),a=r*(1-i*e),s=r*(1-(1-i)*e),u=[[r,s,o],[a,r,o],[o,r,s],[o,a,r],[s,o,r],[r,o,a]][n];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(t,e,r){var n,i=Math.min(t,e,r),o=Math.max(t,e,r),a=o-i;return 0==o?{h:NaN,s:0,v:0}:(n=t==o?(e-r)/a:e==o?2+(r-t)/a:4+(t-e)/a,(n/=6)<0&&(n+=1),{h:360*n,s:a/o,v:o/255})},rgb_to_hex:function(t,e,r){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,r)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,r){return r<<(a=8*e)|t&~(255<<a)}},s.color.toString,s.utils.common)},{}],19:[function(t,e,r){var n,i,o,a,s,u=e.exports=u||{};u.gui=u.gui||{},u.utils=u.utils||{},u.controllers=u.controllers||{},u.dom=u.dom||{},u.color=u.color||{},u.utils.css={load:function(t,e){var r=(e=e||document).createElement("link");r.type="text/css",r.rel="stylesheet",r.href=t,e.getElementsByTagName("head")[0].appendChild(r)},inject:function(t,e){e=e||document;var r=document.createElement("style");r.type="text/css",r.innerHTML=t,e.getElementsByTagName("head")[0].appendChild(r)}},u.utils.common=(n=Array.prototype.forEach,i=Array.prototype.slice,{BREAK:{},extend:function(t){return this.each(i.call(arguments,1),function(e){for(var r in e)this.isUndefined(e[r])||(t[r]=e[r])},this),t},defaults:function(t){return this.each(i.call(arguments,1),function(e){for(var r in e)this.isUndefined(t[r])&&(t[r]=e[r])},this),t},compose:function(){var t=i.call(arguments);return function(){for(var e=i.call(arguments),r=t.length-1;r>=0;r--)e=[t[r].apply(this,e)];return e[0]}},each:function(t,e,r){if(n&&t.forEach===n)t.forEach(e,r);else if(t.length===t.length+0){for(var i=0,o=t.length;i<o;i++)if(i in t&&e.call(r,t[i],i)===this.BREAK)return}else for(var i in t)if(e.call(r,t[i],i)===this.BREAK)return},defer:function(t){setTimeout(t,0)},toArray:function(t){return t.toArray?t.toArray():i.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){return t!=t},isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)}}),u.controllers.Controller=(u.utils.common.extend((o=function(t,e){this.initialValue=t[e],this.domElement=document.createElement("div"),this.object=t,this.property=e,this.__onChange=void 0,this.__onFinishChange=void 0}).prototype,{onChange:function(t){return this.__onChange=t,this},onFinishChange:function(t){return this.__onFinishChange=t,this},setValue:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this},getValue:function(){return this.object[this.property]},updateDisplay:function(){return this},isModified:function(){return this.initialValue!==this.getValue()}}),o),u.dom.dom=function(t){var e={};t.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},function(r,n){t.each(r,function(t){e[t]=n})});var r=/(\d+(\.\d+)?)px/;function n(e){if("0"===e||t.isUndefined(e))return 0;var n=e.match(r);return t.isNull(n)?0:parseFloat(n[1])}var i={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(e,r,n){t.isUndefined(r)&&(r=!0),t.isUndefined(n)&&(n=!0),e.style.position="absolute",r&&(e.style.left=0,e.style.right=0),n&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(r,n,i,o){i=i||{};var a=e[n];if(!a)throw new Error("Event type "+n+" not supported.");var s=document.createEvent(a);switch(a){case"MouseEvents":s.initMouseEvent(n,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,i.x||i.clientX||0,i.y||i.clientY||0,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var u=s.initKeyboardEvent||s.initKeyEvent;t.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),u(n,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(n,i.bubbles||!1,i.cancelable||!0)}t.defaults(s,o),r.dispatchEvent(s)},bind:function(t,e,r,n){return n=n||!1,t.addEventListener?t.addEventListener(e,r,n):t.attachEvent&&t.attachEvent("on"+e,r),i},unbind:function(t,e,r,n){return n=n||!1,t.removeEventListener?t.removeEventListener(e,r,n):t.detachEvent&&t.detachEvent("on"+e,r),i},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var r=t.className.split(/ +/);-1==r.indexOf(e)&&(r.push(e),t.className=r.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return i},removeClass:function(t,e){if(e)if(void 0===t.className);else if(t.className===e)t.removeAttribute("class");else{var r=t.className.split(/ +/),n=r.indexOf(e);-1!=n&&(r.splice(n,1),t.className=r.join(" "))}else t.className=void 0;return i},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return n(e["border-left-width"])+n(e["border-right-width"])+n(e["padding-left"])+n(e["padding-right"])+n(e.width)},getHeight:function(t){var e=getComputedStyle(t);return n(e["border-top-width"])+n(e["border-bottom-width"])+n(e["padding-top"])+n(e["padding-bottom"])+n(e.height)},getOffset:function(t){var e={left:0,top:0};if(t.offsetParent)do{e.left+=t.offsetLeft,e.top+=t.offsetTop}while(t=t.offsetParent);return e},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}};return i}(u.utils.common),u.controllers.OptionController=function(t,e,r){var n=function(t,i,o){n.superclass.call(this,t,i);var a=this;if(this.__select=document.createElement("select"),r.isArray(o)){var s={};r.each(o,function(t){s[t]=t}),o=s}r.each(o,function(t,e){var r=document.createElement("option");r.innerHTML=e,r.setAttribute("value",t),a.__select.appendChild(r)}),this.updateDisplay(),e.bind(this.__select,"change",function(){a.setValue(this.options[this.selectedIndex].value)}),this.domElement.appendChild(this.__select)};return n.superclass=t,r.extend(n.prototype,t.prototype,{setValue:function(t){var e=n.superclass.prototype.setValue.call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),e},updateDisplay:function(){return this.__select.value=this.getValue(),n.superclass.prototype.updateDisplay.call(this)}}),n}(u.controllers.Controller,u.dom.dom,u.utils.common),u.controllers.NumberController=function(t,e){var r=function(t,n,i){var o;r.superclass.call(this,t,n),this.__min=(i=i||{}).min,this.__max=i.max,this.__step=i.step,this.__impliedStep=e.isUndefined(this.__step)?0==this.initialValue?1:Math.pow(10,Math.floor(Math.log(this.initialValue)/Math.LN10))/10:this.__step,this.__precision=(o=(o=this.__impliedStep).toString()).indexOf(".")>-1?o.length-o.indexOf(".")-1:0};return r.superclass=t,e.extend(r.prototype,t.prototype,{setValue:function(t){return void 0!==this.__min&&t<this.__min?t=this.__min:void 0!==this.__max&&t>this.__max&&(t=this.__max),void 0!==this.__step&&t%this.__step!=0&&(t=Math.round(t/this.__step)*this.__step),r.superclass.prototype.setValue.call(this,t)},min:function(t){return this.__min=t,this},max:function(t){return this.__max=t,this},step:function(t){return this.__step=t,this}}),r}(u.controllers.Controller,u.utils.common),u.controllers.NumberControllerBox=function(t,e,r){var n=function(t,i,o){this.__truncationSuspended=!1,n.superclass.call(this,t,i,o);var a,s=this;function u(){var t=parseFloat(s.__input.value);r.isNaN(t)||s.setValue(t)}function l(t){var e=a-t.clientY;s.setValue(s.getValue()+e*s.__impliedStep),a=t.clientY}function c(){e.unbind(window,"mousemove",l),e.unbind(window,"mouseup",c)}this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),e.bind(this.__input,"change",u),e.bind(this.__input,"blur",function(){u(),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}),e.bind(this.__input,"mousedown",function(t){e.bind(window,"mousemove",l),e.bind(window,"mouseup",c),a=t.clientY}),e.bind(this.__input,"keydown",function(t){13===t.keyCode&&(s.__truncationSuspended=!0,this.blur(),s.__truncationSuspended=!1)}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return n.superclass=t,r.extend(n.prototype,t.prototype,{updateDisplay:function(){var t,e;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),e=Math.pow(10,this.__precision),Math.round(t*e)/e),n.superclass.prototype.updateDisplay.call(this)}}),n}(u.controllers.NumberController,u.dom.dom,u.utils.common),u.controllers.NumberControllerSlider=function(t,e,r,n,i){var o=function(t,r,n,i,a){o.superclass.call(this,t,r,{min:n,max:i,step:a});var s=this;function u(t){t.preventDefault();var r,n,i=e.getOffset(s.__background),o=e.getWidth(s.__background);return s.setValue((n=s.__min)+(t.clientX-(r=i.left))/(i.left+o-r)*(s.__max-n)),!1}function l(){e.unbind(window,"mousemove",u),e.unbind(window,"mouseup",l),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}this.__background=document.createElement("div"),this.__foreground=document.createElement("div"),e.bind(this.__background,"mousedown",function(t){e.bind(window,"mousemove",u),e.bind(window,"mouseup",l),u(t)}),e.addClass(this.__background,"slider"),e.addClass(this.__foreground,"slider-fg"),this.updateDisplay(),this.__background.appendChild(this.__foreground),this.domElement.appendChild(this.__background)};return o.superclass=t,o.useDefaultStyles=function(){r.inject(".slider {\n  box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);\n  height: 1em;\n  border-radius: 1em;\n  background-color: #eee;\n  padding: 0 0.5em;\n  overflow: hidden;\n}\n\n.slider-fg {\n  padding: 1px 0 2px 0;\n  background-color: #aaa;\n  height: 1em;\n  margin-left: -0.5em;\n  padding-right: 0.5em;\n  border-radius: 1em 0 0 1em;\n}\n\n.slider-fg:after {\n  display: inline-block;\n  border-radius: 1em;\n  background-color: #fff;\n  border:  1px solid #aaa;\n  content: '';\n  float: right;\n  margin-right: -1em;\n  margin-top: -1px;\n  height: 0.9em;\n  width: 0.9em;\n}")},n.extend(o.prototype,t.prototype,{updateDisplay:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",o.superclass.prototype.updateDisplay.call(this)}}),o}(u.controllers.NumberController,u.dom.dom,u.utils.css,u.utils.common),u.controllers.FunctionController=function(t,e,r){var n=function(t,r,i){n.superclass.call(this,t,r);var o=this;this.__button=document.createElement("div"),this.__button.innerHTML=void 0===i?"Fire":i,e.bind(this.__button,"click",function(t){return t.preventDefault(),o.fire(),!1}),e.addClass(this.__button,"button"),this.domElement.appendChild(this.__button)};return n.superclass=t,r.extend(n.prototype,t.prototype,{fire:function(){this.__onChange&&this.__onChange.call(this),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.getValue().call(this.object)}}),n}(u.controllers.Controller,u.dom.dom,u.utils.common),u.controllers.BooleanController=function(t,e,r){var n=function(t,r){n.superclass.call(this,t,r);var i=this;this.__prev=this.getValue(),this.__checkbox=document.createElement("input"),this.__checkbox.setAttribute("type","checkbox"),e.bind(this.__checkbox,"change",function(){i.setValue(!i.__prev)},!1),this.domElement.appendChild(this.__checkbox),this.updateDisplay()};return n.superclass=t,r.extend(n.prototype,t.prototype,{setValue:function(t){var e=n.superclass.prototype.setValue.call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),e},updateDisplay:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0):this.__checkbox.checked=!1,n.superclass.prototype.updateDisplay.call(this)}}),n}(u.controllers.Controller,u.dom.dom,u.utils.common),u.color.toString=(a=u.utils.common,function(t){if(1==t.a||a.isUndefined(t.a)){for(var e=t.hex.toString(16);e.length<6;)e="0"+e;return"#"+e}return"rgba("+Math.round(t.r)+","+Math.round(t.g)+","+Math.round(t.b)+","+t.a+")"}),u.color.interpret=function(t,e){var r,n,i=[{litmus:e.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString())}},write:t},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString())}},write:t},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:t},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\,\s*(.+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:t}}},{litmus:e.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:e.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3==t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4==t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:e.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(e.isNumber(t.r)&&e.isNumber(t.g)&&e.isNumber(t.b)&&e.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(e.isNumber(t.r)&&e.isNumber(t.g)&&e.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(e.isNumber(t.h)&&e.isNumber(t.s)&&e.isNumber(t.v)&&e.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(e.isNumber(t.h)&&e.isNumber(t.s)&&e.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}];return function(){n=!1;var t=arguments.length>1?e.toArray(arguments):arguments[0];return e.each(i,function(i){if(i.litmus(t))return e.each(i.conversions,function(i,o){if(r=i.read(t),!1===n&&!1!==r)return n=r,r.conversionName=o,r.conversion=i,e.BREAK}),e.BREAK}),n}}(u.color.toString,u.utils.common),u.GUI=u.gui.GUI=function(t,e,r,n,i,o,a,s,u,l,c,h,p,f,d){t.inject(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity 0.1s linear;-o-transition:opacity 0.1s linear;-moz-transition:opacity 0.1s linear;transition:opacity 0.1s linear;border:0;position:absolute;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-x:hidden}.dg.a.has-save ul{margin-top:27px}.dg.a.has-save ul.closed{margin-top:0}.dg.a .save-row{position:fixed;top:0;z-index:1002}.dg li{-webkit-transition:height 0.1s ease-out;-o-transition:height 0.1s ease-out;-moz-transition:height 0.1s ease-out;transition:height 0.1s ease-out}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;overflow:hidden;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li > *{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:9px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2fa1d6}.dg .cr.number input[type=text]{color:#2fa1d6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2fa1d6}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n");var m,y,_="Default",g=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}}(),v=!0,x=!1,b=[],w=function(t){var e=this;this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),f.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],t=d.defaults(t=t||{},{autoPlace:!0,width:w.DEFAULT_WIDTH}),t=d.defaults(t,{resizable:t.autoPlace,hideable:t.autoPlace}),d.isUndefined(t.load)?t.load={preset:_}:t.preset&&(t.load.preset=t.preset),d.isUndefined(t.parent)&&t.hideable&&b.push(this),t.resizable=d.isUndefined(t.parent)&&t.resizable,t.autoPlace&&d.isUndefined(t.scrollable)&&(t.scrollable=!0);var r=g&&"true"===localStorage.getItem(M(this,"isLocal"));if(Object.defineProperties(this,{parent:{get:function(){return t.parent}},scrollable:{get:function(){return t.scrollable}},autoPlace:{get:function(){return t.autoPlace}},preset:{get:function(){return e.parent?e.getRoot().preset:t.load.preset},set:function(r){e.parent?e.getRoot().preset=r:t.load.preset=r,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value==t.preset&&(t.__preset_select.selectedIndex=e)}(this),e.revert()}},width:{get:function(){return t.width},set:function(r){t.width=r,S(e,r)}},name:{get:function(){return t.name},set:function(e){t.name=e,i&&(i.innerHTML=t.name)}},closed:{get:function(){return t.closed},set:function(r){t.closed=r,t.closed?f.addClass(e.__ul,w.CLASS_CLOSED):f.removeClass(e.__ul,w.CLASS_CLOSED),this.onResize(),e.__closeButton&&(e.__closeButton.innerHTML=r?w.TEXT_OPEN:w.TEXT_CLOSED)}},load:{get:function(){return t.load}},useLocalStorage:{get:function(){return r},set:function(t){g&&(r=t,t?f.bind(window,"unload",a):f.unbind(window,"unload",a),localStorage.setItem(M(e,"isLocal"),t))}}}),d.isUndefined(t.parent)){if(t.closed=!1,f.addClass(this.domElement,w.CLASS_MAIN),f.makeSelectable(this.domElement,!1),g&&r){e.useLocalStorage=!0;var n=localStorage.getItem(M(this,"gui"));n&&(t.load=JSON.parse(n))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=w.TEXT_CLOSED,f.addClass(this.__closeButton,w.CLASS_CLOSE_BUTTON),this.domElement.appendChild(this.__closeButton),f.bind(this.__closeButton,"click",function(){e.closed=!e.closed})}else{void 0===t.closed&&(t.closed=!0);var i=document.createTextNode(t.name);f.addClass(i,"controller-name");var o=A(e,i);f.addClass(this.__ul,w.CLASS_CLOSED),f.addClass(o,"title"),f.bind(o,"click",function(t){return t.preventDefault(),e.closed=!e.closed,!1}),t.closed||(this.closed=!1)}function a(){localStorage.setItem(M(e,"gui"),JSON.stringify(e.getSaveObject()))}t.autoPlace&&(d.isUndefined(t.parent)&&(v&&(y=document.createElement("div"),f.addClass(y,"dg"),f.addClass(y,w.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(y),v=!1),y.appendChild(this.domElement),f.addClass(this.domElement,w.CLASS_AUTO_PLACE)),this.parent||S(e,t.width)),f.bind(window,"resize",function(){e.onResize()}),f.bind(this.__ul,"webkitTransitionEnd",function(){e.onResize()}),f.bind(this.__ul,"transitionend",function(){e.onResize()}),f.bind(this.__ul,"oTransitionEnd",function(){e.onResize()}),this.onResize(),t.resizable&&function(t){var e;function r(r){return r.preventDefault(),e=r.clientX,f.addClass(t.__closeButton,w.CLASS_DRAG),f.bind(window,"mousemove",n),f.bind(window,"mouseup",i),!1}function n(r){return r.preventDefault(),t.width+=e-r.clientX,t.onResize(),e=r.clientX,!1}function i(){f.removeClass(t.__closeButton,w.CLASS_DRAG),f.unbind(window,"mousemove",n),f.unbind(window,"mouseup",i)}t.__resize_handle=document.createElement("div"),d.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),f.bind(t.__resize_handle,"mousedown",r),f.bind(t.__closeButton,"mousedown",r),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}(this);e.getRoot();t.parent||function(){var t=e.getRoot();t.width+=1,d.defer(function(){t.width-=1})}()};function E(t,e,r,l){if(void 0===e[r])throw new Error("Object "+e+' has no property "'+r+'"');var h;if(l.color)h=new c(e,r);else{var p=[e,r].concat(l.factoryArgs);h=n.apply(t,p)}l.before instanceof i&&(l.before=l.before.__li),T(t,h),f.addClass(h.domElement,"c");var m=document.createElement("span");f.addClass(m,"property-name"),m.innerHTML=h.property;var y=document.createElement("div");y.appendChild(m),y.appendChild(h.domElement);var _=A(t,y,l.before);return f.addClass(_,w.CLASS_CONTROLLER_ROW),f.addClass(_,typeof h.getValue()),function(t,e,r){if(r.__li=e,r.__gui=t,d.extend(r,{options:function(e){return arguments.length>1?(r.remove(),E(t,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[d.toArray(arguments)]})):d.isArray(e)||d.isObject(e)?(r.remove(),E(t,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[e]})):void 0},name:function(t){return r.__li.firstElementChild.firstElementChild.innerHTML=t,r},listen:function(){return r.__gui.listen(r),r},remove:function(){return r.__gui.remove(r),r}}),r instanceof u){var n=new s(r.object,r.property,{min:r.__min,max:r.__max,step:r.__step});d.each(["updateDisplay","onChange","onFinishChange"],function(t){var e=r[t],i=n[t];r[t]=n[t]=function(){var t=Array.prototype.slice.call(arguments);return e.apply(r,t),i.apply(n,t)}}),f.addClass(e,"has-slider"),r.domElement.insertBefore(n.domElement,r.domElement.firstElementChild)}else if(r instanceof s){var i=function(e){return d.isNumber(r.__min)&&d.isNumber(r.__max)?(r.remove(),E(t,r.object,r.property,{before:r.__li.nextElementSibling,factoryArgs:[r.__min,r.__max,r.__step]})):e};r.min=d.compose(i,r.min),r.max=d.compose(i,r.max)}else r instanceof o?(f.bind(e,"click",function(){f.fakeEvent(r.__checkbox,"click")}),f.bind(r.__checkbox,"click",function(t){t.stopPropagation()})):r instanceof a?(f.bind(e,"click",function(){f.fakeEvent(r.__button,"click")}),f.bind(e,"mouseover",function(){f.addClass(r.__button,"hover")}),f.bind(e,"mouseout",function(){f.removeClass(r.__button,"hover")})):r instanceof c&&(f.addClass(e,"color"),r.updateDisplay=d.compose(function(t){return e.style.borderLeftColor=r.__color.toString(),t},r.updateDisplay),r.updateDisplay());r.setValue=d.compose(function(e){return t.getRoot().__preset_select&&r.isModified()&&C(t.getRoot(),!0),e},r.setValue)}(t,_,h),t.__controllers.push(h),h}function A(t,e,r){var n=document.createElement("li");return e&&n.appendChild(e),r?t.__ul.insertBefore(n,params.before):t.__ul.appendChild(n),t.onResize(),n}function T(t,e){var r=t.getRoot(),n=r.__rememberedObjects.indexOf(e.object);if(-1!=n){var i=r.__rememberedObjectIndecesToControllers[n];if(void 0===i&&(r.__rememberedObjectIndecesToControllers[n]=i={}),i[e.property]=e,r.load&&r.load.remembered){var o,a=r.load.remembered;if(a[t.preset])o=a[t.preset];else{if(!a[_])return;o=a[_]}if(o[n]&&void 0!==o[n][e.property]){var s=o[n][e.property];e.initialValue=s,e.setValue(s)}}}}function M(t,e){return document.location.href+"."+e}function S(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function R(t,e){var r={};return d.each(t.__rememberedObjects,function(n,i){var o={};d.each(t.__rememberedObjectIndecesToControllers[i],function(t,r){o[r]=e?t.initialValue:t.getValue()}),r[i]=o}),r}function I(t,e,r){var n=document.createElement("option");n.innerHTML=e,n.value=e,t.__preset_select.appendChild(n),r&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function C(t,e){var r=t.__preset_select[t.__preset_select.selectedIndex];r.innerHTML=e?r.value+"*":r.value}return w.toggleHide=function(){x=!x,d.each(b,function(t){t.domElement.style.zIndex=x?-999:999,t.domElement.style.opacity=x?0:1})},w.CLASS_AUTO_PLACE="a",w.CLASS_AUTO_PLACE_CONTAINER="ac",w.CLASS_MAIN="main",w.CLASS_CONTROLLER_ROW="cr",w.CLASS_TOO_TALL="taller-than-window",w.CLASS_CLOSED="closed",w.CLASS_CLOSE_BUTTON="close-button",w.CLASS_DRAG="drag",w.DEFAULT_WIDTH=245,w.TEXT_CLOSED="Close Controls",w.TEXT_OPEN="Open Controls",f.bind(window,"keydown",function(t){"text"===document.activeElement.type||72!==t.which&&72!=t.keyCode||w.toggleHide()},!1),d.extend(w.prototype,{add:function(t,e){return E(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return E(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.slice(this.__controllers.indexOf(t),1);var e=this;d.defer(function(){e.onResize()})},destroy:function(){this.autoPlace&&y.removeChild(this.domElement)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var r=new w(e);this.__folders[t]=r;var n=A(this,r.domElement);return f.addClass(n,"folder"),r},open:function(){this.closed=!1},close:function(){this.closed=!0},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=f.getOffset(t.__ul).top,r=0;d.each(t.__ul.childNodes,function(e){t.autoPlace&&e===t.__save_row||(r+=f.getHeight(e))}),window.innerHeight-e-20<r?(f.addClass(t.domElement,w.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(f.removeClass(t.domElement,w.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&d.defer(function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"}),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},remember:function(){if(d.isUndefined(m)&&((m=new p).domElement.innerHTML='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n      \n    </div>\n    \n  </div>\n\n</div>'),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;d.each(Array.prototype.slice.call(arguments),function(e){0==t.__rememberedObjects.length&&function(t){var e=t.__save_row=document.createElement("li");f.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),f.addClass(e,"save-row");var r=document.createElement("span");r.innerHTML="&nbsp;",f.addClass(r,"button gears");var n=document.createElement("span");n.innerHTML="Save",f.addClass(n,"button"),f.addClass(n,"save");var i=document.createElement("span");i.innerHTML="New",f.addClass(i,"button"),f.addClass(i,"save-as");var o=document.createElement("span");o.innerHTML="Revert",f.addClass(o,"button"),f.addClass(o,"revert");var a=t.__preset_select=document.createElement("select");t.load&&t.load.remembered?d.each(t.load.remembered,function(e,r){I(t,r,r==t.preset)}):I(t,_,!1);if(f.bind(a,"change",function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value}),e.appendChild(a),e.appendChild(r),e.appendChild(n),e.appendChild(i),e.appendChild(o),g){var s=document.getElementById("dg-save-locally"),u=document.getElementById("dg-local-explain");s.style.display="block";var l=document.getElementById("dg-local-storage");function c(){u.style.display=t.useLocalStorage?"block":"none"}"true"===localStorage.getItem(M(t,"isLocal"))&&l.setAttribute("checked","checked"),c(),f.bind(l,"change",function(){t.useLocalStorage=!t.useLocalStorage,c()})}var h=document.getElementById("dg-new-constructor");f.bind(h,"keydown",function(t){!t.metaKey||67!==t.which&&67!=t.keyCode||m.hide()}),f.bind(r,"click",function(){h.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),m.show(),h.focus(),h.select()}),f.bind(n,"click",function(){t.save()}),f.bind(i,"click",function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)}),f.bind(o,"click",function(){t.revert()})}(t),-1==t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)}),this.autoPlace&&S(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=R(this)),t.folders={},d.each(this.__folders,function(e,r){t.folders[r]=e.getSaveObject()}),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=R(this),C(this,!1)},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[_]=R(this,!0)),this.load.remembered[t]=R(this),this.preset=t,I(this,t,!0)},revert:function(t){d.each(this.__controllers,function(e){this.getRoot().load.remembered?T(t||this.getRoot(),e):e.setValue(e.initialValue)},this),d.each(this.__folders,function(t){t.revert(t)}),t||C(this.getRoot(),!1)},listen:function(t){var e=0==this.__listening.length;this.__listening.push(t),e&&function t(e){0!=e.length&&h(function(){t(e)});d.each(e,function(t){t.updateDisplay()})}(this.__listening)}}),w}(u.utils.css,0,0,u.controllers.factory=function(t,e,r,n,i,o,a){return function(s,u){var l=s[u];return a.isArray(arguments[2])||a.isObject(arguments[2])?new t(s,u,arguments[2]):a.isNumber(l)?a.isNumber(arguments[2])&&a.isNumber(arguments[3])?new r(s,u,arguments[2],arguments[3]):new e(s,u,{min:arguments[2],max:arguments[3]}):a.isString(l)?new n(s,u):a.isFunction(l)?new i(s,u,""):a.isBoolean(l)?new o(s,u):void 0}}(u.controllers.OptionController,u.controllers.NumberControllerBox,u.controllers.NumberControllerSlider,u.controllers.StringController=function(t,e,r){var n=function(t,r){n.superclass.call(this,t,r);var i=this;function o(){i.setValue(i.__input.value)}this.__input=document.createElement("input"),this.__input.setAttribute("type","text"),e.bind(this.__input,"keyup",o),e.bind(this.__input,"change",o),e.bind(this.__input,"blur",function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}),e.bind(this.__input,"keydown",function(t){13===t.keyCode&&this.blur()}),this.updateDisplay(),this.domElement.appendChild(this.__input)};return n.superclass=t,r.extend(n.prototype,t.prototype,{updateDisplay:function(){return e.isActive(this.__input)||(this.__input.value=this.getValue()),n.superclass.prototype.updateDisplay.call(this)}}),n}(u.controllers.Controller,u.dom.dom,u.utils.common),u.controllers.FunctionController,u.controllers.BooleanController,u.utils.common),u.controllers.Controller,u.controllers.BooleanController,u.controllers.FunctionController,u.controllers.NumberControllerBox,u.controllers.NumberControllerSlider,0,u.controllers.ColorController=function(t,e,r,n,i){var o=function(t,a){o.superclass.call(this,t,a),this.__color=new r(this.getValue()),this.__temp=new r(0);var u=this;this.domElement=document.createElement("div"),e.makeSelectable(this.domElement,!1),this.__selector=document.createElement("div"),this.__selector.className="selector",this.__saturation_field=document.createElement("div"),this.__saturation_field.className="saturation-field",this.__field_knob=document.createElement("div"),this.__field_knob.className="field-knob",this.__field_knob_border="2px solid ",this.__hue_knob=document.createElement("div"),this.__hue_knob.className="hue-knob",this.__hue_field=document.createElement("div"),this.__hue_field.className="hue-field",this.__input=document.createElement("input"),this.__input.type="text",this.__input_textShadow="0 1px 1px ",e.bind(this.__input,"keydown",function(t){13===t.keyCode&&f.call(this)}),e.bind(this.__input,"blur",f),e.bind(this.__selector,"mousedown",function(t){e.addClass(this,"drag").bind(window,"mouseup",function(t){e.removeClass(u.__selector,"drag")})});var l,c=document.createElement("div");function h(t){m(t),e.bind(window,"mousemove",m),e.bind(window,"mouseup",p)}function p(){e.unbind(window,"mousemove",m),e.unbind(window,"mouseup",p)}function f(){var t=n(this.value);!1!==t?(u.__color.__state=t,u.setValue(u.__color.toOriginal())):this.value=u.__color.toString()}function d(){e.unbind(window,"mousemove",y),e.unbind(window,"mouseup",d)}function m(t){t.preventDefault();var r=e.getWidth(u.__saturation_field),n=e.getOffset(u.__saturation_field),i=(t.clientX-n.left+document.body.scrollLeft)/r,o=1-(t.clientY-n.top+document.body.scrollTop)/r;return o>1?o=1:o<0&&(o=0),i>1?i=1:i<0&&(i=0),u.__color.v=o,u.__color.s=i,u.setValue(u.__color.toOriginal()),!1}function y(t){t.preventDefault();var r=e.getHeight(u.__hue_field),n=e.getOffset(u.__hue_field),i=1-(t.clientY-n.top+document.body.scrollTop)/r;return i>1?i=1:i<0&&(i=0),u.__color.h=360*i,u.setValue(u.__color.toOriginal()),!1}i.extend(this.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),i.extend(this.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:this.__field_knob_border+(this.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),i.extend(this.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),i.extend(this.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),i.extend(c.style,{width:"100%",height:"100%",background:"none"}),s(c,"top","rgba(0,0,0,0)","#000"),i.extend(this.__hue_field.style,{width:"15px",height:"100px",display:"inline-block",border:"1px solid #555",cursor:"ns-resize"}),(l=this.__hue_field).style.background="",l.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",l.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",l.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",l.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",l.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.extend(this.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:this.__input_textShadow+"rgba(0,0,0,0.7)"}),e.bind(this.__saturation_field,"mousedown",h),e.bind(this.__field_knob,"mousedown",h),e.bind(this.__hue_field,"mousedown",function(t){y(t),e.bind(window,"mousemove",y),e.bind(window,"mouseup",d)}),this.__saturation_field.appendChild(c),this.__selector.appendChild(this.__field_knob),this.__selector.appendChild(this.__saturation_field),this.__selector.appendChild(this.__hue_field),this.__hue_field.appendChild(this.__hue_knob),this.domElement.appendChild(this.__input),this.domElement.appendChild(this.__selector),this.updateDisplay()};o.superclass=t,i.extend(o.prototype,t.prototype,{updateDisplay:function(){var t=n(this.getValue());if(!1!==t){var e=!1;i.each(r.COMPONENTS,function(r){if(!i.isUndefined(t[r])&&!i.isUndefined(this.__color.__state[r])&&t[r]!==this.__color.__state[r])return e=!0,{}},this),e&&i.extend(this.__color.__state,t)}i.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var o=this.__color.v<.5||this.__color.s>.5?255:0,a=255-o;i.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toString(),border:this.__field_knob_border+"rgb("+o+","+o+","+o+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,s(this.__saturation_field,"left","#fff",this.__temp.toString()),i.extend(this.__input.style,{backgroundColor:this.__input.value=this.__color.toString(),color:"rgb("+o+","+o+","+o+")",textShadow:this.__input_textShadow+"rgba("+a+","+a+","+a+",.7)"})}});var a=["-moz-","-o-","-webkit-","-ms-",""];function s(t,e,r,n){t.style.background="",i.each(a,function(i){t.style.cssText+="background: "+i+"linear-gradient("+e+", "+r+" 0%, "+n+" 100%); "})}return o}(u.controllers.Controller,u.dom.dom,u.color.Color=function(t,e,r,n){var i=function(){if(this.__state=t.apply(this,arguments),!1===this.__state)throw"Failed to interpret color arguments";this.__state.a=this.__state.a||1};function o(t,e,r){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space?this.__state[e]:(s(this,e,r),this.__state[e])},set:function(t){"RGB"!==this.__state.space&&(s(this,e,r),this.__state.space="RGB"),this.__state[e]=t}})}function a(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space?this.__state[e]:(u(this),this.__state[e])},set:function(t){"HSV"!==this.__state.space&&(u(this),this.__state.space="HSV"),this.__state[e]=t}})}function s(t,r,i){if("HEX"===t.__state.space)t.__state[r]=e.component_from_hex(t.__state.hex,i);else{if("HSV"!==t.__state.space)throw"Corrupted color state";n.extend(t.__state,e.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}}function u(t){var r=e.rgb_to_hsv(t.r,t.g,t.b);n.extend(t.__state,{s:r.s,v:r.v}),n.isNaN(r.h)?n.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=r.h}return i.COMPONENTS=["r","g","b","h","s","v","hex","a"],n.extend(i.prototype,{toString:function(){return r(this)},toOriginal:function(){return this.__state.conversion.write(this)}}),o(i.prototype,"r",2),o(i.prototype,"g",1),o(i.prototype,"b",0),a(i.prototype,"h"),a(i.prototype,"s"),a(i.prototype,"v"),Object.defineProperty(i.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(i.prototype,"hex",{get:function(){return"HEX"!==!this.__state.space&&(this.__state.hex=e.rgb_to_hex(this.r,this.g,this.b)),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}}),i}(u.color.interpret,u.color.math={hsv_to_rgb:function(t,e,r){var n=Math.floor(t/60)%6,i=t/60-Math.floor(t/60),o=r*(1-e),a=r*(1-i*e),s=r*(1-(1-i)*e),u=[[r,s,o],[a,r,o],[o,r,s],[o,a,r],[s,o,r],[r,o,a]][n];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(t,e,r){var n,i=Math.min(t,e,r),o=Math.max(t,e,r),a=o-i;return 0==o?{h:NaN,s:0,v:0}:(n=t==o?(e-r)/a:e==o?2+(r-t)/a:4+(t-e)/a,(n/=6)<0&&(n+=1),{h:360*n,s:a/o,v:o/255})},rgb_to_hex:function(t,e,r){var n=this.hex_with_component(0,2,t);return n=this.hex_with_component(n,1,e),n=this.hex_with_component(n,0,r)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,r){return r<<(s=8*e)|t&~(255<<s)}},u.color.toString,u.utils.common),u.color.interpret,u.utils.common),u.utils.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)},u.dom.CenteredDiv=function(t,e){var r=function(){this.backgroundElement=document.createElement("div"),e.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear"}),t.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),e.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var r=this;t.bind(this.backgroundElement,"click",function(){r.hide()})};return r.prototype.show=function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),e.defer(function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"})},r.prototype.hide=function(){var e=this,r=function(){e.domElement.style.display="none",e.backgroundElement.style.display="none",t.unbind(e.domElement,"webkitTransitionEnd",r),t.unbind(e.domElement,"transitionend",r),t.unbind(e.domElement,"oTransitionEnd",r)};t.bind(this.domElement,"webkitTransitionEnd",r),t.bind(this.domElement,"transitionend",r),t.bind(this.domElement,"oTransitionEnd",r),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"},r.prototype.layout=function(){this.domElement.style.left=window.innerWidth/2-t.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-t.getHeight(this.domElement)/2+"px"},r}(u.dom.dom,u.utils.common),u.dom.dom,u.utils.common)},{}],20:[function(t,e,r){var n=t("clone");e.exports=function(t,e){return t=t||{},Object.keys(e).forEach(function(r){void 0===t[r]&&(t[r]=n(e[r]))}),t}},{clone:14}],21:[function(t,e,r){e.exports=function(){for(var t=0;t<arguments.length;t++)if(void 0!==arguments[t])return arguments[t]}},{}],22:[function(t,e,r){"use strict";function n(t,e,r){r=r||2;var n,s,u,l,c,f,d,y=e&&e.length,_=y?e[0]*r:t.length,g=i(t,0,_,r,!0),v=[];if(!g||g.next===g.prev)return v;if(y&&(g=function(t,e,r,n){var a,s,u,l=[];for(a=0,s=e.length;a<s;a++)(u=i(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n,!1))===u.next&&(u.steiner=!0),l.push(m(u));for(l.sort(h),a=0;a<l.length;a++)p(l[a],r),r=o(r,r.next);return r}(t,e,g,r)),t.length>80*r){n=u=t[0],s=l=t[1];for(var x=r;x<_;x+=r)(c=t[x])<n&&(n=c),(f=t[x+1])<s&&(s=f),c>u&&(u=c),f>l&&(l=f);d=0!==(d=Math.max(u-n,l-s))?1/d:0}return a(g,v,r,n,s,d),v}function i(t,e,r,n,i){var o,a;if(i===R(t,e,r,n)>0)for(o=e;o<r;o+=n)a=T(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=T(o,t[o],t[o+1],a);return a&&v(a,a.next)&&(M(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!v(n,n.next)&&0!==g(n.prev,n,n.next))n=n.next;else{if(M(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function a(t,e,r,n,i,h,p){if(t){!p&&h&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=d(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,l=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<l&&(s++,n=n.nextZ);e++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(a>1)}(i)}(t,n,i,h);for(var f,m,y=t;t.prev!==t.next;)if(f=t.prev,m=t.next,h?u(t,n,i,h):s(t))e.push(f.i/r),e.push(t.i/r),e.push(m.i/r),M(t),t=m.next,y=m.next;else if((t=m)===y){p?1===p?a(t=l(o(t),e,r),e,r,n,i,h,2):2===p&&c(t,e,r,n,i,h):a(o(t),e,r,n,i,h,1);break}}}function s(t){var e=t.prev,r=t,n=t.next;if(g(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(y(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&g(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(t,e,r,n){var i=t.prev,o=t,a=t.next;if(g(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,l=d(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,r,n),c=d(s,u,e,r,n),h=t.prevZ,p=t.nextZ;h&&h.z>=l&&p&&p.z<=c;){if(h!==t.prev&&h!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=l;){if(h!==t.prev&&h!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&g(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&y(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&g(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function l(t,e,r){var n=t;do{var i=n.prev,a=n.next.next;!v(i,a)&&x(i,n,n.next,a)&&E(i,a)&&E(a,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(a.i/r),M(n),M(n.next),n=t=a),n=n.next}while(n!==t);return o(n)}function c(t,e,r,n,i,s){var u=t;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&_(u,l)){var c=A(u,l);return u=o(u,u.next),c=o(c,c.next),a(u,e,r,n,i,s),void a(c,e,r,n,i,s)}l=l.next}u=u.next}while(u!==t)}function h(t,e){return t.x-e.x}function p(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-Infinity;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r;var u,l=r,c=r.x,h=r.y,p=Infinity;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&y(o<h?i:a,o,c,h,o<h?a:i,o,n.x,n.y)&&(u=Math.abs(o-n.y)/(i-n.x),E(n,t)&&(u<p||u===p&&(n.x>r.x||n.x===r.x&&f(r,n)))&&(r=n,p=u)),n=n.next}while(n!==l);return r}(t,e)){var r=A(e,t);o(r,r.next)}}function f(t,e){return g(t.prev,t,e.prev)<0&&g(e.next,t,t.next)<0}function d(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function m(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function y(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function _(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&x(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(E(t,e)&&E(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(g(t.prev,t,e.prev)||g(t,e.prev,e))||v(t,e)&&g(t.prev,t,t.next)>0&&g(e.prev,e,e.next)>0)}function g(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function v(t,e){return t.x===e.x&&t.y===e.y}function x(t,e,r,n){var i=w(g(t,e,r)),o=w(g(t,e,n)),a=w(g(r,n,t)),s=w(g(r,n,e));return i!==o&&a!==s||(!(0!==i||!b(t,r,e))||(!(0!==o||!b(t,n,e))||(!(0!==a||!b(r,t,n))||!(0!==s||!b(r,e,n)))))}function b(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function w(t){return t>0?1:t<0?-1:0}function E(t,e){return g(t.prev,t,t.next)<0?g(t,e,t.next)>=0&&g(t,t.prev,e)>=0:g(t,e,t.prev)<0||g(t,t.next,e)<0}function A(t,e){var r=new S(t.i,t.x,t.y),n=new S(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function T(t,e,r,n){var i=new S(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function M(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function S(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function R(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}e.exports=n,e.exports.default=n,n.deviation=function(t,e,r,n){var i=e&&e.length,o=Math.abs(R(t,0,i?e[0]*r:t.length,r));if(i)for(var a=0,s=e.length;a<s;a++){o-=Math.abs(R(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r))}var u=0;for(a=0;a<n.length;a+=3){var l=n[a]*r,c=n[a+1]*r,h=n[a+2]*r;u+=Math.abs((t[l]-t[h])*(t[c+1]-t[l+1])-(t[l]-t[c])*(t[h+1]-t[l+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&r.holes.push(n+=t[i-1].length)}return r}},{}],23:[function(t,e,r){function n(t){return parseFloat(t)||0}e.exports=function(t){if(t===window||t===document.body)return[window.innerWidth,window.innerHeight];if(!t.parentNode){var e=!0;document.body.appendChild(t)}var r=t.getBoundingClientRect(),i=getComputedStyle(t),o=(0|r.height)+n(i.getPropertyValue("margin-top"))+n(i.getPropertyValue("margin-bottom")),a=(0|r.width)+n(i.getPropertyValue("margin-left"))+n(i.getPropertyValue("margin-right"));e&&document.body.removeChild(t);return[a,o]}},{}],24:[function(t,e,r){"use strict";e.exports=function(t,e,r){switch(arguments.length){case 0:return new a([0],[0],0);case 1:if("number"==typeof t){var n=u(t);return new a(n,n,0)}return new a(t,u(t.length),0);case 2:if("number"==typeof e){var n=u(t.length);return new a(t,n,+e)}r=0;case 3:if(t.length!==e.length)throw new Error("state and velocity lengths must match");return new a(t,e,r)}};var n=t("cubic-hermite"),i=t("binary-search-bounds");function o(t,e,r){return Math.min(e,Math.max(t,r))}function a(t,e,r){this.dimension=t.length,this.bounds=[new Array(this.dimension),new Array(this.dimension)];for(var n=0;n<this.dimension;++n)this.bounds[0][n]=-Infinity,this.bounds[1][n]=Infinity;this._state=t.slice().reverse(),this._velocity=e.slice().reverse(),this._time=[r],this._scratch=[t.slice(),t.slice(),t.slice(),t.slice(),t.slice()]}var s=a.prototype;function u(t){for(var e=new Array(t),r=0;r<t;++r)e[r]=0;return e}s.flush=function(t){var e=i.gt(this._time,t)-1;e<=0||(this._time.splice(0,e),this._state.splice(0,e*this.dimension),this._velocity.splice(0,e*this.dimension))},s.curve=function(t){var e=this._time,r=e.length,a=i.le(e,t),s=this._scratch[0],u=this._state,l=this._velocity,c=this.dimension,h=this.bounds;if(a<0)for(var p=c-1,f=0;f<c;++f,--p)s[f]=u[p];else if(a>=r-1){p=u.length-1;var d=t-e[r-1];for(f=0;f<c;++f,--p)s[f]=u[p]+d*l[p]}else{p=c*(a+1)-1;var m=e[a],y=e[a+1]-m||1,_=this._scratch[1],g=this._scratch[2],v=this._scratch[3],x=this._scratch[4],b=!0;for(f=0;f<c;++f,--p)_[f]=u[p],v[f]=l[p]*y,g[f]=u[p+c],x[f]=l[p+c]*y,b=b&&_[f]===g[f]&&v[f]===x[f]&&0===v[f];if(b)for(f=0;f<c;++f)s[f]=_[f];else n(_,v,g,x,(t-m)/y,s)}var w=h[0],E=h[1];for(f=0;f<c;++f)s[f]=o(w[f],E[f],s[f]);return s},s.dcurve=function(t){var e=this._time,r=e.length,o=i.le(e,t),a=this._scratch[0],s=this._state,u=this._velocity,l=this.dimension;if(o>=r-1)for(var c=s.length-1,h=0;h<l;++h,--c)a[h]=u[c];else{c=l*(o+1)-1;var p=e[o],f=e[o+1]-p||1,d=this._scratch[1],m=this._scratch[2],y=this._scratch[3],_=this._scratch[4],g=!0;for(h=0;h<l;++h,--c)d[h]=s[c],y[h]=u[c]*f,m[h]=s[c+l],_[h]=u[c+l]*f,g=g&&d[h]===m[h]&&y[h]===_[h]&&0===y[h];if(g)for(h=0;h<l;++h)a[h]=0;else{n.derivative(d,y,m,_,(t-p)/f,a);for(h=0;h<l;++h)a[h]/=f}}return a},s.lastT=function(){var t=this._time;return t[t.length-1]},s.stable=function(){for(var t=this._velocity,e=t.length,r=this.dimension-1;r>=0;--r)if(t[--e])return!1;return!0},s.jump=function(t){var e=this.lastT(),r=this.dimension;if(!(t<e||arguments.length!==r+1)){var n=this._state,i=this._velocity,a=n.length-this.dimension,s=this.bounds,u=s[0],l=s[1];this._time.push(e,t);for(var c=0;c<2;++c)for(var h=0;h<r;++h)n.push(n[a++]),i.push(0);this._time.push(t);for(h=r;h>0;--h)n.push(o(u[h-1],l[h-1],arguments[h])),i.push(0)}},s.push=function(t){var e=this.lastT(),r=this.dimension;if(!(t<e||arguments.length!==r+1)){var n=this._state,i=this._velocity,a=n.length-this.dimension,s=t-e,u=this.bounds,l=u[0],c=u[1],h=s>1e-6?1/s:0;this._time.push(t);for(var p=r;p>0;--p){var f=o(l[p-1],c[p-1],arguments[p]);n.push(f),i.push((f-n[a++])*h)}}},s.set=function(t){var e=this.dimension;if(!(t<this.lastT()||arguments.length!==e+1)){var r=this._state,n=this._velocity,i=this.bounds,a=i[0],s=i[1];this._time.push(t);for(var u=e;u>0;--u)r.push(o(a[u-1],s[u-1],arguments[u])),n.push(0)}},s.move=function(t){var e=this.lastT(),r=this.dimension;if(!(t<=e||arguments.length!==r+1)){var n=this._state,i=this._velocity,a=n.length-this.dimension,s=this.bounds,u=s[0],l=s[1],c=t-e,h=c>1e-6?1/c:0;this._time.push(t);for(var p=r;p>0;--p){var f=arguments[p];n.push(o(u[p-1],l[p-1],n[a++]+f)),i.push(f*h)}}},s.idle=function(t){var e=this.lastT();if(!(t<e)){var r=this.dimension,n=this._state,i=this._velocity,a=n.length-r,s=this.bounds,u=s[0],l=s[1],c=t-e;this._time.push(t);for(var h=r-1;h>=0;--h)n.push(o(u[h],l[h],n[a]+c*i[a])),i.push(0),a+=1}}},{"binary-search-bounds":9,"cubic-hermite":16}],25:[function(t,e,r){"use strict";var n=t("geo-identify-position-format"),i=t("geo-convert-position-format"),o=t("gl-vec3");e.exports=function(t,e){for(var r=n.identify(t),a=i.convert(t,n.ARRAY_OF_ARRAYS,3),s=0;s<a.length;s++)o.transformMat4(a[s],a[s],e);return a=i.convert(a,r,3)}},{"geo-convert-position-format":28,"geo-identify-position-format":29,"gl-vec3":126}],26:[function(t,e,r){"use strict";const n=t("regl"),i=t("gl-matrix").mat4,o=t("geo-center"),a=t("vertices-bounding-box"),s=t("geo-3d-transform-mat4"),u=t("geo-convert-position-format"),l=t("normals").vertexNormals,c=t("mesh-reindex"),h=t("defaults");e.exports=function(t,e){e=h(e,{cells:void 0,regl:!1,bias:.01,resolution:512}),t=o(t);const r=a(t),p=[1/(r[1][0]-r[0][0]),1/(r[1][1]-r[0][1]),1/(r[1][2]-r[0][2])],f=i.scale([],i.create(),p);t=s(t,f);const d=u.convert(t,u.TYPED_ARRAY);let m,y={cells:e.cells,positions:t};void 0===y.cells&&(y=c(d)),m=void 0===e.normals?l(y.cells,y.positions,0):e.normals;const _=u.convert(m,u.TYPED_ARRAY);if(d.length%3!=0)throw new Error("geo-ambient-occlusion: Position array not divisible by three.");const g=d.length/3;let v=1;for(;v*v<g;)v*=2;const x=new Float32Array(v*v*3);x.set(d);const b=new Float32Array(v*v*3);b.set(_);const w=["OES_texture_float"];if(g>65535&&void 0!==e.cells&&w.push("OES_element_index_uint"),e.regl)for(let t of w)if(!e.regl.hasExtension(t))throw new Error("geo-ambient-occlusion: Provided regl context needs the "+t+" extension for this mesh.");let E,A;e.regl?(E=e.regl,A=!1):(E=n({canvas:document.createElement("canvas"),extensions:w}),A=!0);const T=F(e.resolution),M={vert:"\n      precision highp float;\n      attribute vec3 position;\n      uniform mat4 model, projection;\n      varying vec3 vPos;\n      void main() {\n        gl_Position = projection * model * vec4(position, 1);\n        vPos = vec3(model * vec4(position, 1));\n      }\n    ",frag:"\n      precision highp float;\n      varying vec3 vPos;\n      void main() {\n        gl_FragColor = vec4(vPos, 1);\n      }\n    ",attributes:{position:t},uniforms:{model:E.prop("model"),projection:E.prop("projection")},viewport:{x:0,y:0,width:e.resolution,height:e.resolution},framebuffer:T};e.cells?M.elements=e.cells:M.count=g;const S=E(M),R=[F(v),F(v)],I=E.texture({width:v,height:v,data:x,format:"rgb",type:"float"}),C=E.texture({width:v,height:v,data:b,format:"rgb",type:"float"}),P=E({vert:"\n      precision highp float;\n      attribute vec2 position;\n      void main() {\n          gl_Position = vec4(position, 0, 1);\n      }\n    ",frag:"\n      precision highp float;\n\n      uniform sampler2D tPosition, tSource, tVertex, tNormal;\n      uniform float count, bias;\n      uniform vec2 resolution;\n      uniform mat4 model;\n\n      const float INVSQRT3 = 0.5773502691896258; // 1/sqrt(3)\n\n      void main() {\n          vec2 texel = gl_FragCoord.xy/resolution;\n          vec3 vert = texture2D(tVertex, texel).rgb;\n          vert = vec3(model * vec4(vert, 1));\n          vec3 norm = texture2D(tNormal, texel).rgb;\n          norm = vec3(model * vec4(norm, 1));\n          float z = texture2D(tPosition, INVSQRT3 * vert.xy + 0.5).z;\n          float o = 0.0;\n          if ((vert.z - z) < -bias) {\n              o = 1.0;\n          }\n          vec4 src = texture2D(tSource, texel);\n          if (dot(norm, vec3(0,0,1)) > 0.0) {\n            gl_FragColor = src + vec4(o, 1, 0, 0);\n          } else {\n            gl_FragColor = src;\n          }\n      }\n    ",attributes:{position:[-1,-1,1,-1,1,1,-1,-1,1,1,-1,1]},uniforms:{tPosition:T,tSource:E.prop("source"),tVertex:I,tNormal:C,count:E.prop("count"),bias:E.prop("bias"),resolution:[v,v],model:E.prop("model")},viewport:{x:0,y:0,width:v,height:v},framebuffer:E.prop("destination"),count:6});let D=0,L=0;const O=Math.sqrt(3)/2,k=i.ortho([],-O,O,-O,O,-O,O);function F(t){return E.framebuffer({width:t,height:t,colorFormat:"rgba",colorType:"float"})}return{sample:function(){const t=R[D=1-D],r=R[1-D];L++;const n=i.create();i.rotateX(n,n,100*Math.random()),i.rotateY(n,n,100*Math.random()),i.rotateZ(n,n,100*Math.random()),E.clear({color:[0,0,0,1],depth:1,framebuffer:T}),S({model:n,projection:k}),E.clear({color:[0,0,0,1],depth:1,framebuffer:r}),P({source:t,destination:r,count:L,bias:e.bias,model:n})},report:function(){let t;R[1-D].use(()=>{t=E.read()});const e=new Float32Array(g);for(let r=0;r<g;r++){const n=4*r,i=t[n+1];e[r]=0===i?0:t[n+0]/i}return e},dispose:function(){I.destroy(),T.destroy(),R[0].destroy(),R[1].destroy(),A&&E.destroy()}}}},{defaults:20,"geo-3d-transform-mat4":25,"geo-center":27,"geo-convert-position-format":28,"gl-matrix":61,"mesh-reindex":186,normals:193,regl:204,"vertices-bounding-box":212}],27:[function(t,e,r){"use strict";var n=t("lodash.defaultsdeep"),i=t("vertices-bounding-box"),o=t("gl-mat4"),a=t("geo-3d-transform-mat4"),s=t("geo-convert-position-format");e.exports=function(t,e){e=n(e=e||{},{center:[0,0,0]}),t=s.convert(t,s.ARRAY_OF_ARRAYS);var r=i(t),u=[-.5*(r[0][0]+r[1][0])+e.center[0],-.5*(r[0][1]+r[1][1])+e.center[1],-.5*(r[0][2]+r[1][2])+e.center[2]],l=o.create();return o.translate(l,l,u),a(t,l)}},{"geo-3d-transform-mat4":25,"geo-convert-position-format":28,"gl-mat4":46,"lodash.defaultsdeep":170,"vertices-bounding-box":212}],28:[function(t,e,r){"use strict";var n=t("geo-identify-position-format"),i=t("ndarray");e.exports={convert:function(t,e,r){if(-1===[n.FLAT_ARRAY,n.ARRAY_OF_ARRAYS,n.TYPED_ARRAY,n.ARRAY_OF_TYPED_ARRAYS,n.NDARRAY].indexOf(e=void 0===e?n.TYPED_ARRAY:e))throw new Error("geo-convert-position-format: Unknown target format "+e);var o,a=n.identify(t);if(a===n.FLAT_ARRAY)o=new Float32Array(t);else if(a===n.TYPED_ARRAY)o=new Float32Array(t);else if(a===n.ARRAY_OF_ARRAYS){o=[];for(var s=0;s<t.length;s++)o.push.apply(o,t[s]);o=new Float32Array(o)}else if(a===n.ARRAY_OF_TYPED_ARRAYS){o=[];for(var s=0;s<t.length;s++)o.push.apply(o,t[s]);o=new Float32Array(o)}else{if(a!==n.NDARRAY)throw new Error("geo-convert-position-format: Could not convert from incoming format "+a);o=new Float32Array(t.data)}void 0===r&&(r=o.length%3==0?3:o.length%2==0?2:1);if(-1===[1,2,3].indexOf(r))throw new Error("geo-convert-position-format: Stride "+r+" not a valid stride - must be 1, 2, or 3");if(o.length%r!=0)throw new Error("geo-convert-position-format: Stride "+r+" incompatible with element count "+o.length);if(e===n.TYPED_ARRAY)return o;if(e===n.FLAT_ARRAY)return Array.prototype.slice.call(o);if(e===n.ARRAY_OF_ARRAYS){for(var u=[],s=0,l=0,c=o.length/r;l<c;l++){for(var h=[],p=0;p<r;p++)h.push(o[s++]);u.push(h)}return u}if(e===n.ARRAY_OF_TYPED_ARRAYS){for(var u=[],s=0,l=0,c=o.length/r;l<c;l++){for(var h=[],p=0;p<r;p++)h.push(o[s++]);u.push(new Float32Array(h))}return u}if(e===n.NDARRAY)return i(o);throw new Error("geo-convert-position-format: Could not convert to target format "+e)},FLAT_ARRAY:n.FLAT_ARRAY,ARRAY_OF_ARRAYS:n.ARRAY_OF_ARRAYS,TYPED_ARRAY:n.TYPED_ARRAY,ARRAY_OF_TYPED_ARRAYS:n.ARRAY_OF_TYPED_ARRAYS,NDARRAY:n.NDARRAY}},{"geo-identify-position-format":29,ndarray:191}],29:[function(t,e,r){"use strict";var n=t("is-typedarray"),i=t("isndarray"),o="array of arrays",a="array of typed arrays",s="flat array",u="typed array",l="ndarray";e.exports={identify:function(t){if(Array.isArray(t)&&Array.isArray(t[0]))return o;if(Array.isArray(t)&&n(t[0]))return a;if(Array.isArray(t))return s;if(i(t))return l;if(n(t))return u;throw new Error("geo-identify-position-format: Could not identify position format.")},ARRAY_OF_ARRAYS:o,ARRAY_OF_TYPED_ARRAYS:a,FLAT_ARRAY:s,TYPED_ARRAY:u,NDARRAY:l}},{"is-typedarray":160,isndarray:161}],30:[function(t,e,r){var n=t("gl-vec3/normalize"),i=t("gl-vec3/subtract"),o=t("gl-vec3/cross"),a=[0,0,0];e.exports=function(t,e,r,s){return i(t,e,r),i(a,r,s),o(t,t,a),n(t,t)}},{"gl-vec3/cross":114,"gl-vec3/normalize":136,"gl-vec3/subtract":150}],31:[function(t,e,r){e.exports=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15];return t[0]=s*(p*_-f*y)-h*(u*_-l*y)+m*(u*f-l*p),t[1]=-(n*(p*_-f*y)-h*(i*_-o*y)+m*(i*f-o*p)),t[2]=n*(u*_-l*y)-s*(i*_-o*y)+m*(i*l-o*u),t[3]=-(n*(u*f-l*p)-s*(i*f-o*p)+h*(i*l-o*u)),t[4]=-(a*(p*_-f*y)-c*(u*_-l*y)+d*(u*f-l*p)),t[5]=r*(p*_-f*y)-c*(i*_-o*y)+d*(i*f-o*p),t[6]=-(r*(u*_-l*y)-a*(i*_-o*y)+d*(i*l-o*u)),t[7]=r*(u*f-l*p)-a*(i*f-o*p)+c*(i*l-o*u),t[8]=a*(h*_-f*m)-c*(s*_-l*m)+d*(s*f-l*h),t[9]=-(r*(h*_-f*m)-c*(n*_-o*m)+d*(n*f-o*h)),t[10]=r*(s*_-l*m)-a*(n*_-o*m)+d*(n*l-o*s),t[11]=-(r*(s*f-l*h)-a*(n*f-o*h)+c*(n*l-o*s)),t[12]=-(a*(h*y-p*m)-c*(s*y-u*m)+d*(s*p-u*h)),t[13]=r*(h*y-p*m)-c*(n*y-i*m)+d*(n*p-i*h),t[14]=-(r*(s*y-u*m)-a*(n*y-i*m)+d*(n*u-i*s)),t[15]=r*(s*p-u*h)-a*(n*p-i*h)+c*(n*u-i*s),t}},{}],32:[function(t,e,r){e.exports=function(t){var e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}},{}],33:[function(t,e,r){e.exports=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}},{}],34:[function(t,e,r){e.exports=function(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{}],35:[function(t,e,r){e.exports=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],f=t[12],d=t[13],m=t[14],y=t[15];return(e*a-r*o)*(h*y-p*m)-(e*s-n*o)*(c*y-p*d)+(e*u-i*o)*(c*m-h*d)+(r*s-n*a)*(l*y-p*f)-(r*u-i*a)*(l*m-h*f)+(n*u-i*s)*(l*d-c*f)}},{}],36:[function(t,e,r){e.exports=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,l=r*a,c=n*a,h=n*s,p=i*a,f=i*s,d=i*u,m=o*a,y=o*s,_=o*u;return t[0]=1-h-d,t[1]=c+_,t[2]=p-y,t[3]=0,t[4]=c-_,t[5]=1-l-d,t[6]=f+m,t[7]=0,t[8]=p+y,t[9]=f-m,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{}],37:[function(t,e,r){e.exports=function(t,e,r){var n,i,o,a=r[0],s=r[1],u=r[2],l=Math.sqrt(a*a+s*s+u*u);if(Math.abs(l)<1e-6)return null;return a*=l=1/l,s*=l,u*=l,n=Math.sin(e),i=Math.cos(e),t[0]=a*a*(o=1-i)+i,t[1]=s*a*o+u*n,t[2]=u*a*o-s*n,t[3]=0,t[4]=a*s*o-u*n,t[5]=s*s*o+i,t[6]=u*s*o+a*n,t[7]=0,t[8]=a*u*o+s*n,t[9]=s*u*o-a*n,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{}],38:[function(t,e,r){e.exports=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,u=i+i,l=o+o,c=n*s,h=n*u,p=n*l,f=i*u,d=i*l,m=o*l,y=a*s,_=a*u,g=a*l;return t[0]=1-(f+m),t[1]=h+g,t[2]=p-_,t[3]=0,t[4]=h-g,t[5]=1-(c+m),t[6]=d+y,t[7]=0,t[8]=p+_,t[9]=d-y,t[10]=1-(c+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}},{}],39:[function(t,e,r){e.exports=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{}],40:[function(t,e,r){e.exports=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}},{}],41:[function(t,e,r){e.exports=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{}],42:[function(t,e,r){e.exports=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{}],43:[function(t,e,r){e.exports=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{}],44:[function(t,e,r){e.exports=function(t,e,r,n,i,o,a){var s=1/(r-e),u=1/(i-n),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t}},{}],45:[function(t,e,r){e.exports=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{}],46:[function(t,e,r){e.exports={create:t("./create"),clone:t("./clone"),copy:t("./copy"),identity:t("./identity"),transpose:t("./transpose"),invert:t("./invert"),adjoint:t("./adjoint"),determinant:t("./determinant"),multiply:t("./multiply"),translate:t("./translate"),scale:t("./scale"),rotate:t("./rotate"),rotateX:t("./rotateX"),rotateY:t("./rotateY"),rotateZ:t("./rotateZ"),fromRotation:t("./fromRotation"),fromRotationTranslation:t("./fromRotationTranslation"),fromScaling:t("./fromScaling"),fromTranslation:t("./fromTranslation"),fromXRotation:t("./fromXRotation"),fromYRotation:t("./fromYRotation"),fromZRotation:t("./fromZRotation"),fromQuat:t("./fromQuat"),frustum:t("./frustum"),perspective:t("./perspective"),perspectiveFromFieldOfView:t("./perspectiveFromFieldOfView"),ortho:t("./ortho"),lookAt:t("./lookAt"),str:t("./str")}},{"./adjoint":31,"./clone":32,"./copy":33,"./create":34,"./determinant":35,"./fromQuat":36,"./fromRotation":37,"./fromRotationTranslation":38,"./fromScaling":39,"./fromTranslation":40,"./fromXRotation":41,"./fromYRotation":42,"./fromZRotation":43,"./frustum":44,"./identity":45,"./invert":47,"./lookAt":48,"./multiply":49,"./ortho":50,"./perspective":51,"./perspectiveFromFieldOfView":52,"./rotate":53,"./rotateX":54,"./rotateY":55,"./rotateZ":56,"./scale":57,"./str":58,"./translate":59,"./transpose":60}],47:[function(t,e,r){e.exports=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15],g=r*s-n*a,v=r*u-i*a,x=r*l-o*a,b=n*u-i*s,w=n*l-o*s,E=i*l-o*u,A=c*m-h*d,T=c*y-p*d,M=c*_-f*d,S=h*y-p*m,R=h*_-f*m,I=p*_-f*y,C=g*I-v*R+x*S+b*M-w*T+E*A;if(!C)return null;return t[0]=(s*I-u*R+l*S)*(C=1/C),t[1]=(i*R-n*I-o*S)*C,t[2]=(m*E-y*w+_*b)*C,t[3]=(p*w-h*E-f*b)*C,t[4]=(u*M-a*I-l*T)*C,t[5]=(r*I-i*M+o*T)*C,t[6]=(y*x-d*E-_*v)*C,t[7]=(c*E-p*x+f*v)*C,t[8]=(a*R-s*M+l*A)*C,t[9]=(n*M-r*R-o*A)*C,t[10]=(d*w-m*x+_*g)*C,t[11]=(h*x-c*w-f*g)*C,t[12]=(s*T-a*S-u*A)*C,t[13]=(r*S-n*T+i*A)*C,t[14]=(m*v-d*b-y*g)*C,t[15]=(c*b-h*v+p*g)*C,t}},{}],48:[function(t,e,r){var n=t("./identity");e.exports=function(t,e,r,i){var o,a,s,u,l,c,h,p,f,d,m=e[0],y=e[1],_=e[2],g=i[0],v=i[1],x=i[2],b=r[0],w=r[1],E=r[2];if(Math.abs(m-b)<1e-6&&Math.abs(y-w)<1e-6&&Math.abs(_-E)<1e-6)return n(t);h=m-b,p=y-w,f=_-E,d=1/Math.sqrt(h*h+p*p+f*f),o=v*(f*=d)-x*(p*=d),a=x*(h*=d)-g*f,s=g*p-v*h,(d=Math.sqrt(o*o+a*a+s*s))?(o*=d=1/d,a*=d,s*=d):(o=0,a=0,s=0);u=p*s-f*a,l=f*o-h*s,c=h*a-p*o,(d=Math.sqrt(u*u+l*l+c*c))?(u*=d=1/d,l*=d,c*=d):(u=0,l=0,c=0);return t[0]=o,t[1]=u,t[2]=h,t[3]=0,t[4]=a,t[5]=l,t[6]=p,t[7]=0,t[8]=s,t[9]=c,t[10]=f,t[11]=0,t[12]=-(o*m+a*y+s*_),t[13]=-(u*m+l*y+c*_),t[14]=-(h*m+p*y+f*_),t[15]=1,t}},{"./identity":45}],49:[function(t,e,r){e.exports=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],y=e[13],_=e[14],g=e[15],v=r[0],x=r[1],b=r[2],w=r[3];return t[0]=v*n+x*s+b*h+w*m,t[1]=v*i+x*u+b*p+w*y,t[2]=v*o+x*l+b*f+w*_,t[3]=v*a+x*c+b*d+w*g,t[4]=(v=r[4])*n+(x=r[5])*s+(b=r[6])*h+(w=r[7])*m,t[5]=v*i+x*u+b*p+w*y,t[6]=v*o+x*l+b*f+w*_,t[7]=v*a+x*c+b*d+w*g,t[8]=(v=r[8])*n+(x=r[9])*s+(b=r[10])*h+(w=r[11])*m,t[9]=v*i+x*u+b*p+w*y,t[10]=v*o+x*l+b*f+w*_,t[11]=v*a+x*c+b*d+w*g,t[12]=(v=r[12])*n+(x=r[13])*s+(b=r[14])*h+(w=r[15])*m,t[13]=v*i+x*u+b*p+w*y,t[14]=v*o+x*l+b*f+w*_,t[15]=v*a+x*c+b*d+w*g,t}},{}],50:[function(t,e,r){e.exports=function(t,e,r,n,i,o,a){var s=1/(e-r),u=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(a+o)*l,t[15]=1,t}},{}],51:[function(t,e,r){e.exports=function(t,e,r,n,i){var o=1/Math.tan(e/2),a=1/(n-i);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*a,t[15]=0,t}},{}],52:[function(t,e,r){e.exports=function(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*l*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}},{}],53:[function(t,e,r){e.exports=function(t,e,r,n){var i,o,a,s,u,l,c,h,p,f,d,m,y,_,g,v,x,b,w,E,A,T,M,S,R=n[0],I=n[1],C=n[2],P=Math.sqrt(R*R+I*I+C*C);if(Math.abs(P)<1e-6)return null;R*=P=1/P,I*=P,C*=P,i=Math.sin(r),o=Math.cos(r),u=e[1],l=e[2],c=e[3],p=e[5],f=e[6],d=e[7],y=e[9],_=e[10],g=e[11],w=R*I*(a=1-o)-C*i,E=I*I*a+o,A=C*I*a+R*i,T=R*C*a+I*i,M=I*C*a-R*i,S=C*C*a+o,t[0]=(s=e[0])*(v=R*R*a+o)+(h=e[4])*(x=I*R*a+C*i)+(m=e[8])*(b=C*R*a-I*i),t[1]=u*v+p*x+y*b,t[2]=l*v+f*x+_*b,t[3]=c*v+d*x+g*b,t[4]=s*w+h*E+m*A,t[5]=u*w+p*E+y*A,t[6]=l*w+f*E+_*A,t[7]=c*w+d*E+g*A,t[8]=s*T+h*M+m*S,t[9]=u*T+p*M+y*S,t[10]=l*T+f*M+_*S,t[11]=c*T+d*M+g*S,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t}},{}],54:[function(t,e,r){e.exports=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[4]=o*i+l*n,t[5]=a*i+c*n,t[6]=s*i+h*n,t[7]=u*i+p*n,t[8]=l*i-o*n,t[9]=c*i-a*n,t[10]=h*i-s*n,t[11]=p*i-u*n,t}},{}],55:[function(t,e,r){e.exports=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],p=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[0]=o*i-l*n,t[1]=a*i-c*n,t[2]=s*i-h*n,t[3]=u*i-p*n,t[8]=o*n+l*i,t[9]=a*n+c*i,t[10]=s*n+h*i,t[11]=u*n+p*i,t}},{}],56:[function(t,e,r){e.exports=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);return t[0]=o*i+l*n,t[1]=a*i+c*n,t[2]=s*i+h*n,t[3]=u*i+p*n,t[4]=l*i-o*n,t[5]=c*i-a*n,t[6]=h*i-s*n,t[7]=p*i-u*n,t}},{}],57:[function(t,e,r){e.exports=function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}},{}],58:[function(t,e,r){e.exports=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}},{}],59:[function(t,e,r){e.exports=function(t,e,r){var n,i,o,a,s,u,l,c,h,p,f,d,m=r[0],y=r[1],_=r[2];e===t?(t[12]=e[0]*m+e[4]*y+e[8]*_+e[12],t[13]=e[1]*m+e[5]*y+e[9]*_+e[13],t[14]=e[2]*m+e[6]*y+e[10]*_+e[14],t[15]=e[3]*m+e[7]*y+e[11]*_+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=n=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=n*m+s*y+h*_+e[12],t[13]=i*m+u*y+p*_+e[13],t[14]=o*m+l*y+f*_+e[14],t[15]=a*m+c*y+d*_+e[15]);return t}},{}],60:[function(t,e,r){e.exports=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}},{}],61:[function(t,e,r){!function(t,n){if("object"==typeof r&&"object"==typeof e)e.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var i=n();for(var o in i)("object"==typeof r?r:t)[o]=i[o]}}("undefined"!=typeof self?self:this,function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=10)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=function(t){e.ARRAY_TYPE=t},e.toRadian=function(t){return t*i},e.equals=function(t,e){return Math.abs(t-e)<=n*Math.max(1,Math.abs(t),Math.abs(e))};var n=e.EPSILON=1e-6;e.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,e.RANDOM=Math.random;var i=Math.PI/180},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=i,e.clone=function(t){var e=new n.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.fromValues=function(t,e,r,i){var o=new n.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.set=function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},e.subtract=o,e.multiply=a,e.divide=s,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},e.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},e.distance=u,e.squaredDistance=l,e.length=c,e.squaredLength=h,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},e.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=o*a),t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},e.lerp=function(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t[3]=s+n*(r[3]-s),t},e.random=function(t,e){var r,i,o,a,s,u;e=e||1;do{s=(r=2*n.RANDOM()-1)*r+(i=2*n.RANDOM()-1)*i}while(s>=1);do{u=(o=2*n.RANDOM()-1)*o+(a=2*n.RANDOM()-1)*a}while(u>=1);var l=Math.sqrt((1-s)/u);return t[0]=e*r,t[1]=e*i,t[2]=e*o*l,t[3]=e*a*l,t},e.transformMat4=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t},e.transformQuat=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2],l=r[3],c=l*n+s*o-u*i,h=l*i+u*n-a*o,p=l*o+a*i-s*n,f=-a*n-s*i-u*o;return t[0]=c*l+f*-a+h*-u-p*-s,t[1]=h*l+f*-s+p*-a-c*-u,t[2]=p*l+f*-u+c*-s-h*-a,t[3]=e[3],t},e.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=e[0],u=e[1],l=e[2],c=e[3];return Math.abs(r-s)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-l)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-c)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function i(){var t=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function o(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function a(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function s(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function u(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+n*n+i*i+o*o)}function l(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return r*r+n*n+i*i+o*o}function c(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)}function h(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}e.sub=o,e.mul=a,e.div=s,e.dist=u,e.sqrDist=l,e.len=c,e.sqrLen=h,e.forEach=function(){var t=i();return function(e,r,n,i,o,a){var s,u=void 0;for(r||(r=4),n||(n=0),s=i?Math.min(i*r+n,e.length):e.length,u=n;u<s;u+=r)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],t[3]=e[u+3],o(t,t,a),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];return e}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=i,e.clone=function(t){var e=new n.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},e.length=o,e.fromValues=a,e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},e.subtract=s,e.multiply=u,e.divide=l,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},e.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},e.distance=c,e.squaredDistance=h,e.squaredLength=p,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},e.normalize=f,e.dot=d,e.cross=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2];return t[0]=i*u-o*s,t[1]=o*a-n*u,t[2]=n*s-i*a,t},e.lerp=function(t,e,r,n){var i=e[0],o=e[1],a=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t},e.hermite=function(t,e,r,n,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+r[0]*u+n[0]*l+i[0]*c,t[1]=e[1]*s+r[1]*u+n[1]*l+i[1]*c,t[2]=e[2]*s+r[2]*u+n[2]*l+i[2]*c,t},e.bezier=function(t,e,r,n,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,p=u*o;return t[0]=e[0]*l+r[0]*c+n[0]*h+i[0]*p,t[1]=e[1]*l+r[1]*c+n[1]*h+i[1]*p,t[2]=e[2]*l+r[2]*c+n[2]*h+i[2]*p,t},e.random=function(t,e){e=e||1;var r=2*n.RANDOM()*Math.PI,i=2*n.RANDOM()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*o,t[1]=Math.sin(r)*o,t[2]=i*e,t},e.transformMat4=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/(a=a||1),t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t},e.transformMat3=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t},e.transformQuat=function(t,e,r){var n=r[0],i=r[1],o=r[2],a=e[0],s=e[1],u=e[2],l=i*u-o*s,c=o*a-n*u,h=n*s-i*a,p=i*h-o*c,f=o*l-n*h,d=n*c-i*l,m=2*r[3];return c*=m,h*=m,f*=2,d*=2,t[0]=a+(l*=m)+(p*=2),t[1]=s+c+f,t[2]=u+h+d,t},e.rotateX=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},e.rotateY=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},e.rotateZ=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},e.angle=function(t,e){var r=a(t[0],t[1],t[2]),n=a(e[0],e[1],e[2]);f(r,r),f(n,n);var i=d(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)},e.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},e.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(r-a)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function i(){var t=new n.ARRAY_TYPE(3);return n.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function o(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function a(t,e,r){var i=new n.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=r,i}function s(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function u(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function l(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function c(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)}function h(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function p(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function f(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function d(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}e.sub=s,e.mul=u,e.div=l,e.dist=c,e.sqrDist=h,e.len=o,e.sqrLen=p,e.forEach=function(){var t=i();return function(e,r,n,i,o,a){var s,u=void 0;for(r||(r=3),n||(n=0),s=i?Math.min(i*r+n,e.length):e.length,u=n;u<s;u+=r)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],o(t,t,a),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2];return e}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setAxes=e.sqlerp=e.rotationTo=e.equals=e.exactEquals=e.normalize=e.sqrLen=e.squaredLength=e.len=e.length=e.lerp=e.dot=e.scale=e.mul=e.add=e.set=e.copy=e.fromValues=e.clone=void 0,e.create=u,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},e.setAxisAngle=l,e.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>n.EPSILON?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r},e.multiply=c,e.rotateX=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-n*s,t},e.rotateY=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u-o*s,t[1]=i*u+a*s,t[2]=o*u+n*s,t[3]=a*u-i*s,t},e.rotateZ=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t},e.calculateW=function(t,e){var r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t},e.slerp=h,e.random=function(t){var e=n.RANDOM(),r=n.RANDOM(),i=n.RANDOM(),o=Math.sqrt(1-e),a=Math.sqrt(e);return t[0]=o*Math.sin(2*Math.PI*r),t[1]=o*Math.cos(2*Math.PI*r),t[2]=a*Math.sin(2*Math.PI*i),t[3]=a*Math.cos(2*Math.PI*i),t},e.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o,s=a?1/a:0;return t[0]=-r*s,t[1]=-n*s,t[2]=-i*s,t[3]=o*s,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},e.fromMat3=p,e.fromEuler=function(t,e,r,n){var i=.5*Math.PI/180;e*=i,r*=i,n*=i;var o=Math.sin(e),a=Math.cos(e),s=Math.sin(r),u=Math.cos(r),l=Math.sin(n),c=Math.cos(n);return t[0]=o*u*c-a*s*l,t[1]=a*s*c+o*u*l,t[2]=a*u*l-o*s*c,t[3]=a*u*c+o*s*l,t},e.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"};var n=s(r(0)),i=s(r(5)),o=s(r(2)),a=s(r(1));function s(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function u(){var t=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function l(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function c(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],u=r[1],l=r[2],c=r[3];return t[0]=n*c+a*s+i*l-o*u,t[1]=i*c+a*u+o*s-n*l,t[2]=o*c+a*l+n*u-i*s,t[3]=a*c-n*s-i*u-o*l,t}function h(t,e,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=r[0],c=r[1],h=r[2],p=r[3],f=void 0,d=void 0,m=void 0,y=void 0,_=void 0;return(d=o*l+a*c+s*h+u*p)<0&&(d=-d,l=-l,c=-c,h=-h,p=-p),1-d>n.EPSILON?(f=Math.acos(d),m=Math.sin(f),y=Math.sin((1-i)*f)/m,_=Math.sin(i*f)/m):(y=1-i,_=i),t[0]=y*o+_*l,t[1]=y*a+_*c,t[2]=y*s+_*h,t[3]=y*u+_*p,t}function p(t,e){var r=e[0]+e[4]+e[8],n=void 0;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*n,t[3]=(e[3*o+a]-e[3*a+o])*(n=.5/n),t[o]=(e[3*o+i]+e[3*i+o])*n,t[a]=(e[3*a+i]+e[3*i+a])*n}return t}e.clone=a.clone,e.fromValues=a.fromValues,e.copy=a.copy,e.set=a.set,e.add=a.add,e.mul=c,e.scale=a.scale,e.dot=a.dot,e.lerp=a.lerp;var f=e.length=a.length,d=(e.len=f,e.squaredLength=a.squaredLength),m=(e.sqrLen=d,e.normalize=a.normalize);e.exactEquals=a.exactEquals,e.equals=a.equals,e.rotationTo=function(){var t=o.create(),e=o.fromValues(1,0,0),r=o.fromValues(0,1,0);return function(n,i,a){var s=o.dot(i,a);return s<-.999999?(o.cross(t,e,i),o.len(t)<1e-6&&o.cross(t,r,i),o.normalize(t,t),l(n,t,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(o.cross(t,i,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+s,m(n,n))}}(),e.sqlerp=function(){var t=u(),e=u();return function(r,n,i,o,a,s){return h(t,n,a,s),h(e,i,o,s),h(r,t,e,2*s*(1-s)),r}}(),e.setAxes=function(){var t=i.create();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],m(e,p(e,t))}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=function(){var t=new n.ARRAY_TYPE(16);return n.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},e.clone=function(t){var e=new n.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.fromValues=function(t,e,r,i,o,a,s,u,l,c,h,p,f,d,m,y){var _=new n.ARRAY_TYPE(16);return _[0]=t,_[1]=e,_[2]=r,_[3]=i,_[4]=o,_[5]=a,_[6]=s,_[7]=u,_[8]=l,_[9]=c,_[10]=h,_[11]=p,_[12]=f,_[13]=d,_[14]=m,_[15]=y,_},e.set=function(t,e,r,n,i,o,a,s,u,l,c,h,p,f,d,m,y){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=c,t[10]=h,t[11]=p,t[12]=f,t[13]=d,t[14]=m,t[15]=y,t},e.identity=i,e.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},e.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15],g=r*s-n*a,v=r*u-i*a,x=r*l-o*a,b=n*u-i*s,w=n*l-o*s,E=i*l-o*u,A=c*m-h*d,T=c*y-p*d,M=c*_-f*d,S=h*y-p*m,R=h*_-f*m,I=p*_-f*y,C=g*I-v*R+x*S+b*M-w*T+E*A;return C?(t[0]=(s*I-u*R+l*S)*(C=1/C),t[1]=(i*R-n*I-o*S)*C,t[2]=(m*E-y*w+_*b)*C,t[3]=(p*w-h*E-f*b)*C,t[4]=(u*M-a*I-l*T)*C,t[5]=(r*I-i*M+o*T)*C,t[6]=(y*x-d*E-_*v)*C,t[7]=(c*E-p*x+f*v)*C,t[8]=(a*R-s*M+l*A)*C,t[9]=(n*M-r*R-o*A)*C,t[10]=(d*w-m*x+_*g)*C,t[11]=(h*x-c*w-f*g)*C,t[12]=(s*T-a*S-u*A)*C,t[13]=(r*S-n*T+i*A)*C,t[14]=(m*v-d*b-y*g)*C,t[15]=(c*b-h*v+p*g)*C,t):null},e.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15];return t[0]=s*(p*_-f*y)-h*(u*_-l*y)+m*(u*f-l*p),t[1]=-(n*(p*_-f*y)-h*(i*_-o*y)+m*(i*f-o*p)),t[2]=n*(u*_-l*y)-s*(i*_-o*y)+m*(i*l-o*u),t[3]=-(n*(u*f-l*p)-s*(i*f-o*p)+h*(i*l-o*u)),t[4]=-(a*(p*_-f*y)-c*(u*_-l*y)+d*(u*f-l*p)),t[5]=r*(p*_-f*y)-c*(i*_-o*y)+d*(i*f-o*p),t[6]=-(r*(u*_-l*y)-a*(i*_-o*y)+d*(i*l-o*u)),t[7]=r*(u*f-l*p)-a*(i*f-o*p)+c*(i*l-o*u),t[8]=a*(h*_-f*m)-c*(s*_-l*m)+d*(s*f-l*h),t[9]=-(r*(h*_-f*m)-c*(n*_-o*m)+d*(n*f-o*h)),t[10]=r*(s*_-l*m)-a*(n*_-o*m)+d*(n*l-o*s),t[11]=-(r*(s*f-l*h)-a*(n*f-o*h)+c*(n*l-o*s)),t[12]=-(a*(h*y-p*m)-c*(s*y-u*m)+d*(s*p-u*h)),t[13]=r*(h*y-p*m)-c*(n*y-i*m)+d*(n*p-i*h),t[14]=-(r*(s*y-u*m)-a*(n*y-i*m)+d*(n*u-i*s)),t[15]=r*(s*p-u*h)-a*(n*p-i*h)+c*(n*u-i*s),t},e.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],f=t[12],d=t[13],m=t[14],y=t[15];return(e*a-r*o)*(h*y-p*m)-(e*s-n*o)*(c*y-p*d)+(e*u-i*o)*(c*m-h*d)+(r*s-n*a)*(l*y-p*f)-(r*u-i*a)*(l*m-h*f)+(n*u-i*s)*(l*d-c*f)},e.multiply=o,e.translate=function(t,e,r){var n=r[0],i=r[1],o=r[2],a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,p=void 0,f=void 0,d=void 0,m=void 0,y=void 0,_=void 0;return e===t?(t[12]=e[0]*n+e[4]*i+e[8]*o+e[12],t[13]=e[1]*n+e[5]*i+e[9]*o+e[13],t[14]=e[2]*n+e[6]*i+e[10]*o+e[14],t[15]=e[3]*n+e[7]*i+e[11]*o+e[15]):(s=e[1],u=e[2],l=e[3],c=e[4],h=e[5],p=e[6],f=e[7],d=e[8],m=e[9],y=e[10],_=e[11],t[0]=a=e[0],t[1]=s,t[2]=u,t[3]=l,t[4]=c,t[5]=h,t[6]=p,t[7]=f,t[8]=d,t[9]=m,t[10]=y,t[11]=_,t[12]=a*n+c*i+d*o+e[12],t[13]=s*n+h*i+m*o+e[13],t[14]=u*n+p*i+y*o+e[14],t[15]=l*n+f*i+_*o+e[15]),t},e.scale=function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.rotate=function(t,e,r,i){var o,a,s,u,l,c,h,p,f,d,m,y,_,g,v,x,b,w,E,A,T,M,S,R,I=i[0],C=i[1],P=i[2],D=Math.sqrt(I*I+C*C+P*P);return D<n.EPSILON?null:(I*=D=1/D,C*=D,P*=D,o=Math.sin(r),a=Math.cos(r),l=e[1],c=e[2],h=e[3],f=e[5],d=e[6],m=e[7],_=e[9],g=e[10],v=e[11],E=I*C*(s=1-a)-P*o,A=C*C*s+a,T=P*C*s+I*o,M=I*P*s+C*o,S=C*P*s-I*o,R=P*P*s+a,t[0]=(u=e[0])*(x=I*I*s+a)+(p=e[4])*(b=C*I*s+P*o)+(y=e[8])*(w=P*I*s-C*o),t[1]=l*x+f*b+_*w,t[2]=c*x+d*b+g*w,t[3]=h*x+m*b+v*w,t[4]=u*E+p*A+y*T,t[5]=l*E+f*A+_*T,t[6]=c*E+d*A+g*T,t[7]=h*E+m*A+v*T,t[8]=u*M+p*S+y*R,t[9]=l*M+f*S+_*R,t[10]=c*M+d*S+g*R,t[11]=h*M+m*S+v*R,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},e.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*n,t[5]=a*i+c*n,t[6]=s*i+h*n,t[7]=u*i+p*n,t[8]=l*i-o*n,t[9]=c*i-a*n,t[10]=h*i-s*n,t[11]=p*i-u*n,t},e.rotateY=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*n,t[1]=a*i-c*n,t[2]=s*i-h*n,t[3]=u*i-p*n,t[8]=o*n+l*i,t[9]=a*n+c*i,t[10]=s*n+h*i,t[11]=u*n+p*i,t},e.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*n,t[1]=a*i+c*n,t[2]=s*i+h*n,t[3]=u*i+p*n,t[4]=l*i-o*n,t[5]=c*i-a*n,t[6]=h*i-s*n,t[7]=p*i-u*n,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotation=function(t,e,r){var i,o,a,s=r[0],u=r[1],l=r[2],c=Math.sqrt(s*s+u*u+l*l);return c<n.EPSILON?null:(s*=c=1/c,u*=c,l*=c,i=Math.sin(e),o=Math.cos(e),t[0]=s*s*(a=1-o)+o,t[1]=u*s*a+l*i,t[2]=l*s*a-u*i,t[3]=0,t[4]=s*u*a-l*i,t[5]=u*u*a+o,t[6]=l*u*a+s*i,t[7]=0,t[8]=s*l*a+u*i,t[9]=u*l*a-s*i,t[10]=l*l*a+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},e.fromXRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromYRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromZRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.fromRotationTranslation=a,e.fromQuat2=function(t,e){var r=new n.ARRAY_TYPE(3),i=-e[0],o=-e[1],s=-e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7],f=i*i+o*o+s*s+u*u;return f>0?(r[0]=2*(l*u+p*i+c*s-h*o)/f,r[1]=2*(c*u+p*o+h*i-l*s)/f,r[2]=2*(h*u+p*s+l*o-c*i)/f):(r[0]=2*(l*u+p*i+c*s-h*o),r[1]=2*(c*u+p*o+h*i-l*s),r[2]=2*(h*u+p*s+l*o-c*i)),a(t,e,r),t},e.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},e.getScaling=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],l=e[9],c=e[10];return t[0]=Math.sqrt(r*r+n*n+i*i),t[1]=Math.sqrt(o*o+a*a+s*s),t[2]=Math.sqrt(u*u+l*l+c*c),t},e.getRotation=function(t,e){var r=e[0]+e[5]+e[10],n=0;return r>0?(n=2*Math.sqrt(r+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t},e.fromRotationTranslationScale=function(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,l=o+o,c=a+a,h=i*u,p=i*l,f=i*c,d=o*l,m=o*c,y=a*c,_=s*u,g=s*l,v=s*c,x=n[0],b=n[1],w=n[2];return t[0]=(1-(d+y))*x,t[1]=(p+v)*x,t[2]=(f-g)*x,t[3]=0,t[4]=(p-v)*b,t[5]=(1-(h+y))*b,t[6]=(m+_)*b,t[7]=0,t[8]=(f+g)*w,t[9]=(m-_)*w,t[10]=(1-(h+d))*w,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},e.fromRotationTranslationScaleOrigin=function(t,e,r,n,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,c=a+a,h=s+s,p=o*l,f=o*c,d=o*h,m=a*c,y=a*h,_=s*h,g=u*l,v=u*c,x=u*h,b=n[0],w=n[1],E=n[2],A=i[0],T=i[1],M=i[2],S=(1-(m+_))*b,R=(f+x)*b,I=(d-v)*b,C=(f-x)*w,P=(1-(p+_))*w,D=(y+g)*w,L=(d+v)*E,O=(y-g)*E,k=(1-(p+m))*E;return t[0]=S,t[1]=R,t[2]=I,t[3]=0,t[4]=C,t[5]=P,t[6]=D,t[7]=0,t[8]=L,t[9]=O,t[10]=k,t[11]=0,t[12]=r[0]+A-(S*A+C*T+L*M),t[13]=r[1]+T-(R*A+P*T+O*M),t[14]=r[2]+M-(I*A+D*T+k*M),t[15]=1,t},e.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,l=r*a,c=n*a,h=n*s,p=i*a,f=i*s,d=i*u,m=o*a,y=o*s,_=o*u;return t[0]=1-h-d,t[1]=c+_,t[2]=p-y,t[3]=0,t[4]=c-_,t[5]=1-l-d,t[6]=f+m,t[7]=0,t[8]=p+y,t[9]=f-m,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},e.frustum=function(t,e,r,n,i,o,a){var s=1/(r-e),u=1/(i-n),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t},e.perspective=function(t,e,r,n,i){var o=1/Math.tan(e/2),a=void 0;return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(a=1/(n-i)),t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t},e.perspectiveFromFieldOfView=function(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*l*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},e.ortho=function(t,e,r,n,i,o,a){var s=1/(e-r),u=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(a+o)*l,t[15]=1,t},e.lookAt=function(t,e,r,o){var a=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,p=void 0,f=void 0,d=void 0,m=void 0,y=e[0],_=e[1],g=e[2],v=o[0],x=o[1],b=o[2],w=r[0],E=r[1],A=r[2];return Math.abs(y-w)<n.EPSILON&&Math.abs(_-E)<n.EPSILON&&Math.abs(g-A)<n.EPSILON?i(t):(p=y-w,f=_-E,d=g-A,a=x*(d*=m=1/Math.sqrt(p*p+f*f+d*d))-b*(f*=m),s=b*(p*=m)-v*d,u=v*f-x*p,(m=Math.sqrt(a*a+s*s+u*u))?(a*=m=1/m,s*=m,u*=m):(a=0,s=0,u=0),l=f*u-d*s,c=d*a-p*u,h=p*s-f*a,(m=Math.sqrt(l*l+c*c+h*h))?(l*=m=1/m,c*=m,h*=m):(l=0,c=0,h=0),t[0]=a,t[1]=l,t[2]=p,t[3]=0,t[4]=s,t[5]=c,t[6]=f,t[7]=0,t[8]=u,t[9]=h,t[10]=d,t[11]=0,t[12]=-(a*y+s*_+u*g),t[13]=-(l*y+c*_+h*g),t[14]=-(p*y+f*_+d*g),t[15]=1,t)},e.targetTo=function(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=n[0],u=n[1],l=n[2],c=i-r[0],h=o-r[1],p=a-r[2],f=c*c+h*h+p*p;f>0&&(c*=f=1/Math.sqrt(f),h*=f,p*=f);var d=u*p-l*h,m=l*c-s*p,y=s*h-u*c;return(f=d*d+m*m+y*y)>0&&(d*=f=1/Math.sqrt(f),m*=f,y*=f),t[0]=d,t[1]=m,t[2]=y,t[3]=0,t[4]=h*y-p*m,t[5]=p*d-c*y,t[6]=c*m-h*d,t[7]=0,t[8]=c,t[9]=h,t[10]=p,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t},e.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},e.subtract=s,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},e.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},e.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],d=t[11],m=t[12],y=t[13],_=t[14],g=t[15],v=e[0],x=e[1],b=e[2],w=e[3],E=e[4],A=e[5],T=e[6],M=e[7],S=e[8],R=e[9],I=e[10],C=e[11],P=e[12],D=e[13],L=e[14],O=e[15];return Math.abs(r-v)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-x)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-w)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-E)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-A)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-T)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-M)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(h-S)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(p-R)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(f-I)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(d-C)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(m-P)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(y-D)<=n.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))&&Math.abs(_-L)<=n.EPSILON*Math.max(1,Math.abs(_),Math.abs(L))&&Math.abs(g-O)<=n.EPSILON*Math.max(1,Math.abs(g),Math.abs(O))};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function i(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function o(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],y=e[13],_=e[14],g=e[15],v=r[0],x=r[1],b=r[2],w=r[3];return t[0]=v*n+x*s+b*h+w*m,t[1]=v*i+x*u+b*p+w*y,t[2]=v*o+x*l+b*f+w*_,t[3]=v*a+x*c+b*d+w*g,t[4]=(v=r[4])*n+(x=r[5])*s+(b=r[6])*h+(w=r[7])*m,t[5]=v*i+x*u+b*p+w*y,t[6]=v*o+x*l+b*f+w*_,t[7]=v*a+x*c+b*d+w*g,t[8]=(v=r[8])*n+(x=r[9])*s+(b=r[10])*h+(w=r[11])*m,t[9]=v*i+x*u+b*p+w*y,t[10]=v*o+x*l+b*f+w*_,t[11]=v*a+x*c+b*d+w*g,t[12]=(v=r[12])*n+(x=r[13])*s+(b=r[14])*h+(w=r[15])*m,t[13]=v*i+x*u+b*p+w*y,t[14]=v*o+x*l+b*f+w*_,t[15]=v*a+x*c+b*d+w*g,t}function a(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,u=i+i,l=o+o,c=n*s,h=n*u,p=n*l,f=i*u,d=i*l,m=o*l,y=a*s,_=a*u,g=a*l;return t[0]=1-(f+m),t[1]=h+g,t[2]=p-_,t[3]=0,t[4]=h-g,t[5]=1-(c+m),t[6]=d+y,t[7]=0,t[8]=p+_,t[9]=d-y,t[10]=1-(c+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function s(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}e.mul=o,e.sub=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=function(){var t=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},e.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},e.clone=function(t){var e=new n.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromValues=function(t,e,r,i,o,a,s,u,l){var c=new n.ARRAY_TYPE(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=o,c[5]=a,c[6]=s,c[7]=u,c[8]=l,c},e.set=function(t,e,r,n,i,o,a,s,u,l){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},e.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=c*a-s*l,p=-c*o+s*u,f=l*o-a*u,d=r*h+n*p+i*f;return d?(t[0]=h*(d=1/d),t[1]=(-c*n+i*l)*d,t[2]=(s*n-i*a)*d,t[3]=p*d,t[4]=(c*r-i*u)*d,t[5]=(-s*r+i*o)*d,t[6]=f*d,t[7]=(-l*r+n*u)*d,t[8]=(a*r-n*o)*d,t):null},e.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8];return t[0]=a*c-s*l,t[1]=i*l-n*c,t[2]=n*s-i*a,t[3]=s*u-o*c,t[4]=r*c-i*u,t[5]=i*o-r*s,t[6]=o*l-a*u,t[7]=n*u-r*l,t[8]=r*a-n*o,t},e.determinant=function(t){var e=t[3],r=t[4],n=t[5],i=t[6],o=t[7],a=t[8];return t[0]*(a*r-n*o)+t[1]*(-a*e+n*i)+t[2]*(o*e-r*i)},e.multiply=i,e.translate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=r[0],f=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=p*n+f*a+l,t[7]=p*i+f*s+c,t[8]=p*o+f*u+h,t},e.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=Math.sin(r),f=Math.cos(r);return t[0]=f*n+p*a,t[1]=f*i+p*s,t[2]=f*o+p*u,t[3]=f*a-p*n,t[4]=f*s-p*i,t[5]=f*u-p*o,t[6]=l,t[7]=c,t[8]=h,t},e.scale=function(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},e.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},e.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},e.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,l=r*a,c=n*a,h=n*s,p=i*a,f=i*s,d=i*u,m=o*a,y=o*s,_=o*u;return t[0]=1-h-d,t[3]=c-_,t[6]=p+y,t[1]=c+_,t[4]=1-l-d,t[7]=f-m,t[2]=p-y,t[5]=f+m,t[8]=1-l-h,t},e.normalFromMat4=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15],g=r*s-n*a,v=r*u-i*a,x=r*l-o*a,b=n*u-i*s,w=n*l-o*s,E=i*l-o*u,A=c*m-h*d,T=c*y-p*d,M=c*_-f*d,S=h*y-p*m,R=h*_-f*m,I=p*_-f*y,C=g*I-v*R+x*S+b*M-w*T+E*A;return C?(t[0]=(s*I-u*R+l*S)*(C=1/C),t[1]=(u*M-a*I-l*T)*C,t[2]=(a*R-s*M+l*A)*C,t[3]=(i*R-n*I-o*S)*C,t[4]=(r*I-i*M+o*T)*C,t[5]=(n*M-r*R-o*A)*C,t[6]=(m*E-y*w+_*b)*C,t[7]=(y*x-d*E-_*v)*C,t[8]=(d*w-m*x+_*g)*C,t):null},e.projection=function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},e.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},e.subtract=o,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},e.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},e.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],p=e[0],f=e[1],d=e[2],m=e[3],y=e[4],_=e[5],g=e[6],v=e[7],x=e[8];return Math.abs(r-p)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(i-f)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(o-d)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-m)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-y)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(u-_)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(l-g)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-v)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(h-x)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(x))};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function i(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=r[0],f=r[1],d=r[2],m=r[3],y=r[4],_=r[5],g=r[6],v=r[7],x=r[8];return t[0]=p*n+f*a+d*l,t[1]=p*i+f*s+d*c,t[2]=p*o+f*u+d*h,t[3]=m*n+y*a+_*l,t[4]=m*i+y*s+_*c,t[5]=m*o+y*u+_*h,t[6]=g*n+v*a+x*l,t[7]=g*i+v*s+x*c,t[8]=g*o+v*u+x*h,t}function o(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}e.mul=i,e.sub=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.sqrDist=e.dist=e.div=e.mul=e.sub=e.len=void 0,e.create=i,e.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},e.fromValues=function(t,e){var r=new n.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},e.set=function(t,e,r){return t[0]=e,t[1]=r,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},e.subtract=o,e.multiply=a,e.divide=s,e.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},e.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},e.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},e.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},e.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},e.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},e.distance=u,e.squaredDistance=l,e.length=c,e.squaredLength=h,e.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},e.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},e.normalize=function(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},e.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},e.cross=function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},e.lerp=function(t,e,r,n){var i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t},e.random=function(t,e){e=e||1;var r=2*n.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},e.transformMat2=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t},e.transformMat2d=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t},e.transformMat3=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t},e.transformMat4=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t},e.rotate=function(t,e,r,n){var i=e[0]-r[0],o=e[1]-r[1],a=Math.sin(n),s=Math.cos(n);return t[0]=i*s-o*a+r[0],t[1]=i*a+o*s+r[1],t},e.angle=function(t,e){var r=t[0],n=t[1],i=e[0],o=e[1],a=r*r+n*n;a>0&&(a=1/Math.sqrt(a));var s=i*i+o*o;s>0&&(s=1/Math.sqrt(s));var u=(r*i+n*o)*a*s;return u>1?0:u<-1?Math.PI:Math.acos(u)},e.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},e.equals=function(t,e){var r=t[0],i=t[1],o=e[0],a=e[1];return Math.abs(r-o)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function i(){var t=new n.ARRAY_TYPE(2);return n.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function o(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function a(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function s(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function u(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}function l(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function c(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function h(t){var e=t[0],r=t[1];return e*e+r*r}e.len=c,e.sub=o,e.mul=a,e.div=s,e.dist=u,e.sqrDist=l,e.sqrLen=h,e.forEach=function(){var t=i();return function(e,r,n,i,o,a){var s,u=void 0;for(r||(r=2),n||(n=0),s=i?Math.min(i*r+n,e.length):e.length,u=n;u<s;u+=r)t[0]=e[u],t[1]=e[u+1],o(t,t,a),e[u]=t[0],e[u+1]=t[1];return e}}()},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sqrLen=e.squaredLength=e.len=e.length=e.dot=e.mul=e.setReal=e.getReal=void 0,e.create=function(){var t=new n.ARRAY_TYPE(8);return n.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},e.clone=function(t){var e=new n.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},e.fromValues=function(t,e,r,i,o,a,s,u){var l=new n.ARRAY_TYPE(8);return l[0]=t,l[1]=e,l[2]=r,l[3]=i,l[4]=o,l[5]=a,l[6]=s,l[7]=u,l},e.fromRotationTranslationValues=function(t,e,r,i,o,a,s){var u=new n.ARRAY_TYPE(8);u[0]=t,u[1]=e,u[2]=r,u[3]=i;var l=.5*o,c=.5*a,h=.5*s;return u[4]=l*i+c*r-h*e,u[5]=c*i+h*t-l*r,u[6]=h*i+l*e-c*t,u[7]=-l*t-c*e-h*r,u},e.fromRotationTranslation=s,e.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},e.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.fromMat4=function(t,e){var r=i.create();o.getRotation(r,e);var a=new n.ARRAY_TYPE(3);return o.getTranslation(a,e),s(t,r,a),t},e.copy=u,e.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},e.set=function(t,e,r,n,i,o,a,s,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t},e.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},e.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},e.getTranslation=function(t,e){var r=e[4],n=e[5],i=e[6],o=e[7],a=-e[0],s=-e[1],u=-e[2],l=e[3];return t[0]=2*(r*l+o*a+n*u-i*s),t[1]=2*(n*l+o*s+i*a-r*u),t[2]=2*(i*l+o*u+r*s-n*a),t},e.translate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=.5*r[0],u=.5*r[1],l=.5*r[2],c=e[4],h=e[5],p=e[6],f=e[7];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=a*s+i*l-o*u+c,t[5]=a*u+o*s-n*l+h,t[6]=a*l+n*u-i*s+p,t[7]=-n*s-i*u-o*l+f,t},e.rotateX=function(t,e,r){var n=-e[0],o=-e[1],a=-e[2],s=e[3],u=e[4],l=e[5],c=e[6],h=e[7],p=u*s+h*n+l*a-c*o,f=l*s+h*o+c*n-u*a,d=c*s+h*a+u*o-l*n,m=h*s-u*n-l*o-c*a;return i.rotateX(t,e,r),t[4]=p*(s=t[3])+m*(n=t[0])+f*(a=t[2])-d*(o=t[1]),t[5]=f*s+m*o+d*n-p*a,t[6]=d*s+m*a+p*o-f*n,t[7]=m*s-p*n-f*o-d*a,t},e.rotateY=function(t,e,r){var n=-e[0],o=-e[1],a=-e[2],s=e[3],u=e[4],l=e[5],c=e[6],h=e[7],p=u*s+h*n+l*a-c*o,f=l*s+h*o+c*n-u*a,d=c*s+h*a+u*o-l*n,m=h*s-u*n-l*o-c*a;return i.rotateY(t,e,r),t[4]=p*(s=t[3])+m*(n=t[0])+f*(a=t[2])-d*(o=t[1]),t[5]=f*s+m*o+d*n-p*a,t[6]=d*s+m*a+p*o-f*n,t[7]=m*s-p*n-f*o-d*a,t},e.rotateZ=function(t,e,r){var n=-e[0],o=-e[1],a=-e[2],s=e[3],u=e[4],l=e[5],c=e[6],h=e[7],p=u*s+h*n+l*a-c*o,f=l*s+h*o+c*n-u*a,d=c*s+h*a+u*o-l*n,m=h*s-u*n-l*o-c*a;return i.rotateZ(t,e,r),t[4]=p*(s=t[3])+m*(n=t[0])+f*(a=t[2])-d*(o=t[1]),t[5]=f*s+m*o+d*n-p*a,t[6]=d*s+m*a+p*o-f*n,t[7]=m*s-p*n-f*o-d*a,t},e.rotateByQuatAppend=function(t,e,r){var n=r[0],i=r[1],o=r[2],a=r[3],s=e[0],u=e[1],l=e[2],c=e[3];return t[0]=s*a+c*n+u*o-l*i,t[1]=u*a+c*i+l*n-s*o,t[2]=l*a+c*o+s*i-u*n,t[3]=c*a-s*n-u*i-l*o,t[4]=(s=e[4])*a+(c=e[7])*n+(u=e[5])*o-(l=e[6])*i,t[5]=u*a+c*i+l*n-s*o,t[6]=l*a+c*o+s*i-u*n,t[7]=c*a-s*n-u*i-l*o,t},e.rotateByQuatPrepend=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],u=r[1],l=r[2],c=r[3];return t[0]=n*c+a*s+i*l-o*u,t[1]=i*c+a*u+o*s-n*l,t[2]=o*c+a*l+n*u-i*s,t[3]=a*c-n*s-i*u-o*l,t[4]=n*(c=r[7])+a*(s=r[4])+i*(l=r[6])-o*(u=r[5]),t[5]=i*c+a*u+o*s-n*l,t[6]=o*c+a*l+n*u-i*s,t[7]=a*c-n*s-i*u-o*l,t},e.rotateAroundAxis=function(t,e,r,i){if(Math.abs(i)<n.EPSILON)return u(t,e);var o=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);i*=.5;var a=Math.sin(i),s=a*r[0]/o,l=a*r[1]/o,c=a*r[2]/o,h=Math.cos(i),p=e[0],f=e[1],d=e[2],m=e[3];t[0]=p*h+m*s+f*c-d*l,t[1]=f*h+m*l+d*s-p*c,t[2]=d*h+m*c+p*l-f*s,t[3]=m*h-p*s-f*l-d*c;var y=e[4],_=e[5],g=e[6],v=e[7];return t[4]=y*h+v*s+_*c-g*l,t[5]=_*h+v*l+g*s-y*c,t[6]=g*h+v*c+y*l-_*s,t[7]=v*h-y*s-_*l-g*c,t},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},e.multiply=l,e.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},e.lerp=function(t,e,r,n){var i=1-n;return c(e,r)<0&&(n=-n),t[0]=e[0]*i+r[0]*n,t[1]=e[1]*i+r[1]*n,t[2]=e[2]*i+r[2]*n,t[3]=e[3]*i+r[3]*n,t[4]=e[4]*i+r[4]*n,t[5]=e[5]*i+r[5]*n,t[6]=e[6]*i+r[6]*n,t[7]=e[7]*i+r[7]*n,t},e.invert=function(t,e){var r=p(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},e.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},e.normalize=function(t,e){var r=p(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,i=e[1]/r,o=e[2]/r,a=e[3]/r,s=e[4],u=e[5],l=e[6],c=e[7],h=n*s+i*u+o*l+a*c;t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=(s-n*h)/r,t[5]=(u-i*h)/r,t[6]=(l-o*h)/r,t[7]=(c-a*h)/r}return t},e.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},e.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=e[0],p=e[1],f=e[2],d=e[3],m=e[4],y=e[5],_=e[6],g=e[7];return Math.abs(r-h)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-p)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-f)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-d)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(s-m)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(u-y)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(l-_)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(c-g)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))};var n=a(r(0)),i=a(r(3)),o=a(r(4));function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function s(t,e,r){var n=.5*r[0],i=.5*r[1],o=.5*r[2],a=e[0],s=e[1],u=e[2],l=e[3];return t[0]=a,t[1]=s,t[2]=u,t[3]=l,t[4]=n*l+i*u-o*s,t[5]=i*l+o*a-n*u,t[6]=o*l+n*s-i*a,t[7]=-n*a-i*s-o*u,t}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function l(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[4],u=r[5],l=r[6],c=r[7],h=e[4],p=e[5],f=e[6],d=e[7],m=r[0],y=r[1],_=r[2],g=r[3];return t[0]=n*g+a*m+i*_-o*y,t[1]=i*g+a*y+o*m-n*_,t[2]=o*g+a*_+n*y-i*m,t[3]=a*g-n*m-i*y-o*_,t[4]=n*c+a*s+i*l-o*u+h*g+d*m+p*_-f*y,t[5]=i*c+a*u+o*s-n*l+p*g+d*y+f*m-h*_,t[6]=o*c+a*l+n*u-i*s+f*g+d*_+h*y-p*m,t[7]=a*c-n*s-i*u-o*l+d*g-h*m-p*y-f*_,t}e.getReal=i.copy,e.setReal=i.copy,e.mul=l;var c=e.dot=i.dot,h=e.length=i.length,p=(e.len=h,e.squaredLength=i.squaredLength);e.sqrLen=p},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=function(){var t=new n.ARRAY_TYPE(6);return n.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new n.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},e.fromValues=function(t,e,r,i,o,a){var s=new n.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s[4]=o,s[5]=a,s},e.set=function(t,e,r,n,i,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t},e.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=r*o-n*i;return u?(t[0]=o*(u=1/u),t[1]=-n*u,t[2]=-i*u,t[3]=r*u,t[4]=(i*s-o*a)*u,t[5]=(n*a-r*s)*u,t):null},e.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},e.multiply=i,e.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=Math.sin(r),c=Math.cos(r);return t[0]=n*c+o*l,t[1]=i*c+a*l,t[2]=n*-l+o*c,t[3]=i*-l+a*c,t[4]=s,t[5]=u,t},e.scale=function(t,e,r){var n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=r[0],l=r[1];return t[0]=e[0]*u,t[1]=n*u,t[2]=i*l,t[3]=o*l,t[4]=a,t[5]=s,t},e.translate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=r[0],c=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=n*l+o*c+s,t[5]=i*l+a*c+u,t},e.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},e.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},e.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},e.subtract=o,e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},e.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t},e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},e.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=e[0],c=e[1],h=e[2],p=e[3],f=e[4],d=e[5];return Math.abs(r-l)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-h)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(a-p)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(s-f)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(u-d)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(d))};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function i(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=r[0],c=r[1],h=r[2],p=r[3],f=r[4],d=r[5];return t[0]=n*l+o*c,t[1]=i*l+a*c,t[2]=n*h+o*p,t[3]=i*h+a*p,t[4]=n*f+o*d+s,t[5]=i*f+a*d+u,t}function o(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}e.mul=i,e.sub=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=function(){var t=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},e.clone=function(t){var e=new n.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},e.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},e.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},e.fromValues=function(t,e,r,i){var o=new n.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o},e.set=function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},e.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},e.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*o-i*n;return a?(t[0]=o*(a=1/a),t[1]=-n*a,t[2]=-i*a,t[3]=r*a,t):null},e.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},e.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},e.multiply=i,e.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=n*-s+o*u,t[3]=i*-s+a*u,t},e.scale=function(t,e,r){var n=e[1],i=e[2],o=e[3],a=r[0],s=r[1];return t[0]=e[0]*a,t[1]=n*a,t[2]=i*s,t[3]=o*s,t},e.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t},e.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},e.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},e.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},e.LDU=function(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]},e.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},e.subtract=o,e.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},e.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=e[0],u=e[1],l=e[2],c=e[3];return Math.abs(r-s)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-l)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-c)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))},e.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},e.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t};var n=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(r(0));function i(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],u=r[1],l=r[2],c=r[3];return t[0]=n*s+o*u,t[1]=i*s+a*u,t[2]=n*l+o*c,t[3]=i*l+a*c,t}function o(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}e.mul=i,e.sub=o},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.vec4=e.vec3=e.vec2=e.quat2=e.quat=e.mat4=e.mat3=e.mat2d=e.mat2=e.glMatrix=void 0;var n=f(r(0)),i=f(r(9)),o=f(r(8)),a=f(r(5)),s=f(r(4)),u=f(r(3)),l=f(r(7)),c=f(r(6)),h=f(r(2)),p=f(r(1));function f(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}e.glMatrix=n,e.mat2=i,e.mat2d=o,e.mat3=a,e.mat4=s,e.quat=u,e.quat2=l,e.vec2=c,e.vec3=h,e.vec4=p}])})},{}],62:[function(t,e,r){e.exports=function(t,e,r,n){var i,o,a,s,u,l=e[0],c=e[1],h=e[2],p=e[3],f=r[0],d=r[1],m=r[2],y=r[3];(o=l*f+c*d+h*m+p*y)<0&&(o=-o,f=-f,d=-d,m=-m,y=-y);1-o>1e-6?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-n)*i)/a,u=Math.sin(n*i)/a):(s=1-n,u=n);return t[0]=s*l+u*f,t[1]=s*c+u*d,t[2]=s*h+u*m,t[3]=s*p+u*y,t}},{}],63:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}},{}],64:[function(t,e,r){e.exports=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}},{}],65:[function(t,e,r){e.exports=function(t){var e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}},{}],66:[function(t,e,r){e.exports=function(t,e){return t[0]=e[0],t[1]=e[1],t}},{}],67:[function(t,e,r){e.exports=function(){var t=new Float32Array(2);return t[0]=0,t[1]=0,t}},{}],68:[function(t,e,r){e.exports=function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}},{}],69:[function(t,e,r){e.exports=t("./distance")},{"./distance":70}],70:[function(t,e,r){e.exports=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}},{}],71:[function(t,e,r){e.exports=t("./divide")},{"./divide":72}],72:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}},{}],73:[function(t,e,r){e.exports=function(t,e){return t[0]*e[0]+t[1]*e[1]}},{}],74:[function(t,e,r){e.exports=1e-6},{}],75:[function(t,e,r){e.exports=function(t,e){var r=t[0],i=t[1],o=e[0],a=e[1];return Math.abs(r-o)<=n*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=n*Math.max(1,Math.abs(i),Math.abs(a))};var n=t("./epsilon")},{"./epsilon":74}],76:[function(t,e,r){e.exports=function(t,e){return t[0]===e[0]&&t[1]===e[1]}},{}],77:[function(t,e,r){e.exports=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}},{}],78:[function(t,e,r){e.exports=function(t,e,r,i,o,a){var s,u;e||(e=2);r||(r=0);u=i?Math.min(i*e+r,t.length):t.length;for(s=r;s<u;s+=e)n[0]=t[s],n[1]=t[s+1],o(n,n,a),t[s]=n[0],t[s+1]=n[1];return t};var n=t("./create")()},{"./create":67}],79:[function(t,e,r){e.exports=function(t,e){var r=new Float32Array(2);return r[0]=t,r[1]=e,r}},{}],80:[function(t,e,r){e.exports={EPSILON:t("./epsilon"),create:t("./create"),clone:t("./clone"),fromValues:t("./fromValues"),copy:t("./copy"),set:t("./set"),equals:t("./equals"),exactEquals:t("./exactEquals"),add:t("./add"),subtract:t("./subtract"),sub:t("./sub"),multiply:t("./multiply"),mul:t("./mul"),divide:t("./divide"),div:t("./div"),inverse:t("./inverse"),min:t("./min"),max:t("./max"),rotate:t("./rotate"),floor:t("./floor"),ceil:t("./ceil"),round:t("./round"),scale:t("./scale"),scaleAndAdd:t("./scaleAndAdd"),distance:t("./distance"),dist:t("./dist"),squaredDistance:t("./squaredDistance"),sqrDist:t("./sqrDist"),length:t("./length"),len:t("./len"),squaredLength:t("./squaredLength"),sqrLen:t("./sqrLen"),negate:t("./negate"),normalize:t("./normalize"),dot:t("./dot"),cross:t("./cross"),lerp:t("./lerp"),random:t("./random"),transformMat2:t("./transformMat2"),transformMat2d:t("./transformMat2d"),transformMat3:t("./transformMat3"),transformMat4:t("./transformMat4"),forEach:t("./forEach"),limit:t("./limit")}},{"./add":63,"./ceil":64,"./clone":65,"./copy":66,"./create":67,"./cross":68,"./dist":69,"./distance":70,"./div":71,"./divide":72,"./dot":73,"./epsilon":74,"./equals":75,"./exactEquals":76,"./floor":77,"./forEach":78,"./fromValues":79,"./inverse":81,"./len":82,"./length":83,"./lerp":84,"./limit":85,"./max":86,"./min":87,"./mul":88,"./multiply":89,"./negate":90,"./normalize":91,"./random":92,"./rotate":93,"./round":94,"./scale":95,"./scaleAndAdd":96,"./set":97,"./sqrDist":98,"./sqrLen":99,"./squaredDistance":100,"./squaredLength":101,"./sub":102,"./subtract":103,"./transformMat2":104,"./transformMat2d":105,"./transformMat3":106,"./transformMat4":107}],81:[function(t,e,r){e.exports=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}},{}],82:[function(t,e,r){e.exports=t("./length")},{"./length":83}],83:[function(t,e,r){e.exports=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}},{}],84:[function(t,e,r){e.exports=function(t,e,r,n){var i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t}},{}],85:[function(t,e,r){e.exports=function(t,e,r){var n=e[0]*e[0]+e[1]*e[1];if(n>r*r){var i=Math.sqrt(n);t[0]=e[0]/i*r,t[1]=e[1]/i*r}else t[0]=e[0],t[1]=e[1];return t}},{}],86:[function(t,e,r){e.exports=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}},{}],87:[function(t,e,r){e.exports=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}},{}],88:[function(t,e,r){e.exports=t("./multiply")},{"./multiply":89}],89:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}},{}],90:[function(t,e,r){e.exports=function(t,e){return t[0]=-e[0],t[1]=-e[1],t}},{}],91:[function(t,e,r){e.exports=function(t,e){var r=e[0],n=e[1],i=r*r+n*n;i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i);return t}},{}],92:[function(t,e,r){e.exports=function(t,e){e=e||1;var r=2*Math.random()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}},{}],93:[function(t,e,r){e.exports=function(t,e,r){var n=Math.cos(r),i=Math.sin(r),o=e[0],a=e[1];return t[0]=o*n-a*i,t[1]=o*i+a*n,t}},{}],94:[function(t,e,r){e.exports=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}},{}],95:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}},{}],96:[function(t,e,r){e.exports=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}},{}],97:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e,t[1]=r,t}},{}],98:[function(t,e,r){e.exports=t("./squaredDistance")},{"./squaredDistance":100}],99:[function(t,e,r){e.exports=t("./squaredLength")},{"./squaredLength":101}],100:[function(t,e,r){e.exports=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}},{}],101:[function(t,e,r){e.exports=function(t){var e=t[0],r=t[1];return e*e+r*r}},{}],102:[function(t,e,r){e.exports=t("./subtract")},{"./subtract":103}],103:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}},{}],104:[function(t,e,r){e.exports=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t}},{}],105:[function(t,e,r){e.exports=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t}},{}],106:[function(t,e,r){e.exports=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}},{}],107:[function(t,e,r){e.exports=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}},{}],108:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}},{}],109:[function(t,e,r){e.exports=function(t,e){var r=n(t[0],t[1],t[2]),a=n(e[0],e[1],e[2]);i(r,r),i(a,a);var s=o(r,a);return s>1?0:Math.acos(s)};var n=t("./fromValues"),i=t("./normalize"),o=t("./dot")},{"./dot":119,"./fromValues":125,"./normalize":136}],110:[function(t,e,r){e.exports=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}},{}],111:[function(t,e,r){e.exports=function(t){var e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}},{}],112:[function(t,e,r){e.exports=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}},{}],113:[function(t,e,r){e.exports=function(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}},{}],114:[function(t,e,r){e.exports=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2];return t[0]=i*u-o*s,t[1]=o*a-n*u,t[2]=n*s-i*a,t}},{}],115:[function(t,e,r){arguments[4][69][0].apply(r,arguments)},{"./distance":116,dup:69}],116:[function(t,e,r){e.exports=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)}},{}],117:[function(t,e,r){arguments[4][71][0].apply(r,arguments)},{"./divide":118,dup:71}],118:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}},{}],119:[function(t,e,r){e.exports=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}},{}],120:[function(t,e,r){arguments[4][74][0].apply(r,arguments)},{dup:74}],121:[function(t,e,r){e.exports=function(t,e){var r=t[0],i=t[1],o=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(r-a)<=n*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=n*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=n*Math.max(1,Math.abs(o),Math.abs(u))};var n=t("./epsilon")},{"./epsilon":120}],122:[function(t,e,r){e.exports=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}},{}],123:[function(t,e,r){e.exports=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}},{}],124:[function(t,e,r){e.exports=function(t,e,r,i,o,a){var s,u;e||(e=3);r||(r=0);u=i?Math.min(i*e+r,t.length):t.length;for(s=r;s<u;s+=e)n[0]=t[s],n[1]=t[s+1],n[2]=t[s+2],o(n,n,a),t[s]=n[0],t[s+1]=n[1],t[s+2]=n[2];return t};var n=t("./create")()},{"./create":113}],125:[function(t,e,r){e.exports=function(t,e,r){var n=new Float32Array(3);return n[0]=t,n[1]=e,n[2]=r,n}},{}],126:[function(t,e,r){e.exports={EPSILON:t("./epsilon"),create:t("./create"),clone:t("./clone"),angle:t("./angle"),fromValues:t("./fromValues"),copy:t("./copy"),set:t("./set"),equals:t("./equals"),exactEquals:t("./exactEquals"),add:t("./add"),subtract:t("./subtract"),sub:t("./sub"),multiply:t("./multiply"),mul:t("./mul"),divide:t("./divide"),div:t("./div"),min:t("./min"),max:t("./max"),floor:t("./floor"),ceil:t("./ceil"),round:t("./round"),scale:t("./scale"),scaleAndAdd:t("./scaleAndAdd"),distance:t("./distance"),dist:t("./dist"),squaredDistance:t("./squaredDistance"),sqrDist:t("./sqrDist"),length:t("./length"),len:t("./len"),squaredLength:t("./squaredLength"),sqrLen:t("./sqrLen"),negate:t("./negate"),inverse:t("./inverse"),normalize:t("./normalize"),dot:t("./dot"),cross:t("./cross"),lerp:t("./lerp"),random:t("./random"),transformMat4:t("./transformMat4"),transformMat3:t("./transformMat3"),transformQuat:t("./transformQuat"),rotateX:t("./rotateX"),rotateY:t("./rotateY"),rotateZ:t("./rotateZ"),forEach:t("./forEach")}},{"./add":108,"./angle":109,"./ceil":110,"./clone":111,"./copy":112,"./create":113,"./cross":114,"./dist":115,"./distance":116,"./div":117,"./divide":118,"./dot":119,"./epsilon":120,"./equals":121,"./exactEquals":122,"./floor":123,"./forEach":124,"./fromValues":125,"./inverse":127,"./len":128,"./length":129,"./lerp":130,"./max":131,"./min":132,"./mul":133,"./multiply":134,"./negate":135,"./normalize":136,"./random":137,"./rotateX":138,"./rotateY":139,"./rotateZ":140,"./round":141,"./scale":142,"./scaleAndAdd":143,"./set":144,"./sqrDist":145,"./sqrLen":146,"./squaredDistance":147,"./squaredLength":148,"./sub":149,"./subtract":150,"./transformMat3":151,"./transformMat4":152,"./transformQuat":153}],127:[function(t,e,r){e.exports=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}},{}],128:[function(t,e,r){arguments[4][82][0].apply(r,arguments)},{"./length":129,dup:82}],129:[function(t,e,r){e.exports=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}},{}],130:[function(t,e,r){e.exports=function(t,e,r,n){var i=e[0],o=e[1],a=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t}},{}],131:[function(t,e,r){e.exports=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}},{}],132:[function(t,e,r){e.exports=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}},{}],133:[function(t,e,r){arguments[4][88][0].apply(r,arguments)},{"./multiply":134,dup:88}],134:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}},{}],135:[function(t,e,r){e.exports=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}},{}],136:[function(t,e,r){e.exports=function(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o);return t}},{}],137:[function(t,e,r){e.exports=function(t,e){e=e||1;var r=2*Math.random()*Math.PI,n=2*Math.random()-1,i=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*i,t[1]=Math.sin(r)*i,t[2]=n*e,t}},{}],138:[function(t,e,r){e.exports=function(t,e,r,n){var i=r[1],o=r[2],a=e[1]-i,s=e[2]-o,u=Math.sin(n),l=Math.cos(n);return t[0]=e[0],t[1]=i+a*l-s*u,t[2]=o+a*u+s*l,t}},{}],139:[function(t,e,r){e.exports=function(t,e,r,n){var i=r[0],o=r[2],a=e[0]-i,s=e[2]-o,u=Math.sin(n),l=Math.cos(n);return t[0]=i+s*u+a*l,t[1]=e[1],t[2]=o+s*l-a*u,t}},{}],140:[function(t,e,r){e.exports=function(t,e,r,n){var i=r[0],o=r[1],a=e[0]-i,s=e[1]-o,u=Math.sin(n),l=Math.cos(n);return t[0]=i+a*l-s*u,t[1]=o+a*u+s*l,t[2]=e[2],t}},{}],141:[function(t,e,r){e.exports=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}},{}],142:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}},{}],143:[function(t,e,r){e.exports=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}},{}],144:[function(t,e,r){e.exports=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}},{}],145:[function(t,e,r){arguments[4][98][0].apply(r,arguments)},{"./squaredDistance":147,dup:98}],146:[function(t,e,r){arguments[4][99][0].apply(r,arguments)},{"./squaredLength":148,dup:99}],147:[function(t,e,r){e.exports=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}},{}],148:[function(t,e,r){e.exports=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}},{}],149:[function(t,e,r){arguments[4][102][0].apply(r,arguments)},{"./subtract":150,dup:102}],150:[function(t,e,r){e.exports=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}},{}],151:[function(t,e,r){e.exports=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}},{}],152:[function(t,e,r){e.exports=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/(a=a||1),t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t}},{}],153:[function(t,e,r){e.exports=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2],l=r[3],c=l*n+s*o-u*i,h=l*i+u*n-a*o,p=l*o+a*i-s*n,f=-a*n-s*i-u*o;return t[0]=c*l+f*-a+h*-u-p*-s,t[1]=h*l+f*-s+p*-a-c*-u,t[2]=p*l+f*-u+c*-s-h*-a,t}},{}],154:[function(t,e,r){"use strict";var n=t("is-browser");e.exports=n&&function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch(e){t=!1}return t}()},{"is-browser":158}],155:[function(t,e,r){var n=t("vectors/normalize-nd");function i(t){for(var e=t.positions,r=t.cells,n=[],i=[],o={},a=0,s=0;s<r.length;s++){var u=r[s],l=e[u[0]],c=e[u[1]],h=e[u[2]],p=b(l,c),f=b(c,h),d=b(h,l),m=i.indexOf(p);-1===m&&(m=a++,i.push(p));var y=i.indexOf(f);-1===y&&(y=a++,i.push(f));var _=i.indexOf(d);-1===_&&(_=a++,i.push(d));var g=i.indexOf(l);-1===g&&(g=a++,i.push(l));var v=i.indexOf(c);-1===v&&(v=a++,i.push(c));var x=i.indexOf(h);-1===x&&(x=a++,i.push(h)),n.push([g,m,_]),n.push([v,y,m]),n.push([x,_,y]),n.push([m,y,_])}return{cells:n,positions:i};function b(t,e){var r=function(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2,(t[2]+e[2])/2]}(t,e),n=function(t){return t[0].toPrecision(6)+","+t[1].toPrecision(6)+","+t[2].toPrecision(6)}(r),i=o[n];return i||(o[n]=r)}}e.exports=function(t){t=0|+t;var e=[],r=[],o=.5+Math.sqrt(5)/2;e.push([-1,+o,0]),e.push([1,+o,0]),e.push([-1,-o,0]),e.push([1,-o,0]),e.push([0,-1,+o]),e.push([0,1,+o]),e.push([0,-1,-o]),e.push([0,1,-o]),e.push([+o,0,-1]),e.push([+o,0,1]),e.push([-o,0,-1]),e.push([-o,0,1]),r.push([0,11,5]),r.push([0,5,1]),r.push([0,1,7]),r.push([0,7,10]),r.push([0,10,11]),r.push([1,5,9]),r.push([5,11,4]),r.push([11,10,2]),r.push([10,7,6]),r.push([7,1,8]),r.push([3,9,4]),r.push([3,4,2]),r.push([3,2,6]),r.push([3,6,8]),r.push([3,8,9]),r.push([4,9,5]),r.push([2,4,11]),r.push([6,2,10]),r.push([8,6,7]),r.push([9,8,1]);var a={cells:r,positions:e};for(;t-- >0;)a=i(a);e=a.positions;for(var s=0;s<e.length;s++)n(e[s]);return a}},{"vectors/normalize-nd":211}],156:[function(t,e,r){r.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,l=u>>1,c=-7,h=r?i-1:0,p=r?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:Infinity*(f?-1:1);a+=Math.pow(2,n),o-=l}return(f?-1:1)*a*Math.pow(2,o-n)},r.write=function(t,e,r,n,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||Infinity===e?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[r+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[r+f]=255&a,f+=d,a/=256,l-=8);t[r+f-d]|=128*m}},{}],157:[function(t,e,r){"use strict";e.exports=function(t){for(var e=new Array(t),r=0;r<t;++r)e[r]=r;return e}},{}],158:[function(t,e,r){e.exports=!0},{}],159:[function(t,e,r){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}e.exports=function(t){return null!=t&&(n(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}(t)||!!t._isBuffer)}},{}],160:[function(t,e,r){e.exports=o,o.strict=a,o.loose=s;var n=Object.prototype.toString,i={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function o(t){return a(t)||s(t)}function a(t){return t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array}function s(t){return i[n.call(t)]}},{}],161:[function(t,e,r){e.exports=function(t){return!!t&&(!!t.dtype&&new RegExp("function View[0-9]+d(:?"+t.dtype+")+").test(String(t.constructor)))}},{}],162:[function(t,e,r){e.exports=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}},{}],163:[function(t,e,r){e.exports=function(t,e){for(var r=-1,n=t.length;++r<n&&!1!==e(t[r],r,t););return t}},{}],164:[function(t,e,r){e.exports=function(t,e,r){r||(r={});for(var n=-1,i=e.length;++n<i;){var o=e[n];r[o]=t[o]}return r}},{}],165:[function(t,e,r){var n;e.exports=function(t,e,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[n?s:++i];if(!1===e(o[u],u,o))break}return t}},{}],166:[function(t,e,r){function n(t){return t}e.exports=function(t,e,r){if("function"!=typeof t)return n;if(void 0===e)return t;switch(r){case 1:return function(r){return t.call(e,r)};case 3:return function(r,n,i){return t.call(e,r,n,i)};case 4:return function(r,n,i,o){return t.call(e,r,n,i,o)};case 5:return function(r,n,i,o,a){return t.call(e,r,n,i,o,a)}}return function(){return t.apply(e,arguments)}}},{}],167:[function(t,e,r){var n=t("lodash._bindcallback"),i=t("lodash._isiterateecall"),o=t("lodash.restparam");e.exports=function(t){return o(function(e,r){var o=-1,a=null==e?0:r.length,s=a>2?r[a-2]:void 0,u=a>2?r[2]:void 0,l=a>1?r[a-1]:void 0;for("function"==typeof s?(s=n(s,l,5),a-=2):a-=(s="function"==typeof l?l:void 0)?1:0,u&&i(r[0],r[1],u)&&(s=a<3?void 0:s,a=1);++o<a;){var c=r[o];c&&t(e,c,s)}return e})}},{"lodash._bindcallback":166,"lodash._isiterateecall":169,"lodash.restparam":178}],168:[function(t,e,r){var n="[object Function]",i=/^\[object .+?Constructor\]$/;var o=Object.prototype,a=Function.prototype.toString,s=o.toString,u=RegExp("^"+a.call(o.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(t,e){var r=null==t?void 0:t[e];return function(t){return null!=t&&(function(t){return function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)&&s.call(t)==n}(t)?u.test(a.call(t)):function(t){return!!t&&"object"==typeof t}(t)&&i.test(t))}(r)?r:void 0}},{}],169:[function(t,e,r){var n=/^\d+$/,i=9007199254740991;var o,a=(o="length",function(t){return null==t?void 0:t[o]});function s(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=i}(a(t))}e.exports=function(t,e,r){if(!function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(r))return!1;var o=typeof e;if("number"==o?s(r)&&function(t,e){return t="number"==typeof t||n.test(t)?+t:-1,e=null==e?i:e,t>-1&&t%1==0&&t<e}(e,r.length):"string"==o&&e in r){var a=r[e];return t==t?t===a:a!=a}return!1}},{}],170:[function(t,e,r){var n=t("lodash.merge"),i=t("lodash.restparam");var o,a,s=(o=n,a=function t(e,r){return void 0===e?r:n(e,r,t)},i(function(t){var e=t[0];return null==e?e:(t.push(a),o.apply(void 0,t))}));e.exports=s},{"lodash.merge":177,"lodash.restparam":178}],171:[function(t,e,r){var n=9007199254740991,i="[object Arguments]",o="[object Function]",a="[object GeneratorFunction]",s=Object.prototype,u=s.hasOwnProperty,l=s.toString,c=s.propertyIsEnumerable;e.exports=function(t){return function(t){return function(t){return!!t&&"object"==typeof t}(t)&&function(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!function(t){var e=function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)?l.call(t):"";return e==o||e==a}(t)}(t)}(t)&&u.call(t,"callee")&&(!c.call(t,"callee")||l.call(t)==i)}},{}],172:[function(t,e,r){var n="[object Function]",i=/^\[object .+?Constructor\]$/;function o(t){return!!t&&"object"==typeof t}var a,s,u,l=Object.prototype,c=Function.prototype.toString,h=l.toString,p=RegExp("^"+c.call(l.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),f=(a=Array,s="isArray",function(t){return null!=t&&(function(t){return function(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}(t)&&h.call(t)==n}(t)?p.test(c.call(t)):o(t)&&i.test(t))}(u=null==a?void 0:a[s])?u:void 0),d=9007199254740991;e.exports=f||function(t){return o(t)&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=d}(t.length)&&"[object Array]"==h.call(t)}},{}],173:[function(t,e,r){var n=t("lodash._basefor"),i=t("lodash.isarguments"),o=t("lodash.keysin"),a="[object Object]";var s=Object.prototype,u=s.hasOwnProperty,l=s.toString;e.exports=function(t){var e,r;return!(!function(t){return!!t&&"object"==typeof t}(t)||l.call(t)!=a||i(t)||!(u.call(t,"constructor")||"function"!=typeof(e=t.constructor)||e instanceof e))&&(n(t,function(t,e){r=e},o),void 0===r||u.call(t,r))}},{"lodash._basefor":165,"lodash.isarguments":171,"lodash.keysin":176}],174:[function(t,e,r){var n=9007199254740991,i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1;var o=Object.prototype.toString;e.exports=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=n}(t.length)&&!!i[o.call(t)]}},{}],175:[function(t,e,r){var n=t("lodash._getnative"),i=t("lodash.isarguments"),o=t("lodash.isarray"),a=/^\d+$/,s=Object.prototype.hasOwnProperty,u=n(Object,"keys"),l=9007199254740991;var c,h=(c="length",function(t){return null==t?void 0:t[c]});function p(t,e){return t="number"==typeof t||a.test(t)?+t:-1,e=null==e?l:e,t>-1&&t%1==0&&t<e}function f(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=l}function d(t){for(var e=function(t){if(null==t)return[];m(t)||(t=Object(t));var e=t.length;e=e&&f(e)&&(o(t)||i(t))&&e||0;var r=t.constructor,n=-1,a="function"==typeof r&&r.prototype===t,u=Array(e),l=e>0;for(;++n<e;)u[n]=n+"";for(var c in t)l&&p(c,e)||"constructor"==c&&(a||!s.call(t,c))||u.push(c);return u}(t),r=e.length,n=r&&t.length,a=!!n&&f(n)&&(o(t)||i(t)),u=-1,l=[];++u<r;){var c=e[u];(a&&p(c,n)||s.call(t,c))&&l.push(c)}return l}function m(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=u?function(t){var e,r=null==t?void 0:t.constructor;return"function"==typeof r&&r.prototype===t||"function"!=typeof t&&(null!=(e=t)&&f(h(e)))?d(t):m(t)?u(t):[]}:d},{"lodash._getnative":168,"lodash.isarguments":171,"lodash.isarray":172}],176:[function(t,e,r){var n=t("lodash.isarguments"),i=t("lodash.isarray"),o=/^\d+$/,a=Object.prototype.hasOwnProperty,s=9007199254740991;function u(t,e){return t="number"==typeof t||o.test(t)?+t:-1,e=null==e?s:e,t>-1&&t%1==0&&t<e}e.exports=function(t){if(null==t)return[];var e,r;r=typeof(e=t),(!e||"object"!=r&&"function"!=r)&&(t=Object(t));var o=t.length;o=o&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=s}(o)&&(i(t)||n(t))&&o||0;for(var l=t.constructor,c=-1,h="function"==typeof l&&l.prototype===t,p=Array(o),f=o>0;++c<o;)p[c]=c+"";for(var d in t)f&&u(d,o)||"constructor"==d&&(h||!a.call(t,d))||p.push(d);return p}},{"lodash.isarguments":171,"lodash.isarray":172}],177:[function(t,e,r){var n=t("lodash._arraycopy"),i=t("lodash._arrayeach"),o=t("lodash._createassigner"),a=t("lodash.isarguments"),s=t("lodash.isarray"),u=t("lodash.isplainobject"),l=t("lodash.istypedarray"),c=t("lodash.keys"),h=t("lodash.toplainobject");var p=9007199254740991;var f,d=(f="length",function(t){return null==t?void 0:t[f]});function m(t){return null!=t&&function(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=p}(d(t))}var y=o(function t(e,r,o,p,f){if(y=typeof(d=e),!d||"object"!=y&&"function"!=y)return e;var d,y,_=m(r)&&(s(r)||l(r)),g=_?void 0:c(r);return i(g||r,function(i,c){if(g&&(i=r[c=i]),function(t){return!!t&&"object"==typeof t}(i))p||(p=[]),f||(f=[]),function(t,e,r,i,o,c,p){for(var f=c.length,d=e[r];f--;)if(c[f]==d)return void(t[r]=p[f]);var y=t[r],_=o?o(y,d,r,t,e):void 0,g=void 0===_;g&&(_=d,m(d)&&(s(d)||l(d))?_=s(y)?y:m(y)?n(y):[]:u(d)||a(d)?_=a(y)?h(y):u(y)?y:{}:g=!1),c.push(d),p.push(_),g?t[r]=i(_,d,o,c,p):(_==_?_!==y:y==y)&&(t[r]=_)}(e,r,c,t,o,p,f);else{var d=e[c],y=o?o(d,i,c,e,r):void 0,v=void 0===y;v&&(y=i),void 0===y&&(!_||c in e)||!v&&(y==y?y===d:d!=d)||(e[c]=y)}}),e});e.exports=y},{"lodash._arraycopy":162,"lodash._arrayeach":163,"lodash._createassigner":167,"lodash.isarguments":171,"lodash.isarray":172,"lodash.isplainobject":173,"lodash.istypedarray":174,"lodash.keys":175,"lodash.toplainobject":179}],178:[function(t,e,r){var n="Expected a function",i=Math.max;e.exports=function(t,e){if("function"!=typeof t)throw new TypeError(n);return e=i(void 0===e?t.length-1:+e||0,0),function(){for(var r=arguments,n=-1,o=i(r.length-e,0),a=Array(o);++n<o;)a[n]=r[e+n];switch(e){case 0:return t.call(this,a);case 1:return t.call(this,r[0],a);case 2:return t.call(this,r[0],r[1],a)}var s=Array(e+1);for(n=-1;++n<e;)s[n]=r[n];return s[e]=a,t.apply(this,s)}}},{}],179:[function(t,e,r){var n=t("lodash._basecopy"),i=t("lodash.keysin");e.exports=function(t){return n(t,i(t))}},{"lodash._basecopy":164,"lodash.keysin":176}],180:[function(t,e,r){var n,i;n=this,i=function(){"use strict";var t,e,r;function n(n,i){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),(r=i(a)).workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"}))}else e=i;else t=i}return n(0,function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var r=n;function n(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){var r,n,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?r=i:n=i,i=.5*(n-r)+r}return i},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=o;function o(t,e){this.x=t,this.y=e}function a(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(!a(t[r],e[r]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var n in t)if(!a(t[n],e[n]))return!1;return!0}return t===e}function s(t,e,n,i){var o=new r(t,e,n,i);return function(t){return o.solve(t)}}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),n=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),n=Math.sin(t),i=e.y+n*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var u=s(.25,.1,.25,1);function l(t,e,r){return Math.min(r,Math.max(e,t))}function c(t,e,r){var n=r-e,i=((t-e)%n+n)%n+e;return i===e?r:i}function h(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var a in o)t[a]=o[a]}return t}var p=1;function f(){return p++}function d(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function m(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function y(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})}function _(t,e){return-1!==t.indexOf(e,t.length-e.length)}function g(t,e,r){var n={};for(var i in t)n[i]=e.call(r||this,t[i],i,t);return n}function v(t,e,r){var n={};for(var i in t)e.call(r||this,t[i],i,t)&&(n[i]=t[i]);return n}function x(t){return Array.isArray(t)?t.map(x):"object"==typeof t&&t?g(t,x):t}var b={};function w(t){b[t]||("undefined"!=typeof console&&console.warn(t),b[t]=!0)}function E(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function A(t){for(var e=0,r=0,n=t.length,i=n-1,o=void 0,a=void 0;r<n;i=r++)e+=((a=t[i]).x-(o=t[r]).x)*(o.y+a.y);return e}function T(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(t,r,n,i){var o=n||i;return e[r]=!o||o.toLowerCase(),""}),e["max-age"]){var r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}function M(t){try{var e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var S,R,I,C,P=self.performance&&self.performance.now?self.performance.now.bind(self.performance):Date.now.bind(Date),D=self.requestAnimationFrame||self.mozRequestAnimationFrame||self.webkitRequestAnimationFrame||self.msRequestAnimationFrame,L=self.cancelAnimationFrame||self.mozCancelAnimationFrame||self.webkitCancelAnimationFrame||self.msCancelAnimationFrame,O={now:P,frame:function(t){var e=D(t);return{cancel:function(){return L(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var r=self.document.createElement("canvas"),n=r.getContext("2d");if(!n)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,n.drawImage(t,0,0,t.width,t.height),n.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return S||(S=self.document.createElement("a")),S.href=t,S.href},hardwareConcurrency:self.navigator.hardwareConcurrency||4,get devicePixelRatio(){return self.devicePixelRatio},get prefersReducedMotion(){return!!self.matchMedia&&(null==R&&(R=self.matchMedia("(prefers-reduced-motion: reduce)")),R.matches)}},k={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},F={supported:!1,testSupport:function(t){!B&&C&&(N?z(t):I=t)}},B=!1,N=!1;function z(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,C),t.isContextLost())return;F.supported=!0}catch(t){}t.deleteTexture(e),B=!0}self.document&&((C=self.document.createElement("img")).onload=function(){I&&z(I),I=null,N=!0},C.onerror=function(){B=!0,I=null},C.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var U="01",V=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function j(t){return 0===t.indexOf("mapbox:")}V.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",U,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},V.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},V.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},V.prototype.normalizeStyleURL=function(t,e){if(!j(t))return t;var r=X(t);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},V.prototype.normalizeGlyphsURL=function(t,e){if(!j(t))return t;var r=X(t);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||e)},V.prototype.normalizeSourceURL=function(t,e){if(!j(t))return t;var r=X(t);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)},V.prototype.normalizeSpriteURL=function(t,e,r,n){var i=X(t);return j(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+r,this._makeAPIURL(i,this._customAccessToken||n)):(i.path+=""+e+r,Y(i))},V.prototype.normalizeTileURL=function(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),!e||!j(e))return t;var n=X(t);return n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,""+(O.devicePixelRatio>=2||512===r?"@2x":"")+(F.supported?".webp":"$1")),n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/v4"+n.path,k.REQUIRE_ACCESS_TOKEN&&(k.ACCESS_TOKEN||this._customAccessToken)&&this._skuToken&&n.params.push("sku="+this._skuToken),this._makeAPIURL(n,this._customAccessToken)},V.prototype.canonicalizeTileURL=function(t){var e=X(t);if(!e.path.match(/(^\/v4\/)/)||!e.path.match(/\.[\w]+$/))return t;var r="mapbox://tiles/";r+=e.path.replace("/v4/","");var n=e.params.filter(function(t){return!t.match(/^access_token=/)});return n.length&&(r+="?"+n.join("&")),r},V.prototype.canonicalizeTileset=function(t,e){if(!j(e))return t.tiles||[];for(var r=[],n=0,i=t.tiles;n<i.length;n+=1){var o=this.canonicalizeTileURL(i[n]);r.push(o)}return r},V.prototype._makeAPIURL=function(t,e){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",n=X(k.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,"/"!==n.path&&(t.path=""+n.path+t.path),!k.REQUIRE_ACCESS_TOKEN)return Y(t);if(!(e=e||k.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return t.params=t.params.filter(function(t){return-1===t.indexOf("access_token")}),t.params.push("access_token="+e),Y(t)};var G=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function q(t){return G.test(t)}var H=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function X(t){var e=t.match(H);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Y(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function Z(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(self.atob(e[1]).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(t){return null}}var W=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};W.prototype.getStorageKey=function(t){var e=Z(k.ACCESS_TOKEN),r="";return e&&e.u?r=self.btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(Number("0x"+e))})):r=k.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+r:"mapbox.eventData:"+r},W.prototype.fetchEventData=function(){var t=M("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{var n=self.localStorage.getItem(e);n&&(this.eventData=JSON.parse(n));var i=self.localStorage.getItem(r);i&&(this.anonId=i)}catch(t){w("Unable to read from LocalStorage")}},W.prototype.saveEventData=function(){var t=M("localStorage"),e=this.getStorageKey(),r=this.getStorageKey("uuid");if(t)try{self.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&self.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){w("Unable to write to LocalStorage")}},W.prototype.processRequests=function(t){},W.prototype.postEvent=function(t,e,r,n){var i=this;if(k.EVENTS_URL){var o=X(k.EVENTS_URL);o.params.push("access_token="+(n||k.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.4.0",skuId:U,userId:this.anonId},s=e?h(a,e):a,u={url:Y(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=_t(u,function(t){i.pendingRequest=null,r(t),i.saveEventData(),i.processRequests(n)})}},W.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var K,J=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,r,n){this.skuToken=r,(k.EVENTS_URL&&n||k.ACCESS_TOKEN&&Array.isArray(t)&&t.some(function(t){return j(t)||q(t)}))&&this.queueRequest({id:e,timestamp:Date.now()},n)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var r=this.queue.shift(),n=r.id,i=r.timestamp;n&&this.success[n]||(this.anonId||this.fetchEventData(),m(this.anonId)||(this.anonId=d()),this.postEvent(i,{skuToken:this.skuToken},function(t){t||n&&(e.success[n]=!0)},t))}},e}(W),Q=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){k.EVENTS_URL&&k.ACCESS_TOKEN&&Array.isArray(t)&&t.some(function(t){return j(t)||q(t)})&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var r=Z(k.ACCESS_TOKEN),n=r?r.u:k.ACCESS_TOKEN,i=n!==this.eventData.tokenU;m(this.anonId)||(this.anonId=d(),i=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),u=(o-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||a.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=n)},t)}},e}(W)),$=Q.postTurnstileEvent.bind(Q),tt=new J,et=tt.postMapLoadEvent.bind(tt),rt="mapbox-tiles",nt=500,it=50,ot=42e4;function at(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var st=1/0,ut={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ut);var lt=function(t){function e(e,r,n){401===r&&q(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=r,this.url=n,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error);function ct(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}var ht=ct()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===self.location.protocol?self.parent:self).location.href};function pt(t,e){var r,n=new self.AbortController,i=new self.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:ht(),signal:n.signal}),o=!1,a=!1,s=(r=i.url).indexOf("sku=")>0&&q(r);"json"===t.type&&i.headers.set("Accept","application/json");var u=function(r,n,o){if(!a){if(r&&"SecurityError"!==r.message&&w(r),n&&o)return l(n);var u=Date.now();self.fetch(i).then(function(r){if(r.ok){var n=s?r.clone():null;return l(r,n,u)}return e(new lt(r.statusText,r.status,t.url))}).catch(function(t){20!==t.code&&e(new Error(t.message))})}},l=function(r,n,s){("arrayBuffer"===t.type?r.arrayBuffer():"json"===t.type?r.json():r.text()).then(function(t){a||(n&&s&&function(t,e,r){if(self.caches){var n={status:e.status,statusText:e.statusText,headers:new self.Headers};e.headers.forEach(function(t,e){return n.headers.set(e,t)});var i=T(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&n.headers.set("Expires",new Date(r+1e3*i["max-age"]).toUTCString()),new Date(n.headers.get("Expires")).getTime()-r<ot||function(t,e){if(void 0===K)try{new Response(new ReadableStream),K=!0}catch(t){K=!1}K?e(t.body):t.blob().then(e)}(e,function(e){var r=new self.Response(e,n);self.caches.open(rt).then(function(e){return e.put(at(t.url),r)}).catch(function(t){return w(t.message)})}))}}(i,n,s),o=!0,e(null,t,r.headers.get("Cache-Control"),r.headers.get("Expires")))}).catch(function(t){return e(new Error(t.message))})};return s?function(t,e){if(!self.caches)return e(null);var r=at(t.url);self.caches.open(rt).then(function(t){t.match(r).catch(e).then(function(n){var i=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")),r=T(t.headers.get("Cache-Control")||"");return e>Date.now()&&!r["no-cache"]}(n);t.delete(r),i&&t.put(r,n.clone()),e(null,n,i)})}).catch(e)}(i,u):u(null,null),{cancel:function(){a=!0,o||n.abort()}}}var ft,dt,mt=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(ht())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&self.Request.prototype.hasOwnProperty("signal"))return pt(t,e);if(ct()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e)}var r;return function(t,e){var r=new self.XMLHttpRequest;for(var n in r.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(r.responseType="arraybuffer"),t.headers)r.setRequestHeader(n,t.headers[n]);return"json"===t.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===t.credentials,r.onerror=function(){e(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){var n=r.response;if("json"===t.type)try{n=JSON.parse(r.response)}catch(t){return e(t)}e(null,n,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else e(new lt(r.statusText,r.status,t.url))},r.send(t.body),{cancel:function(){return r.abort()}}}(t,e)},yt=function(t,e){return mt(h(t,{type:"arrayBuffer"}),e)},_t=function(t,e){return mt(h(t,{method:"POST"}),e)};ft=[],dt=0;var gt=function(t,e){if(dt>=k.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:t,callback:e,cancelled:!1,cancel:function(){this.cancelled=!0}};return ft.push(r),r}dt++;var n=!1,i=function(){if(!n)for(n=!0,dt--;ft.length&&dt<k.MAX_PARALLEL_IMAGE_REQUESTS;){var t=ft.shift();t.cancelled||(t.cancel=gt(t.requestParameters,t.callback).cancel)}},o=yt(t,function(t,r,n,o){if(i(),t)e(t);else if(r){var a=new self.Image,s=self.URL||self.webkitURL;a.onload=function(){e(null,a),s.revokeObjectURL(a.src)},a.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var u=new self.Blob([new Uint8Array(r)],{type:"image/png"});a.cacheControl=n,a.expires=o,a.src=r.byteLength?s.createObjectURL(u):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII="}});return{cancel:function(){o.cancel(),i()}}};function vt(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function xt(t,e,r){if(r&&r[t]){var n=r[t].indexOf(e);-1!==n&&r[t].splice(n,1)}}var bt=function(t,e){void 0===e&&(e={}),h(this,e),this.type=t},wt=function(t){function e(e,r){void 0===r&&(r={}),t.call(this,"error",h({error:e},r))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(bt),Et=function(){};Et.prototype.on=function(t,e){return this._listeners=this._listeners||{},vt(t,e,this._listeners),this},Et.prototype.off=function(t,e){return xt(t,e,this._listeners),xt(t,e,this._oneTimeListeners),this},Et.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},vt(t,e,this._oneTimeListeners),this},Et.prototype.fire=function(t,e){"string"==typeof t&&(t=new bt(t,e||{}));var r=t.type;if(this.listens(r)){t.target=this;for(var n=0,i=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];n<i.length;n+=1)i[n].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];o<a.length;o+=1){var s=a[o];xt(r,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(h(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}else t instanceof wt&&console.error(t.error);return this},Et.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Et.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var At={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"image",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Zoom"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"image",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"image",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"image",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"image",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}}},Tt=function(t,e,r,n){this.message=(t?t+": ":"")+r,n&&(this.identifier=n),null!=e&&e.__line__&&(this.line=e.__line__)};function Mt(t){var e=t.value;return e?[new Tt(t.key,e,"constants have been deprecated as of v8")]:[]}function St(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];for(var n=0,i=e;n<i.length;n+=1){var o=i[n];for(var a in o)t[a]=o[a]}return t}function Rt(t){return t instanceof Number||t instanceof String||t instanceof Boolean}function It(t){return Rt(t)?t.valueOf():t}function Ct(t){if(Array.isArray(t))return t.map(Ct);if(t instanceof Object&&!Rt(t)){var e={};for(var r in t)e[r]=Ct(t[r]);return e}return It(t)}var Pt=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Dt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,n=e;r<n.length;r+=1){var i=n[r];this.bindings[i[0]]=i[1]}};Dt.prototype.concat=function(t){return new Dt(this,t)},Dt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Dt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Lt={kind:"null"},Ot={kind:"number"},kt={kind:"string"},Ft={kind:"boolean"},Bt={kind:"color"},Nt={kind:"object"},zt={kind:"value"},Ut={kind:"collator"},Vt={kind:"formatted"},jt={kind:"image"};function Gt(t,e){return{kind:"array",itemType:t,N:e}}function qt(t){if("array"===t.kind){var e=qt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Ht=[Lt,Ot,kt,Ft,Bt,Vt,Nt,Gt(zt),jt];function Xt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Xt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,n=Ht;r<n.length;r+=1)if(!Xt(n[r],e))return null}return"Expected "+qt(t)+" but found "+qt(e)+" instead."}var Yt=e(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return t<0?0:t>1?1:t}function o(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function a(t){return i("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function s(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{e.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in r)return r[i].slice();if("#"===i[0])return 4===i.length?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===i.length&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=i.indexOf("("),l=i.indexOf(")");if(-1!==u&&l+1===i.length){var c=i.substr(0,u),h=i.substr(u+1,l-(u+1)).split(","),p=1;switch(c){case"rgba":if(4!==h.length)return null;p=a(h.pop());case"rgb":return 3!==h.length?null:[o(h[0]),o(h[1]),o(h[2]),p];case"hsla":if(4!==h.length)return null;p=a(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,d=a(h[1]),m=a(h[2]),y=m<=.5?m*(d+1):m+d-m*d,_=2*m-y;return[n(255*s(_,y,f+1/3)),n(255*s(_,y,f)),n(255*s(_,y,f-1/3)),p];default:return null}}return null}}catch(t){}}).parseCSSColor,Zt=function(t,e,r,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n};Zt.parse=function(t){if(t){if(t instanceof Zt)return t;if("string"==typeof t){var e=Yt(t);if(e)return new Zt(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},Zt.prototype.toString=function(){var t=this.toArray(),e=t[1],r=t[2],n=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(r)+","+n+")"},Zt.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Zt.black=new Zt(0,0,0,1),Zt.white=new Zt(1,1,1,1),Zt.transparent=new Zt(0,0,0,0),Zt.red=new Zt(1,0,0,1);var Wt=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Wt.prototype.compare=function(t,e){return this.collator.compare(t,e)},Wt.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var Kt=function(t,e,r,n){this.text=t,this.scale=e,this.fontStack=r,this.textColor=n},Jt=function(t){this.sections=t};Jt.fromString=function(t){return new Jt([new Kt(t,null,null,null)])},Jt.prototype.toString=function(){return this.sections.map(function(t){return t.text}).join("")},Jt.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.text);var i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i)}return t};var Qt=function(t){this.name=t.name,this.available=t.available};function $t(t,e,r,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,r,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function te(t){if(null===t)return Lt;if("string"==typeof t)return kt;if("boolean"==typeof t)return Ft;if("number"==typeof t)return Ot;if(t instanceof Zt)return Bt;if(t instanceof Wt)return Ut;if(t instanceof Jt)return Vt;if(t instanceof Qt)return jt;if(Array.isArray(t)){for(var e,r=t.length,n=0,i=t;n<i.length;n+=1){var o=te(i[n]);if(e){if(e===o)continue;e=zt;break}e=o}return Gt(e||zt,r)}return Nt}function ee(t){var e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Zt||t instanceof Jt||t instanceof Qt?t.toString():JSON.stringify(t)}Qt.prototype.toString=function(){return this.name},Qt.fromString=function(t){return new Qt(t)},Qt.prototype.serialize=function(){return["image",this.name]};var re=function(t,e){this.type=t,this.value=e};re.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!function t(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Zt)return!0;if(e instanceof Wt)return!0;if(e instanceof Jt)return!0;if(e instanceof Qt)return!0;if(Array.isArray(e)){for(var r=0,n=e;r<n.length;r+=1)if(!t(n[r]))return!1;return!0}if("object"==typeof e){for(var i in e)if(!t(e[i]))return!1;return!0}return!1}(t[1]))return e.error("invalid value");var r=t[1],n=te(r),i=e.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new re(n,r)},re.prototype.evaluate=function(){return this.value},re.prototype.eachChild=function(){},re.prototype.possibleOutputs=function(){return[this.value]},re.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Zt?["rgba"].concat(this.value.toArray()):this.value instanceof Jt?this.value.serialize():this.value};var ne=function(t){this.name="ExpressionEvaluationError",this.message=t};ne.prototype.toJSON=function(){return this.message};var ie={string:kt,number:Ot,boolean:Ft,object:Nt},oe=function(t,e){this.type=t,this.args=e};oe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,n=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in ie)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=ie[s],n++}else o=zt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],n++}r=Gt(o,a)}else r=ie[i];for(var u=[];n<t.length;n++){var l=e.parse(t[n],n,zt);if(!l)return null;u.push(l)}return new oe(r,u)},oe.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!Xt(this.type,te(r)))return r;if(e===this.args.length-1)throw new ne("Expected value to be of type "+qt(this.type)+", but found "+qt(te(r))+" instead.")}return null},oe.prototype.eachChild=function(t){this.args.forEach(t)},oe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},oe.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map(function(t){return t.serialize()}))};var ae=function(t){this.type=Vt,this.sections=t};ae.parse=function(t,e){if(t.length<3)return e.error("Expected at least two arguments.");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");for(var r=[],n=1;n<t.length-1;n+=2){var i=e.parse(t[n],1,zt);if(!i)return null;var o=i.type.kind;if("string"!==o&&"value"!==o&&"null"!==o)return e.error("Formatted text type must be 'string', 'value', or 'null'.");var a=t[n+1];if("object"!=typeof a||Array.isArray(a))return e.error("Format options argument must be an object.");var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,Ot)))return null;var u=null;if(a["text-font"]&&!(u=e.parse(a["text-font"],1,Gt(kt))))return null;var l=null;if(a["text-color"]&&!(l=e.parse(a["text-color"],1,Bt)))return null;r.push({text:i,scale:s,font:u,textColor:l})}return new ae(r)},ae.prototype.evaluate=function(t){return new Jt(this.sections.map(function(e){return new Kt(ee(e.text.evaluate(t)),e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))},ae.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t(n.text),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}},ae.prototype.possibleOutputs=function(){return[void 0]},ae.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.text.serialize());var i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i)}return t};var se=function(t){this.type=jt,this.input=t};se.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,kt);return r?new se(r):e.error("No image name provided.")},se.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=!1;return t.availableImages&&t.availableImages.indexOf(e)>-1&&(r=!0),{name:e,available:r}},se.prototype.eachChild=function(t){t(this.input)},se.prototype.possibleOutputs=function(){return[void 0]},se.prototype.serialize=function(){return["image",this.input.serialize()]};var ue={"to-boolean":Ft,"to-color":Bt,"to-number":Ot,"to-string":kt},le=function(t,e){this.type=t,this.args=e};le.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var n=ue[r],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,zt);if(!a)return null;i.push(a)}return new le(n,i)},le.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,n=0,i=this.args;n<i.length;n+=1){if(r=null,(e=i[n].evaluate(t))instanceof Zt)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":$t(e[0],e[1],e[2],e[3])))return new Zt(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new ne(r||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var l=Number(a);if(!isNaN(l))return l}throw new ne("Could not convert "+JSON.stringify(a)+" to number.")}if("formatted"===this.type.kind)return Jt.fromString(ee(this.args[0].evaluate(t)));if("image"===this.type.kind){var c=ee(this.args[0].evaluate(t));return Qt.fromString({name:c,available:!1})}return ee(this.args[0].evaluate(t))},le.prototype.eachChild=function(t){this.args.forEach(t)},le.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},le.prototype.serialize=function(){if("formatted"===this.type.kind)return new ae([{text:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("image"===this.type.kind)return new se(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(e){t.push(e.serialize())}),t};var ce=["Unknown","Point","LineString","Polygon"],he=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null};he.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},he.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ce[this.feature.type]:this.feature.type:null},he.prototype.properties=function(){return this.feature&&this.feature.properties||{}},he.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Zt.parse(t)),e};var pe=function(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n};pe.prototype.evaluate=function(t){return this._evaluate(t,this.args)},pe.prototype.eachChild=function(t){this.args.forEach(t)},pe.prototype.possibleOutputs=function(){return[void 0]},pe.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},pe.parse=function(t,e){var r,n=t[0],i=pe.definitions[n];if(!i)return e.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter(function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1}),u=null,l=0,c=s;l<c.length;l+=1){var h=c[l],p=h[0],f=h[1];u=new ge(e.registry,e.path,null,e.scope);for(var d=[],m=!1,y=1;y<t.length;y++){var _=t[y],g=Array.isArray(p)?p[y-1]:p.type,v=u.parse(_,1+d.length,g);if(!v){m=!0;break}d.push(v)}if(!m)if(Array.isArray(p)&&p.length!==d.length)u.error("Expected "+p.length+" arguments, but found "+d.length+" instead.");else{for(var x=0;x<d.length;x++){var b=Array.isArray(p)?p[x]:p.type,w=d[x];u.concat(x+1).checkSubtype(b,w.type)}if(0===u.errors.length)return new pe(n,o,f,d)}}if(1===s.length)(r=e.errors).push.apply(r,u.errors);else{for(var E=(s.length?s:a).map(function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(qt).join(", ")+")":"("+qt(e.type)+"...)"}).join(" | "),A=[],T=1;T<t.length;T++){var M=e.parse(t[T],1+A.length);if(!M)return null;A.push(qt(M.type))}e.error("Expected arguments of type "+E+", but found ("+A.join(", ")+") instead.")}return null},pe.register=function(t,e){for(var r in pe.definitions=e,e)t[r]=pe};var fe=function(t,e,r){this.type=Ut,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};function de(t){if(t instanceof pe){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}var e=!0;return t.eachChild(function(t){e&&!de(t)&&(e=!1)}),e}function me(t){if(t instanceof pe&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild(function(t){e&&!me(t)&&(e=!1)}),e}function ye(t,e){if(t instanceof pe&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild(function(t){r&&!ye(t,e)&&(r=!1)}),r}fe.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Ft);if(!n)return null;var i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Ft);if(!i)return null;var o=null;return r.locale&&!(o=e.parse(r.locale,1,kt))?null:new fe(n,i,o)},fe.prototype.evaluate=function(t){return new Wt(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},fe.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},fe.prototype.possibleOutputs=function(){return[void 0]},fe.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var _e=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};_e.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new _e(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},_e.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},_e.prototype.eachChild=function(){},_e.prototype.possibleOutputs=function(){return[void 0]},_e.prototype.serialize=function(){return["var",this.name]};var ge=function(t,e,r,n,i){void 0===e&&(e=[]),void 0===n&&(n=new Dt),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map(function(t){return"["+t+"]"}).join(""),this.scope=n,this.errors=i,this.expectedType=r};function ve(t,e){for(var r,n=t.length-1,i=0,o=n,a=0;i<=o;)if((r=t[a=Math.floor((i+o)/2)])<=e){if(a===n||e<t[a+1])return a;i=a+1}else{if(!(r>e))throw new ne("Input is not a number.");o=a-1}return 0}ge.prototype.parse=function(t,e,r,n,i){return void 0===i&&(i={}),e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)},ge.prototype._parse=function(t,e){function r(t,e,r){return"assert"===r?new oe(e,[t]):"coerce"===r?new le(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found "+typeof n+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[n];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"image"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=r(o,a,e.typeAnnotation||"coerce");else o=r(o,a,e.typeAnnotation||"assert")}if(!(o instanceof re)&&"image"!==o.type.kind&&function t(e){if(e instanceof _e)return t(e.boundExpression);if(e instanceof pe&&"error"===e.name)return!1;if(e instanceof fe)return!1;var r=e instanceof le||e instanceof oe,n=!0;return e.eachChild(function(e){n=r?n&&t(e):n&&e instanceof re}),!!n&&(de(e)&&ye(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"]))}(o)){var u=new he;try{o=new re(o.type,o.evaluate(u))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},ge.prototype.concat=function(t,e,r){var n="number"==typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new ge(this.registry,n,e||null,i,this.errors)},ge.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var n=""+this.key+e.map(function(t){return"["+t+"]"}).join("");this.errors.push(new Pt(n,t))},ge.prototype.checkSubtype=function(t,e){var r=Xt(t,e);return r&&this.error(r),r};var xe=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,i=r;n<i.length;n+=1){var o=i[n],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function be(t,e,r){return t*(1-r)+e*r}xe.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,Ot);if(!r)return null;var n=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],u=o,l=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(n.length&&n[n.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var c=e.parse(s,l,i);if(!c)return null;i=i||c.type,n.push([a,c])}return new xe(i,r,n)},xe.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[ve(e,n)].evaluate(t)},xe.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},xe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}))},xe.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var we=Object.freeze({number:be,color:function(t,e,r){return new Zt(be(t.r,e.r,r),be(t.g,e.g,r),be(t.b,e.b,r),be(t.a,e.a,r))},array:function(t,e,r){return t.map(function(t,n){return be(t,e[n],r)})}}),Ee=.95047,Ae=1,Te=1.08883,Me=4/29,Se=6/29,Re=3*Se*Se,Ie=Se*Se*Se,Ce=Math.PI/180,Pe=180/Math.PI;function De(t){return t>Ie?Math.pow(t,1/3):t/Re+Me}function Le(t){return t>Se?t*t*t:Re*(t-Me)}function Oe(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ke(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Fe(t){var e=ke(t.r),r=ke(t.g),n=ke(t.b),i=De((.4124564*e+.3575761*r+.1804375*n)/Ee),o=De((.2126729*e+.7151522*r+.072175*n)/Ae);return{l:116*o-16,a:500*(i-o),b:200*(o-De((.0193339*e+.119192*r+.9503041*n)/Te)),alpha:t.a}}function Be(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=Ae*Le(e),r=Ee*Le(r),n=Te*Le(n),new Zt(Oe(3.2404542*r-1.5371385*e-.4985314*n),Oe(-.969266*r+1.8760108*e+.041556*n),Oe(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function Ne(t,e,r){var n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}var ze={forward:Fe,reverse:Be,interpolate:function(t,e,r){return{l:be(t.l,e.l,r),a:be(t.a,e.a,r),b:be(t.b,e.b,r),alpha:be(t.alpha,e.alpha,r)}}},Ue={forward:function(t){var e=Fe(t),r=e.l,n=e.a,i=e.b,o=Math.atan2(i,n)*Pe;return{h:o<0?o+360:o,c:Math.sqrt(n*n+i*i),l:r,alpha:t.a}},reverse:function(t){var e=t.h*Ce,r=t.c;return Be({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:Ne(t.h,e.h,r),c:be(t.c,e.c,r),l:be(t.l,e.l,r),alpha:be(t.alpha,e.alpha,r)}}},Ve=Object.freeze({lab:ze,hcl:Ue}),je=function(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[1];this.labels.push(s[0]),this.outputs.push(u)}};function Ge(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}je.interpolationFactor=function(t,e,n,i){var o=0;if("exponential"===t.name)o=Ge(e,t.base,n,i);else if("linear"===t.name)o=Ge(e,1,n,i);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new r(a[0],a[1],a[2],a[3]).solve(Ge(e,1,n,i))}return o},je.parse=function(t,e){var r=t[0],n=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var a=n[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:a}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var s=n.slice(1);if(4!==s.length||s.some(function(t){return"number"!=typeof t||t<0||t>1}))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,Ot)))return null;var u=[],l=null;"interpolate-hcl"===r||"interpolate-lab"===r?l=Bt:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<o.length;c+=2){var h=o[c],p=o[c+1],f=c+3,d=c+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',f);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',f);var m=e.parse(p,d,l);if(!m)return null;l=l||m.type,u.push([h,m])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new je(l,r,n,i,u):e.error("Type "+qt(l)+" is not interpolatable.")},je.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var o=ve(e,n),a=je.interpolationFactor(this.interpolation,n,e[o],e[o+1]),s=r[o].evaluate(t),u=r[o+1].evaluate(t);return"interpolate"===this.operator?we[this.type.kind.toLowerCase()](s,u,a):"interpolate-hcl"===this.operator?Ue.reverse(Ue.interpolate(Ue.forward(s),Ue.forward(u),a)):ze.reverse(ze.interpolate(ze.forward(s),ze.forward(u),a))},je.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1)t(r[e])},je.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()}))},je.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var qe=function(t,e){this.type=t,this.args=e};qe.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,n=e.expectedType;n&&"value"!==n.kind&&(r=n);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+i.length,r,void 0,{typeAnnotation:"omit"});if(!s)return null;r=r||s.type,i.push(s)}var u=n&&i.some(function(t){return Xt(n,t.type)});return new qe(u?zt:r,i)},qe.prototype.evaluate=function(t){for(var e,r=null,n=0,i=0,o=this.args;i<o.length;i+=1){var a=o[i];if(n++,r=a.evaluate(t),"image"!==a.type.kind||r.available||(e||(e=a.evaluate(t).name),r=null,n===this.args.length&&(r=e)),null!==r)break}return r},qe.prototype.eachChild=function(t){this.args.forEach(t)},qe.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.args.map(function(t){return t.possibleOutputs()}))},qe.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(e){t.push(e.serialize())}),t};var He=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};He.prototype.evaluate=function(t){return this.result.evaluate(t)},He.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1)t(r[e][1]);t(this.result)},He.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var i=t[n];if("string"!=typeof i)return e.error("Expected string, but found "+typeof i+" instead.",n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var o=e.parse(t[n+1],n+1);if(!o)return null;r.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return a?new He(r,a):null},He.prototype.possibleOutputs=function(){return this.result.possibleOutputs()},He.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var n=r[e];t.push(n[0],n[1].serialize())}return t.push(this.result.serialize()),t};var Xe=function(t,e,r){this.type=t,this.index=e,this.input=r};Xe.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Ot),n=e.parse(t[2],2,Gt(e.expectedType||zt));return r&&n?new Xe(n.type.itemType,r,n):null},Xe.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new ne("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new ne("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new ne("Array index must be an integer, but found "+e+" instead.");return r[e]},Xe.prototype.eachChild=function(t){t(this.index),t(this.input)},Xe.prototype.possibleOutputs=function(){return[void 0]},Xe.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Ye=function(t,e,r,n,i,o){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o};Ye.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var l=e.concat(a);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,h=s;c<h.length;c+=1){var p=h[c];if("number"!=typeof p&&"string"!=typeof p)return l.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof p&&Math.floor(p)!==p)return l.error("Numeric branch labels must be integer values.");if(r){if(l.checkSubtype(r,te(p)))return null}else r=te(p);if(void 0!==i[String(p)])return l.error("Branch labels must be unique.");i[String(p)]=o.length}var f=e.parse(u,a,n);if(!f)return null;n=n||f.type,o.push(f)}var d=e.parse(t[1],1,zt);if(!d)return null;var m=e.parse(t[t.length-1],t.length-1,n);return m?"value"!==d.type.kind&&e.concat(1).checkSubtype(r,d.type)?null:new Ye(r,n,d,i,o,m):null},Ye.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(te(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},Ye.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Ye.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.outputs.map(function(t){return t.possibleOutputs()})).concat(this.otherwise.possibleOutputs())},Ye.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],n={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(h=n[this.cases[a]])?(n[this.cases[a]]=r.length,r.push([this.cases[a],[a]])):r[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=r;u<l.length;u+=1){var c=l[u],h=c[0],p=c[1];e.push(1===p.length?s(p[0]):p.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var Ze=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};function We(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Ke(t,e,r,n){return 0===n.compare(e,r)}function Je(t,e,r){var n="=="!==t&&"!="!==t;return function(){function i(t,e,r){this.type=Ft,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],o=e.parse(t[1],1,zt);if(!o)return null;if(!We(r,o.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+qt(o.type)+"'.");var a=e.parse(t[2],2,zt);if(!a)return null;if(!We(r,a.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+qt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+qt(o.type)+"' and '"+qt(a.type)+"'.");n&&("value"===o.type.kind&&"value"!==a.type.kind?o=new oe(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new oe(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Ut)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){var s=te(o),u=te(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new ne('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!n&&this.hasUntypedArgument){var l=te(o),c=te(a);if("string"!==l.kind||"string"!==c.kind)return e(i,o,a)}return this.collator?r(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.possibleOutputs=function(){return[!0,!1]},i.prototype.serialize=function(){var e=[t];return this.eachChild(function(t){e.push(t.serialize())}),e},i}()}Ze.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,Ft);if(!o)return null;var a=e.parse(t[i+1],i+1,r);if(!a)return null;n.push([o,a]),r=r||a.type}var s=e.parse(t[t.length-1],t.length-1,r);return s?new Ze(r,n,s):null},Ze.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];if(n[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},Ze.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[1];t(n[0]),t(i)}t(this.otherwise)},Ze.prototype.possibleOutputs=function(){var t;return(t=[]).concat.apply(t,this.branches.map(function(t){return t[1].possibleOutputs()})).concat(this.otherwise.possibleOutputs())},Ze.prototype.serialize=function(){var t=["case"];return this.eachChild(function(e){t.push(e.serialize())}),t};var Qe=Je("==",function(t,e,r){return e===r},Ke),$e=Je("!=",function(t,e,r){return e!==r},function(t,e,r,n){return!Ke(0,e,r,n)}),tr=Je("<",function(t,e,r){return e<r},function(t,e,r,n){return n.compare(e,r)<0}),er=Je(">",function(t,e,r){return e>r},function(t,e,r,n){return n.compare(e,r)>0}),rr=Je("<=",function(t,e,r){return e<=r},function(t,e,r,n){return n.compare(e,r)<=0}),nr=Je(">=",function(t,e,r){return e>=r},function(t,e,r,n){return n.compare(e,r)>=0}),ir=function(t,e,r,n,i){this.type=kt,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i};ir.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Ot);if(!r)return null;var n=t[2];if("object"!=typeof n||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");var i=null;if(n.locale&&!(i=e.parse(n.locale,1,kt)))return null;var o=null;if(n.currency&&!(o=e.parse(n.currency,1,kt)))return null;var a=null;if(n["min-fraction-digits"]&&!(a=e.parse(n["min-fraction-digits"],1,Ot)))return null;var s=null;return n["max-fraction-digits"]&&!(s=e.parse(n["max-fraction-digits"],1,Ot))?null:new ir(r,i,o,a,s)},ir.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},ir.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},ir.prototype.possibleOutputs=function(){return[void 0]},ir.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var or=function(t){this.type=Ot,this.input=t};or.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+qt(r.type)+" instead."):new or(r):null},or.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new ne("Expected value to be of type string or array, but found "+qt(te(e))+" instead.")},or.prototype.eachChild=function(t){t(this.input)},or.prototype.possibleOutputs=function(){return[void 0]},or.prototype.serialize=function(){var t=["length"];return this.eachChild(function(e){t.push(e.serialize())}),t};var ar={"==":Qe,"!=":$e,">":er,"<":tr,">=":nr,"<=":rr,array:oe,at:Xe,boolean:oe,case:Ze,coalesce:qe,collator:fe,format:ae,image:se,interpolate:je,"interpolate-hcl":je,"interpolate-lab":je,length:or,let:He,literal:re,match:Ye,number:oe,"number-format":ir,object:oe,step:xe,string:oe,"to-boolean":le,"to-color":le,"to-number":le,"to-string":le,var:_e};function sr(t,e){var r=e[0],n=e[1],i=e[2],o=e[3];r=r.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=$t(r,n,i,a);if(s)throw new ne(s);return new Zt(r/255*a,n/255*a,i/255*a,a)}function ur(t,e){return t in e}function lr(t,e){var r=e[t];return void 0===r?null:r}function cr(t){return{type:t}}function hr(t){return{result:"success",value:t}}function pr(t){return{result:"error",value:t}}function fr(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function dr(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function mr(t){return!!t.expression&&t.expression.interpolated}function yr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function _r(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function gr(t){return t}function vr(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function xr(t,e,r,n,i){return vr(typeof r===i?n[r]:void 0,t.default,e.default)}function br(t,e,r){if("number"!==yr(r))return vr(t.default,e.default);var n=t.stops.length;if(1===n)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[n-1][0])return t.stops[n-1][1];var i=ve(t.stops.map(function(t){return t[0]}),r);return t.stops[i][1]}function wr(t,e,r){var n=void 0!==t.base?t.base:1;if("number"!==yr(r))return vr(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[i-1][0])return t.stops[i-1][1];var o=ve(t.stops.map(function(t){return t[0]}),r),a=function(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(r,n,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],u=t.stops[o+1][1],l=we[e.type]||gr;if(t.colorSpace&&"rgb"!==t.colorSpace){var c=Ve[t.colorSpace];l=function(t,e){return c.reverse(c.interpolate(c.forward(t),c.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var r=s.evaluate.apply(void 0,t),n=u.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==n)return l(r,n,a)}}:l(s,u,a)}function Er(t,e,r){return"color"===e.type?r=Zt.parse(r):"formatted"===e.type?r=Jt.fromString(r.toString()):"image"===e.type?r=Qt.fromString({name:r.toString(),available:!1}):yr(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),vr(r,t.default,e.default)}pe.register(ar,{error:[{kind:"error"},[kt],function(t,e){throw new ne(e[0].evaluate(t))}],typeof:[kt,[zt],function(t,e){return qt(te(e[0].evaluate(t)))}],"to-rgba":[Gt(Ot,4),[Bt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Bt,[Ot,Ot,Ot],sr],rgba:[Bt,[Ot,Ot,Ot,Ot],sr],has:{type:Ft,overloads:[[[kt],function(t,e){return ur(e[0].evaluate(t),t.properties())}],[[kt,Nt],function(t,e){var r=e[1];return ur(e[0].evaluate(t),r.evaluate(t))}]]},get:{type:zt,overloads:[[[kt],function(t,e){return lr(e[0].evaluate(t),t.properties())}],[[kt,Nt],function(t,e){var r=e[1];return lr(e[0].evaluate(t),r.evaluate(t))}]]},"feature-state":[zt,[kt],function(t,e){return lr(e[0].evaluate(t),t.featureState||{})}],properties:[Nt,[],function(t){return t.properties()}],"geometry-type":[kt,[],function(t){return t.geometryType()}],id:[zt,[],function(t){return t.id()}],zoom:[Ot,[],function(t){return t.globals.zoom}],"heatmap-density":[Ot,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Ot,[],function(t){return t.globals.lineProgress||0}],accumulated:[zt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Ot,cr(Ot),function(t,e){for(var r=0,n=0,i=e;n<i.length;n+=1)r+=i[n].evaluate(t);return r}],"*":[Ot,cr(Ot),function(t,e){for(var r=1,n=0,i=e;n<i.length;n+=1)r*=i[n].evaluate(t);return r}],"-":{type:Ot,overloads:[[[Ot,Ot],function(t,e){var r=e[1];return e[0].evaluate(t)-r.evaluate(t)}],[[Ot],function(t,e){return-e[0].evaluate(t)}]]},"/":[Ot,[Ot,Ot],function(t,e){var r=e[1];return e[0].evaluate(t)/r.evaluate(t)}],"%":[Ot,[Ot,Ot],function(t,e){var r=e[1];return e[0].evaluate(t)%r.evaluate(t)}],ln2:[Ot,[],function(){return Math.LN2}],pi:[Ot,[],function(){return Math.PI}],e:[Ot,[],function(){return Math.E}],"^":[Ot,[Ot,Ot],function(t,e){var r=e[1];return Math.pow(e[0].evaluate(t),r.evaluate(t))}],sqrt:[Ot,[Ot],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Ot,[Ot],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Ot,[Ot],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Ot,[Ot],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Ot,[Ot],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Ot,[Ot],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Ot,[Ot],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Ot,[Ot],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Ot,[Ot],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Ot,[Ot],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Ot,cr(Ot),function(t,e){return Math.min.apply(Math,e.map(function(e){return e.evaluate(t)}))}],max:[Ot,cr(Ot),function(t,e){return Math.max.apply(Math,e.map(function(e){return e.evaluate(t)}))}],abs:[Ot,[Ot],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Ot,[Ot],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ot,[Ot],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Ot,[Ot],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[Ft,[kt,zt],function(t,e){var r=e[0],n=e[1];return t.properties()[r.value]===n.value}],"filter-id-==":[Ft,[zt],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[Ft,[kt],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[Ft,[kt,zt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<o}],"filter-id-<":[Ft,[zt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[Ft,[kt,zt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i>o}],"filter-id->":[Ft,[zt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>i}],"filter-<=":[Ft,[kt,zt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[Ft,[zt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[Ft,[kt,zt],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[Ft,[zt],function(t,e){var r=e[0],n=t.id(),i=r.value;return typeof n==typeof i&&n>=i}],"filter-has":[Ft,[zt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Ft,[],function(t){return null!==t.id()}],"filter-type-in":[Ft,[Gt(kt)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Ft,[Gt(zt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Ft,[kt,Gt(zt)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[Ft,[kt,Gt(zt)],function(t,e){var r=e[0],n=e[1];return function(t,e,r,n){for(;r<=n;){var i=r+n>>1;if(e[i]===t)return!0;e[i]>t?n=i-1:r=i+1}return!1}(t.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:Ft,overloads:[[[Ft,Ft],function(t,e){var r=e[1];return e[0].evaluate(t)&&r.evaluate(t)}],[cr(Ft),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(!n[r].evaluate(t))return!1;return!0}]]},any:{type:Ft,overloads:[[[Ft,Ft],function(t,e){var r=e[1];return e[0].evaluate(t)||r.evaluate(t)}],[cr(Ft),function(t,e){for(var r=0,n=e;r<n.length;r+=1)if(n[r].evaluate(t))return!0;return!1}]]},"!":[Ft,[Ft],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Ft,[kt],function(t,e){var r=t.globals&&t.globals.isSupportedScript;return!r||r(e[0].evaluate(t))}],upcase:[kt,[kt],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[kt,[kt],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[kt,cr(zt),function(t,e){return e.map(function(e){return ee(e.evaluate(t))}).join("")}],"resolved-locale":[kt,[Ut],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Ar=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new he,this._defaultValue=e?function(t){return"color"===t.type&&_r(t.default)?new Zt(0,0,0,0):"color"===t.type?Zt.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function Tr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in ar}function Mr(t,e){var r=new ge(ar,[],e?function(t){var e={color:Bt,string:kt,number:Ot,enum:kt,boolean:Ft,formatted:Vt,image:jt};return"array"===t.type?Gt(e[t.value]||zt,t.length):e[t.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?hr(new Ar(n,e)):pr(r.errors)}Ar.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=i,this.expression.evaluate(this._evaluator)},Ar.prototype.evaluate=function(t,e,r,n,i){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.availableImages=n||null,this._evaluator.formattedSection=i||null;try{var o=this.expression.evaluate(this._evaluator);if(null==o)return this._defaultValue;if(this._enumValues&&!(o in this._enumValues))throw new ne("Expected value to be one of "+Object.keys(this._enumValues).map(function(t){return JSON.stringify(t)}).join(", ")+", but found "+JSON.stringify(o)+" instead.");return o}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Sr=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!me(e.expression)};Sr.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i)},Sr.prototype.evaluate=function(t,e,r,n,i){return this._styleExpression.evaluate(t,e,r,n,i)};var Rr=function(t,e,r,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!me(e.expression),this.interpolationType=n};function Ir(t,e){if("error"===(t=Mr(t,e)).result)return t;var r=t.value.expression,n=de(r);if(!n&&!fr(e))return pr([new Pt("","data expressions not supported")]);var i=ye(r,["zoom"]);if(!i&&!dr(e))return pr([new Pt("","zoom expressions not supported")]);var o=function t(e){var r=null;if(e instanceof He)r=t(e.result);else if(e instanceof qe)for(var n=0,i=e.args;n<i.length;n+=1){if(r=t(i[n]))break}else(e instanceof xe||e instanceof je)&&e.input instanceof pe&&"zoom"===e.input.name&&(r=e);return r instanceof Pt?r:(e.eachChild(function(e){var n=t(e);n instanceof Pt?r=n:!r&&n?r=new Pt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&n&&r!==n&&(r=new Pt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r)}(r);return o||i?o instanceof Pt?pr([o]):o instanceof je&&!mr(e)?pr([new Pt("",'"interpolate" expressions cannot be used with this property')]):hr(o?new Rr(n?"camera":"composite",t.value,o.labels,o instanceof je?o.interpolation:void 0):new Sr(n?"constant":"source",t.value)):pr([new Pt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Rr.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i)},Rr.prototype.evaluate=function(t,e,r,n,i){return this._styleExpression.evaluate(t,e,r,n,i)},Rr.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?je.interpolationFactor(this.interpolationType,t,e,r):0};var Cr=function(t,e){this._parameters=t,this._specification=e,St(this,function t(e,r){var n,i,o,a="color"===r.type,s=e.stops&&"object"==typeof e.stops[0][0],u=s||!(s||void 0!==e.property),l=e.type||(mr(r)?"exponential":"interval");if(a&&((e=St({},e)).stops&&(e.stops=e.stops.map(function(t){return[t[0],Zt.parse(t[1])]})),e.default=Zt.parse(e.default?e.default:r.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Ve[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)n=wr;else if("interval"===l)n=br;else if("categorical"===l){n=xr,i=Object.create(null);for(var c=0,h=e.stops;c<h.length;c+=1){var p=h[c];i[p[0]]=p[1]}o=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');n=Er}if(s){for(var f={},d=[],m=0;m<e.stops.length;m++){var y=e.stops[m],_=y[0].zoom;void 0===f[_]&&(f[_]={zoom:_,type:e.type,property:e.property,default:e.default,stops:[]},d.push(_)),f[_].stops.push([y[0].value,y[1]])}for(var g=[],v=0,x=d;v<x.length;v+=1){var b=x[v];g.push([f[b].zoom,t(f[b],r)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:je.interpolationFactor.bind(void 0,w),zoomStops:g.map(function(t){return t[0]}),evaluate:function(t,n){var i=t.zoom;return wr({stops:g,base:e.base},r,i).evaluate(i,n)}}}if(u){var E="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:je.interpolationFactor.bind(void 0,E),zoomStops:e.stops.map(function(t){return t[0]}),evaluate:function(t){return n(e,r,t.zoom,i,o)}}}return{kind:"source",evaluate:function(t,a){var s=a&&a.properties?a.properties[e.property]:void 0;return void 0===s?vr(e.default,r.default):n(e,r,s,i,o)}}}(this._parameters,this._specification))};function Pr(t){var e=t.key,r=t.value,n=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],u=yr(r);if("object"!==u)return[new Tt(e,r,"object expected, "+u+" found")];for(var l in r){var c=l.split(".")[0],h=n[c]||n["*"],p=void 0;if(i[c])p=i[c];else if(n[c])p=en;else if(i["*"])p=i["*"];else{if(!n["*"]){s.push(new Tt(e,r[l],'unknown property "'+l+'"'));continue}p=en}s=s.concat(p({key:(e?e+".":e)+l,value:r[l],valueSpec:h,style:o,styleSpec:a,object:r,objectKey:l},r))}for(var f in n)i[f]||n[f].required&&void 0===n[f].default&&void 0===r[f]&&s.push(new Tt(e,r,'missing required property "'+f+'"'));return s}function Dr(t){var e=t.value,r=t.valueSpec,n=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||en;if("array"!==yr(e))return[new Tt(o,e,"array expected, "+yr(e)+" found")];if(r.length&&e.length!==r.length)return[new Tt(o,e,"array length "+r.length+" expected, length "+e.length+" found")];if(r["min-length"]&&e.length<r["min-length"])return[new Tt(o,e,"array length at least "+r["min-length"]+" expected, length "+e.length+" found")];var s={type:r.value,values:r.values};i.$version<7&&(s.function=r.function),"object"===yr(r.value)&&(s=r.value);for(var u=[],l=0;l<e.length;l++)u=u.concat(a({array:e,arrayIndex:l,value:e[l],valueSpec:s,style:n,styleSpec:i,key:o+"["+l+"]"}));return u}function Lr(t){var e=t.key,r=t.value,n=t.valueSpec,i=yr(r);return"number"!==i?[new Tt(e,r,"number expected, "+i+" found")]:"minimum"in n&&r<n.minimum?[new Tt(e,r,r+" is less than the minimum value "+n.minimum)]:"maximum"in n&&r>n.maximum?[new Tt(e,r,r+" is greater than the maximum value "+n.maximum)]:[]}function Or(t){var e,r,n,i=t.valueSpec,o=It(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,u=!s,l="array"===yr(t.value.stops)&&"array"===yr(t.value.stops[0])&&"object"===yr(t.value.stops[0][0]),c=Pr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new Tt(t.key,t.value,'identity function may not have a "stops" property')];var e=[],r=t.value;return e=e.concat(Dr({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===yr(r)&&0===r.length&&e.push(new Tt(t.key,r,"array must have at least one stop")),e},default:function(t){return en({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&c.push(new Tt(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||c.push(new Tt(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!mr(t.valueSpec)&&c.push(new Tt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!fr(t.valueSpec)?c.push(new Tt(t.key,t.value,"property functions not supported")):s&&!dr(t.valueSpec)&&c.push(new Tt(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!l||void 0!==t.value.property||c.push(new Tt(t.key,t.value,'"property" property is required')),c;function h(t){var e=[],o=t.value,s=t.key;if("array"!==yr(o))return[new Tt(s,o,"array expected, "+yr(o)+" found")];if(2!==o.length)return[new Tt(s,o,"array length 2 expected, length "+o.length+" found")];if(l){if("object"!==yr(o[0]))return[new Tt(s,o,"object expected, "+yr(o[0])+" found")];if(void 0===o[0].zoom)return[new Tt(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new Tt(s,o,"object stop key must have value")];if(n&&n>It(o[0].zoom))return[new Tt(s,o[0].zoom,"stop zoom values must appear in ascending order")];It(o[0].zoom)!==n&&(n=It(o[0].zoom),r=void 0,a={}),e=e.concat(Pr({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:Lr,value:p}}))}else e=e.concat(p({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return Tr(Ct(o[1]))?e.concat([new Tt(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(en({key:s+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,n){var s=yr(t.value),u=It(t.value),l=null!==t.value?t.value:n;if(e){if(s!==e)return[new Tt(t.key,l,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Tt(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var c="number expected, "+s+" found";return fr(i)&&void 0===o&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Tt(t.key,l,c)]}return"categorical"!==o||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==o&&"number"===s&&void 0!==r&&u<r?[new Tt(t.key,l,"stop domain values must appear in ascending order")]:(r=u,"categorical"===o&&u in a?[new Tt(t.key,l,"stop domain values must be unique")]:(a[u]=!0,[])):[new Tt(t.key,l,"integer expected, found "+u)]}}function kr(t){var e=("property"===t.expressionContext?Ir:Mr)(Ct(t.value),t.valueSpec);if("error"===e.result)return e.value.map(function(e){return new Tt(""+t.key+e.key,t.value,e.message)});var r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&-1!==r.possibleOutputs().indexOf(void 0))return[new Tt(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!me(r))return[new Tt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!me(r))return[new Tt(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!ye(r,["zoom","feature-state"]))return[new Tt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!de(r))return[new Tt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fr(t){var e=t.key,r=t.value,n=t.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(It(r))&&i.push(new Tt(e,r,"expected one of ["+n.values.join(", ")+"], "+JSON.stringify(r)+" found")):-1===Object.keys(n.values).indexOf(It(r))&&i.push(new Tt(e,r,"expected one of ["+Object.keys(n.values).join(", ")+"], "+JSON.stringify(r)+" found")),i}function Br(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var n=r[e];if(!Br(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}Cr.deserialize=function(t){return new Cr(t._parameters,t._specification)},Cr.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var Nr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zr(t){if(null==t)return function(){return!0};Br(t)||(t=Vr(t));var e=Mr(t,Nr);if("error"===e.result)throw new Error(e.value.map(function(t){return t.key+": "+t.message}).join(", "));return function(t,r){return e.value.evaluate(t,r)}}function Ur(t,e){return t<e?-1:t>e?1:0}function Vr(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?jr(t[1],t[2],"=="):"!="===r?Hr(jr(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?jr(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(Vr))):"all"===r?["all"].concat(t.slice(1).map(Vr)):"none"===r?["all"].concat(t.slice(1).map(Vr).map(Hr)):"in"===r?Gr(t[1],t.slice(2)):"!in"===r?Hr(Gr(t[1],t.slice(2))):"has"===r?qr(t[1]):"!has"!==r||Hr(qr(t[1]))}function jr(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function Gr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(function(t){return typeof t!=typeof e[0]})?["filter-in-large",t,["literal",e.sort(Ur)]]:["filter-in-small",t,["literal",e]]}}function qr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Hr(t){return["!",t]}function Xr(t){return Br(Ct(t.value))?kr(St({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var r=e.value,n=e.key;if("array"!==yr(r))return[new Tt(n,r,"array expected, "+yr(r)+" found")];var i,o=e.styleSpec,a=[];if(r.length<1)return[new Tt(n,r,"filter array must have at least 1 element")];switch(a=a.concat(Fr({key:n+"[0]",value:r[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),It(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===It(r[1])&&a.push(new Tt(n,r,'"$type" cannot be use with operator "'+r[0]+'"'));case"==":case"!=":3!==r.length&&a.push(new Tt(n,r,'filter array for operator "'+r[0]+'" must have 3 elements'));case"in":case"!in":r.length>=2&&"string"!==(i=yr(r[1]))&&a.push(new Tt(n+"[1]",r[1],"string expected, "+i+" found"));for(var s=2;s<r.length;s++)i=yr(r[s]),"$type"===It(r[1])?a=a.concat(Fr({key:n+"["+s+"]",value:r[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new Tt(n+"["+s+"]",r[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<r.length;u++)a=a.concat(t({key:n+"["+u+"]",value:r[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=yr(r[1]),2!==r.length?a.push(new Tt(n,r,'filter array for "'+r[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new Tt(n+"[1]",r[1],"string expected, "+i+" found"))}return a}(t)}function Yr(t,e){var r=t.key,n=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return en({key:r,value:o,valueSpec:i.transition,style:n,styleSpec:i});var l,c=t.valueSpec||s[a];if(!c)return[new Tt(r,o,'unknown property "'+a+'"')];if("string"===yr(o)&&fr(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(o)))return[new Tt(r,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(l[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&n&&!n.glyphs&&h.push(new Tt(r,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&_r(Ct(o))&&"identity"===It(o.type)&&h.push(new Tt(r,o,'"text-font" does not support identity functions'))),h.concat(en({key:t.key,value:o,valueSpec:c,style:n,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function Zr(t){return Yr(t,"paint")}function Wr(t){return Yr(t,"layout")}function Kr(t){var e=[],r=t.value,n=t.key,i=t.style,o=t.styleSpec;r.type||r.ref||e.push(new Tt(n,r,'either "type" or "ref" is required'));var a,s=It(r.type),u=It(r.ref);if(r.id)for(var l=It(r.id),c=0;c<t.arrayIndex;c++){var h=i.layers[c];It(h.id)===l&&e.push(new Tt(n,r.id,'duplicate layer id "'+r.id+'", previously used at line '+h.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(t){t in r&&e.push(new Tt(n,r[t],'"'+t+'" is prohibited for ref layers'))}),i.layers.forEach(function(t){It(t.id)===u&&(a=t)}),a?a.ref?e.push(new Tt(n,r.ref,"ref cannot reference another ref layer")):s=It(a.type):e.push(new Tt(n,r.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(r.source){var p=i.sources&&i.sources[r.source],f=p&&It(p.type);p?"vector"===f&&"raster"===s?e.push(new Tt(n,r.source,'layer "'+r.id+'" requires a raster source')):"raster"===f&&"raster"!==s?e.push(new Tt(n,r.source,'layer "'+r.id+'" requires a vector source')):"vector"!==f||r["source-layer"]?"raster-dem"===f&&"hillshade"!==s?e.push(new Tt(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]||"geojson"===f&&p.lineMetrics||e.push(new Tt(n,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new Tt(n,r,'layer "'+r.id+'" must specify a "source-layer"')):e.push(new Tt(n,r.source,'source "'+r.source+'" not found'))}else e.push(new Tt(n,r,'missing required property "source"'));return e=e.concat(Pr({key:n,value:r,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return en({key:n+".type",value:r.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"})},filter:Xr,layout:function(t){return Pr({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Wr(St({layerType:s},t))}}})},paint:function(t){return Pr({layer:r,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return Zr(St({layerType:s},t))}}})}}}))}function Jr(t){var e=t.value,r=t.key,n=t.styleSpec,i=t.style;if(!e.type)return[new Tt(r,e,'"type" is required')];var o,a=It(e.type);switch(a){case"vector":case"raster":case"raster-dem":return Pr({key:r,value:e,valueSpec:n["source_"+a.replace("-","_")],style:t.style,styleSpec:n});case"geojson":if(o=Pr({key:r,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],l=u[0],c="string"==typeof l?[l,["accumulated"],["get",s]]:l;o.push.apply(o,kr({key:r+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),o.push.apply(o,kr({key:r+"."+s+".reduce",value:c,expressionContext:"cluster-reduce"}))}return o;case"video":return Pr({key:r,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return Pr({key:r,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new Tt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Fr({key:r+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:n})}}function Qr(t){var e=t.value,r=t.styleSpec,n=r.light,i=t.style,o=[],a=yr(e);if(void 0===e)return o;if("object"!==a)return o.concat([new Tt("light",e,"object expected, "+a+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);o=o.concat(u&&n[u[1]]&&n[u[1]].transition?en({key:s,value:e[s],valueSpec:r.transition,style:i,styleSpec:r}):n[s]?en({key:s,value:e[s],valueSpec:n[s],style:i,styleSpec:r}):[new Tt(s,e[s],'unknown property "'+s+'"')])}return o}function $r(t){var e=t.value,r=t.key,n=yr(e);return"string"!==n?[new Tt(r,e,"string expected, "+n+" found")]:[]}var tn={"*":function(){return[]},array:Dr,boolean:function(t){var e=t.value,r=t.key,n=yr(e);return"boolean"!==n?[new Tt(r,e,"boolean expected, "+n+" found")]:[]},number:Lr,color:function(t){var e=t.key,r=t.value,n=yr(r);return"string"!==n?[new Tt(e,r,"color expected, "+n+" found")]:null===Yt(r)?[new Tt(e,r,'color expected, "'+r+'" found')]:[]},constants:Mt,enum:Fr,filter:Xr,function:Or,layer:Kr,object:Pr,source:Jr,light:Qr,string:$r,formatted:function(t){return 0===$r(t).length?[]:kr(t)},image:function(t){return 0===$r(t).length?[]:kr(t)}};function en(t){var e=t.value,r=t.valueSpec,n=t.styleSpec;return r.expression&&_r(It(e))?Or(t):r.expression&&Tr(Ct(e))?kr(t):r.type&&tn[r.type]?tn[r.type](t):Pr(St({},t,{valueSpec:r.type?n[r.type]:r}))}function rn(t){var e=t.value,r=t.key,n=$r(t);return n.length?n:(-1===e.indexOf("{fontstack}")&&n.push(new Tt(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new Tt(r,e,'"glyphs" url must include a "{range}" token')),n)}function nn(t,e){void 0===e&&(e=At);var r=[];return r=r.concat(en({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:rn,"*":function(){return[]}}})),t.constants&&(r=r.concat(Mt({key:"constants",value:t.constants,style:t,styleSpec:e}))),on(r)}function on(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function an(t){return function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return on(t.apply(this,e))}}nn.source=an(Jr),nn.light=an(Qr),nn.layer=an(Kr),nn.filter=an(Xr),nn.paintProperty=an(Zr),nn.layoutProperty=an(Wr);var sn=nn,un=sn.light,ln=sn.paintProperty,cn=sn.layoutProperty;function hn(t,e){var r=!1;if(e&&e.length)for(var n=0,i=e;n<i.length;n+=1){t.fire(new wt(new Error(i[n].message))),r=!0}return r}var pn=dn,fn=3;function dn(t,e,r){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(r=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[fn+o],s=i[fn+o+1];n.push(a===s?null:i.subarray(a,s))}var u=i[fn+n.length+1];this.keys=i.subarray(i[fn+n.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var l=0;l<this.d*this.d;l++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var c=r/e*t;this.min=-c,this.max=t+c}dn.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},dn.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},dn.prototype._insertCell=function(t,e,r,n,i,o){this.cells[i].push(o)},dn.prototype.query=function(t,e,r,n,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=r&&a<=n&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,r,n,this._queryCell,s,{},i),s},dn.prototype._queryCell=function(t,e,r,n,i,o,a,s){var u=this.cells[i];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var p=u[h];if(void 0===a[p]){var f=4*p;(s?s(c[f+0],c[f+1],c[f+2],c[f+3]):t<=c[f+2]&&e<=c[f+3]&&r>=c[f+0]&&n>=c[f+1])?(a[p]=!0,o.push(l[p])):a[p]=!1}}},dn.prototype._forEachCell=function(t,e,r,n,i,o,a,s){for(var u=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(r),h=this._convertToCellCoord(n),p=u;p<=c;p++)for(var f=l;f<=h;f++){var d=this.d*f+p;if((!s||s(this._convertFromCellCoord(p),this._convertFromCellCoord(f),this._convertFromCellCoord(p+1),this._convertFromCellCoord(f+1)))&&i.call(this,t,e,r,n,d,o,a,s))return}},dn.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},dn.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},dn.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=fn+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(e+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[fn+a]=o,i.set(s,o),o+=s.length}return i[fn+t.length]=o,i.set(this.keys,o),i[fn+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var mn=self.ImageData,yn={};function _n(t,e,r){void 0===r&&(r={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),yn[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}for(var gn in _n("Object",Object),pn.serialize=function(t,e){var r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},pn.deserialize=function(t){return new pn(t.buffer)},_n("Grid",pn),_n("Color",Zt),_n("Error",Error),_n("StylePropertyFunction",Cr),_n("StyleExpression",Ar,{omit:["_evaluator"]}),_n("ZoomDependentExpression",Rr),_n("ZoomConstantExpression",Sr),_n("CompoundExpression",pe,{omit:["_evaluate"]}),ar)ar[gn]._classRegistryKey||_n("Expression_"+gn,ar[gn]);function vn(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(t instanceof ArrayBuffer)return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var r=t;return e&&e.push(r.buffer),r}if(t instanceof mn)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var n=[],i=0,o=t;i<o.length;i+=1){n.push(vn(o[i],e))}return n}if("object"==typeof t){var a=t.constructor,s=a._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");var u=a.serialize?a.serialize(t,e):{};if(!a.serialize){for(var l in t)if(t.hasOwnProperty(l)&&!(yn[s].omit.indexOf(l)>=0)){var c=t[l];u[l]=yn[s].shallow.indexOf(l)>=0?c:vn(c,e)}t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function xn(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||t instanceof ArrayBuffer||ArrayBuffer.isView(t)||t instanceof mn)return t;if(Array.isArray(t))return t.map(xn);if("object"==typeof t){var e=t.$name||"Object",r=yn[e].klass;if(!r)throw new Error("can't deserialize unregistered class "+e);if(r.deserialize)return r.deserialize(t);for(var n=Object.create(r.prototype),i=0,o=Object.keys(t);i<o.length;i+=1){var a=o[i];if("$name"!==a){var s=t[a];n[a]=yn[e].shallow.indexOf(a)>=0?s:xn(s)}}return n}throw new Error("can't deserialize object of type "+typeof t)}var bn=function(){this.first=!0};bn.prototype.update=function(t,e){var r=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=r,!0))};var wn={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function En(t){for(var e=0,r=t;e<r.length;e+=1)if(Tn(r[e].charCodeAt(0)))return!0;return!1}function An(t){return!(wn.Arabic(t)||wn["Arabic Supplement"](t)||wn["Arabic Extended-A"](t)||wn["Arabic Presentation Forms-A"](t)||wn["Arabic Presentation Forms-B"](t))}function Tn(t){return!!(746===t||747===t||!(t<4352)&&(wn["Bopomofo Extended"](t)||wn.Bopomofo(t)||wn["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||wn["CJK Compatibility Ideographs"](t)||wn["CJK Compatibility"](t)||wn["CJK Radicals Supplement"](t)||wn["CJK Strokes"](t)||!(!wn["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||wn["CJK Unified Ideographs Extension A"](t)||wn["CJK Unified Ideographs"](t)||wn["Enclosed CJK Letters and Months"](t)||wn["Hangul Compatibility Jamo"](t)||wn["Hangul Jamo Extended-A"](t)||wn["Hangul Jamo Extended-B"](t)||wn["Hangul Jamo"](t)||wn["Hangul Syllables"](t)||wn.Hiragana(t)||wn["Ideographic Description Characters"](t)||wn.Kanbun(t)||wn["Kangxi Radicals"](t)||wn["Katakana Phonetic Extensions"](t)||wn.Katakana(t)&&12540!==t||!(!wn["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!wn["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||wn["Unified Canadian Aboriginal Syllabics"](t)||wn["Unified Canadian Aboriginal Syllabics Extended"](t)||wn["Vertical Forms"](t)||wn["Yijing Hexagram Symbols"](t)||wn["Yi Syllables"](t)||wn["Yi Radicals"](t)))}function Mn(t){return!(Tn(t)||function(t){return!!(wn["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||wn["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||wn["Letterlike Symbols"](t)||wn["Number Forms"](t)||wn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||wn["Control Pictures"](t)&&9251!==t||wn["Optical Character Recognition"](t)||wn["Enclosed Alphanumerics"](t)||wn["Geometric Shapes"](t)||wn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||wn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||wn["CJK Symbols and Punctuation"](t)||wn.Katakana(t)||wn["Private Use Area"](t)||wn["CJK Compatibility Forms"](t)||wn["Small Form Variants"](t)||wn["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Sn(t,e){return!(!e&&(t>=1424&&t<=2303||wn["Arabic Presentation Forms-A"](t)||wn["Arabic Presentation Forms-B"](t))||t>=2304&&t<=3583||t>=3840&&t<=4255||wn.Khmer(t))}var Rn,In=!1,Cn=null,Pn=!1,Dn=new Et,Ln={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Pn||null!=Ln.applyArabicShaping}},On=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new bn,this.transition={})};On.prototype.isSupportedScript=function(t){return function(t,e){for(var r=0,n=t;r<n.length;r+=1)if(!Sn(n[r].charCodeAt(0),e))return!1;return!0}(t,Ln.isLoaded())},On.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},On.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),r=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*e}};var kn=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(_r(t))return new Cr(t,e);if(Tr(t)){var r=Ir(t,e);if("error"===r.result)throw new Error(r.value.map(function(t){return t.key+": "+t.message}).join(", "));return r.value}var n=t;return"string"==typeof t&&"color"===e.type&&(n=Zt.parse(t)),{kind:"constant",evaluate:function(){return n}}}(void 0===e?t.specification.default:e,t.specification)};kn.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},kn.prototype.possiblyEvaluate=function(t,e){return this.property.possiblyEvaluate(this,t,e)};var Fn=function(t){this.property=t,this.value=new kn(t,void 0)};Fn.prototype.transitioned=function(t,e){return new Nn(this.property,this.value,e,h({},t.transition,this.transition),t.now)},Fn.prototype.untransitioned=function(){return new Nn(this.property,this.value,null,{},0)};var Bn=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Bn.prototype.getValue=function(t){return x(this._values[t].value.value)},Bn.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Fn(this._values[t].property)),this._values[t].value=new kn(this._values[t].property,null===e?void 0:x(e))},Bn.prototype.getTransition=function(t){return x(this._values[t].transition)},Bn.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new Fn(this._values[t].property)),this._values[t].transition=x(e)||void 0},Bn.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i);var o=this.getTransition(n);void 0!==o&&(t[n+"-transition"]=o)}return t},Bn.prototype.transitioned=function(t,e){for(var r=new zn(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var o=i[n];r._values[o]=this._values[o].transitioned(t,e._values[o])}return r},Bn.prototype.untransitioned=function(){for(var t=new zn(this._properties),e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e];t._values[n]=this._values[n].untransitioned()}return t};var Nn=function(t,e,r,n,i){this.property=t,this.value=e,this.begin=i+n.delay||0,this.end=this.begin+n.duration||0,t.specification.transition&&(n.delay||n.duration)&&(this.prior=r)};Nn.prototype.possiblyEvaluate=function(t,e){var r=t.now||0,n=this.value.possiblyEvaluate(t,e),i=this.prior;if(i){if(r>this.end)return this.prior=null,n;if(this.value.isDataDriven())return this.prior=null,n;if(r<this.begin)return i.possiblyEvaluate(t,e);var o=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(i.possiblyEvaluate(t,e),n,function(t){if(o<=0)return 0;if(o>=1)return 1;var e=o*o,r=e*o;return 4*(o<.5?r:3*(o-e)+r-.75)}())}return n};var zn=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};zn.prototype.possiblyEvaluate=function(t,e){for(var r=new jn(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var o=i[n];r._values[o]=this._values[o].possiblyEvaluate(t,e)}return r},zn.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1){if(this._values[e[t]].prior)return!0}return!1};var Un=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Un.prototype.getValue=function(t){return x(this._values[t].value)},Un.prototype.setValue=function(t,e){this._values[t]=new kn(this._values[t].property,null===e?void 0:x(e))},Un.prototype.serialize=function(){for(var t={},e=0,r=Object.keys(this._values);e<r.length;e+=1){var n=r[e],i=this.getValue(n);void 0!==i&&(t[n]=i)}return t},Un.prototype.possiblyEvaluate=function(t,e){for(var r=new jn(this._properties),n=0,i=Object.keys(this._values);n<i.length;n+=1){var o=i[n];r._values[o]=this._values[o].possiblyEvaluate(t,e)}return r};var Vn=function(t,e,r){this.property=t,this.value=e,this.parameters=r};Vn.prototype.isConstant=function(){return"constant"===this.value.kind},Vn.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},Vn.prototype.evaluate=function(t,e,r){return this.property.evaluate(this.value,this.parameters,t,e,r)};var jn=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};jn.prototype.get=function(t){return this._values[t]};var Gn=function(t){this.specification=t};Gn.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},Gn.prototype.interpolate=function(t,e,r){var n=we[this.specification.type];return n?n(t,e,r):t};var qn=function(t,e){this.specification=t,this.overrides=e};qn.prototype.possiblyEvaluate=function(t,e,r){return new Vn(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},r)}:t.expression,e)},qn.prototype.interpolate=function(t,e,r){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new Vn(this,{kind:"constant",value:void 0},t.parameters);var n=we[this.specification.type];return n?new Vn(this,{kind:"constant",value:n(t.value.value,e.value.value,r)},t.parameters):t},qn.prototype.evaluate=function(t,e,r,n,i){return"constant"===t.kind?t.value:t.evaluate(e,r,n,i)};var Hn=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,r){if(void 0===t.value)return new Vn(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var n=t.expression.evaluate(e,null,{},r),i="image"===t.property.specification.type&&"string"!=typeof n?n.name:n,o=this._calculate(i,i,i,e);return new Vn(this,{kind:"constant",value:o},e)}if("camera"===t.expression.kind){var a=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new Vn(this,{kind:"constant",value:a},e)}return new Vn(this,t.expression,e)},e.prototype.evaluate=function(t,e,r,n,i){if("source"===t.kind){var o=t.evaluate(e,r,n,i);return this._calculate(o,o,o,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},r,n),t.evaluate({zoom:Math.floor(e.zoom)},r,n),t.evaluate({zoom:Math.floor(e.zoom)+1},r,n),e):t.value},e.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},e.prototype.interpolate=function(t){return t},e}(qn),Xn=function(t){this.specification=t};Xn.prototype.possiblyEvaluate=function(t,e,r){if(void 0!==t.value){if("constant"===t.expression.kind){var n=t.expression.evaluate(e,null,{},r);return this._calculate(n,n,n,e)}return this._calculate(t.expression.evaluate(new On(Math.floor(e.zoom-1),e)),t.expression.evaluate(new On(Math.floor(e.zoom),e)),t.expression.evaluate(new On(Math.floor(e.zoom+1),e)),e)}},Xn.prototype._calculate=function(t,e,r,n){return n.zoom>n.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:r,to:e}},Xn.prototype.interpolate=function(t){return t};var Yn=function(t){this.specification=t};Yn.prototype.possiblyEvaluate=function(t,e,r){return!!t.expression.evaluate(e,null,{},r)},Yn.prototype.interpolate=function(){return!1};var Zn=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var r=t[e];r.specification.overridable&&this.overridableProperties.push(e);var n=this.defaultPropertyValues[e]=new kn(r,void 0),i=this.defaultTransitionablePropertyValues[e]=new Fn(r);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=n.possiblyEvaluate({})}};_n("DataDrivenProperty",qn),_n("DataConstantProperty",Gn),_n("CrossFadedDataDrivenProperty",Hn),_n("CrossFadedProperty",Xn),_n("ColorRampProperty",Yn);var Wn=function(t){function e(e,r){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter=function(){return!0},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Un(r.layout)),r.paint)){for(var n in this._transitionablePaint=new Bn(r.paint),e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned()}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,r){if((void 0===r&&(r={}),null!=e)&&this._validate(cn,"layers."+this.id+".layout."+t,t,e,r))return;"visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e},e.prototype.getPaintProperty=function(t){return _(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,r){if((void 0===r&&(r={}),null!=e)&&this._validate(ln,"layers."+this.id+".paint."+t,t,e,r))return!1;if(_(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var n=this._transitionablePaint._values[t],i="cross-faded-data-driven"===n.property.specification["property-type"],o=n.value.isDataDriven(),a=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||o||i||this._handleOverridablePaintPropertyUpdate(t,a,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,r){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),v(t,function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)})},e.prototype._validate=function(t,e,r,n,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&hn(this,t.call(sn,{key:e,layerType:this.type,objectKey:r,value:n,styleSpec:At,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof Vn&&fr(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(Et),Kn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Jn=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Qn=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function $n(t,e){void 0===e&&(e=1);var r=0,n=0;return{members:t.map(function(t){var i=Kn[t.type].BYTES_PER_ELEMENT,o=r=ti(r,Math.max(e,i)),a=t.components||1;return n=Math.max(n,i),r+=i*a,{name:t.name,type:t.type,components:a,offset:o}}),size:ti(r,Math.max(n,e)),alignment:e}}function ti(t,e){return Math.ceil(t/e)*e}Qn.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Qn.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Qn.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Qn.prototype.clear=function(){this.length=0},Qn.prototype.resize=function(t){this.reserve(t),this.length=t},Qn.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Qn.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.int16[n+0]=e,this.int16[n+1]=r,t},e}(Qn);ei.prototype.bytesPerElement=4,_n("StructArrayLayout2i4",ei);var ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=r,this.int16[o+2]=n,this.int16[o+3]=i,t},e}(Qn);ri.prototype.bytesPerElement=8,_n("StructArrayLayout4i8",ri);var ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},e.prototype.emplace=function(t,e,r,n,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Qn);ni.prototype.bytesPerElement=12,_n("StructArrayLayout2i4i12",ni);var ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},e.prototype.emplace=function(t,e,r,n,i,o,a){var s=4*t,u=8*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.uint8[u+4]=n,this.uint8[u+5]=i,this.uint8[u+6]=o,this.uint8[u+7]=a,t},e}(Qn);ii.prototype.bytesPerElement=8,_n("StructArrayLayout2i4ub8",ii);var oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,r,n,i,o,a,s)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,u){var l=8*t;return this.uint16[l+0]=e,this.uint16[l+1]=r,this.uint16[l+2]=n,this.uint16[l+3]=i,this.uint16[l+4]=o,this.uint16[l+5]=a,this.uint16[l+6]=s,this.uint16[l+7]=u,t},e}(Qn);oi.prototype.bytesPerElement=16,_n("StructArrayLayout8ui16",oi);var ai=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s){var u=this.length;return this.resize(u+1),this.emplace(u,t,e,r,n,i,o,a,s)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,u){var l=8*t;return this.int16[l+0]=e,this.int16[l+1]=r,this.int16[l+2]=n,this.int16[l+3]=i,this.uint16[l+4]=o,this.uint16[l+5]=a,this.uint16[l+6]=s,this.uint16[l+7]=u,t},e}(Qn);ai.prototype.bytesPerElement=16,_n("StructArrayLayout4i4ui16",ai);var si=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=r,this.float32[i+2]=n,t},e}(Qn);si.prototype.bytesPerElement=12,_n("StructArrayLayout3f12",si);var ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Qn);ui.prototype.bytesPerElement=4,_n("StructArrayLayout1ul4",ui);var li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,u,l,c){var h=this.length;return this.resize(h+1),this.emplace(h,t,e,r,n,i,o,a,s,u,l,c)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,u,l,c,h){var p=12*t,f=6*t;return this.int16[p+0]=e,this.int16[p+1]=r,this.int16[p+2]=n,this.int16[p+3]=i,this.int16[p+4]=o,this.int16[p+5]=a,this.uint32[f+3]=s,this.uint16[p+8]=u,this.uint16[p+9]=l,this.int16[p+10]=c,this.int16[p+11]=h,t},e}(Qn);li.prototype.bytesPerElement=24,_n("StructArrayLayout6i1ul2ui2i24",li);var ci=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,r,n,i,o)},e.prototype.emplace=function(t,e,r,n,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Qn);ci.prototype.bytesPerElement=12,_n("StructArrayLayout2i2i2i12",ci);var hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=r,this.float32[a+1]=n,this.float32[a+2]=i,t},e}(Qn);hi.prototype.bytesPerElement=12,_n("StructArrayLayout2ub2f12",hi);var pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,u,l,c,h,p,f,d,m,y){var _=this.length;return this.resize(_+1),this.emplace(_,t,e,r,n,i,o,a,s,u,l,c,h,p,f,d,m,y)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,u,l,c,h,p,f,d,m,y,_){var g=24*t,v=12*t,x=48*t;return this.int16[g+0]=e,this.int16[g+1]=r,this.uint16[g+2]=n,this.uint16[g+3]=i,this.uint32[v+2]=o,this.uint32[v+3]=a,this.uint32[v+4]=s,this.uint16[g+10]=u,this.uint16[g+11]=l,this.uint16[g+12]=c,this.float32[v+7]=h,this.float32[v+8]=p,this.uint8[x+36]=f,this.uint8[x+37]=d,this.uint8[x+38]=m,this.uint32[v+10]=y,this.int16[g+22]=_,t},e}(Qn);pi.prototype.bytesPerElement=48,_n("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",pi);var fi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n,i,o,a,s,u,l,c,h,p,f,d,m,y,_,g,v,x,b){var w=this.length;return this.resize(w+1),this.emplace(w,t,e,r,n,i,o,a,s,u,l,c,h,p,f,d,m,y,_,g,v,x,b)},e.prototype.emplace=function(t,e,r,n,i,o,a,s,u,l,c,h,p,f,d,m,y,_,g,v,x,b,w){var E=26*t,A=13*t;return this.int16[E+0]=e,this.int16[E+1]=r,this.int16[E+2]=n,this.int16[E+3]=i,this.int16[E+4]=o,this.int16[E+5]=a,this.int16[E+6]=s,this.uint16[E+7]=u,this.uint16[E+8]=l,this.uint16[E+9]=c,this.uint16[E+10]=h,this.uint16[E+11]=p,this.uint16[E+12]=f,this.uint16[E+13]=d,this.uint16[E+14]=m,this.uint16[E+15]=y,this.uint16[E+16]=_,this.uint16[E+17]=g,this.uint32[A+9]=v,this.float32[A+10]=x,this.float32[A+11]=b,this.float32[A+12]=w,t},e}(Qn);fi.prototype.bytesPerElement=52,_n("StructArrayLayout7i11ui1ul3f52",fi);var di=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Qn);di.prototype.bytesPerElement=4,_n("StructArrayLayout1f4",di);var mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=r,this.int16[i+2]=n,t},e}(Qn);mi.prototype.bytesPerElement=6,_n("StructArrayLayout3i6",mi);var yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=r,this.uint16[i+3]=n,t},e}(Qn);yi.prototype.bytesPerElement=8,_n("StructArrayLayout1ul2ui8",yi);var _i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r){var n=this.length;return this.resize(n+1),this.emplace(n,t,e,r)},e.prototype.emplace=function(t,e,r,n){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=r,this.uint16[i+2]=n,t},e}(Qn);_i.prototype.bytesPerElement=6,_n("StructArrayLayout3ui6",_i);var gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.uint16[n+0]=e,this.uint16[n+1]=r,t},e}(Qn);gi.prototype.bytesPerElement=4,_n("StructArrayLayout2ui4",gi);var vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Qn);vi.prototype.bytesPerElement=2,_n("StructArrayLayout1ui2",vi);var xi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var r=this.length;return this.resize(r+1),this.emplace(r,t,e)},e.prototype.emplace=function(t,e,r){var n=2*t;return this.float32[n+0]=e,this.float32[n+1]=r,t},e}(Qn);xi.prototype.bytesPerElement=8,_n("StructArrayLayout2f8",xi);var bi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,r,n)},e.prototype.emplace=function(t,e,r,n,i){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,t},e}(Qn);bi.prototype.bytesPerElement=16,_n("StructArrayLayout4f16",bi);var wi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},radius:{configurable:!0},signedDistanceFromAnchor:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorPointY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.x1.set=function(t){this._structArray.int16[this._pos2+2]=t},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.y1.set=function(t){this._structArray.int16[this._pos2+3]=t},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.x2.set=function(t){this._structArray.int16[this._pos2+4]=t},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.y2.set=function(t){this._structArray.int16[this._pos2+5]=t},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.featureIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},r.radius.get=function(){return this._structArray.int16[this._pos2+10]},r.radius.set=function(t){this._structArray.int16[this._pos2+10]=t},r.signedDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+11]},r.signedDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+11]=t},r.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,r),e}(Jn);wi.prototype.size=24;var Ei=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new wi(this,t)},e}(li);_n("CollisionBoxArray",Ei);var Ai=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.glyphStartIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.numGlyphs.set=function(t){this._structArray.uint16[this._pos2+3]=t},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.vertexStartIndex.set=function(t){this._structArray.uint32[this._pos4+2]=t},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineStartIndex.set=function(t){this._structArray.uint32[this._pos4+3]=t},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.lineLength.set=function(t){this._structArray.uint32[this._pos4+4]=t},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.segment.set=function(t){this._structArray.uint16[this._pos2+10]=t},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.lowerSize.set=function(t){this._structArray.uint16[this._pos2+11]=t},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.upperSize.set=function(t){this._structArray.uint16[this._pos2+12]=t},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetX.set=function(t){this._structArray.float32[this._pos4+7]=t},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.lineOffsetY.set=function(t){this._structArray.float32[this._pos4+8]=t},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.writingMode.set=function(t){this._structArray.uint8[this._pos1+36]=t},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},r.associatedIconIndex.set=function(t){this._structArray.int16[this._pos2+22]=t},Object.defineProperties(e.prototype,r),e}(Jn);Ai.prototype.size=48;var Ti=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Ai(this,t)},e}(pi);_n("PlacedSymbolArray",Ti);var Mi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorX.set=function(t){this._structArray.int16[this._pos2+0]=t},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.anchorY.set=function(t){this._structArray.int16[this._pos2+1]=t},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.rightJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+2]=t},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.centerJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+3]=t},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.leftJustifiedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+4]=t},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.verticalPlacedTextSymbolIndex.set=function(t){this._structArray.int16[this._pos2+5]=t},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.placedIconSymbolIndex.set=function(t){this._structArray.int16[this._pos2+6]=t},r.key.get=function(){return this._structArray.uint16[this._pos2+7]},r.key.set=function(t){this._structArray.uint16[this._pos2+7]=t},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+8]=t},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+9]=t},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+10]=t},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+11]=t},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.set=function(t){this._structArray.uint16[this._pos2+12]=t},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.set=function(t){this._structArray.uint16[this._pos2+13]=t},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.featureIndex.set=function(t){this._structArray.uint16[this._pos2+14]=t},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+15]},r.numHorizontalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+15]=t},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+16]},r.numVerticalGlyphVertices.set=function(t){this._structArray.uint16[this._pos2+16]=t},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+17]},r.numIconVertices.set=function(t){this._structArray.uint16[this._pos2+17]=t},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+9]},r.crossTileID.set=function(t){this._structArray.uint32[this._pos4+9]=t},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+10]},r.textBoxScale.set=function(t){this._structArray.float32[this._pos4+10]=t},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+11]},r.textOffset0.set=function(t){this._structArray.float32[this._pos4+11]=t},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+12]},r.textOffset1.set=function(t){this._structArray.float32[this._pos4+12]=t},Object.defineProperties(e.prototype,r),e}(Jn);Mi.prototype.size=52;var Si=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Mi(this,t)},e}(fi);_n("SymbolInstanceArray",Si);var Ri=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={offsetX:{configurable:!0}};return r.offsetX.get=function(){return this._structArray.float32[this._pos4+0]},r.offsetX.set=function(t){this._structArray.float32[this._pos4+0]=t},Object.defineProperties(e.prototype,r),e}(Jn);Ri.prototype.size=4;var Ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e.prototype.get=function(t){return new Ri(this,t)},e}(di);_n("GlyphOffsetArray",Ii);var Ci=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={x:{configurable:!0},y:{configurable:!0},tileUnitDistanceFromAnchor:{configurable:!0}};return r.x.get=function(){return this._structArray.int16[this._pos2+0]},r.x.set=function(t){this._structArray.int16[this._pos2+0]=t},r.y.get=function(){return this._structArray.int16[this._pos2+1]},r.y.set=function(t){this._structArray.int16[this._pos2+1]=t},r.tileUnitDistanceFromAnchor.get=function(){return this._structArray.int16[this._pos2+2]},r.tileUnitDistanceFromAnchor.set=function(t){this._structArray.int16[this._pos2+2]=t},Object.defineProperties(e.prototype,r),e}(Jn);Ci.prototype.size=6;var Pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e.prototype.get=function(t){return new Ci(this,t)},e}(mi);_n("SymbolLineVertexArray",Pi);var Di=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.featureIndex.set=function(t){this._structArray.uint32[this._pos4+0]=t},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.sourceLayerIndex.set=function(t){this._structArray.uint16[this._pos2+2]=t},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},r.bucketIndex.set=function(t){this._structArray.uint16[this._pos2+3]=t},Object.defineProperties(e.prototype,r),e}(Jn);Di.prototype.size=8;var Li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Di(this,t)},e}(yi);_n("FeatureIndexArray",Li);var Oi=$n([{name:"a_pos",components:2,type:"Int16"}],4).members,ki=function(t){void 0===t&&(t=[]),this.segments=t};function Fi(t,e){return 256*(t=l(Math.floor(t),0,255))+l(Math.floor(e),0,255)}ki.prototype.prepareSegment=function(t,e,r,n){var i=this.segments[this.segments.length-1];return t>ki.MAX_VERTEX_ARRAY_LENGTH&&w("Max vertices per segment is "+ki.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>ki.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:e.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i},ki.prototype.get=function(){return this.segments},ki.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var r=e[t];for(var n in r.vaos)r.vaos[n].destroy()}},ki.simpleSegment=function(t,e,r,n){return new ki([{vertexOffset:t,primitiveOffset:e,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])},ki.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,_n("SegmentVector",ki);var Bi=function(){this.ids=[],this.positions=[],this.indexed=!1};function Ni(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}Bi.prototype.add=function(t,e,r,n){this.ids.push(t),this.positions.push(e,r,n)},Bi.prototype.getPositions=function(t){for(var e=0,r=this.ids.length-1;e<r;){var n=e+r>>1;this.ids[n]>=t?r=n:e=n+1}for(var i=[];this.ids[e]===t;){i.push({index:this.positions[3*e],start:this.positions[3*e+1],end:this.positions[3*e+2]}),e++}return i},Bi.serialize=function(t,e){var r=new Float64Array(t.ids),n=new Uint32Array(t.positions);return function t(e,r,n,i){if(!(n>=i)){for(var o=e[n+i>>1],a=n-1,s=i+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;Ni(e,a,s),Ni(r,3*a,3*s),Ni(r,3*a+1,3*s+1),Ni(r,3*a+2,3*s+2)}t(e,r,n,s),t(e,r,s+1,i)}}(r,n,0,r.length-1),e.push(r.buffer,n.buffer),{ids:r,positions:n}},Bi.deserialize=function(t){var e=new Bi;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e},_n("FeaturePositionMap",Bi);var zi=function(t,e){this.gl=t.gl,this.location=e},Ui=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(zi),Vi=function(t){function e(e,r){t.call(this,e,r),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(zi),ji=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(zi),Gi=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(zi),qi=function(t){function e(e,r){t.call(this,e,r),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(zi),Hi=function(t){function e(e,r){t.call(this,e,r),this.current=Zt.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(zi),Xi=new Float32Array(16),Yi=function(t){function e(e,r){t.call(this,e,r),this.current=Xi}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(zi);function Zi(t){return[Fi(255*t.r,255*t.g),Fi(255*t.b,255*t.a)]}var Wi=function(t,e,r){this.value=t,this.names=e,this.uniformNames=this.names.map(function(t){return"u_"+t}),this.type=r,this.maxValue=-1/0};Wi.prototype.defines=function(){return this.names.map(function(t){return"#define HAS_UNIFORM_u_"+t})},Wi.prototype.setConstantPatternPositions=function(){},Wi.prototype.populatePaintArray=function(){},Wi.prototype.updatePaintArray=function(){},Wi.prototype.upload=function(){},Wi.prototype.destroy=function(){},Wi.prototype.setUniforms=function(t,e,r,n){e.set(n.constantOr(this.value))},Wi.prototype.getBinding=function(t,e){return"color"===this.type?new Hi(t,e):new Vi(t,e)},Wi.serialize=function(t){var e=t.names,r=t.type;return{value:vn(t.value),names:e,type:r}},Wi.deserialize=function(t){var e=t.names,r=t.type;return new Wi(xn(t.value),e,r)};var Ki=function(t,e,r){this.value=t,this.names=e,this.uniformNames=this.names.map(function(t){return"u_"+t}),this.type=r,this.maxValue=-1/0,this.patternPositions={patternTo:null,patternFrom:null}};Ki.prototype.defines=function(){return this.names.map(function(t){return"#define HAS_UNIFORM_u_"+t})},Ki.prototype.populatePaintArray=function(){},Ki.prototype.updatePaintArray=function(){},Ki.prototype.upload=function(){},Ki.prototype.destroy=function(){},Ki.prototype.setConstantPatternPositions=function(t,e){this.patternPositions.patternTo=t.tlbr,this.patternPositions.patternFrom=e.tlbr},Ki.prototype.setUniforms=function(t,e,r,n,i){var o=this.patternPositions;"u_pattern_to"===i&&o.patternTo&&e.set(o.patternTo),"u_pattern_from"===i&&o.patternFrom&&e.set(o.patternFrom)},Ki.prototype.getBinding=function(t,e){return new qi(t,e)};var Ji=function(t,e,r,n){this.expression=t,this.names=e,this.type=r,this.uniformNames=this.names.map(function(t){return"a_"+t}),this.maxValue=-1/0,this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?2:1,offset:0}}),this.paintVertexArray=new n};Ji.prototype.defines=function(){return[]},Ji.prototype.setConstantPatternPositions=function(){},Ji.prototype.populatePaintArray=function(t,e,r,n){var i=this.paintVertexArray,o=i.length;i.reserve(t);var a=this.expression.evaluate(new On(0),e,{},[],n);if("color"===this.type)for(var s=Zi(a),u=o;u<t;u++)i.emplaceBack(s[0],s[1]);else{for(var l=o;l<t;l++)i.emplaceBack(a);this.maxValue=Math.max(this.maxValue,a)}},Ji.prototype.updatePaintArray=function(t,e,r,n){var i=this.paintVertexArray,o=this.expression.evaluate({zoom:0},r,n);if("color"===this.type)for(var a=Zi(o),s=t;s<e;s++)i.emplace(s,a[0],a[1]);else{for(var u=t;u<e;u++)i.emplace(u,o);this.maxValue=Math.max(this.maxValue,o)}},Ji.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ji.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ji.prototype.setUniforms=function(t,e){e.set(0)},Ji.prototype.getBinding=function(t,e){return new Vi(t,e)};var Qi=function(t,e,r,n,i,o){this.expression=t,this.names=e,this.uniformNames=this.names.map(function(t){return"u_"+t+"_t"}),this.type=r,this.useIntegerZoom=n,this.zoom=i,this.maxValue=-1/0;var a=o;this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Float32",components:"color"===r?4:2,offset:0}}),this.paintVertexArray=new a};Qi.prototype.defines=function(){return[]},Qi.prototype.setConstantPatternPositions=function(){},Qi.prototype.populatePaintArray=function(t,e,r,n){var i=this.paintVertexArray,o=i.length;i.reserve(t);var a=this.expression.evaluate(new On(this.zoom),e,{},[],n),s=this.expression.evaluate(new On(this.zoom+1),e,{},[],n);if("color"===this.type)for(var u=Zi(a),l=Zi(s),c=o;c<t;c++)i.emplaceBack(u[0],u[1],l[0],l[1]);else{for(var h=o;h<t;h++)i.emplaceBack(a,s);this.maxValue=Math.max(this.maxValue,a,s)}},Qi.prototype.updatePaintArray=function(t,e,r,n){var i=this.paintVertexArray,o=this.expression.evaluate({zoom:this.zoom},r,n),a=this.expression.evaluate({zoom:this.zoom+1},r,n);if("color"===this.type)for(var s=Zi(o),u=Zi(a),l=t;l<e;l++)i.emplace(l,s[0],s[1],u[0],u[1]);else{for(var c=t;c<e;c++)i.emplace(c,o,a);this.maxValue=Math.max(this.maxValue,o,a)}},Qi.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Qi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Qi.prototype.interpolationFactor=function(t){return this.expression.interpolationFactor(this.useIntegerZoom?Math.floor(t):t,this.zoom,this.zoom+1)},Qi.prototype.setUniforms=function(t,e,r){e.set(this.interpolationFactor(r.zoom))},Qi.prototype.getBinding=function(t,e){return new Vi(t,e)};var $i=function(t,e,r,n,i,o,a){this.expression=t,this.names=e,this.type=r,this.uniformNames=this.names.map(function(t){return"u_"+t+"_t"}),this.useIntegerZoom=n,this.zoom=i,this.maxValue=-1/0,this.layerId=a,this.paintVertexAttributes=e.map(function(t){return{name:"a_"+t,type:"Uint16",components:4,offset:0}}),this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o};$i.prototype.defines=function(){return[]},$i.prototype.setConstantPatternPositions=function(){},$i.prototype.populatePaintArray=function(t,e,r){var n=this.zoomInPaintVertexArray,i=this.zoomOutPaintVertexArray,o=this.layerId,a=n.length;if(n.reserve(t),i.reserve(t),r&&e.patterns&&e.patterns[o]){var s=e.patterns[o],u=r[s.min],l=r[s.mid],c=r[s.max];if(!u||!l||!c)return;for(var h=a;h<t;h++)n.emplaceBack(l.tl[0],l.tl[1],l.br[0],l.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1]),i.emplaceBack(l.tl[0],l.tl[1],l.br[0],l.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1])}},$i.prototype.updatePaintArray=function(t,e,r,n,i){var o=this.zoomInPaintVertexArray,a=this.zoomOutPaintVertexArray,s=this.layerId;if(i&&r.patterns&&r.patterns[s]){var u=r.patterns[s],l=i[u.min],c=i[u.mid],h=i[u.max];if(!l||!c||!h)return;for(var p=t;p<e;p++)o.emplace(p,c.tl[0],c.tl[1],c.br[0],c.br[1],l.tl[0],l.tl[1],l.br[0],l.br[1]),a.emplace(p,c.tl[0],c.tl[1],c.br[0],c.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1])}},$i.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},$i.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()},$i.prototype.setUniforms=function(t,e){e.set(0)},$i.prototype.getBinding=function(t,e){return new Vi(t,e)};var to=function(){this.binders={},this.cacheKey="",this._buffers=[],this._featureMap=new Bi,this._bufferOffset=0};to.createDynamic=function(t,e,r){var n=new to,i=[];for(var o in t.paint._values)if(r(o)){var a=t.paint.get(o);if(a instanceof Vn&&fr(a.property.specification)){var s=ro(o,t.type),u=a.property.specification.type,l=a.property.useIntegerZoom;if("cross-faded"===a.property.specification["property-type"]||"cross-faded-data-driven"===a.property.specification["property-type"])if("constant"===a.value.kind)n.binders[o]=new Ki(a.value.value,s,u),i.push("/u_"+o);else{var c=no(o,u,"source");n.binders[o]=new $i(a.value,s,u,l,e,c,t.id),i.push("/a_"+o)}else if("constant"===a.value.kind)n.binders[o]=new Wi(a.value.value,s,u),i.push("/u_"+o);else if("source"===a.value.kind){var h=no(o,u,"source");n.binders[o]=new Ji(a.value,s,u,h),i.push("/a_"+o)}else{var p=no(o,u,"composite");n.binders[o]=new Qi(a.value,s,u,l,e,p),i.push("/z_"+o)}}}return n.cacheKey=i.sort().join(""),n},to.prototype.populatePaintArrays=function(t,e,r,n,i){for(var o in this.binders)this.binders[o].populatePaintArray(t,e,n,i);void 0!==e.id&&this._featureMap.add(+e.id,r,this._bufferOffset,t),this._bufferOffset=t},to.prototype.setConstantPatternPositions=function(t,e){for(var r in this.binders)this.binders[r].setConstantPatternPositions(t,e)},to.prototype.updatePaintArrays=function(t,e,r,n){var i=!1;for(var o in t)for(var a=0,s=this._featureMap.getPositions(+o);a<s.length;a+=1){var u=s[a],l=e.feature(u.index);for(var c in this.binders){var h=this.binders[c];if(!(h instanceof Wi||h instanceof Ki)&&!0===h.expression.isStateDependent){var p=r.paint.get(c);h.expression=p.value,h.updatePaintArray(u.start,u.end,l,t[o],n),i=!0}}}return i},to.prototype.defines=function(){var t=[];for(var e in this.binders)t.push.apply(t,this.binders[e].defines());return t},to.prototype.getPaintVertexBuffers=function(){return this._buffers},to.prototype.getUniforms=function(t,e){var r=[];for(var n in this.binders)for(var i=this.binders[n],o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var u=i.getBinding(t,e[s]);r.push({name:s,property:n,binding:u})}}return r},to.prototype.setUniforms=function(t,e,r,n){for(var i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.name,u=a.property;this.binders[u].setUniforms(t,a.binding,n,r.get(u),s)}},to.prototype.updatePatternPaintBuffers=function(t){var e=[];for(var r in this.binders){var n=this.binders[r];if(n instanceof $i){var i=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;i&&e.push(i)}else(n instanceof Ji||n instanceof Qi)&&n.paintVertexBuffer&&e.push(n.paintVertexBuffer)}this._buffers=e},to.prototype.upload=function(t){for(var e in this.binders)this.binders[e].upload(t);var r=[];for(var n in this.binders){var i=this.binders[n];(i instanceof Ji||i instanceof Qi)&&i.paintVertexBuffer&&r.push(i.paintVertexBuffer)}this._buffers=r},to.prototype.destroy=function(){for(var t in this.binders)this.binders[t].destroy()};var eo=function(t,e,r,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var i=0,o=e;i<o.length;i+=1){var a=o[i];this.programConfigurations[a.id]=to.createDynamic(a,r,n),this.programConfigurations[a.id].layoutAttributes=t}this.needsUpload=!1};function ro(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from"],"fill-pattern":["pattern_to","pattern_from"],"fill-extrusion-pattern":["pattern_to","pattern_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function no(t,e,r){var n={color:{source:xi,composite:bi},number:{source:di,composite:xi}},i=function(t){return{"line-pattern":{source:oi,composite:oi},"fill-pattern":{source:oi,composite:oi},"fill-extrusion-pattern":{source:oi,composite:oi}}[t]}(t);return i&&i[r]||n[e][r]}eo.prototype.populatePaintArrays=function(t,e,r,n,i){for(var o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(t,e,r,n,i);this.needsUpload=!0},eo.prototype.updatePaintArrays=function(t,e,r,n){for(var i=0,o=r;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,e,a,n)||this.needsUpload}},eo.prototype.get=function(t){return this.programConfigurations[t]},eo.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},eo.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},_n("ConstantBinder",Wi),_n("CrossFadedConstantBinder",Ki),_n("SourceExpressionBinder",Ji),_n("CrossFadedCompositeBinder",$i),_n("CompositeExpressionBinder",Qi),_n("ProgramConfiguration",to,{omit:["_buffers"]}),_n("ProgramConfigurationSet",eo);var io=8192,oo=(15,{min:-1*Math.pow(2,14),max:Math.pow(2,14)-1});function ao(t){for(var e=io/t.extent,r=t.loadGeometry(),n=0;n<r.length;n++)for(var i=r[n],o=0;o<i.length;o++){var a=i[o];a.x=Math.round(a.x*e),a.y=Math.round(a.y*e),(a.x<oo.min||a.x>oo.max||a.y<oo.min||a.y>oo.max)&&(w("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a.x=l(a.x,oo.min,oo.max),a.y=l(a.y,oo.min,oo.max))}return r}function so(t,e,r,n,i){t.emplaceBack(2*e+(n+1)/2,2*r+(i+1)/2)}var uo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ei,this.indexArray=new _i,this.segments=new ki,this.programConfigurations=new eo(Oi,t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function lo(t,e){for(var r=0;r<t.length;r++)if(vo(e,t[r]))return!0;for(var n=0;n<e.length;n++)if(vo(t,e[n]))return!0;return!!fo(t,e)}function co(t,e,r){return!!vo(t,e)||!!yo(e,t,r)}function ho(t,e){if(1===t.length)return go(e,t[0]);for(var r=0;r<e.length;r++)for(var n=e[r],i=0;i<n.length;i++)if(vo(t,n[i]))return!0;for(var o=0;o<t.length;o++)if(go(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(fo(t,e[a]))return!0;return!1}function po(t,e,r){if(t.length>1){if(fo(t,e))return!0;for(var n=0;n<e.length;n++)if(yo(e[n],t,r))return!0}for(var i=0;i<t.length;i++)if(yo(t[i],e,r))return!0;return!1}function fo(t,e){if(0===t.length||0===e.length)return!1;for(var r=0;r<t.length-1;r++)for(var n=t[r],i=t[r+1],o=0;o<e.length-1;o++)if(mo(n,i,e[o],e[o+1]))return!0;return!1}function mo(t,e,r,n){return E(t,r,n)!==E(e,r,n)&&E(t,e,r)!==E(t,e,n)}function yo(t,e,r){var n=r*r;if(1===e.length)return t.distSqr(e[0])<n;for(var i=1;i<e.length;i++)if(_o(t,e[i-1],e[i])<n)return!0;return!1}function _o(t,e,r){var n=e.distSqr(r);if(0===n)return t.distSqr(e);var i=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/n;return t.distSqr(i<0?e:i>1?r:r.sub(e)._mult(i)._add(e))}function go(t,e){for(var r,n,i,o=!1,a=0;a<t.length;a++)for(var s=0,u=(r=t[a]).length-1;s<r.length;u=s++)(n=r[s]).y>e.y!=(i=r[u]).y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(o=!o);return o}function vo(t,e){for(var r=!1,n=0,i=t.length-1;n<t.length;i=n++){var o=t[n],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(r=!r)}return r}function xo(t,e,r){var n=r[0],i=r[2];if(t.x<n.x&&e.x<n.x||t.x>i.x&&e.x>i.x||t.y<n.y&&e.y<n.y||t.y>i.y&&e.y>i.y)return!1;var o=E(t,e,r[0]);return o!==E(t,e,r[1])||o!==E(t,e,r[2])||o!==E(t,e,r[3])}function bo(t,e,r){var n=e.paint.get(t).value;return"constant"===n.kind?n.value:r.programConfigurations.get(e.id).binders[t].maxValue}function wo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Eo(t,e,r,n,o){if(!e[0]&&!e[1])return t;var a=i.convert(e)._mult(o);"viewport"===r&&a._rotate(-n);for(var s=[],u=0;u<t.length;u++){s.push(t[u].sub(a))}return s}uo.prototype.populate=function(t,e){var r=this.layers[0],n=[],i=null;"circle"===r.type&&(i=r.layout.get("circle-sort-key"));for(var o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,l=s.index,c=s.sourceLayerIndex;if(this.layers[0]._featureFilter(new On(this.zoom),u)){var h=ao(u),p=i?i.evaluate(u,{}):void 0;n.push({id:u.id,properties:u.properties,type:u.type,sourceLayerIndex:c,index:l,geometry:h,patterns:{},sortKey:p})}}i&&n.sort(function(t,e){return t.sortKey-e.sortKey});for(var f=0,d=n;f<d.length;f+=1){var m=d[f],y=m.geometry,_=m.index,g=m.sourceLayerIndex,v=t[_].feature;this.addFeature(m,y,_),e.featureIndex.insert(v,y,_,g,this.index)}},uo.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},uo.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},uo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},uo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Oi),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},uo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},uo.prototype.addFeature=function(t,e,r){for(var n=0,i=e;n<i.length;n+=1)for(var o=0,a=i[n];o<a.length;o+=1){var s=a[o],u=s.x,l=s.y;if(!(u<0||u>=io||l<0||l>=io)){var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),h=c.vertexLength;so(this.layoutVertexArray,u,l,-1,-1),so(this.layoutVertexArray,u,l,1,-1),so(this.layoutVertexArray,u,l,1,1),so(this.layoutVertexArray,u,l,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+3,h+2),c.vertexLength+=4,c.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,{})},_n("CircleBucket",uo,{omit:["layers"]});var Ao,To=new Zn({"circle-sort-key":new qn(At.layout_circle["circle-sort-key"])}),Mo={paint:new Zn({"circle-radius":new qn(At.paint_circle["circle-radius"]),"circle-color":new qn(At.paint_circle["circle-color"]),"circle-blur":new qn(At.paint_circle["circle-blur"]),"circle-opacity":new qn(At.paint_circle["circle-opacity"]),"circle-translate":new Gn(At.paint_circle["circle-translate"]),"circle-translate-anchor":new Gn(At.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Gn(At.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Gn(At.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qn(At.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qn(At.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qn(At.paint_circle["circle-stroke-opacity"])}),layout:To},So="undefined"!=typeof Float32Array?Float32Array:Array;function Ro(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,r=arguments.length;r--;)e+=t[r]*t[r];return Math.sqrt(e)}),Ao=new So(3),So!=Float32Array&&(Ao[0]=0,Ao[1]=0,Ao[2]=0),function(){var t=new So(4);So!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Io=function(t){function e(e){t.call(this,e,Mo)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new uo(t)},e.prototype.queryRadius=function(t){var e=t;return bo("circle-radius",this,e)+bo("circle-stroke-width",this,e)+wo(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a,s){for(var u=Eo(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),l=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r),c="map"===this.paint.get("circle-pitch-alignment"),h=c?u:function(t,e){return u.map(function(t){return Co(t,e)})}(0,s),p=c?l*a:l,f=0,d=n;f<d.length;f+=1)for(var m=0,y=d[f];m<y.length;m+=1){var _=y[m],g=c?_:Co(_,s),v=p,x=Ro([],[_.x,_.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?v*=x[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(v*=o.cameraToCenterDistance/x[3]),co(h,g,v))return!0}return!1},e}(Wn);function Co(t,e){var r=Ro([],[t.x,t.y,0,1],e);return new i(r[0]/r[3],r[1]/r[3])}var Po=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(uo);function Do(t,e,r,n){var i=e.width,o=e.height;if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==i*o*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*o*r);return t.width=i,t.height=o,t.data=n,t}function Lo(t,e,r){var n=e.width,i=e.height;if(n!==t.width||i!==t.height){var o=Do({},{width:n,height:i},r);Oo(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,i)},r),t.width=n,t.height=i,t.data=o.data}}function Oo(t,e,r,n,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<i.height;u++)for(var l=((r.y+u)*t.width+r.x)*o,c=((n.y+u)*e.width+n.x)*o,h=0;h<i.width*o;h++)s[c+h]=a[l+h];return e}_n("HeatmapBucket",Po,{omit:["layers"]});var ko=function(t,e){Do(this,t,1,e)};ko.prototype.resize=function(t){Lo(this,t,1)},ko.prototype.clone=function(){return new ko({width:this.width,height:this.height},new Uint8Array(this.data))},ko.copy=function(t,e,r,n,i){Oo(t,e,r,n,i,1)};var Fo=function(t,e){Do(this,t,4,e)};Fo.prototype.resize=function(t){Lo(this,t,4)},Fo.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Fo.prototype.clone=function(){return new Fo({width:this.width,height:this.height},new Uint8Array(this.data))},Fo.copy=function(t,e,r,n,i){Oo(t,e,r,n,i,4)},_n("AlphaImage",ko),_n("RGBAImage",Fo);var Bo={paint:new Zn({"heatmap-radius":new qn(At.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qn(At.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Gn(At.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Yn(At.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Gn(At.paint_heatmap["heatmap-opacity"])})};function No(t,e){for(var r=new Uint8Array(1024),n={},i=0,o=0;i<256;i++,o+=4){n[e]=i/255;var a=t.evaluate(n);r[o+0]=Math.floor(255*a.r/a.a),r[o+1]=Math.floor(255*a.g/a.a),r[o+2]=Math.floor(255*a.b/a.a),r[o+3]=Math.floor(255*a.a)}return new Fo({width:256,height:1},r)}var zo=function(t){function e(e){t.call(this,e,Bo),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Po(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=No(this._transitionablePaint._values["heatmap-color"].value.expression,"heatmapDensity"),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Wn),Uo={paint:new Zn({"hillshade-illumination-direction":new Gn(At.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Gn(At.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Gn(At.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Gn(At.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Gn(At.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Gn(At.paint_hillshade["hillshade-accent-color"])})},Vo=function(t){function e(e){t.call(this,e,Uo)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Wn),jo=$n([{name:"a_pos",components:2,type:"Int16"}],4).members,Go=Ho,qo=Ho;function Ho(t,e,r){r=r||2;var n,i,o,a,s,u,l,c=e&&e.length,h=c?e[0]*r:t.length,p=Xo(t,0,h,r,!0),f=[];if(!p||p.next===p.prev)return f;if(c&&(p=function(t,e,r,n){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Xo(t,e[i]*n,i<o-1?e[i+1]*n:t.length,n,!1))===a.next&&(a.steiner=!0),s.push(na(a));for(s.sort($o),i=0;i<s.length;i++)ta(s[i],r),r=Yo(r,r.next);return r}(t,e,p,r)),t.length>80*r){n=o=t[0],i=a=t[1];for(var d=r;d<h;d+=r)(s=t[d])<n&&(n=s),(u=t[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);l=0!==(l=Math.max(o-n,a-i))?1/l:0}return Zo(p,f,r,n,i,l),f}function Xo(t,e,r,n,i){var o,a;if(i===ya(t,e,r,n)>0)for(o=e;o<r;o+=n)a=fa(o,t[o],t[o+1],a);else for(o=r-n;o>=e;o-=n)a=fa(o,t[o],t[o+1],a);return a&&sa(a,a.next)&&(da(a),a=a.next),a}function Yo(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!sa(n,n.next)&&0!==aa(n.prev,n,n.next))n=n.next;else{if(da(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function Zo(t,e,r,n,i,o,a){if(t){!a&&o&&function(t,e,r,n){var i=t;do{null===i.z&&(i.z=ra(i.x,i.y,e,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,r,n,i,o,a,s,u,l=1;do{for(r=t,t=null,o=null,a=0;r;){for(a++,n=r,s=0,e=0;e<l&&(s++,n=n.nextZ);e++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(a>1)}(i)}(t,n,i,o);for(var s,u,l=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Ko(t,n,i,o):Wo(t))e.push(s.i/r),e.push(t.i/r),e.push(u.i/r),da(t),t=u.next,l=u.next;else if((t=u)===l){a?1===a?Zo(t=Jo(Yo(t),e,r),e,r,n,i,o,2):2===a&&Qo(t,e,r,n,i,o):Zo(Yo(t),e,r,n,i,o,1);break}}}function Wo(t){var e=t.prev,r=t,n=t.next;if(aa(e,r,n)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(ia(e.x,e.y,r.x,r.y,n.x,n.y,i.x,i.y)&&aa(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Ko(t,e,r,n){var i=t.prev,o=t,a=t.next;if(aa(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,l=ra(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,r,n),c=ra(s,u,e,r,n),h=t.prevZ,p=t.nextZ;h&&h.z>=l&&p&&p.z<=c;){if(h!==t.prev&&h!==t.next&&ia(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&aa(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,p!==t.prev&&p!==t.next&&ia(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&aa(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;h&&h.z>=l;){if(h!==t.prev&&h!==t.next&&ia(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&aa(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;p&&p.z<=c;){if(p!==t.prev&&p!==t.next&&ia(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&aa(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Jo(t,e,r){var n=t;do{var i=n.prev,o=n.next.next;!sa(i,o)&&ua(i,n,n.next,o)&&ha(i,o)&&ha(o,i)&&(e.push(i.i/r),e.push(n.i/r),e.push(o.i/r),da(n),da(n.next),n=t=o),n=n.next}while(n!==t);return Yo(n)}function Qo(t,e,r,n,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&oa(a,s)){var u=pa(a,s);return a=Yo(a,a.next),u=Yo(u,u.next),Zo(a,e,r,n,i,o),void Zo(u,e,r,n,i,o)}s=s.next}a=a.next}while(a!==t)}function $o(t,e){return t.x-e.x}function ta(t,e){if(e=function(t,e){var r,n=e,i=t.x,o=t.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var s=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!r)return null;if(i===a)return r;var u,l=r,c=r.x,h=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&ia(o<h?i:a,o,c,h,o<h?a:i,o,n.x,n.y)&&(u=Math.abs(o-n.y)/(i-n.x),ha(n,t)&&(u<p||u===p&&(n.x>r.x||n.x===r.x&&ea(r,n)))&&(r=n,p=u)),n=n.next}while(n!==l);return r}(t,e)){var r=pa(e,t);Yo(r,r.next)}}function ea(t,e){return aa(t.prev,t,e.prev)<0&&aa(e.next,t,t.next)<0}function ra(t,e,r,n,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function na(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function ia(t,e,r,n,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(n-s)-(r-a)*(e-s)>=0&&(r-a)*(o-s)-(i-a)*(n-s)>=0}function oa(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&ua(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(ha(t,e)&&ha(e,t)&&function(t,e){var r=t,n=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(aa(t.prev,t,e.prev)||aa(t,e.prev,e))||sa(t,e)&&aa(t.prev,t,t.next)>0&&aa(e.prev,e,e.next)>0)}function aa(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function sa(t,e){return t.x===e.x&&t.y===e.y}function ua(t,e,r,n){var i=ca(aa(t,e,r)),o=ca(aa(t,e,n)),a=ca(aa(r,n,t)),s=ca(aa(r,n,e));return i!==o&&a!==s||!(0!==i||!la(t,r,e))||!(0!==o||!la(t,n,e))||!(0!==a||!la(r,t,n))||!(0!==s||!la(r,e,n))}function la(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function ca(t){return t>0?1:t<0?-1:0}function ha(t,e){return aa(t.prev,t,t.next)<0?aa(t,e,t.next)>=0&&aa(t,t.prev,e)>=0:aa(t,e,t.prev)<0||aa(t,t.next,e)<0}function pa(t,e){var r=new ma(t.i,t.x,t.y),n=new ma(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function fa(t,e,r,n){var i=new ma(t,e,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function da(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function ma(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ya(t,e,r,n){for(var i=0,o=e,a=r-n;o<r;o+=n)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function _a(t,e,r,n,i){!function t(e,r,n,i,o){for(;i>n;){if(i-n>600){var a=i-n+1,s=r-n+1,u=Math.log(a),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(a-l)/a)*(s-a/2<0?-1:1);t(e,r,Math.max(n,Math.floor(r-s*l/a+c)),Math.min(i,Math.floor(r+(a-s)*l/a+c)),o)}var h=e[r],p=n,f=i;for(ga(e,n,r),o(e[i],h)>0&&ga(e,n,i);p<f;){for(ga(e,p,f),p++,f--;o(e[p],h)<0;)p++;for(;o(e[f],h)>0;)f--}0===o(e[n],h)?ga(e,n,f):ga(e,++f,i),f<=r&&(n=f+1),r<=f&&(i=f-1)}}(t,e,r||0,n||t.length-1,i||va)}function ga(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function va(t,e){return t<e?-1:t>e?1:0}function xa(t,e){var r=t.length;if(r<=1)return[t];for(var n,i,o=[],a=0;a<r;a++){var s=A(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(n&&o.push(n),n=[t[a]]):n.push(t[a]))}if(n&&o.push(n),e>1)for(var u=0;u<o.length;u++)o[u].length<=e||(_a(o[u],e,1,o[u].length-1,ba),o[u]=o[u].slice(0,e));return o}function ba(t,e){return e.area-t.area}function wa(t,e,r){for(var n=r.patternDependencies,i=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,n[u.to]=!0,n[u.from]=!0)}return i}function Ea(t,e,r,n,i){for(var o=i.patternDependencies,a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.paint.get(t+"-pattern").value;if("constant"!==l.kind){var c=l.evaluate({zoom:n-1},r,{},i.availableImages),h=l.evaluate({zoom:n},r,{},i.availableImages),p=l.evaluate({zoom:n+1},r,{},i.availableImages);h=h&&h.name?h.name:h,p=p&&p.name?p.name:p,o[c=c&&c.name?c.name:c]=!0,o[h]=!0,o[p]=!0,r.patterns[u.id]={min:c,mid:h,max:p}}}return r}Ho.deviation=function(t,e,r,n){var i=e&&e.length,o=Math.abs(ya(t,0,i?e[0]*r:t.length,r));if(i)for(var a=0,s=e.length;a<s;a++){o-=Math.abs(ya(t,e[a]*r,a<s-1?e[a+1]*r:t.length,r))}var u=0;for(a=0;a<n.length;a+=3){var l=n[a]*r,c=n[a+1]*r,h=n[a+2]*r;u+=Math.abs((t[l]-t[h])*(t[c+1]-t[l+1])-(t[l]-t[c])*(t[h+1]-t[l+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},Ho.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)r.vertices.push(t[i][o][a]);i>0&&r.holes.push(n+=t[i-1].length)}return r},Go.default=qo;var Aa=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ei,this.indexArray=new _i,this.indexArray2=new gi,this.programConfigurations=new eo(jo,t.layers,t.zoom),this.segments=new ki,this.segments2=new ki,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Aa.prototype.populate=function(t,e){this.hasPattern=wa("fill",this.layers,e);for(var r=this.layers[0].layout.get("fill-sort-key"),n=[],i=0,o=t;i<o.length;i+=1){var a=o[i],s=a.feature,u=a.index,l=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new On(this.zoom),s)){var c=ao(s),h=r?r.evaluate(s,{},e.availableImages):void 0;n.push({id:s.id,properties:s.properties,type:s.type,sourceLayerIndex:l,index:u,geometry:c,patterns:{},sortKey:h})}}r&&n.sort(function(t,e){return t.sortKey-e.sortKey});for(var p=0,f=n;p<f.length;p+=1){var d=f[p],m=d.geometry,y=d.index,_=d.sourceLayerIndex;if(this.hasPattern){var g=Ea("fill",this.layers,d,this.zoom,e);this.patternFeatures.push(g)}else this.addFeature(d,m,y,{});e.featureIndex.insert(t[y].feature,m,y,_,this.index)}},Aa.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Aa.prototype.addFeatures=function(t,e){for(var r=0,n=this.patternFeatures;r<n.length;r+=1){var i=n[r];this.addFeature(i,i.geometry,i.index,e)}},Aa.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Aa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Aa.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,jo),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Aa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Aa.prototype.addFeature=function(t,e,r,n){for(var i=0,o=xa(e,500);i<o.length;i+=1){for(var a=o[i],s=0,u=0,l=a;u<l.length;u+=1)s+=l[u].length;for(var c=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray),h=c.vertexLength,p=[],f=[],d=0,m=a;d<m.length;d+=1){var y=m[d];if(0!==y.length){y!==a[0]&&f.push(p.length/2);var _=this.segments2.prepareSegment(y.length,this.layoutVertexArray,this.indexArray2),g=_.vertexLength;this.layoutVertexArray.emplaceBack(y[0].x,y[0].y),this.indexArray2.emplaceBack(g+y.length-1,g),p.push(y[0].x),p.push(y[0].y);for(var v=1;v<y.length;v++)this.layoutVertexArray.emplaceBack(y[v].x,y[v].y),this.indexArray2.emplaceBack(g+v-1,g+v),p.push(y[v].x),p.push(y[v].y);_.vertexLength+=y.length,_.primitiveLength+=y.length}}for(var x=Go(p,f),b=0;b<x.length;b+=3)this.indexArray.emplaceBack(h+x[b],h+x[b+1],h+x[b+2]);c.vertexLength+=s,c.primitiveLength+=x.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n)},_n("FillBucket",Aa,{omit:["layers","patternFeatures"]});var Ta=new Zn({"fill-sort-key":new qn(At.layout_fill["fill-sort-key"])}),Ma={paint:new Zn({"fill-antialias":new Gn(At.paint_fill["fill-antialias"]),"fill-opacity":new qn(At.paint_fill["fill-opacity"]),"fill-color":new qn(At.paint_fill["fill-color"]),"fill-outline-color":new qn(At.paint_fill["fill-outline-color"]),"fill-translate":new Gn(At.paint_fill["fill-translate"]),"fill-translate-anchor":new Gn(At.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hn(At.paint_fill["fill-pattern"])}),layout:Ta},Sa=function(t){function e(e){t.call(this,e,Ma)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,r){t.prototype.recalculate.call(this,e,r);var n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new Aa(t)},e.prototype.queryRadius=function(){return wo(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,i,o,a){return ho(Eo(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),n)},e.prototype.isTileClipped=function(){return!0},e}(Wn),Ra=$n([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Ia=Ca;function Ca(t,e,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=i,t.readFields(Pa,this,e)}function Pa(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var n=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[n]=i}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function Da(t){for(var e,r,n=0,i=0,o=t.length,a=o-1;i<o;a=i++)n+=((r=t[a]).x-(e=t[i]).x)*(e.y+r.y);return n}Ca.types=["Unknown","Point","LineString","Polygon"],Ca.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,o=0,a=0,s=0,u=[];t.pos<r;){if(o<=0){var l=t.readVarint();n=7&l,o=l>>3}if(o--,1===n||2===n)a+=t.readSVarint(),s+=t.readSVarint(),1===n&&(e&&u.push(e),e=[]),e.push(new i(a,s));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&u.push(e),u},Ca.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,n=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;t.pos<e;){if(n<=0){var c=t.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==r)throw new Error("unknown command "+r)}return[a,u,s,l]},Ca.prototype.toGeoJSON=function(t,e,r){var n,i,o=this.extent*Math.pow(2,r),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),l=Ca.types[this.type];function c(t){for(var e=0;e<t.length;e++){var r=t[e];t[e]=[360*(r.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<u.length;n++)h[n]=u[n][0];c(u=h);break;case 2:for(n=0;n<u.length;n++)c(u[n]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var r,n,i=[],o=0;o<e;o++){var a=Da(t[o]);0!==a&&(void 0===n&&(n=a<0),n===a<0?(r&&i.push(r),r=[t[o]]):r.push(t[o]))}return r&&i.push(r),i}(u),n=0;n<u.length;n++)for(i=0;i<u[n].length;i++)c(u[n][i])}1===u.length?u=u[0]:l="Multi"+l;var p={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(p.id=this.id),p};var La=Oa;function Oa(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ka,this,e),this.length=this._features.length}function ka(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}(r))}function Fa(t,e,r){if(3===t){var n=new La(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}Oa.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Ia(this._pbf,e,this.extent,this._keys,this._values)};var Ba={VectorTile:function(t,e){this.layers=t.readFields(Fa,{},e)},VectorTileFeature:Ia,VectorTileLayer:La},Na=Ba.VectorTileFeature.types,za=Math.pow(2,13);function Ua(t,e,r,n,i,o,a,s){t.emplaceBack(e,r,2*Math.floor(n*za)+a,i*za*2,o*za*2,Math.round(s))}var Va=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ni,this.indexArray=new _i,this.programConfigurations=new eo(Ra,t.layers,t.zoom),this.segments=new ki,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function ja(t,e){return t.x===e.x&&(t.x<0||t.x>io)||t.y===e.y&&(t.y<0||t.y>io)}function Ga(t){return t.every(function(t){return t.x<0})||t.every(function(t){return t.x>io})||t.every(function(t){return t.y<0})||t.every(function(t){return t.y>io})}Va.prototype.populate=function(t,e){this.features=[],this.hasPattern=wa("fill-extrusion",this.layers,e);for(var r=0,n=t;r<n.length;r+=1){var i=n[r],o=i.feature,a=i.index,s=i.sourceLayerIndex;if(this.layers[0]._featureFilter(new On(this.zoom),o)){var u=ao(o),l={sourceLayerIndex:s,index:a,geometry:u,properties:o.properties,type:o.type,patterns:{}};void 0!==o.id&&(l.id=o.id),this.hasPattern?this.features.push(Ea("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,u,a,{}),e.featureIndex.insert(o,u,a,s,this.index,!0)}}},Va.prototype.addFeatures=function(t,e){for(var r=0,n=this.features;r<n.length;r+=1){var i=n[r];this.addFeature(i,i.geometry,i.index,e)}},Va.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Va.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Va.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Va.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ra),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Va.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Va.prototype.addFeature=function(t,e,r,n){for(var i=0,o=xa(e,500);i<o.length;i+=1){for(var a=o[i],s=0,u=0,l=a;u<l.length;u+=1)s+=l[u].length;for(var c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),h=0,p=a;h<p.length;h+=1){var f=p[h];if(0!==f.length&&!Ga(f))for(var d=0,m=0;m<f.length;m++){var y=f[m];if(m>=1){var _=f[m-1];if(!ja(y,_)){c.vertexLength+4>ki.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var g=y.sub(_)._perp()._unit(),v=_.dist(y);d+v>32768&&(d=0),Ua(this.layoutVertexArray,y.x,y.y,g.x,g.y,0,0,d),Ua(this.layoutVertexArray,y.x,y.y,g.x,g.y,0,1,d),Ua(this.layoutVertexArray,_.x,_.y,g.x,g.y,0,0,d+=v),Ua(this.layoutVertexArray,_.x,_.y,g.x,g.y,0,1,d);var x=c.vertexLength;this.indexArray.emplaceBack(x,x+2,x+1),this.indexArray.emplaceBack(x+1,x+2,x+3),c.vertexLength+=4,c.primitiveLength+=2}}}}if(c.vertexLength+s>ki.MAX_VERTEX_ARRAY_LENGTH&&(c=this.segments.prepareSegment(s,this.layoutVertexArray,this.indexArray)),"Polygon"===Na[t.type]){for(var b=[],w=[],E=c.vertexLength,A=0,T=a;A<T.length;A+=1){var M=T[A];if(0!==M.length){M!==a[0]&&w.push(b.length/2);for(var S=0;S<M.length;S++){var R=M[S];Ua(this.layoutVertexArray,R.x,R.y,0,0,1,1,0),b.push(R.x),b.push(R.y)}}}for(var I=Go(b,w),C=0;C<I.length;C+=3)this.indexArray.emplaceBack(E+I[C],E+I[C+2],E+I[C+1]);c.primitiveLength+=I.length/3,c.vertexLength+=s}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,r,n)},_n("FillExtrusionBucket",Va,{omit:["layers","features"]});var qa={paint:new Zn({"fill-extrusion-opacity":new Gn(At["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qn(At["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Gn(At["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Gn(At["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hn(At["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qn(At["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qn(At["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Gn(At["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Ha=function(t){function e(e){t.call(this,e,qa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Va(t)},e.prototype.queryRadius=function(){return wo(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,r,n,o,a,s,u){var l=Eo(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),c=this.paint.get("fill-extrusion-height").evaluate(e,r),h=this.paint.get("fill-extrusion-base").evaluate(e,r),p=function(t,e,r,n){for(var o=[],a=0,s=t;a<s.length;a+=1){var u=s[a],l=[u.x,u.y,0,1];Ro(l,l,e),o.push(new i(l[0]/l[3],l[1]/l[3]))}return o}(l,u),f=function(t,e,r,n){for(var o=[],a=[],s=n[8]*e,u=n[9]*e,l=n[10]*e,c=n[11]*e,h=n[8]*r,p=n[9]*r,f=n[10]*r,d=n[11]*r,m=0,y=t;m<y.length;m+=1){for(var _=[],g=[],v=0,x=y[m];v<x.length;v+=1){var b=x[v],w=b.x,E=b.y,A=n[0]*w+n[4]*E+n[12],T=n[1]*w+n[5]*E+n[13],M=n[2]*w+n[6]*E+n[14],S=n[3]*w+n[7]*E+n[15],R=M+l,I=S+c,C=A+h,P=T+p,D=M+f,L=S+d,O=new i((A+s)/I,(T+u)/I);O.z=R/I,_.push(O);var k=new i(C/L,P/L);k.z=D/L,g.push(k)}o.push(_),a.push(g)}return[o,a]}(n,h,c,u);return function(t,e,r){var n=1/0;ho(r,e)&&(n=Ya(r,e[0]));for(var i=0;i<e.length;i++)for(var o=e[i],a=t[i],s=0;s<o.length-1;s++){var u=o[s],l=[u,o[s+1],a[s+1],a[s],u];lo(r,l)&&(n=Math.min(n,Ya(r,l)))}return n!==1/0&&n}(f[0],f[1],p)},e}(Wn);function Xa(t,e){return t.x*e.x+t.y*e.y}function Ya(t,e){if(1===t.length){var r=e[0],n=e[1],i=e[3],o=t[0],a=n.sub(r),s=i.sub(r),u=o.sub(r),l=Xa(a,a),c=Xa(a,s),h=Xa(s,s),p=Xa(u,a),f=Xa(u,s),d=l*h-c*c,m=(h*p-c*f)/d,y=(l*f-c*p)/d;return r.z*(1-m-y)+n.z*m+i.z*y}for(var _=1/0,g=0,v=e;g<v.length;g+=1){_=Math.min(_,v[g].z)}return _}var Za=$n([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Wa=Ba.VectorTileFeature.types,Ka=Math.cos(Math.PI/180*37.5),Ja=Math.pow(2,14)/.5,Qa=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ii,this.indexArray=new _i,this.programConfigurations=new eo(Za,t.layers,t.zoom),this.segments=new ki,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Qa.prototype.populate=function(t,e){this.hasPattern=wa("line",this.layers,e);for(var r=this.layers[0].layout.get("line-sort-key"),n=[],i=0,o=t;i<o.length;i+=1){var a=o[i],s=a.feature,u=a.index,l=a.sourceLayerIndex;if(this.layers[0]._featureFilter(new On(this.zoom),s)){var c=ao(s),h=r?r.evaluate(s,{}):void 0;n.push({id:s.id,properties:s.properties,type:s.type,sourceLayerIndex:l,index:u,geometry:c,patterns:{},sortKey:h})}}r&&n.sort(function(t,e){return t.sortKey-e.sortKey});for(var p=0,f=n;p<f.length;p+=1){var d=f[p],m=d.geometry,y=d.index,_=d.sourceLayerIndex;if(this.hasPattern){var g=Ea("line",this.layers,d,this.zoom,e);this.patternFeatures.push(g)}else this.addFeature(d,m,y,{});e.featureIndex.insert(t[y].feature,m,y,_,this.index)}},Qa.prototype.update=function(t,e,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,r)},Qa.prototype.addFeatures=function(t,e){for(var r=0,n=this.patternFeatures;r<n.length;r+=1){var i=n[r];this.addFeature(i,i.geometry,i.index,e)}},Qa.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Qa.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Qa.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Za),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Qa.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Qa.prototype.addFeature=function(t,e,r,n){for(var i=this.layers[0].layout,o=i.get("line-join").evaluate(t,{}),a=i.get("line-cap"),s=i.get("line-miter-limit"),u=i.get("line-round-limit"),l=0,c=e;l<c.length;l+=1){this.addLine(c[l],t,o,a,s,u,r,n)}},Qa.prototype.addLine=function(t,e,r,n,i,o,a,s){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end")){this.clipStart=+e.properties.mapbox_clip_start,this.clipEnd=+e.properties.mapbox_clip_end;for(var u=0;u<t.length-1;u++)this.totalDistance+=t[u].dist(t[u+1])}for(var l="Polygon"===Wa[e.type],c=t.length;c>=2&&t[c-1].equals(t[c-2]);)c--;for(var h=0;h<c-1&&t[h].equals(t[h+1]);)h++;if(!(c<(l?3:2))){"bevel"===r&&(i=1.05);var p,f=io/(512*this.overscaling)*15,d=this.segments.prepareSegment(10*c,this.layoutVertexArray,this.indexArray),m=void 0,y=void 0,_=void 0,g=void 0;this.e1=this.e2=-1,l&&(g=t[h].sub(p=t[c-2])._unit()._perp());for(var v=h;v<c;v++)if(!(y=l&&v===c-1?t[h+1]:t[v+1])||!t[v].equals(y)){g&&(_=g),p&&(m=p),p=t[v],g=y?y.sub(p)._unit()._perp():_;var x=(_=_||g).add(g);0===x.x&&0===x.y||x._unit();var b=_.x*g.x+_.y*g.y,w=x.x*g.x+x.y*g.y,E=0!==w?1/w:1/0,A=2*Math.sqrt(2-2*w),T=w<Ka&&m&&y,M=_.x*g.y-_.y*g.x>0;if(T&&v>h){var S=p.dist(m);if(S>2*f){var R=p.sub(p.sub(m)._mult(f/S)._round());this.updateDistance(m,R),this.addCurrentVertex(R,_,0,0,d),m=R}}var I=m&&y,C=I?r:l?"butt":n;if(I&&"round"===C&&(E<o?C="miter":E<=2&&(C="fakeround")),"miter"===C&&E>i&&(C="bevel"),"bevel"===C&&(E>2&&(C="flipbevel"),E<i&&(C="miter")),m&&this.updateDistance(m,p),"miter"===C)x._mult(E),this.addCurrentVertex(p,x,0,0,d);else if("flipbevel"===C){if(E>100)x=g.mult(-1);else{var P=E*_.add(g).mag()/_.sub(g).mag();x._perp()._mult(P*(M?-1:1))}this.addCurrentVertex(p,x,0,0,d),this.addCurrentVertex(p,x.mult(-1),0,0,d)}else if("bevel"===C||"fakeround"===C){var D=-Math.sqrt(E*E-1),L=M?D:0,O=M?0:D;if(m&&this.addCurrentVertex(p,_,L,O,d),"fakeround"===C)for(var k=Math.round(180*A/Math.PI/20),F=1;F<k;F++){var B=F/k;if(.5!==B){var N=B-.5;B+=B*N*(B-1)*((1.0904+b*(b*(3.55645-1.43519*b)-3.2452))*N*N+(.848013+b*(.215638*b-1.06021)))}var z=g.sub(_)._mult(B)._add(_)._unit()._mult(M?-1:1);this.addHalfVertex(p,z.x,z.y,!1,M,0,d)}y&&this.addCurrentVertex(p,g,-L,-O,d)}else if("butt"===C)this.addCurrentVertex(p,x,0,0,d);else if("square"===C){var U=m?1:-1;this.addCurrentVertex(p,x,U,U,d)}else"round"===C&&(m&&(this.addCurrentVertex(p,_,0,0,d),this.addCurrentVertex(p,_,1,1,d,!0)),y&&(this.addCurrentVertex(p,g,-1,-1,d,!0),this.addCurrentVertex(p,g,0,0,d)));if(T&&v<c-1){var V=p.dist(y);if(V>2*f){var j=p.add(y.sub(p)._mult(f/V)._round());this.updateDistance(p,j),this.addCurrentVertex(j,g,0,0,d),p=j}}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,s)}},Qa.prototype.addCurrentVertex=function(t,e,r,n,i,o){void 0===o&&(o=!1);var a=e.y*n-e.x,s=-e.y-e.x*n;this.addHalfVertex(t,e.x+e.y*r,e.y-e.x*r,o,!1,r,i),this.addHalfVertex(t,a,s,o,!0,-n,i),this.distance>Ja/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,r,n,i,o))},Qa.prototype.addHalfVertex=function(t,e,r,n,i,o,a){var s=.5*this.scaledDistance;this.layoutVertexArray.emplaceBack((t.x<<1)+(n?1:0),(t.y<<1)+(i?1:0),Math.round(63*e)+128,Math.round(63*r)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6);var u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),i?this.e2=u:this.e1=u},Qa.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(Ja-1):this.distance},_n("LineBucket",Qa,{omit:["layers","patternFeatures"]});var $a=new Zn({"line-cap":new Gn(At.layout_line["line-cap"]),"line-join":new qn(At.layout_line["line-join"]),"line-miter-limit":new Gn(At.layout_line["line-miter-limit"]),"line-round-limit":new Gn(At.layout_line["line-round-limit"]),"line-sort-key":new qn(At.layout_line["line-sort-key"])}),ts={paint:new Zn({"line-opacity":new qn(At.paint_line["line-opacity"]),"line-color":new qn(At.paint_line["line-color"]),"line-translate":new Gn(At.paint_line["line-translate"]),"line-translate-anchor":new Gn(At.paint_line["line-translate-anchor"]),"line-width":new qn(At.paint_line["line-width"]),"line-gap-width":new qn(At.paint_line["line-gap-width"]),"line-offset":new qn(At.paint_line["line-offset"]),"line-blur":new qn(At.paint_line["line-blur"]),"line-dasharray":new Xn(At.paint_line["line-dasharray"]),"line-pattern":new Hn(At.paint_line["line-pattern"]),"line-gradient":new Yn(At.paint_line["line-gradient"])}),layout:$a},es=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,r){return r=new On(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),t.prototype.possiblyEvaluate.call(this,e,r)},e.prototype.evaluate=function(e,r,n,i){return r=h({},r,{zoom:Math.floor(r.zoom)}),t.prototype.evaluate.call(this,e,r,n,i)},e}(qn))(ts.paint.properties["line-width"].specification);es.useIntegerZoom=!0;var rs=function(t){function e(e){t.call(this,e,ts)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&this._updateGradient()},e.prototype._updateGradient=function(){this.gradient=No(this._transitionablePaint._values["line-gradient"].value.expression,"lineProgress"),this.gradientTexture=null},e.prototype.recalculate=function(e,r){t.prototype.recalculate.call(this,e,r),this.paint._values["line-floorwidth"]=es.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Qa(t)},e.prototype.queryRadius=function(t){var e=t,r=ns(bo("line-width",this,e),bo("line-gap-width",this,e)),n=bo("line-offset",this,e);return r/2+Math.abs(n)+wo(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,r,n,o,a,s){var u=Eo(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),l=s/2*ns(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),c=this.paint.get("line-offset").evaluate(e,r);return c&&(n=function(t,e){for(var r=[],n=new i(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],u=0;u<a.length;u++){var l=a[u],c=a[u+1],h=0===u?n:l.sub(a[u-1])._unit()._perp(),p=u===a.length-1?n:c.sub(l)._unit()._perp(),f=h._add(p)._unit();f._mult(1/(f.x*p.x+f.y*p.y)),s.push(f._mult(e)._add(l))}r.push(s)}return r}(n,c*s)),function(t,e,r){for(var n=0;n<e.length;n++){var i=e[n];if(t.length>=3)for(var o=0;o<i.length;o++)if(vo(t,i[o]))return!0;if(po(t,i,r))return!0}return!1}(u,n,l)},e.prototype.isTileClipped=function(){return!0},e}(Wn);function ns(t,e){return e>0?e+2*t:t}var is=$n([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"}]),os=$n([{name:"a_projected_pos",components:3,type:"Float32"}],4),as=($n([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),$n([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),ss=($n([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"radius"},{type:"Int16",name:"signedDistanceFromAnchor"}]),$n([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),us=$n([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);function ls(t,e,r){return t.sections.forEach(function(t){t.text=function(t,e,r){var n=e.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?t=t.toLocaleUpperCase():"lowercase"===n&&(t=t.toLocaleLowerCase()),Ln.applyArabicShaping&&(t=Ln.applyArabicShaping(t)),t}(t.text,e,r)}),t}$n([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),$n([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"}]),$n([{type:"Float32",name:"offsetX"}]),$n([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var cs={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},hs=24,ps={horizontal:1,vertical:2,horizontalOnly:3},fs=function(){this.text="",this.sectionIndex=[],this.sections=[]};function ds(t,e,r,n,i,o,a,s,u,l,c,h){var p,f=fs.fromFeature(t,r);l===ps.vertical&&f.verticalizePunctuation();var d=Ln.processBidirectionalText,m=Ln.processStyledBidirectionalText;if(d&&1===f.sections.length){p=[];for(var y=0,_=d(f.toString(),xs(f,s,n,e,h));y<_.length;y+=1){var g=_[y],v=new fs;v.text=g,v.sections=f.sections;for(var x=0;x<g.length;x++)v.sectionIndex.push(0);p.push(v)}}else if(m){p=[];for(var b=0,w=m(f.text,f.sectionIndex,xs(f,s,n,e,h));b<w.length;b+=1){var E=w[b],A=new fs;A.text=E[0],A.sectionIndex=E[1],A.sections=f.sections,p.push(A)}}else p=function(t,e){for(var r=[],n=t.text,i=0,o=0,a=e;o<a.length;o+=1){var s=a[o];r.push(t.substring(i,s)),i=s}return i<n.length&&r.push(t.substring(i,n.length)),r}(f,xs(f,s,n,e,h));var T=[],M={positionedGlyphs:T,text:f.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:l,lineCount:p.length,yOffset:-17};return function(t,e,r,n,i,o,a,s,u){for(var l=0,c=t.yOffset,h=0,p=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,d=0,m=r;d<m.length;d+=1){var y=m[d];y.trim();var _=y.getMaxScale();if(y.length()){for(var g=p.length,v=0;v<y.length();v++){var x=y.getSection(v),b=y.getSectionIndex(v),w=y.getCharCode(v),E=24*(_-x.scale),A=e[x.fontStack],T=A&&A[w];T&&(a===ps.horizontal||!u&&!Tn(w)||u&&(ms[w]||(wn.Arabic(M=w)||wn["Arabic Supplement"](M)||wn["Arabic Extended-A"](M)||wn["Arabic Presentation Forms-A"](M)||wn["Arabic Presentation Forms-B"](M)))?(p.push({glyph:w,x:l,y:c+E,vertical:!1,scale:x.scale,fontStack:x.fontStack,sectionIndex:b}),l+=T.metrics.advance*x.scale+s):(p.push({glyph:w,x:l,y:c+E,vertical:!0,scale:x.scale,fontStack:x.fontStack,sectionIndex:b}),l+=hs*x.scale+s))}if(p.length!==g)h=Math.max(l-s,h),ws(p,e,g,p.length-1,f);l=0,c+=n*_}else c+=n}var M,S=bs(i),R=S.horizontalAlign,I=S.verticalAlign;!function(t,e,r,n,i,o,a){for(var s=(f-R)*h,u=(-I*a+.5)*o,l=0;l<t.length;l++)t[l].x+=s,t[l].y+=u}(p,0,0,0,0,n,r.length);var C=c-t.yOffset;t.top+=-I*C,t.bottom=t.top+C,t.left+=-R*h,t.right=t.left+h}(M,e,p,i,o,a,l,s,c),!!T.length&&M}fs.fromFeature=function(t,e){for(var r=new fs,n=0;n<t.sections.length;n++){var i=t.sections[n];r.sections.push({scale:i.scale||1,fontStack:i.fontStack||e}),r.text+=i.text;for(var o=0;o<i.text.length;o++)r.sectionIndex.push(n)}return r},fs.prototype.length=function(){return this.text.length},fs.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},fs.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},fs.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},fs.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",r=0;r<t.length;r++){var n=t.charCodeAt(r+1)||null,i=t.charCodeAt(r-1)||null;n&&Mn(n)&&!cs[t[r+1]]||i&&Mn(i)&&!cs[t[r-1]]||!cs[t[r]]?e+=t[r]:e+=cs[t[r]]}return e}(this.text)},fs.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&ms[this.text.charCodeAt(e)];e++)t++;for(var r=this.text.length,n=this.text.length-1;n>=0&&n>=t&&ms[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)},fs.prototype.substring=function(t,e){var r=new fs;return r.text=this.text.substring(t,e),r.sectionIndex=this.sectionIndex.slice(t,e),r.sections=this.sections,r},fs.prototype.toString=function(){return this.text},fs.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(e,r){return Math.max(e,t.sections[r].scale)},0)};var ms={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ys={};function _s(t,e,r,n){var i=Math.pow(t-e,2);return n?t<e?i/2:2*i:i+Math.abs(r)*r}function gs(t,e,r){var n=0;return 10===t&&(n-=1e4),r&&(n+=150),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function vs(t,e,r,n,i,o){for(var a=null,s=_s(e,r,i,o),u=0,l=n;u<l.length;u+=1){var c=l[u],h=_s(e-c.x,r,i,o)+c.badness;h<=s&&(a=c,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function xs(t,e,r,n,i){if("point"!==i)return[];if(!t)return[];for(var o,a=[],s=function(t,e,r,n){for(var i=0,o=0;o<t.length();o++){var a=t.getSection(o),s=n[a.fontStack],u=s&&s[t.getCharCode(o)];u&&(i+=u.metrics.advance*a.scale+e)}return i/Math.max(1,Math.ceil(i/r))}(t,e,r,n),u=t.text.indexOf("")>=0,l=0,c=0;c<t.length();c++){var h=t.getSection(c),p=t.getCharCode(c),f=n[h.fontStack],d=f&&f[p];if(d&&!ms[p]&&(l+=d.metrics.advance*h.scale+e),c<t.length()-1){var m=!((o=p)<11904||!(wn["Bopomofo Extended"](o)||wn.Bopomofo(o)||wn["CJK Compatibility Forms"](o)||wn["CJK Compatibility Ideographs"](o)||wn["CJK Compatibility"](o)||wn["CJK Radicals Supplement"](o)||wn["CJK Strokes"](o)||wn["CJK Symbols and Punctuation"](o)||wn["CJK Unified Ideographs Extension A"](o)||wn["CJK Unified Ideographs"](o)||wn["Enclosed CJK Letters and Months"](o)||wn["Halfwidth and Fullwidth Forms"](o)||wn.Hiragana(o)||wn["Ideographic Description Characters"](o)||wn["Kangxi Radicals"](o)||wn["Katakana Phonetic Extensions"](o)||wn.Katakana(o)||wn["Vertical Forms"](o)||wn["Yi Radicals"](o)||wn["Yi Syllables"](o)));(ys[p]||m)&&a.push(vs(c+1,l,s,a,gs(p,t.getCharCode(c+1),m&&u),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(vs(t.length(),l,s,a,0,!0))}function bs(t){var e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function ws(t,e,r,n,i){if(i){var o=t[n],a=e[o.fontStack],s=a&&a[o.glyph];if(s)for(var u=(t[n].x+s.metrics.advance*o.scale)*i,l=r;l<=n;l++)t[l].x-=u}}ys[10]=!0,ys[32]=!0,ys[38]=!0,ys[40]=!0,ys[41]=!0,ys[43]=!0,ys[45]=!0,ys[47]=!0,ys[173]=!0,ys[183]=!0,ys[8203]=!0,ys[8208]=!0,ys[8211]=!0,ys[8231]=!0;var Es=function(t){function e(e,r,n,i){t.call(this,e,r),this.angle=n,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(i);_n("Anchor",Es);var As=256;function Ts(t,e){var r=e.expression;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new On(t+1))};if("source"===r.kind)return{kind:"source"};for(var n=r.zoomStops,i=r.interpolationType,o=0;o<n.length&&n[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<n.length&&n[a]<t+1;)a++;a=Math.min(n.length-1,a);var s=n[o],u=n[a];return"composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:r.evaluate(new On(s)),maxSize:r.evaluate(new On(u)),interpolationType:i}}function Ms(t,e,r){var n=e.uSize,i=r.lowerSize;return"source"===t.kind?i/As:"composite"===t.kind?be(i/As,r.upperSize/As,e.uSizeT):n}function Ss(t,e){var r=0,n=0;if("constant"===t.kind)n=t.layoutSize;else if("source"!==t.kind){var i=t.interpolationType,o=i?l(je.interpolationFactor(i,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?n=be(t.minSize,t.maxSize,o):r=o}return{uSizeT:r,uSize:n}}var Rs=Object.freeze({getSizeData:Ts,evaluateSizeForFeature:Ms,evaluateSizeForZoom:Ss,SIZE_PACK_FACTOR:As}),Is=Ba.VectorTileFeature.types,Cs=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ps(t,e,r,n,i,o,a,s){t.emplaceBack(e,r,Math.round(32*n),Math.round(32*i),o,a,s?s[0]:0,s?s[1]:0)}function Ds(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}var Ls=function(t){this.layoutVertexArray=new ai,this.indexArray=new _i,this.programConfigurations=t,this.segments=new ki,this.dynamicLayoutVertexArray=new si,this.opacityVertexArray=new ui,this.placedSymbolArray=new Ti};Ls.prototype.upload=function(t,e,r,n){r&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,is.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,os.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Cs,!0),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(t)},Ls.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},_n("SymbolBuffers",Ls);var Os=function(t,e,r){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new r,this.segments=new ki,this.collisionVertexArray=new hi};Os.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,as.members,!0)},Os.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},_n("CollisionBuffers",Os);var ks=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasPaintOverrides=!1;var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ts(this.zoom,e["text-size"]),this.iconSizeData=Ts(this.zoom,e["icon-size"]);var r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&(r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement")),"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map(function(t){return ps[t]})),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id}),this.sourceID=t.sourceID};ks.prototype.createArrays=function(){this.hasPaintOverrides=zs.hasPaintOverrides(this.layers[0].layout),this.text=new Ls(new eo(is.members,this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Ls(new eo(is.members,this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.textCollisionBox=new Os(ci,ss.members,gi),this.iconCollisionBox=new Os(ci,ss.members,gi),this.textCollisionCircle=new Os(ci,us.members,_i),this.iconCollisionCircle=new Os(ci,us.members,_i),this.glyphOffsetArray=new Ii,this.lineVertexArray=new Pi,this.symbolInstances=new Si},ks.prototype.calculateGlyphDependencies=function(t,e,r,n,i){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(r||n)&&i){var a=cs[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},ks.prototype.populate=function(t,e){var r=this.layers[0],n=r.layout,i=n.get("text-font"),o=n.get("text-field"),a=n.get("icon-image"),s=("constant"!==o.value.kind||o.value.value.toString().length>0)&&("constant"!==i.value.kind||i.value.value.length>0),u="constant"!==a.value.kind||!!a.value.value||Object.keys(a.parameters).length>0,l=n.get("symbol-sort-key");if(this.features=[],s||u){for(var c=e.iconDependencies,h=e.glyphDependencies,p=e.availableImages,f=new On(this.zoom),d=0,m=t;d<m.length;d+=1){var y=m[d],_=y.feature,g=y.index,v=y.sourceLayerIndex;if(r._featureFilter(f,_)){var x=void 0;if(s){var b=r.getValueAndResolveTokens("text-field",_,p);x=ls(b instanceof Jt?b:Jt.fromString(b),r,_)}var w=void 0;if(u){var E=r.getValueAndResolveTokens("icon-image",_,p);w=E instanceof Qt?E:Qt.fromString(E&&"string"!=typeof E?E:{name:E,available:!1})}if(x||w){var A=this.sortFeaturesByKey?l.evaluate(_,{}):void 0,T={text:x,icon:w,index:g,sourceLayerIndex:v,geometry:ao(_),properties:_.properties,type:Is[_.type],sortKey:A};if(void 0!==_.id&&(T.id=_.id),this.features.push(T),w&&(c[w.name]=!0),x){var M=i.evaluate(_,{}).join(","),S="map"===n.get("text-rotation-alignment")&&"point"!==n.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ps.vertical)>=0;for(var R=0,I=x.sections;R<I.length;R+=1){var C=I[R],P=En(x.toString()),D=C.fontStack||M,L=h[D]=h[D]||{};this.calculateGlyphDependencies(C.text,L,S,this.allowVerticalPlacement,P)}}}}}"line"===n.get("symbol-placement")&&(this.features=function(t){var e={},r={},n=[],i=0;function o(e){n.push(t[e]),i++}function a(t,e,i){var o=r[t];return delete r[t],r[e]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(i[0]),o}function s(t,r,i){var o=e[r];return delete e[r],e[t]=o,n[o].geometry[0].shift(),n[o].geometry[0]=i[0].concat(n[o].geometry[0]),o}function u(t,e,r){var n=r?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.text?c.text.toString():null;if(p){var f=u(p,h),d=u(p,h,!0);if(f in r&&d in e&&r[f]!==e[d]){var m=s(f,d,h),y=a(f,d,n[m].geometry);delete e[f],delete r[d],r[u(p,n[y].geometry,!0)]=y,n[m].geometry=null}else f in r?a(f,d,h):d in e?s(f,d,h):(o(l),e[f]=i-1,r[d]=i-1)}else o(l)}return n.filter(function(t){return t.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(t,e){return t.sortKey-e.sortKey})}},ks.prototype.update=function(t,e,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,r))},ks.prototype.isEmpty=function(){return 0===this.symbolInstances.length},ks.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},ks.prototype.upload=function(t){this.uploaded||(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t),this.textCollisionCircle.upload(t),this.iconCollisionCircle.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},ks.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.textCollisionBox.destroy(),this.iconCollisionBox.destroy(),this.textCollisionCircle.destroy(),this.iconCollisionCircle.destroy()},ks.prototype.addToLineVertexArray=function(t,e){var r=this.lineVertexArray.length;if(void 0!==t.segment){for(var n=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:n},a<e.length-1&&(n+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var l=o[u];this.lineVertexArray.emplaceBack(l.x,l.y,l.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},ks.prototype.addSymbols=function(t,e,r,n,i,o,a,s,u,l,c){var h=this,p=t.indexArray,f=t.layoutVertexArray,d=t.dynamicLayoutVertexArray,m=t.segments.prepareSegment(4*e.length,t.layoutVertexArray,t.indexArray,o.sortKey),y=this.glyphOffsetArray.length,_=m.vertexLength,g=this.allowVerticalPlacement&&a===ps.vertical?Math.PI/2:0,v=function(t){var e=t.tl,n=t.tr,i=t.bl,o=t.br,a=t.tex,u=m.vertexLength,l=t.glyphOffset[1];Ps(f,s.x,s.y,e.x,l+e.y,a.x,a.y,r),Ps(f,s.x,s.y,n.x,l+n.y,a.x+a.w,a.y,r),Ps(f,s.x,s.y,i.x,l+i.y,a.x,a.y+a.h,r),Ps(f,s.x,s.y,o.x,l+o.y,a.x+a.w,a.y+a.h,r),Ds(d,s,g),p.emplaceBack(u,u+1,u+2),p.emplaceBack(u+1,u+2,u+3),m.vertexLength+=4,m.primitiveLength+=2,h.glyphOffsetArray.emplaceBack(t.glyphOffset[0])};if(o.text&&o.text.sections){var x=o.text.sections;if(this.hasPaintOverrides){for(var b,w=function(e,r){void 0===b||b===e&&!r||t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o,o.index,{},x[b]),b=e},E=0,A=e;E<A.length;E+=1){var T=A[E];w(T.sectionIndex,!1),v(T)}w(b,!0)}else{for(var M=0,S=e;M<S.length;M+=1)v(S[M]);t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o,o.index,{},x[0])}}else{for(var R=0,I=e;R<I.length;R+=1)v(I[R]);t.programConfigurations.populatePaintArrays(t.layoutVertexArray.length,o,o.index,{})}t.placedSymbolArray.emplaceBack(s.x,s.y,y,this.glyphOffsetArray.length-y,_,u,l,s.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,0,!1,0,c)},ks.prototype._addCollisionDebugVertex=function(t,e,r,n,i,o){return e.emplaceBack(0,0),t.emplaceBack(r.x,r.y,n,i,Math.round(o.x),Math.round(o.y))},ks.prototype.addCollisionDebugVertices=function(t,e,r,n,o,a,s,u){var l=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),c=l.vertexLength,h=o.layoutVertexArray,p=o.collisionVertexArray,f=s.anchorX,d=s.anchorY;if(this._addCollisionDebugVertex(h,p,a,f,d,new i(t,e)),this._addCollisionDebugVertex(h,p,a,f,d,new i(r,e)),this._addCollisionDebugVertex(h,p,a,f,d,new i(r,n)),this._addCollisionDebugVertex(h,p,a,f,d,new i(t,n)),l.vertexLength+=4,u){var m=o.indexArray;m.emplaceBack(c,c+1,c+2),m.emplaceBack(c,c+2,c+3),l.primitiveLength+=2}else{var y=o.indexArray;y.emplaceBack(c,c+1),y.emplaceBack(c+1,c+2),y.emplaceBack(c+2,c+3),y.emplaceBack(c+3,c),l.primitiveLength+=4}},ks.prototype.addDebugCollisionBoxes=function(t,e,r,n){for(var i=t;i<e;i++){var o=this.collisionBoxArray.get(i),a=o.radius>0;this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,a?n?this.textCollisionCircle:this.iconCollisionCircle:n?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,r,a)}},ks.prototype.generateCollisionDebugBuffers=function(){for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1)}},ks.prototype._deserializeCollisionBoxesForSymbol=function(t,e,r,n,i,o,a){for(var s={},u=e;u<r;u++){var l=t.get(u);if(0===l.radius){s.textBox={x1:l.x1,y1:l.y1,x2:l.x2,y2:l.y2,anchorPointX:l.anchorPointX,anchorPointY:l.anchorPointY},s.textFeatureIndex=l.featureIndex;break}s.textCircles||(s.textCircles=[],s.textFeatureIndex=l.featureIndex),s.textCircles.push(l.anchorPointX,l.anchorPointY,l.radius,l.signedDistanceFromAnchor,1)}for(var c=n;c<i;c++){var h=t.get(c);if(0===h.radius){s.verticalTextBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},s.verticalTextFeatureIndex=h.featureIndex;break}}for(var p=o;p<a;p++){var f=t.get(p);if(0===f.radius){s.iconBox={x1:f.x1,y1:f.y1,x2:f.x2,y2:f.y2,anchorPointX:f.anchorPointX,anchorPointY:f.anchorPointY},s.iconFeatureIndex=f.featureIndex;break}}return s},ks.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var r=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex))}},ks.prototype.hasTextData=function(){return this.text.segments.get().length>0},ks.prototype.hasIconData=function(){return this.icon.segments.get().length>0},ks.prototype.hasTextCollisionBoxData=function(){return this.textCollisionBox.segments.get().length>0},ks.prototype.hasIconCollisionBoxData=function(){return this.iconCollisionBox.segments.get().length>0},ks.prototype.hasTextCollisionCircleData=function(){return this.textCollisionCircle.segments.get().length>0},ks.prototype.hasIconCollisionCircleData=function(){return this.iconCollisionCircle.segments.get().length>0},ks.prototype.addIndicesForPlacedTextSymbol=function(t){for(var e=this.text.placedSymbolArray.get(t),r=e.vertexStartIndex+4*e.numGlyphs,n=e.vertexStartIndex;n<r;n+=4)this.text.indexArray.emplaceBack(n,n+1,n+2),this.text.indexArray.emplaceBack(n+1,n+2,n+3)},ks.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),r=Math.cos(t),n=[],i=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);n.push(0|Math.round(e*s.anchorX+r*s.anchorY)),i.push(s.featureIndex)}return o.sort(function(t,e){return n[t]-n[e]||i[e]-i[t]}),o},ks.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,n=this.symbolInstanceIndexes;r<n.length;r+=1){var i=n[r],o=this.symbolInstances.get(i);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach(function(t,r,n){t>=0&&n.indexOf(t)===r&&e.addIndicesForPlacedTextSymbol(t)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedTextSymbol(o.verticalPlacedTextSymbolIndex);var a=this.icon.placedSymbolArray.get(i);if(a.numGlyphs){var s=a.vertexStartIndex;this.icon.indexArray.emplaceBack(s,s+1,s+2),this.icon.indexArray.emplaceBack(s+1,s+2,s+3)}}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},_n("SymbolBucket",ks,{omit:["layers","collisionBoxArray","features","compareText"]}),ks.MAX_GLYPHS=65535,ks.addDynamicAttributes=Ds;var Fs=new Zn({"symbol-placement":new Gn(At.layout_symbol["symbol-placement"]),"symbol-spacing":new Gn(At.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Gn(At.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qn(At.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Gn(At.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Gn(At.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Gn(At.layout_symbol["icon-ignore-placement"]),"icon-optional":new Gn(At.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Gn(At.layout_symbol["icon-rotation-alignment"]),"icon-size":new qn(At.layout_symbol["icon-size"]),"icon-text-fit":new Gn(At.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gn(At.layout_symbol["icon-text-fit-padding"]),"icon-image":new qn(At.layout_symbol["icon-image"]),"icon-rotate":new qn(At.layout_symbol["icon-rotate"]),"icon-padding":new Gn(At.layout_symbol["icon-padding"]),"icon-keep-upright":new Gn(At.layout_symbol["icon-keep-upright"]),"icon-offset":new qn(At.layout_symbol["icon-offset"]),"icon-anchor":new qn(At.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Gn(At.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Gn(At.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Gn(At.layout_symbol["text-rotation-alignment"]),"text-field":new qn(At.layout_symbol["text-field"]),"text-font":new qn(At.layout_symbol["text-font"]),"text-size":new qn(At.layout_symbol["text-size"]),"text-max-width":new qn(At.layout_symbol["text-max-width"]),"text-line-height":new Gn(At.layout_symbol["text-line-height"]),"text-letter-spacing":new qn(At.layout_symbol["text-letter-spacing"]),"text-justify":new qn(At.layout_symbol["text-justify"]),"text-radial-offset":new qn(At.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Gn(At.layout_symbol["text-variable-anchor"]),"text-anchor":new qn(At.layout_symbol["text-anchor"]),"text-max-angle":new Gn(At.layout_symbol["text-max-angle"]),"text-writing-mode":new Gn(At.layout_symbol["text-writing-mode"]),"text-rotate":new qn(At.layout_symbol["text-rotate"]),"text-padding":new Gn(At.layout_symbol["text-padding"]),"text-keep-upright":new Gn(At.layout_symbol["text-keep-upright"]),"text-transform":new qn(At.layout_symbol["text-transform"]),"text-offset":new qn(At.layout_symbol["text-offset"]),"text-allow-overlap":new Gn(At.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Gn(At.layout_symbol["text-ignore-placement"]),"text-optional":new Gn(At.layout_symbol["text-optional"])}),Bs={paint:new Zn({"icon-opacity":new qn(At.paint_symbol["icon-opacity"]),"icon-color":new qn(At.paint_symbol["icon-color"]),"icon-halo-color":new qn(At.paint_symbol["icon-halo-color"]),"icon-halo-width":new qn(At.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qn(At.paint_symbol["icon-halo-blur"]),"icon-translate":new Gn(At.paint_symbol["icon-translate"]),"icon-translate-anchor":new Gn(At.paint_symbol["icon-translate-anchor"]),"text-opacity":new qn(At.paint_symbol["text-opacity"]),"text-color":new qn(At.paint_symbol["text-color"],{runtimeType:Bt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new qn(At.paint_symbol["text-halo-color"]),"text-halo-width":new qn(At.paint_symbol["text-halo-width"]),"text-halo-blur":new qn(At.paint_symbol["text-halo-blur"]),"text-translate":new Gn(At.paint_symbol["text-translate"]),"text-translate-anchor":new Gn(At.paint_symbol["text-translate-anchor"])}),layout:Fs},Ns=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Lt,this.defaultValue=t};Ns.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ns.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ns.prototype.possibleOutputs=function(){return[void 0]},Ns.prototype.serialize=function(){return null},_n("FormatSectionOverride",Ns,{omit:["defaultValue"]});var zs=function(t){function e(e){t.call(this,e,Bs)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,r){if(t.prototype.recalculate.call(this,e,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var n=this.layout.get("text-writing-mode");if(n){for(var i=[],o=0,a=n;o<a.length;o+=1){var s=a[o];i.indexOf(s)<0&&i.push(s)}this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,r){var n=this.layout.get(t).evaluate(e,{},r),i=this._unevaluatedLayout._values[t];return i.isDataDriven()||Tr(i.value)||!n?n:function(t,e){return n.replace(/{([^{}]+)}/g,function(e,r){return r in t?String(t[r]):""})}(e.properties)},e.prototype.createBucket=function(t){return new ks(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,r=Bs.paint.overridableProperties;t<r.length;t+=1){var n=r[t];if(e.hasPaintOverride(this.layout,n)){var i,o=this.paint.get(n),a=new Ns(o),s=new Ar(a,o.property.specification);i="constant"===o.value.kind||"source"===o.value.kind?new Sr("source",s):new Rr("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new Vn(o.property,i,o.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,r,n){return!(!this.layout||r.isDataDriven()||n.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var r=t.get("text-field"),n=Bs.paint.properties[e],i=!1,o=function(t){for(var e=0,r=t;e<r.length;e+=1){if(n.overrides&&n.overrides.hasOverride(r[e]))return void(i=!0)}};if("constant"===r.value.kind&&r.value.value instanceof Jt)o(r.value.value.sections);else if("source"===r.value.kind){var a=function(t){if(!i)if(t instanceof re&&te(t.value)===Vt){o(t.value.sections)}else t instanceof ae?o(t.sections):t.eachChild(a)},s=r.value;s._styleExpression&&a(s._styleExpression.expression)}return i},e.hasPaintOverrides=function(t){for(var r=0,n=Bs.paint.overridableProperties;r<n.length;r+=1){if(e.hasPaintOverride(t,n[r]))return!0}return!1},e}(Wn),Us={paint:new Zn({"background-color":new Gn(At.paint_background["background-color"]),"background-pattern":new Xn(At.paint_background["background-pattern"]),"background-opacity":new Gn(At.paint_background["background-opacity"])})},Vs=function(t){function e(e){t.call(this,e,Us)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Wn),js={paint:new Zn({"raster-opacity":new Gn(At.paint_raster["raster-opacity"]),"raster-hue-rotate":new Gn(At.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Gn(At.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Gn(At.paint_raster["raster-brightness-max"]),"raster-saturation":new Gn(At.paint_raster["raster-saturation"]),"raster-contrast":new Gn(At.paint_raster["raster-contrast"]),"raster-resampling":new Gn(At.paint_raster["raster-resampling"]),"raster-fade-duration":new Gn(At.paint_raster["raster-fade-duration"])})},Gs=function(t){function e(e){t.call(this,e,js)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Wn),qs=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(Wn),Hs={circle:Io,heatmap:zo,hillshade:Vo,fill:Sa,"fill-extrusion":Ha,line:rs,symbol:zs,background:Vs,raster:Gs};function Xs(t){for(var e=0,r=0,n=0,i=t;n<i.length;n+=1){var o=i[n];e+=o.w*o.h,r=Math.max(r,o.w)}t.sort(function(t,e){return e.h-t.h});for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}],s=0,u=0,l=0,c=t;l<c.length;l+=1)for(var h=c[l],p=a.length-1;p>=0;p--){var f=a[p];if(!(h.w>f.w||h.h>f.h)){if(h.x=f.x,h.y=f.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===f.w&&h.h===f.h){var d=a.pop();p<a.length&&(a[p]=d)}else h.h===f.h?(f.x+=h.w,f.w-=h.w):h.w===f.w?(f.y+=h.h,f.h-=h.h):(a.push({x:f.x+h.w,y:f.y,w:f.w-h.w,h:h.h}),f.y+=h.h,f.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}var Ys=function(t,e){var r=e.pixelRatio,n=e.version;this.paddedRect=t,this.pixelRatio=r,this.version=n},Zs={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Zs.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Zs.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Zs.tlbr.get=function(){return this.tl.concat(this.br)},Zs.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Ys.prototype,Zs);var Ws=function(t,e){var r={},n={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,r,i),this.addImages(e,n,i);var o=Xs(i),a=new Fo({width:o.w||1,height:o.h||1});for(var s in t){var u=t[s],l=r[s].paddedRect;Fo.copy(u.data,a,{x:0,y:0},{x:l.x+1,y:l.y+1},u.data)}for(var c in e){var h=e[c],p=n[c].paddedRect,f=p.x+1,d=p.y+1,m=h.data.width,y=h.data.height;Fo.copy(h.data,a,{x:0,y:0},{x:f,y:d},h.data),Fo.copy(h.data,a,{x:0,y:y-1},{x:f,y:d-1},{width:m,height:1}),Fo.copy(h.data,a,{x:0,y:0},{x:f,y:d+y},{width:m,height:1}),Fo.copy(h.data,a,{x:m-1,y:0},{x:f-1,y:d},{width:1,height:y}),Fo.copy(h.data,a,{x:0,y:0},{x:f+m,y:d},{width:1,height:y})}this.image=a,this.iconPositions=r,this.patternPositions=n};Ws.prototype.addImages=function(t,e,r){for(var n in t){var i=t[n],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};r.push(o),e[n]=new Ys(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}},Ws.prototype.patchUpdatedImages=function(t,e){for(var r in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[r],t.getImage(r),e),this.patchUpdatedImage(this.patternPositions[r],t.getImage(r),e)},Ws.prototype.patchUpdatedImage=function(t,e,r){if(t&&e&&t.version!==e.version){t.version=e.version;var n=t.tl;r.update(e.data,void 0,{x:n[0],y:n[1]})}},_n("ImagePosition",Ys),_n("ImageAtlas",Ws);var Ks=self.HTMLImageElement,Js=self.HTMLCanvasElement,Qs=self.HTMLVideoElement,$s=self.ImageData,tu=function(t,e,r,n){this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(e,n)};tu.prototype.update=function(t,e,r){var n=t.width,i=t.height,o=!(this.size&&this.size[0]===n&&this.size[1]===i||r),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[n,i],t instanceof Ks||t instanceof Js||t instanceof Qs||t instanceof $s?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,n,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=r||{x:0,y:0},l=u.x,c=u.y;t instanceof Ks||t instanceof Js||t instanceof Qs||t instanceof $s?s.texSubImage2D(s.TEXTURE_2D,0,l,c,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,l,c,n,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},tu.prototype.bind=function(t,e,r){var n=this.context.gl;n.bindTexture(n.TEXTURE_2D,this.texture),r!==n.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=n.LINEAR),t!==this.filter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,r||t),this.filter=t),e!==this.wrap&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,e),this.wrap=e)},tu.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},tu.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var eu=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,l=u>>1,c=-7,h=r?i-1:0,p=r?-1:1,f=t[e+h];for(h+=p,o=f&(1<<-c)-1,f>>=-c,c+=s;c>0;o=256*o+t[e+h],h+=p,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+h],h+=p,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),o-=l}return(f?-1:1)*a*Math.pow(2,o-n)},ru=function(t,e,r,n,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,h=c>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:o-1,d=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=c?(s=0,a=c):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[r+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[r+f]=255&a,f+=d,a/=256,l-=8);t[r+f-d]|=128*m},nu=iu;function iu(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}function ou(t){return t.type===iu.Bytes?t.readVarint()+t.pos:t.pos+1}function au(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function su(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function uu(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function lu(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function cu(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function hu(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function pu(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function fu(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function du(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function mu(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function yu(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function _u(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function gu(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function vu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}iu.Varint=0,iu.Fixed64=1,iu.Bytes=2,iu.Fixed32=5,iu.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=_u(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=vu(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_u(this.buf,this.pos)+4294967296*_u(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=_u(this.buf,this.pos)+4294967296*vu(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=eu(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=eu(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(n=(112&(i=o[r.pos++]))>>4,i<128)return au(t,n,e);if(n|=(127&(i=o[r.pos++]))<<3,i<128)return au(t,n,e);if(n|=(127&(i=o[r.pos++]))<<10,i<128)return au(t,n,e);if(n|=(127&(i=o[r.pos++]))<<17,i<128)return au(t,n,e);if(n|=(127&(i=o[r.pos++]))<<24,i<128)return au(t,n,e);if(n|=(1&(i=o[r.pos++]))<<31,i<128)return au(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,r){for(var n="",i=e;i<r;){var o,a,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>r)break;1===c?u<128&&(l=u):2===c?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=c}return n}(this.buf,this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==iu.Bytes)return t.push(this.readVarint(e));var r=ou(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==iu.Bytes)return t.push(this.readSVarint());var e=ou(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==iu.Bytes)return t.push(this.readBoolean());var e=ou(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==iu.Bytes)return t.push(this.readFloat());var e=ou(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==iu.Bytes)return t.push(this.readDouble());var e=ou(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==iu.Bytes)return t.push(this.readFixed32());var e=ou(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==iu.Bytes)return t.push(this.readSFixed32());var e=ou(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==iu.Bytes)return t.push(this.readFixed64());var e=ou(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==iu.Bytes)return t.push(this.readSFixed64());var e=ou(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===iu.Varint)for(;this.buf[this.pos++]>127;);else if(e===iu.Bytes)this.pos=this.readVarint()+this.pos;else if(e===iu.Fixed32)this.pos+=4;else{if(e!==iu.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),gu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),gu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),gu(this.buf,-1&t,this.pos),gu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),gu(this.buf,-1&t,this.pos),gu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;if(t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,r.buf[r.pos]=127&(t>>>=7)}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&su(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),ru(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ru(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&su(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,iu.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,uu,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,lu,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,pu,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,cu,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,hu,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,fu,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,du,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,mu,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,yu,e)},writeBytesField:function(t,e){this.writeTag(t,iu.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,iu.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,iu.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,iu.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,iu.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,iu.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,iu.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,iu.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,iu.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,iu.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var xu=3;function bu(t,e,r){1===t&&r.readMessage(wu,e)}function wu(t,e,r){if(3===t){var n=r.readMessage(Eu,{}),i=n.width,o=n.height,a=n.left,s=n.top,u=n.advance;e.push({id:n.id,bitmap:new ko({width:i+2*xu,height:o+2*xu},n.bitmap),metrics:{width:i,height:o,left:a,top:s,advance:u}})}}function Eu(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}var Au=xu,Tu=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};Tu.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))};var Mu=function(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},y(["receive","process"],this),this.invoker=new Tu(this.process),this.target.addEventListener("message",this.receive,!1)};function Su(t,e,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[t*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}Mu.prototype.send=function(t,e,r,n){var i=this,o=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[o]=r);var a=[];return this.target.postMessage({id:o,type:t,hasCallback:!!r,targetMapId:n,sourceMapId:this.mapId,data:vn(e,a)},a),{cancel:function(){r&&delete i.callbacks[o],i.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:i.mapId})}}},Mu.prototype.receive=function(t){var e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[r];var n=this.cancelCallbacks[r];delete this.cancelCallbacks[r],n&&n()}else this.tasks[r]=e,this.taskQueue.push(r),this.invoker.trigger()},Mu.prototype.process=function(){var t=this;if(this.taskQueue.length){var e=this.taskQueue.shift(),r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),r)if("<response>"===r.type){var n=this.callbacks[e];delete this.callbacks[e],n&&(r.error?n(xn(r.error)):n(null,xn(r.data)))}else{var i=!1,o=r.hasCallback?function(r,n){i=!0,delete t.cancelCallbacks[e];var o=[];t.target.postMessage({id:e,type:"<response>",sourceMapId:t.mapId,error:r?vn(r):null,data:vn(n,o)},o)}:function(t){i=!0},a=null,s=xn(r.data);if(this.parent[r.type])a=this.parent[r.type](r.sourceMapId,s,o);else if(this.parent.getWorkerSource){var u=r.type.split(".");a=this.parent.getWorkerSource(r.sourceMapId,u[0],s.source)[u[1]](s,o)}else o(new Error("Could not find function "+r.type));!i&&a&&a.cancel&&(this.cancelCallbacks[e]=a.cancel)}}},Mu.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)};var Ru=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Ru.prototype.setNorthEast=function(t){return this._ne=t instanceof Iu?new Iu(t.lng,t.lat):Iu.convert(t),this},Ru.prototype.setSouthWest=function(t){return this._sw=t instanceof Iu?new Iu(t.lng,t.lat):Iu.convert(t),this},Ru.prototype.extend=function(t){var e,r,n=this._sw,i=this._ne;if(t instanceof Iu)e=t,r=t;else{if(!(t instanceof Ru))return Array.isArray(t)?t.every(Array.isArray)?this.extend(Ru.convert(t)):this.extend(Iu.convert(t)):this;if(r=t._ne,!(e=t._sw)||!r)return this}return n||i?(n.lng=Math.min(e.lng,n.lng),n.lat=Math.min(e.lat,n.lat),i.lng=Math.max(r.lng,i.lng),i.lat=Math.max(r.lat,i.lat)):(this._sw=new Iu(e.lng,e.lat),this._ne=new Iu(r.lng,r.lat)),this},Ru.prototype.getCenter=function(){return new Iu((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ru.prototype.getSouthWest=function(){return this._sw},Ru.prototype.getNorthEast=function(){return this._ne},Ru.prototype.getNorthWest=function(){return new Iu(this.getWest(),this.getNorth())},Ru.prototype.getSouthEast=function(){return new Iu(this.getEast(),this.getSouth())},Ru.prototype.getWest=function(){return this._sw.lng},Ru.prototype.getSouth=function(){return this._sw.lat},Ru.prototype.getEast=function(){return this._ne.lng},Ru.prototype.getNorth=function(){return this._ne.lat},Ru.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ru.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ru.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ru.convert=function(t){return!t||t instanceof Ru?t:new Ru(t)};var Iu=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Iu.prototype.wrap=function(){return new Iu(c(this.lng,-180,180),this.lat)},Iu.prototype.toArray=function(){return[this.lng,this.lat]},Iu.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Iu.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,r=e/Math.cos(Math.PI/180*this.lat);return new Ru(new Iu(this.lng-r,this.lat-e),new Iu(this.lng+r,this.lat+e))},Iu.convert=function(t){if(t instanceof Iu)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Iu(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Iu(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Cu=2*Math.PI*6378137;function Pu(t){return Cu*Math.cos(t*Math.PI/180)}function Du(t){return(180+t)/360}function Lu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Ou(t,e){return t/Pu(e)}function ku(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Fu=function(t,e,r){void 0===r&&(r=0),this.x=+t,this.y=+e,this.z=+r};Fu.fromLngLat=function(t,e){void 0===e&&(e=0);var r=Iu.convert(t);return new Fu(Du(r.lng),Lu(r.lat),Ou(e,r.lat))},Fu.prototype.toLngLat=function(){return new Iu(360*this.x-180,ku(this.y))},Fu.prototype.toAltitude=function(){return this.z*Pu(ku(this.y))},Fu.prototype.meterInMercatorCoordinateUnits=function(){return 1/Cu*(t=ku(this.y),1/Math.cos(t*Math.PI/180));var t};var Bu=function(t,e,r){this.z=t,this.x=e,this.y=r,this.key=Uu(0,t,e,r)};Bu.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Bu.prototype.url=function(t,e){var r,n,i,o,a,s=(n=this.y,i=this.z,o=Su(256*(r=this.x),256*(n=Math.pow(2,i)-n-1),i),a=Su(256*(r+1),256*(n+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),u=function(t,e,r){for(var n,i="",o=t;o>0;o--)i+=(e&(n=1<<o-1)?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},Bu.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new i((t.x*e-this.x)*io,(t.y*e-this.y)*io)};var Nu=function(t,e){this.wrap=t,this.canonical=e,this.key=Uu(t,e.z,e.x,e.y)},zu=function(t,e,r,n,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Bu(r,+n,+i),this.key=Uu(e,t,n,i)};function Uu(t,e,r,n){(t*=2)<0&&(t=-1*t-1);var i=1<<e;return 32*(i*i*t+i*n+r)+e}zu.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},zu.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new zu(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zu(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},zu.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},zu.prototype.children=function(t){if(this.overscaledZ>=t)return[new zu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new zu(e,this.wrap,e,r,n),new zu(e,this.wrap,e,r+1,n),new zu(e,this.wrap,e,r,n+1),new zu(e,this.wrap,e,r+1,n+1)]},zu.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},zu.prototype.wrapped=function(){return new zu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},zu.prototype.unwrapTo=function(t){return new zu(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},zu.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},zu.prototype.toUnwrapped=function(){return new Nu(this.wrap,this.canonical)},zu.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},zu.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Fu(t.x-this.wrap,t.y))},_n("CanonicalTileID",Bu),_n("OverscaledTileID",zu,{omit:["posMatrix"]});var Vu=function(t,e,r){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return w('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var n=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=r||"mapbox";for(var i=0;i<n;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(n,i)]=this.data[this._idx(n-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,n)]=this.data[this._idx(i,n-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(n,-1)]=this.data[this._idx(n-1,0)],this.data[this._idx(-1,n)]=this.data[this._idx(0,n-1)],this.data[this._idx(n,n)]=this.data[this._idx(n-1,n-1)]};Vu.prototype.get=function(t,e){var r=new Uint8Array(this.data.buffer),n=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(r[n],r[n+1],r[n+2])},Vu.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Vu.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Vu.prototype._unpackMapbox=function(t,e,r){return(256*t*256+256*e+r)/10-1e4},Vu.prototype._unpackTerrarium=function(t,e,r){return 256*t+e+r/256-32768},Vu.prototype.getPixels=function(){return new Fo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Vu.prototype.backfillBorder=function(t,e,r){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var n=e*this.dim,i=e*this.dim+this.dim,o=r*this.dim,a=r*this.dim+this.dim;switch(e){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,u=-r*this.dim,l=o;l<a;l++)for(var c=n;c<i;c++)this.data[this._idx(c,l)]=t.data[this._idx(c+s,l+u)]},_n("DEMData",Vu);var ju=$n([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Gu=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var r=t[e];this._stringToNumber[r]=e,this._numberToString[e]=r}};Gu.prototype.encode=function(t){return this._stringToNumber[t]},Gu.prototype.decode=function(t){return this._numberToString[t]};var qu=function(t,e,r,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=r,t._y=n,this.properties=t.properties,null!=t.id&&(this.id=t.id)},Hu={geometry:{configurable:!0}};Hu.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},Hu.geometry.set=function(t){this._geometry=t},qu.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties(qu.prototype,Hu);var Xu=function(){this.state={},this.stateChanges={},this.deletedStates={}};Xu.prototype.updateState=function(t,e,r){var n=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][n]=this.stateChanges[t][n]||{},h(this.stateChanges[t][n],r),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==n&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][n])for(var o in this.deletedStates[t][n]={},this.state[t][n])r[o]||(this.deletedStates[t][n][o]=null);else for(var a in r)this.deletedStates[t]&&this.deletedStates[t][n]&&null===this.deletedStates[t][n][a]&&delete this.deletedStates[t][n][a]},Xu.prototype.removeFeatureState=function(t,e,r){if(null!==this.deletedStates[t]){var n=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},r&&void 0!==e&&e>=0)null!==this.deletedStates[t][n]&&(this.deletedStates[t][n]=this.deletedStates[t][n]||{},this.deletedStates[t][n][r]=null);else if(void 0!==e&&e>=0)if(this.stateChanges[t]&&this.stateChanges[t][n])for(r in this.deletedStates[t][n]={},this.stateChanges[t][n])this.deletedStates[t][n][r]=null;else this.deletedStates[t][n]=null;else this.deletedStates[t]=null}},Xu.prototype.getState=function(t,e){var r=String(e),n=h({},(this.state[t]||{})[r],(this.stateChanges[t]||{})[r]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return{};for(var o in i)delete n[o]}return n},Xu.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},Xu.prototype.coalesceChanges=function(t,e){var r={};for(var n in this.stateChanges){this.state[n]=this.state[n]||{};var i={};for(var o in this.stateChanges[n])this.state[n][o]||(this.state[n][o]={}),h(this.state[n][o],this.stateChanges[n][o]),i[o]=this.state[n][o];r[n]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var u in this.state[a])s[u]={},this.state[a][u]={};else for(var l in this.deletedStates[a]){if(null===this.deletedStates[a][l])this.state[a][l]={};else for(var c=0,p=Object.keys(this.deletedStates[a][l]);c<p.length;c+=1){delete this.state[a][l][p[c]]}s[l]=this.state[a][l]}r[a]=r[a]||{},h(r[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(var f in t)t[f].setFeatureState(r,e)};var Yu=function(t,e,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=e||new pn(io,16,0),this.grid3D=new pn(io,16,0),this.featureIndexArray=r||new Li};function Zu(t){for(var e=1/0,r=1/0,n=-1/0,i=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y)}return{minX:e,minY:r,maxX:n,maxY:i}}function Wu(t,e){return e-t}Yu.prototype.insert=function(t,e,r,n,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i);for(var s=o?this.grid3D:this.grid,u=0;u<e.length;u++){for(var l=e[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var p=l[h];c[0]=Math.min(c[0],p.x),c[1]=Math.min(c[1],p.y),c[2]=Math.max(c[2],p.x),c[3]=Math.max(c[3],p.y)}c[0]<io&&c[1]<io&&c[2]>=0&&c[3]>=0&&s.insert(a,c[0],c[1],c[2],c[3])}},Yu.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Ba.VectorTile(new nu(this.rawTileData)).layers,this.sourceLayerCoder=new Gu(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Yu.prototype.query=function(t,e,r){var n=this;this.loadVTLayers();for(var o=t.params||{},a=io/t.tileSize/t.scale,s=zr(o.filter),u=t.queryGeometry,l=t.queryPadding*a,c=Zu(u),h=this.grid.query(c.minX-l,c.minY-l,c.maxX+l,c.maxY+l),p=Zu(t.cameraQueryGeometry),f=0,d=this.grid3D.query(p.minX-l,p.minY-l,p.maxX+l,p.maxY+l,function(e,r,n,o){return function(t,e,r,n,o){for(var a=0,s=t;a<s.length;a+=1){var u=s[a];if(e<=u.x&&r<=u.y&&n>=u.x&&o>=u.y)return!0}var l=[new i(e,r),new i(e,o),new i(n,o),new i(n,r)];if(t.length>2)for(var c=0,h=l;c<h.length;c+=1)if(vo(t,h[c]))return!0;for(var p=0;p<t.length-1;p++)if(xo(t[p],t[p+1],l))return!0;return!1}(t.cameraQueryGeometry,e-l,r-l,n+l,o+l)});f<d.length;f+=1){h.push(d[f])}h.sort(Wu);for(var m,y={},_=function(i){var l=h[i];if(l!==m){m=l;var c=n.featureIndexArray.get(l),p=null;n.loadMatchingFeature(y,c.bucketIndex,c.sourceLayerIndex,c.featureIndex,s,o.layers,e,function(e,i){p||(p=ao(e));var o={};return e.id&&(o=r.getState(i.sourceLayer||"_geojsonTileLayer",e.id)),i.queryIntersectsFeature(u,e,o,p,n.z,t.transform,a,t.pixelPosMatrix)})}},g=0;g<h.length;g++)_(g);return y},Yu.prototype.loadMatchingFeature=function(t,e,r,n,i,o,a,s){var u=this.bucketLayerIDs[e];if(!o||function(t,e){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>=0)return!0;return!1}(o,u)){var l=this.sourceLayerCoder.decode(r),c=this.vtLayers[l].feature(n);if(i(new On(this.tileID.overscaledZ),c))for(var h=0;h<u.length;h++){var p=u[h];if(!(o&&o.indexOf(p)<0)){var f=a[p];if(f){var d=!s||s(c,f);if(d){var m=new qu(c,this.z,this.x,this.y);m.layer=f.serialize();var y=t[p];void 0===y&&(y=t[p]=[]),y.push({featureIndex:n,feature:m,intersectionZ:d})}}}}}},Yu.prototype.lookupSymbolFeatures=function(t,e,r,n,i,o){var a={};this.loadVTLayers();for(var s=zr(n),u=0,l=t;u<l.length;u+=1){this.loadMatchingFeature(a,e,r,l[u],s,i,o)}return a},Yu.prototype.hasLayer=function(t){for(var e=0,r=this.bucketLayerIDs;e<r.length;e+=1)for(var n=0,i=r[e];n<i.length;n+=1)if(t===i[n])return!0;return!1},_n("FeatureIndex",Yu,{omit:["rawTileData","sourceLayerCoder"]});var Ku=function(t,e){this.tileID=t,this.uid=f(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.expiredRequestCount=0,this.state="loading"};function Ju(t,e,r,n,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-r/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var u=[],l=0;s<r/2;){var c=t[a],h=t[a+1];if(!h)return!1;var p=t[a-1].angleTo(c)-c.angleTo(h);for(p=Math.abs((p+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:p}),l+=p;s-u[0].distance>n;)l-=u.shift().angleDelta;if(l>i)return!1;a++,s+=c.dist(h)}return!0}function Qu(t){for(var e=0,r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function $u(t,e,r){return t?.6*e*r:0}function tl(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function el(t,e,r,n,i,o){for(var a=$u(r,i,o),s=tl(r,n)*o,u=0,l=Qu(t)/2,c=0;c<t.length-1;c++){var h=t[c],p=t[c+1],f=h.dist(p);if(u+f>l){var d=(l-u)/f,m=be(h.x,p.x,d),y=be(h.y,p.y,d),_=new Es(m,y,p.angleTo(h),c);return _._round(),!a||Ju(t,_,s,a,e)?_:void 0}u+=f}}function rl(t,e,r,n,i,o,a,s,u){var l=$u(n,o,a),c=tl(n,i),h=c*a,p=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,r,n,i,o,a,s,u,l){for(var c=a/2,h=Qu(e),p=0,f=r-n,d=[],m=0;m<e.length-1;m++){for(var y=e[m],_=e[m+1],g=y.dist(_),v=_.angleTo(y);f+n<p+g;){var x=((f+=n)-p)/g,b=be(y.x,_.x,x),w=be(y.y,_.y,x);if(b>=0&&b<l&&w>=0&&w<l&&f-c>=0&&f+c<=h){var E=new Es(b,w,v,m);E._round(),i&&!Ju(e,E,a,i,o)||d.push(E)}}p+=g}return u||d.length||s||(d=t(e,p/2,n,i,o,a,s,!0,l)),d}(t,p?e/2*s%e:(c/2+2*o)*a*s%e,e,l,r,h,p,!1,u)}Ku.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<O.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},Ku.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},Ku.prototype.loadVectorData=function(t,e,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var n in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var r={};if(!e)return r;for(var n=function(){var t=o[i],n=t.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==n.length){t.layers=n,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map(function(t){return n.filter(function(e){return e.id===t})[0]}));for(var a=0,s=n;a<s.length;a+=1){r[s[a].id]=t}}},i=0,o=t;i<o.length;i+=1)n();return r}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[n];if(i instanceof ks){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}for(var o in this.queryPadding=0,this.buckets){var a=this.buckets[o];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(o).queryRadius(a))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Ei},Ku.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Ku.prototype.unloadDEMData=function(){this.dem=null,this.neighboringTiles=null,this.state="unloaded"},Ku.prototype.getBucket=function(t){return this.buckets[t.id]},Ku.prototype.upload=function(t){for(var e in this.buckets){var r=this.buckets[e];r.uploadPending()&&r.upload(t)}var n=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new tu(t,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new tu(t,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)},Ku.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Ku.prototype.queryRenderedFeatures=function(t,e,r,n,i,o,a,s,u){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:n,scale:i,tileSize:this.tileSize,pixelPosMatrix:u,transform:a,params:o,queryPadding:this.queryPadding*s},t,e):{}},Ku.prototype.querySourceFeatures=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData){var r=this.latestFeatureIndex.loadVTLayers(),n=r._geojsonTileLayer||r[e?e.sourceLayer:""];if(n)for(var i=zr(e&&e.filter),o=this.tileID.canonical,a=o.z,s=o.x,u=o.y,l={z:a,x:s,y:u},c=0;c<n.length;c++){var h=n.feature(c);if(i(new On(this.tileID.overscaledZ),h)){var p=new qu(h,a,s,u);p.tile=l,t.push(p)}}}},Ku.prototype.clearMask=function(){this.segments&&(this.segments.destroy(),delete this.segments),this.maskedBoundsBuffer&&(this.maskedBoundsBuffer.destroy(),delete this.maskedBoundsBuffer),this.maskedIndexBuffer&&(this.maskedIndexBuffer.destroy(),delete this.maskedIndexBuffer)},Ku.prototype.setMask=function(t,e){if(!a(this.mask,t)&&(this.mask=t,this.clearMask(),!a(t,{0:!0}))){var r=new ri,n=new _i;this.segments=new ki,this.segments.prepareSegment(0,r,n);for(var o=Object.keys(t),s=0;s<o.length;s++){var u=t[+o[s]],l=io>>u.z,c=new i(u.x*l,u.y*l),h=new i(c.x+l,c.y+l),p=this.segments.prepareSegment(4,r,n);r.emplaceBack(c.x,c.y,c.x,c.y),r.emplaceBack(h.x,c.y,h.x,c.y),r.emplaceBack(c.x,h.y,c.x,h.y),r.emplaceBack(h.x,h.y,h.x,h.y);var f=p.vertexLength;n.emplaceBack(f,f+1,f+2),n.emplaceBack(f+1,f+2,f+3),p.vertexLength+=4,p.primitiveLength+=2}this.maskedBoundsBuffer=e.createVertexBuffer(r,ju.members),this.maskedIndexBuffer=e.createIndexBuffer(n)}},Ku.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},Ku.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Ku.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var r=T(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var n=Date.now(),i=!1;if(this.expirationTime>n)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var o=this.expirationTime-e;o?this.expirationTime=n+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Ku.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},Ku.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var r=this.latestFeatureIndex.loadVTLayers();for(var n in this.buckets){var i=this.buckets[n],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=r[o],s=t[o];a&&s&&0!==Object.keys(s).length&&(i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{}),e&&e.style&&(this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(n).queryRadius(i))))}}},Ku.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},Ku.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<O.now()},Ku.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Ku.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=O.now()+t};var nl=function(t,e,r,n,o,a,s,u,l,c,h,p){var f=s.top*u-l,d=s.bottom*u+l,m=s.left*u-l,y=s.right*u+l;if(this.boxStartIndex=t.length,c){var _=d-f,g=y-m;_>0&&(_=Math.max(10*u,_),this._addLineCollisionCircles(t,e,r,r.segment,g,_,n,o,a,h))}else{if(p){var v=new i(m,f),x=new i(y,f),b=new i(m,d),w=new i(y,d),E=p*Math.PI/180;v._rotate(E),x._rotate(E),b._rotate(E),w._rotate(E),m=Math.min(v.x,x.x,b.x,w.x),y=Math.max(v.x,x.x,b.x,w.x),f=Math.min(v.y,x.y,b.y,w.y),d=Math.max(v.y,x.y,b.y,w.y)}t.emplaceBack(r.x,r.y,m,f,y,d,n,o,a,0,0)}this.boxEndIndex=t.length};nl.prototype._addLineCollisionCircles=function(t,e,r,n,i,o,a,s,u,l){var c=o/2,h=Math.floor(i/c)||1,p=1+.4*Math.log(l)/Math.LN2,f=Math.floor(h*p/2),d=-o/2,m=r,y=n+1,_=d,g=-i/2,v=g-i/4;do{if(--y<0){if(_>g)return;y=0;break}_-=e[y].dist(m),m=e[y]}while(_>v);for(var x=e[y].dist(e[y+1]),b=-f;b<h+f;b++){var w=b*c,E=g+w;if(w<0&&(E+=w),w>i&&(E+=w-i),!(E<_)){for(;_+x<E;){if(_+=x,++y+1>=e.length)return;x=e[y].dist(e[y+1])}var A=E-_,T=e[y],M=e[y+1].sub(T)._unit()._mult(A)._add(T)._round(),S=Math.abs(E-d)<c?0:.8*(E-d);t.emplaceBack(M.x,M.y,-o/2,-o/2,o/2,o/2,a,s,u,o/2,S)}}};var il=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=ol),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function ol(t,e){return t<e?-1:t>e?1:0}function al(t,e,r){void 0===e&&(e=1),void 0===r&&(r=!1);for(var n=1/0,o=1/0,a=-1/0,s=-1/0,u=t[0],l=0;l<u.length;l++){var c=u[l];(!l||c.x<n)&&(n=c.x),(!l||c.y<o)&&(o=c.y),(!l||c.x>a)&&(a=c.x),(!l||c.y>s)&&(s=c.y)}var h=Math.min(a-n,s-o),p=h/2,f=new il([],sl);if(0===h)return new i(n,o);for(var d=n;d<a;d+=h)for(var m=o;m<s;m+=h)f.push(new ul(d+p,m+p,p,t));for(var y=function(t){for(var e=0,r=0,n=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],l=i[s],c=u.x*l.y-l.x*u.y;r+=(u.x+l.x)*c,n+=(u.y+l.y)*c,e+=3*c}return new ul(r/e,n/e,0,t)}(t),_=f.length;f.length;){var g=f.pop();(g.d>y.d||!y.d)&&(y=g,r&&console.log("found best %d after %d probes",Math.round(1e4*g.d)/1e4,_)),g.max-y.d<=e||(f.push(new ul(g.p.x-(p=g.h/2),g.p.y-p,p,t)),f.push(new ul(g.p.x+p,g.p.y-p,p,t)),f.push(new ul(g.p.x-p,g.p.y+p,p,t)),f.push(new ul(g.p.x+p,g.p.y+p,p,t)),_+=4)}return r&&(console.log("num probes: "+_),console.log("best distance: "+y.d)),y.p}function sl(t,e){return e.max-t.max}function ul(t,e,r,n){this.p=new i(t,e),this.h=r,this.d=function(t,e){for(var r=!1,n=1/0,i=0;i<e.length;i++)for(var o=e[i],a=0,s=o.length,u=s-1;a<s;u=a++){var l=o[a],c=o[u];l.y>t.y!=c.y>t.y&&t.x<(c.x-l.x)*(t.y-l.y)/(c.y-l.y)+l.x&&(r=!r),n=Math.min(n,_o(t,l,c))}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}il.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},il.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},il.prototype.peek=function(){return this.data[0]},il.prototype._up=function(t){for(var e=this.data,r=this.compare,n=e[t];t>0;){var i=t-1>>1,o=e[i];if(r(n,o)>=0)break;e[t]=o,t=i}e[t]=n},il.prototype._down=function(t){for(var e=this.data,r=this.compare,n=this.length>>1,i=e[t];t<n;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&r(e[s],a)<0&&(o=s,a=e[s]),r(a,i)>=0)break;e[t]=a,t=o}e[t]=i};var ll=e(function(t){t.exports=function(t,e){var r,n,i,o,a,s,u,l;for(n=t.length-(r=3&t.length),i=e,a=3432918353,s=461845907,l=0;l<n;)u=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,r){case 3:u^=(255&t.charCodeAt(l+2))<<16;case 2:u^=(255&t.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(l)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}}),cl=e(function(t){t.exports=function(t,e){for(var r,n=t.length,i=e^n,o=0;n>=4;)r=1540483477*(65535&(r=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}}),hl=ll,pl=cl;hl.murmur3=ll,hl.murmur2=pl;var fl=7,dl=Number.POSITIVE_INFINITY;function ml(t,e){return e[1]!==dl?function(t,e,r){var n=0,i=0;switch(e=Math.abs(e),r=Math.abs(r),t){case"top-right":case"top-left":case"top":i=r-fl;break;case"bottom-right":case"bottom-left":case"bottom":i=-r+fl}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}return[n,i]}(t,e[0],e[1]):function(t,e){var r=0,n=0;e<0&&(e=0);var i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":n=i-fl;break;case"bottom-right":case"bottom-left":n=-i+fl;break;case"bottom":n=-e+fl;break;case"top":n=e-fl}switch(t){case"top-right":case"bottom-right":r=-i;break;case"top-left":case"bottom-left":r=i;break;case"left":r=e;break;case"right":r=-e}return[r,n]}(t,e[0])}function yl(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}var _l=65535;function gl(t,e,r,n,o,a,s,u,l,c,h,p,f,d){var m=function(t,e,r,n,o,a,s,u){for(var l=n.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,c=e.positionedGlyphs,h=[],p=0;p<c.length;p++){var f=c[p],d=s[f.fontStack],m=d&&d[f.glyph];if(m){var y=m.rect;if(y){var _=Au+1,g=m.metrics.advance*f.scale/2,v=o?[f.x+g,f.y]:[0,0],x=o?[0,0]:[f.x+g+r[0],f.y+r[1]],b=(o||u)&&f.vertical,w=[0,0];b&&(w=x,x=[0,0]);var E=(m.metrics.left-_)*f.scale-g+x[0],A=(-m.metrics.top-_)*f.scale+x[1],T=E+y.w*f.scale,M=A+y.h*f.scale,S=new i(E,A),R=new i(T,A),I=new i(E,M),C=new i(T,M);if(b){var P=new i(-g,g-e.yOffset),D=-Math.PI/2,L=new i(5-e.yOffset-(hs/2-g),0),O=new(Function.prototype.bind.apply(i,[null].concat(w)));S._rotateAround(D,P)._add(L)._add(O),R._rotateAround(D,P)._add(L)._add(O),I._rotateAround(D,P)._add(L)._add(O),C._rotateAround(D,P)._add(L)._add(O)}if(l){var k=Math.sin(l),F=Math.cos(l),B=[F,-k,k,F];S._matMult(B),R._matMult(B),I._matMult(B),C._matMult(B)}h.push({tl:S,tr:R,bl:I,br:C,tex:y,writingMode:e.writingMode,glyphOffset:v,sectionIndex:f.sectionIndex})}}}return h}(0,r,s,n,o,a,p,t.allowVerticalPlacement),y=t.textSizeData,_=null;"source"===y.kind?(_=[As*n.layout.get("text-size").evaluate(a,{})])[0]>_l&&w(t.layerIds[0]+': Value for "text-size" is >= 256. Reduce your "text-size".'):"composite"===y.kind&&((_=[As*d.compositeTextSizes[0].evaluate(a,{}),As*d.compositeTextSizes[1].evaluate(a,{})])[0]>_l||_[1]>_l)&&w(t.layerIds[0]+': Value for "text-size" is >= 256. Reduce your "text-size".'),t.addSymbols(t.text,m,_,s,o,a,l,e,u.lineStartIndex,u.lineLength,f);for(var g=0,v=c;g<v.length;g+=1)h[v[g]]=t.text.placedSymbolArray.length-1;return 4*m.length}function vl(t,e,r,n){var i=t.compareText;if(e in i){for(var o=i[e],a=o.length-1;a>=0;a--)if(n.dist(o[a])<r)return!0}else i[e]=[];return i[e].push(n),!1}t.Actor=Mu,t.AlphaImage=ko,t.CanonicalTileID=Bu,t.CollisionBoxArray=Ei,t.Color=Zt,t.DEMData=Vu,t.DataConstantProperty=Gn,t.DictionaryCoder=Gu,t.EXTENT=io,t.ErrorEvent=wt,t.EvaluationParameters=On,t.Event=bt,t.Evented=Et,t.FeatureIndex=Yu,t.FillBucket=Aa,t.FillExtrusionBucket=Va,t.ImageAtlas=Ws,t.ImagePosition=Ys,t.LineBucket=Qa,t.LngLat=Iu,t.LngLatBounds=Ru,t.MercatorCoordinate=Fu,t.ONE_EM=hs,t.OverscaledTileID=zu,t.Point=i,t.Point$1=i,t.ProgramConfiguration=to,t.Properties=Zn,t.Protobuf=nu,t.RGBAImage=Fo,t.RequestManager=V,t.ResourceType=ut,t.SegmentVector=ki,t.SourceFeatureState=Xu,t.StructArrayLayout1ui2=vi,t.StructArrayLayout2i4=ei,t.StructArrayLayout2ui4=gi,t.StructArrayLayout3ui6=_i,t.StructArrayLayout4i8=ri,t.SymbolBucket=ks,t.Texture=tu,t.Tile=Ku,t.Transitionable=Bn,t.Uniform1f=Vi,t.Uniform1i=Ui,t.Uniform2f=ji,t.Uniform3f=Gi,t.Uniform4f=qi,t.UniformColor=Hi,t.UniformMatrix4f=Yi,t.UnwrappedTileID=Nu,t.ValidationError=Tt,t.WritingMode=ps,t.ZoomHistory=bn,t.addDynamicAttributes=Ds,t.asyncAll=function(t,e,r){if(!t.length)return r(null,[]);var n=t.length,i=new Array(t.length),o=null;t.forEach(function(t,a){e(t,function(t,e){t&&(o=t),i[a]=e,0==--n&&r(o,i)})})},t.bezier=s,t.bindAll=y,t.browser=O,t.cacheEntryPossiblyAdded=function(t){++st>it&&(t.getActor().send("enforceCacheSizeLimit",nt),st=0)},t.clamp=l,t.clearTileCache=function(t){var e=self.caches.delete(rt);t&&e.catch(t).then(function(){return t()})},t.clone=function(t){var e=new So(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=x,t.config=k,t.create=function(){var t=new So(16);return So!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new So(9);return So!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new So(4);return So!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Mr,t.createLayout=$n,t.createStyleLayer=function(t){return"custom"===t.type?new qs(t):new Hs[t.type](t)},t.deepEqual=a,t.ease=u,t.emitValidationErrors=hn,t.endsWith=_,t.enforceCacheSizeLimit=function(t){self.caches&&self.caches.open(rt).then(function(e){e.keys().then(function(r){for(var n=0;n<r.length-t;n++)e.delete(r[n])})})},t.evaluateSizeForFeature=Ms,t.evaluateSizeForZoom=Ss,t.evaluateVariableOffset=ml,t.evented=Dn,t.extend=h,t.featureFilter=zr,t.filterObject=v,t.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=bs,t.getAnchorJustification=yl,t.getArrayBuffer=yt,t.getImage=gt,t.getJSON=function(t,e){return mt(h(t,{type:"json"}),e)},t.getReferrer=ht,t.getVideo=function(t,e){var r,n,i=self.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var a=self.document.createElement("source");r=t[o],n=void 0,(n=self.document.createElement("a")).href=r,(n.protocol!==self.document.location.protocol||n.host!==self.document.location.host)&&(i.crossOrigin="Anonymous"),a.src=t[o],i.appendChild(a)}return{cancel:function(){}}},t.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15],g=r*s-n*a,v=r*u-i*a,x=r*l-o*a,b=n*u-i*s,w=n*l-o*s,E=i*l-o*u,A=c*m-h*d,T=c*y-p*d,M=c*_-f*d,S=h*y-p*m,R=h*_-f*m,I=p*_-f*y,C=g*I-v*R+x*S+b*M-w*T+E*A;return C?(t[0]=(s*I-u*R+l*S)*(C=1/C),t[1]=(i*R-n*I-o*S)*C,t[2]=(m*E-y*w+_*b)*C,t[3]=(p*w-h*E-f*b)*C,t[4]=(u*M-a*I-l*T)*C,t[5]=(r*I-i*M+o*T)*C,t[6]=(y*x-d*E-_*v)*C,t[7]=(c*E-p*x+f*v)*C,t[8]=(a*R-s*M+l*A)*C,t[9]=(n*M-r*R-o*A)*C,t[10]=(d*w-m*x+_*g)*C,t[11]=(h*x-c*w-f*g)*C,t[12]=(s*T-a*S-u*A)*C,t[13]=(r*S-n*T+i*A)*C,t[14]=(m*v-d*b-y*g)*C,t[15]=(c*b-h*v+p*g)*C,t):null},t.isChar=wn,t.isMapboxURL=j,t.keysDifference=function(t,e){var r=[];for(var n in t)n in e||r.push(n);return r},t.makeRequest=mt,t.mapObject=g,t.mercatorXfromLng=Du,t.mercatorYfromLat=Lu,t.mercatorZfromAltitude=Ou,t.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],y=e[13],_=e[14],g=e[15],v=r[0],x=r[1],b=r[2],w=r[3];return t[0]=v*n+x*s+b*h+w*m,t[1]=v*i+x*u+b*p+w*y,t[2]=v*o+x*l+b*f+w*_,t[3]=v*a+x*c+b*d+w*g,t[4]=(v=r[4])*n+(x=r[5])*s+(b=r[6])*h+(w=r[7])*m,t[5]=v*i+x*u+b*p+w*y,t[6]=v*o+x*l+b*f+w*_,t[7]=v*a+x*c+b*d+w*g,t[8]=(v=r[8])*n+(x=r[9])*s+(b=r[10])*h+(w=r[11])*m,t[9]=v*i+x*u+b*p+w*y,t[10]=v*o+x*l+b*f+w*_,t[11]=v*a+x*c+b*d+w*g,t[12]=(v=r[12])*n+(x=r[13])*s+(b=r[14])*h+(w=r[15])*m,t[13]=v*i+x*u+b*p+w*y,t[14]=v*o+x*l+b*f+w*_,t[15]=v*a+x*c+b*d+w*g,t},t.mvt=Ba,t.number=be,t.ortho=function(t,e,r,n,i,o,a){var s=1/(e-r),u=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(a+o)*l,t[15]=1,t},t.parseGlyphPBF=function(t){return new nu(t).readFields(bu,[])},t.pbf=nu,t.performSymbolLayout=function(t,e,r,n,o,a){t.createArrays(),t.tilePixelRatio=io/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,l={};if("composite"===t.textSizeData.kind){var c=t.textSizeData,h=c.maxZoom;l.compositeTextSizes=[u["text-size"].possiblyEvaluate(new On(c.minZoom)),u["text-size"].possiblyEvaluate(new On(h))]}if("composite"===t.iconSizeData.kind){var p=t.iconSizeData,f=p.maxZoom;l.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new On(p.minZoom)),u["icon-size"].possiblyEvaluate(new On(f))]}l.layoutTextSize=u["text-size"].possiblyEvaluate(new On(t.zoom+1)),l.layoutIconSize=u["icon-size"].possiblyEvaluate(new On(t.zoom+1)),l.textMaxSize=u["text-size"].possiblyEvaluate(new On(18));for(var d=s.get("text-line-height")*hs,m="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),y=s.get("text-keep-upright"),_=function(){var a=v[g],u=s.get("text-font").evaluate(a,{}).join(","),c=r,h={horizontal:{},vertical:void 0},p=a.text,f=[0,0];if(p){var _=p.toString(),x=s.get("text-letter-spacing").evaluate(a,{})*hs,b=function(t){for(var e=0,r=_;e<r.length;e+=1)if(!An(r[e].charCodeAt(0)))return!1;return!0}()?x:0,E=s.get("text-anchor").evaluate(a,{}),A=s.get("text-variable-anchor");if(!A){var T=s.get("text-radial-offset").evaluate(a,{});f=T?ml(E,[T*hs,dl]):s.get("text-offset").evaluate(a,{}).map(function(t){return t*hs})}var M=m?"center":s.get("text-justify").evaluate(a,{}),S=s.get("symbol-placement"),R="point"===S?s.get("text-max-width").evaluate(a,{})*hs:0,I=function(){t.allowVerticalPlacement&&En(_)&&(h.vertical=ds(p,e,u,R,d,E,"left",b,f,ps.vertical,!0,S))};if(!m&&A){for(var C="auto"===M?A.map(function(t){return yl(t)}):[M],P=!1,D=0;D<C.length;D++){var L=C[D];if(!h.horizontal[L])if(P)h.horizontal[L]=h.horizontal[0];else{var O=ds(p,e,u,R,d,"center",L,b,f,ps.horizontal,!1,S);O&&(h.horizontal[L]=O,P=1===O.lineCount)}}I()}else{"auto"===M&&(M=yl(E));var k=ds(p,e,u,R,d,E,M,b,f,ps.horizontal,!1,S);k&&(h.horizontal[M]=k),I(),En(_)&&m&&y&&(h.vertical=ds(p,e,u,R,d,E,M,b,f,ps.vertical,!1,S))}}var F=void 0;if(a.icon&&a.icon.name){var B=n[a.icon.name];B&&(F=function(t,e,r){var n=bs(r),i=e[0]-t.displaySize[0]*n.horizontalAlign,o=e[1]-t.displaySize[1]*n.verticalAlign;return{image:t,top:o,bottom:o+t.displaySize[1],left:i,right:i+t.displaySize[0]}}(o[a.icon.name],s.get("icon-offset").evaluate(a,{}),s.get("icon-anchor").evaluate(a,{})),void 0===t.sdfIcons?t.sdfIcons=B.sdf:t.sdfIcons!==B.sdf&&w("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),B.pixelRatio!==t.pixelRatio?t.iconsNeedLinear=!0:0!==s.get("icon-rotate").constantOr(1)&&(t.iconsNeedLinear=!0))}(Object.keys(h.horizontal).length||F)&&function(t,e,r,n,o,a,s){var u=a.layoutTextSize.evaluate(e,{}),l=a.layoutIconSize.evaluate(e,{}),c=a.textMaxSize.evaluate(e,{});void 0===c&&(c=u);var h=t.layers[0].layout,p=h.get("icon-offset").evaluate(e,{}),f=function(t){for(var e in t)return t[e];return null}(r.horizontal),d=u/24,m=t.tilePixelRatio*d,y=t.tilePixelRatio*c/24,_=t.tilePixelRatio*l,g=t.tilePixelRatio*h.get("symbol-spacing"),v=h.get("text-padding")*t.tilePixelRatio,x=h.get("icon-padding")*t.tilePixelRatio,b=h.get("text-max-angle")/180*Math.PI,E="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),A="map"===h.get("icon-rotation-alignment")&&"point"!==h.get("symbol-placement"),T=h.get("symbol-placement"),M=g/2,S=h.get("icon-text-fit");n&&"none"!==S&&f&&(n=function(t,e,r,n,i,o){var a,s,u,l,c=t.image,h=e.left*o,p=e.right*o;"width"===r||"both"===r?(l=i[0]+h-n[3],s=i[0]+p+n[1]):s=(l=i[0]+(h+p-c.displaySize[0])/2)+c.displaySize[0];var f=e.top*o,d=e.bottom*o;return"height"===r||"both"===r?(a=i[1]+f-n[0],u=i[1]+d+n[2]):u=(a=i[1]+(f+d-c.displaySize[1])/2)+c.displaySize[1],{image:c,top:a,right:s,bottom:u,left:l}}(n,f,S,h.get("icon-text-fit-padding"),p,d));var R=function(u,l){l.x<0||l.x>=io||l.y<0||l.y>=io||function(t,e,r,n,o,a,s,u,l,c,h,p,f,d,m,y,_,g,v,x,b){var E,A,T,M,S=t.addToLineVertexArray(e,r),R=0,I=0,C=0,P=-1,D={},L=hl(""),O=0,k=0;if(void 0===a._unevaluatedLayout.getValue("text-radial-offset")?(O=(E=a.layout.get("text-offset").evaluate(v,{}).map(function(t){return t*hs}))[0],k=E[1]):(O=a.layout.get("text-radial-offset").evaluate(v,{})*hs,k=dl),t.allowVerticalPlacement&&n.vertical){var F=a.layout.get("text-rotate").evaluate(v,{})+90;M=new nl(s,r,e,u,l,c,n.vertical,h,p,f,t.overscaling,F)}if(o){var B=a.layout.get("icon-rotate").evaluate(v,{}),N=function(t,e){var r=t.image,n=t.right-t.left,o=(n*r.paddedRect.w/(r.paddedRect.w-2)-n)/2,a=t.left-o,s=t.right+o,u=t.bottom-t.top,l=(u*r.paddedRect.h/(r.paddedRect.h-2)-u)/2,c=t.top-l,h=t.bottom+l,p=new i(a,c),f=new i(s,c),d=new i(s,h),m=new i(a,h),y=e*Math.PI/180;if(y){var _=Math.sin(y),g=Math.cos(y),v=[g,-_,_,g];p._matMult(v),f._matMult(v),m._matMult(v),d._matMult(v)}return[{tl:p,tr:f,bl:m,br:d,tex:r.paddedRect,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0}]}(o,B);T=new nl(s,r,e,u,l,c,o,m,y,!1,t.overscaling,B),R=4*N.length;var z=t.iconSizeData,U=null;"source"===z.kind?(U=[As*a.layout.get("icon-size").evaluate(v,{})])[0]>_l&&w(t.layerIds[0]+': Value for "icon-size" is >= 256. Reduce your "icon-size".'):"composite"===z.kind&&((U=[As*b.compositeIconSizes[0].evaluate(v,{}),As*b.compositeIconSizes[1].evaluate(v,{})])[0]>_l||U[1]>_l)&&w(t.layerIds[0]+': Value for "icon-size" is >= 256. Reduce your "icon-size".'),t.addSymbols(t.icon,N,U,g,_,v,!1,e,S.lineStartIndex,S.lineLength,-1),P=t.icon.placedSymbolArray.length-1}for(var V in n.horizontal){var j=n.horizontal[V];if(!A){L=hl(j.text);var G=a.layout.get("text-rotate").evaluate(v,{});A=new nl(s,r,e,u,l,c,j,h,p,f,t.overscaling,G)}var q=1===j.lineCount;if(I+=gl(t,e,j,a,f,v,d,S,n.vertical?ps.horizontal:ps.horizontalOnly,q?Object.keys(n.horizontal):[V],D,x,P,b),q)break}n.vertical&&(C+=gl(t,e,n.vertical,a,f,v,d,S,ps.vertical,["vertical"],D,x,P,b));var H=A?A.boxStartIndex:t.collisionBoxArray.length,X=A?A.boxEndIndex:t.collisionBoxArray.length,Y=M?M.boxStartIndex:t.collisionBoxArray.length,Z=M?M.boxEndIndex:t.collisionBoxArray.length,W=T?T.boxStartIndex:t.collisionBoxArray.length,K=T?T.boxEndIndex:t.collisionBoxArray.length;t.glyphOffsetArray.length>=ks.MAX_GLYPHS&&w("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),t.symbolInstances.emplaceBack(e.x,e.y,D.right>=0?D.right:-1,D.center>=0?D.center:-1,D.left>=0?D.left:-1,D.vertical||-1,P,L,H,X,Y,Z,W,K,u,I,C,R,0,h,O,k)}(t,l,u,r,n,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,m,v,E,s,_,x,A,p,e,o,a)};if("line"===T)for(var I=0,C=function(t,e,r,n,o){for(var a=[],s=0;s<t.length;s++)for(var u=t[s],l=void 0,c=0;c<u.length-1;c++){var h=u[c],p=u[c+1];h.x<0&&p.x<0||(h.x<0?h=new i(0,h.y+(0-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x<0&&(p=new i(0,h.y+(0-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y<0&&p.y<0||(h.y<0?h=new i(h.x+(0-h.y)/(p.y-h.y)*(p.x-h.x),0)._round():p.y<0&&(p=new i(h.x+(0-h.y)/(p.y-h.y)*(p.x-h.x),0)._round()),h.x>=n&&p.x>=n||(h.x>=n?h=new i(n,h.y+(n-h.x)/(p.x-h.x)*(p.y-h.y))._round():p.x>=n&&(p=new i(n,h.y+(n-h.x)/(p.x-h.x)*(p.y-h.y))._round()),h.y>=o&&p.y>=o||(h.y>=o?h=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round():p.y>=o&&(p=new i(h.x+(o-h.y)/(p.y-h.y)*(p.x-h.x),o)._round()),l&&h.equals(l[l.length-1])||a.push(l=[h]),l.push(p)))))}return a}(e.geometry,0,0,io,io);I<C.length;I+=1)for(var P=C[I],D=0,L=rl(P,g,b,r.vertical||f,n,24,y,t.overscaling,io);D<L.length;D+=1){var O=L[D];f&&vl(t,f.text,M,O)||R(P,O)}else if("line-center"===T)for(var k=0,F=e.geometry;k<F.length;k+=1){var B=F[k];if(B.length>1){var N=el(B,b,r.vertical||f,n,24,y);N&&R(B,N)}}else if("Polygon"===e.type)for(var z=0,U=xa(e.geometry,0);z<U.length;z+=1){var V=U[z],j=al(V,16);R(V[0],new Es(j.x,j.y,0))}else if("LineString"===e.type)for(var G=0,q=e.geometry;G<q.length;G+=1){var H=q[G];R(H,new Es(H[0].x,H[0].y,0))}else if("Point"===e.type)for(var X=0,Y=e.geometry;X<Y.length;X+=1)for(var Z=0,W=Y[X];Z<W.length;Z+=1){var K=W[Z];R([K],new Es(K.x,K.y,0))}}(t,a,h,F,c,l,f)},g=0,v=t.features;g<v.length;g+=1)_();a&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,r,n,i){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(o=1/(n-i)),t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t},t.pick=function(t,e){for(var r={},n=0;n<e.length;n++){var i=e[n];i in t&&(r[i]=t[i])}return r},t.plugin=Ln,t.polygonIntersectsPolygon=lo,t.postMapLoadEvent=et,t.postTurnstileEvent=$,t.potpack=Xs,t.rasterBoundsAttributes=ju,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=_n,t.registerForPluginAvailability=function(t){return Cn?t({pluginURL:Cn,completionCallback:Rn}):Dn.once("pluginAvailable",t),t},t.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=n*-s+o*u,t[3]=i*-s+a*u,t},t.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*n,t[5]=a*i+c*n,t[6]=s*i+h*n,t[7]=u*i+p*n,t[8]=l*i-o*n,t[9]=c*i-a*n,t[10]=h*i-s*n,t[11]=p*i-u*n,t},t.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*n,t[1]=a*i+c*n,t[2]=s*i+h*n,t[3]=u*i+p*n,t[4]=l*i-o*n,t[5]=c*i-a*n,t[6]=h*i-s*n,t[7]=p*i-u*n,t},t.scale=function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.setCacheLimits=function(t,e){nt=t,it=e},t.setRTLTextPlugin=function(t,e){if(In)throw new Error("setRTLTextPlugin cannot be called multiple times.");In=!0,Cn=O.resolveURL(t),Rn=function(t){t?(In=!1,Cn=null,e&&e(t)):Pn=!0},Dn.fire(new bt("pluginAvailable",{pluginURL:Cn,completionCallback:Rn}))},t.sphericalToCartesian=function(t){var e=t[0],r=t[1],n=t[2];return r+=90,r*=Math.PI/180,n*=Math.PI/180,{x:e*Math.cos(r)*Math.sin(n),y:e*Math.sin(r)*Math.sin(n),z:e*Math.cos(n)}},t.styleSpec=At,t.symbolSize=Rs,t.transformMat3=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t},t.transformMat4=Ro,t.translate=function(t,e,r){var n,i,o,a,s,u,l,c,h,p,f,d,m=r[0],y=r[1],_=r[2];return e===t?(t[12]=e[0]*m+e[4]*y+e[8]*_+e[12],t[13]=e[1]*m+e[5]*y+e[9]*_+e[13],t[14]=e[2]*m+e[6]*y+e[10]*_+e[14],t[15]=e[3]*m+e[7]*y+e[11]*_+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=n=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=n*m+s*y+h*_+e[12],t[13]=i*m+u*y+p*_+e[13],t[14]=o*m+l*y+f*_+e[14],t[15]=a*m+c*y+d*_+e[15]),t},t.uniqueId=f,t.validateCustomStyleLayer=function(t){var e=[],r=t.id;return void 0===r&&e.push({message:"layers."+r+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+r+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=un,t.validateStyle=sn,t.values=function(t){var e=[];for(var r in t)e.push(t[r]);return e},t.vectorTile=Ba,t.version="1.4.0",t.warnOnce=w,t.webpSupported=F,t.window=self,t.wrap=c}),n(0,function(t){function e(t){var r=typeof t;if("number"===r||"boolean"===r||"string"===r||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var n="[",i=0,o=t;i<o.length;i+=1)n+=e(o[i])+",";return n+"]"}for(var a=Object.keys(t).sort(),s="{",u=0;u<a.length;u++)s+=JSON.stringify(a[u])+":"+e(t[a[u]])+",";return s+"}"}function r(r){for(var n="",i=0,o=t.refProperties;i<o.length;i+=1)n+="/"+e(r[o[i]]);return n}var n=function(t){this.keyCache={},t&&this.replace(t)};n.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},n.prototype.update=function(e,n){for(var i=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var l=0,c=n;l<c.length;l+=1){var h=c[l];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var p=0,f=function(t,e){for(var n={},i=0;i<t.length;i++){var o=e&&e[t[i].id]||r(t[i]);e&&(e[t[i].id]=o);var a=n[o];a||(a=n[o]=[]),a.push(t[i])}var s=[];for(var u in n)s.push(n[u]);return s}(t.values(this._layerConfigs),this.keyCache);p<f.length;p+=1){var d=f[p].map(function(t){return i._layers[t.id]}),m=d[0];if("none"!==m.visibility){var y=m.source||"",_=this.familiesBySource[y];_||(_=this.familiesBySource[y]={});var g=m.sourceLayer||"_geojsonTileLayer",v=_[g];v||(v=_[g]=[]),v.push(d)}}};var i=function(e){var r={},n=[];for(var i in e){var o=e[i],a=r[i]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};n.push(l),a[s]={rect:l,metrics:u.metrics}}}}var c=t.potpack(n),h=new t.AlphaImage({width:c.w||1,height:c.h||1});for(var p in e){var f=e[p];for(var d in f){var m=f[+d];if(m&&0!==m.bitmap.width&&0!==m.bitmap.height){var y=r[p][d].rect;t.AlphaImage.copy(m.bitmap,h,{x:0,y:0},{x:y.x+1,y:y.y+1},m.bitmap)}}}this.image=h,this.positions=r};t.register("GlyphAtlas",i);var o=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies};function a(e,r,n){for(var i=new t.EvaluationParameters(r),o=0,a=e;o<a.length;o+=1)a[o].recalculate(i,n)}o.prototype.parse=function(e,r,n,o,s){var u=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var l=new t.DictionaryCoder(Object.keys(e.layers).sort()),c=new t.FeatureIndex(this.tileID);c.bucketLayerIDs=[];var h,p,f,d,m={},y={featureIndex:c,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:n},_=r.familiesBySource[this.source];for(var g in _){var v=e.layers[g];if(v){1===v.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+g+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var x=l.encode(g),b=[],w=0;w<v.length;w++){var E=v.feature(w);b.push({feature:E,index:w,sourceLayerIndex:x})}for(var A=0,T=_[g];A<T.length;A+=1){var M=T[A],S=M[0];S.minzoom&&this.zoom<Math.floor(S.minzoom)||S.maxzoom&&this.zoom>=S.maxzoom||"none"!==S.visibility&&(a(M,this.zoom,n),(m[S.id]=S.createBucket({index:c.bucketLayerIDs.length,layers:M,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:x,sourceID:this.source})).populate(b,y),c.bucketLayerIDs.push(M.map(function(t){return t.id})))}}}var R=t.mapObject(y.glyphDependencies,function(t){return Object.keys(t).map(Number)});Object.keys(R).length?o.send("getGlyphs",{uid:this.uid,stacks:R},function(t,e){h||(h=t,p=e,P.call(u))}):p={};var I=Object.keys(y.iconDependencies);I.length?o.send("getImages",{icons:I},function(t,e){h||(h=t,f=e,P.call(u))}):f={};var C=Object.keys(y.patternDependencies);function P(){if(h)return s(h);if(p&&f&&d){var e=new i(p),r=new t.ImageAtlas(f,d);for(var o in m){var u=m[o];u instanceof t.SymbolBucket?(a(u.layers,this.zoom,n),t.performSymbolLayout(u,p,e.positions,f,r.iconPositions,this.showCollisionBoxes)):u.hasPattern&&(u instanceof t.LineBucket||u instanceof t.FillBucket||u instanceof t.FillExtrusionBucket)&&(a(u.layers,this.zoom,n),u.addFeatures(y,r.patternPositions))}this.status="done",s(null,{buckets:t.values(m).filter(function(t){return!t.isEmpty()}),featureIndex:c,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:r,glyphMap:this.returnDependencies?p:null,iconMap:this.returnDependencies?f:null,glyphPositions:this.returnDependencies?e.positions:null})}}C.length?o.send("getImages",{icons:C},function(t,e){h||(h=t,d=e,P.call(u))}):d={},P.call(this)};var s="undefined"!=typeof performance,u={getEntriesByName:function(t){return!!(s&&performance&&performance.getEntriesByName)&&performance.getEntriesByName(t)},mark:function(t){return!!(s&&performance&&performance.mark)&&performance.mark(t)},measure:function(t,e,r){return!!(s&&performance&&performance.measure)&&performance.measure(t,e,r)},clearMarks:function(t){return!!(s&&performance&&performance.clearMarks)&&performance.clearMarks(t)},clearMeasures:function(t){return!!(s&&performance&&performance.clearMeasures)&&performance.clearMeasures(t)}},l=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},u.mark(this._marks.start)};function c(e,r){var n=t.getArrayBuffer(e.request,function(e,n,i,o){e?r(e):n&&r(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(n)),rawData:n,cacheControl:i,expires:o})});return function(){n.cancel(),r()}}l.prototype.finish=function(){u.mark(this._marks.end);var t=u.getEntriesByName(this._marks.measure);return 0===t.length&&(u.measure(this._marks.measure,this._marks.start,this._marks.end),t=u.getEntriesByName(this._marks.measure),u.clearMarks(this._marks.start),u.clearMarks(this._marks.end),u.clearMeasures(this._marks.measure)),t},u.Performance=l;var h=function(t,e,r,n){this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=n||c,this.loading={},this.loaded={}};h.prototype.loadTile=function(e,r){var n=this,i=e.uid;this.loading||(this.loading={});var a=!!(e&&e.request&&e.request.collectResourceTiming)&&new u.Performance(e.request),s=this.loading[i]=new o(e);s.abort=this.loadVectorData(e,function(e,o){if(delete n.loading[i],e||!o)return s.status="done",n.loaded[i]=s,r(e);var u=o.rawData,l={};o.expires&&(l.expires=o.expires),o.cacheControl&&(l.cacheControl=o.cacheControl);var c={};if(a){var h=a.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=o.vectorTile,s.parse(o.vectorTile,n.layerIndex,n.availableImages,n.actor,function(e,n){if(e||!n)return r(e);r(null,t.extend({rawTileData:u.slice(0)},n,l,c))}),n.loaded=n.loaded||{},n.loaded[i]=s})},h.prototype.reloadTile=function(t,e){var r=this,n=this.loaded,i=t.uid,o=this;if(n&&n[i]){var a=n[i];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,n){var i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,r.availableImages,o.actor,i)),e(t,n)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},h.prototype.abortTile=function(t,e){var r=this.loading,n=t.uid;r&&r[n]&&r[n].abort&&(r[n].abort(),delete r[n]),e()},h.prototype.removeTile=function(t,e){var r=this.loaded,n=t.uid;r&&r[n]&&delete r[n],e()};var p=function(){this.loaded={}};p.prototype.loadTile=function(e,r){var n=e.uid,i=new t.DEMData(n,e.rawImageData,e.encoding);this.loaded=this.loaded||{},this.loaded[n]=i,r(null,i)},p.prototype.removeTile=function(t){var e=this.loaded,r=t.uid;e&&e[r]&&delete e[r]};var f={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function d(t){var e=0;if(t&&t.length>0){e+=Math.abs(m(t[0]));for(var r=1;r<t.length;r++)e-=Math.abs(m(t[r]))}return e}function m(t){var e,r,n,i,o,a,s=0,u=t.length;if(u>2){for(a=0;a<u;a++)a===u-2?(n=u-2,i=u-1,o=0):a===u-1?(n=u-1,i=0,o=1):(n=a,i=a+1,o=a+2),e=t[n],r=t[i],s+=(y(t[o][0])-y(e[0]))*Math.sin(y(r[1]));s=s*f.RADIUS*f.RADIUS/2}return s}function y(t){return t*Math.PI/180}var _={geometry:function t(e){var r,n=0;switch(e.type){case"Polygon":return d(e.coordinates);case"MultiPolygon":for(r=0;r<e.coordinates.length;r++)n+=d(e.coordinates[r]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(r=0;r<e.geometries.length;r++)n+=t(e.geometries[r]);return n}},ring:m};function g(t,e){return function(r){return t(r,e)}}function v(t,e){t[0]=x(t[0],e=!!e);for(var r=1;r<t.length;r++)t[r]=x(t[r],!e);return t}function x(t,e){return function(t){return _.ring(t)>=0}(t)===e?t:t.reverse()}var b=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,w=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};w.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],r=0,n=this._feature.geometry;r<n.length;r+=1){var i=n[r];e.push([new t.Point$1(i[0],i[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var u=[],l=0,c=s[a];l<c.length;l+=1){var h=c[l];u.push(new t.Point$1(h[0],h[1]))}o.push(u)}return o},w.prototype.toGeoJSON=function(t,e,r){return b.call(this,t,e,r)};var E=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};E.prototype.feature=function(t){return new w(this._features[t])};var A=t.vectorTile.VectorTileFeature,T=M;function M(t,e){this.options=e||{},this.features=t,this.length=t.length}function S(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}M.prototype.feature=function(t){return new S(this.features[t],this.options.extent)},S.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var r=0;r<e.length;r++){for(var n=e[r],i=[],o=0;o<n.length;o++)i.push(new t.Point$1(n[o][0],n[o][1]));this.geometry.push(i)}return this.geometry},S.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,r=-1/0,n=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),r=Math.max(r,u.x),n=Math.min(n,u.y),i=Math.max(i,u.y)}return[e,n,r,i]},S.prototype.toGeoJSON=A.prototype.toGeoJSON;var R=C,I=T;function C(e){var r=new t.pbf;return function(t,e){for(var r in t.layers)e.writeMessage(3,P,t.layers[r])}(e,r),r.finish()}function P(t,e){var r;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<t.length;r++)n.feature=t.feature(r),e.writeMessage(2,D,n);var i=n.keys;for(r=0;r<i.length;r++)e.writeStringField(3,i[r]);var o=n.values;for(r=0;r<o.length;r++)e.writeMessage(4,B,o[r])}function D(t,e){var r=t.feature;void 0!==r.id&&e.writeVarintField(1,r.id),e.writeMessage(2,L,t),e.writeVarintField(3,r.type),e.writeMessage(4,F,r)}function L(t,e){var r=t.feature,n=t.keys,i=t.values,o=t.keycache,a=t.valuecache;for(var s in r.properties){var u=o[s];void 0===u&&(n.push(s),o[s]=u=n.length-1),e.writeVarint(u);var l=r.properties[s],c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var h=c+":"+l,p=a[h];void 0===p&&(i.push(l),a[h]=p=i.length-1),e.writeVarint(p)}}function O(t,e){return(e<<3)+(7&t)}function k(t){return t<<1^t>>31}function F(t,e){for(var r=t.loadGeometry(),n=t.type,i=0,o=0,a=r.length,s=0;s<a;s++){var u=r[s],l=1;1===n&&(l=u.length),e.writeVarint(O(1,l));for(var c=3===n?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==n&&e.writeVarint(O(2,c-1));var p=u[h].x-i,f=u[h].y-o;e.writeVarint(k(p)),e.writeVarint(k(f)),i+=p,o+=f}3===n&&e.writeVarint(O(7,1))}}function B(t,e){var r=typeof t;"string"===r?e.writeStringField(1,t):"boolean"===r?e.writeBooleanField(7,t):"number"===r&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function N(t,e,r,n){z(t,r,n),z(e,2*r,2*n),z(e,2*r+1,2*n+1)}function z(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function U(t,e,r,n){var i=t-r,o=e-n;return i*i+o*o}R.fromVectorTileJs=C,R.fromGeojsonVt=function(t,e){e=e||{};var r={};for(var n in t)r[n]=new T(t[n].features,e),r[n].name=n,r[n].version=e.version,r[n].extent=e.extent;return C({layers:r})},R.GeoJSONWrapper=I;var V=function(t){return t[0]},j=function(t){return t[1]},G=function(t,e,r,n,i){void 0===e&&(e=V),void 0===r&&(r=j),void 0===n&&(n=64),void 0===i&&(i=Float64Array),this.nodeSize=n,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=r(t[u]);!function t(e,r,n,i,o,a){if(!(o-i<=n)){var s=i+o>>1;!function t(e,r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(e,r,n,Math.max(i,Math.floor(n-u*c/s+h)),Math.min(o,Math.floor(n+(s-u)*c/s+h)),a)}var p=r[2*n+a],f=i,d=o;for(N(e,r,i,n),r[2*o+a]>p&&N(e,r,i,o);f<d;){for(N(e,r,f,d),f++,d--;r[2*f+a]<p;)f++;for(;r[2*d+a]>p;)d--}r[2*i+a]===p?N(e,r,i,d):N(e,r,++d,o),d<=n&&(i=d+1),n<=d&&(o=d-1)}}(e,r,s,i,o,a%2),t(e,r,n,i,s-1,a+1),t(e,r,n,s+1,o,a+1)}}(a,s,n,0,a.length-1,0)};G.prototype.range=function(t,e,r,n){return function(t,e,r,n,i,o,a){for(var s,u,l=[0,t.length-1,0],c=[];l.length;){var h=l.pop(),p=l.pop(),f=l.pop();if(p-f<=a)for(var d=f;d<=p;d++)u=e[2*d+1],(s=e[2*d])>=r&&s<=i&&u>=n&&u<=o&&c.push(t[d]);else{var m=Math.floor((f+p)/2);u=e[2*m+1],(s=e[2*m])>=r&&s<=i&&u>=n&&u<=o&&c.push(t[m]);var y=(h+1)%2;(0===h?r<=s:n<=u)&&(l.push(f),l.push(m-1),l.push(y)),(0===h?i>=s:o>=u)&&(l.push(m+1),l.push(p),l.push(y))}}return c}(this.ids,this.coords,t,e,r,n,this.nodeSize)},G.prototype.within=function(t,e,r){return function(t,e,r,n,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var l=a.pop(),c=a.pop(),h=a.pop();if(c-h<=o)for(var p=h;p<=c;p++)U(e[2*p],e[2*p+1],r,n)<=u&&s.push(t[p]);else{var f=Math.floor((h+c)/2),d=e[2*f],m=e[2*f+1];U(d,m,r,n)<=u&&s.push(t[f]);var y=(l+1)%2;(0===l?r-i<=d:n-i<=m)&&(a.push(h),a.push(f-1),a.push(y)),(0===l?r+i>=d:n+i>=m)&&(a.push(f+1),a.push(c),a.push(y))}}return s}(this.ids,this.coords,t,e,r,this.nodeSize)};var q={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1,reduce:null,map:function(t){return t}},H=function(t){this.options=Q(Object.create(q),t),this.trees=new Array(this.options.maxZoom+1)};function X(t,e,r,n,i){return{x:t,y:e,zoom:1/0,id:r,parentId:-1,numPoints:n,properties:i}}function Y(t,e){var r=t.geometry.coordinates,n=r[1];return{x:K(r[0]),y:J(n),zoom:1/0,index:e,parentId:-1}}function Z(t){return{type:"Feature",id:t.id,properties:W(t),geometry:{type:"Point",coordinates:[(n=t.x,360*(n-.5)),(e=t.y,r=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(r))/Math.PI-90)]}};var e,r,n}function W(t){var e=t.numPoints,r=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return Q(Q({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:r})}function K(t){return t/360+.5}function J(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function Q(t,e){for(var r in e)t[r]=e[r];return t}function $(t){return t.x}function tt(t){return t.y}function et(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var u=((t-r)*a+(e-n)*s)/(a*a+s*s);u>1?(r=i,n=o):u>0&&(r+=a*u,n+=s*u)}return(a=t-r)*a+(s=e-n)*s}function rt(t,e,r,n){var i={id:void 0===t?null:t,type:e,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)nt(t,e);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<e.length;n++)nt(t,e[n]);else if("MultiPolygon"===r)for(n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)nt(t,e[n][i])}(i),i}function nt(t,e){for(var r=0;r<e.length;r+=3)t.minX=Math.min(t.minX,e[r]),t.minY=Math.min(t.minY,e[r+1]),t.maxX=Math.max(t.maxX,e[r]),t.maxY=Math.max(t.maxY,e[r+1])}function it(t,e,r,n){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],u=e.id;if(r.promoteId?u=e.properties[r.promoteId]:r.generateId&&(u=n||0),"Point"===o)ot(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)ot(i[l],s);else if("LineString"===o)at(i,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(l=0;l<i.length;l++)at(i[l],s=[],a,!1),t.push(rt(u,"LineString",s,e.properties));return}st(i,s,a,!1)}else if("Polygon"===o)st(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)it(t,{id:u,geometry:e.geometry.geometries[l],properties:e.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];st(i[l],c,a,!0),s.push(c)}}t.push(rt(u,o,s,e.properties))}}function ot(t,e){e.push(ut(t[0])),e.push(lt(t[1])),e.push(0)}function at(t,e,r,n){for(var i,o,a=0,s=0;s<t.length;s++){var u=ut(t[s][0]),l=lt(t[s][1]);e.push(u),e.push(l),e.push(0),s>0&&(a+=n?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=e.length-3;e[2]=1,function t(e,r,n,i){for(var o,a=i,s=n-r>>1,u=n-r,l=e[r],c=e[r+1],h=e[n],p=e[n+1],f=r+3;f<n;f+=3){var d=et(e[f],e[f+1],l,c,h,p);if(d>a)o=f,a=d;else if(d===a){var m=Math.abs(f-s);m<u&&(o=f,u=m)}}a>i&&(o-r>3&&t(e,r,o,i),e[o+2]=a,n-o>3&&t(e,o,n,i))}(e,0,c,r),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function st(t,e,r,n){for(var i=0;i<t.length;i++){var o=[];at(t[i],o,r,n),e.push(o)}}function ut(t){return t/360+.5}function lt(t){var e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function ct(t,e,r,n,i,o,a,s){if(n/=e,o>=(r/=e)&&a<n)return t;if(a<r||o>=n)return null;for(var u=[],l=0;l<t.length;l++){var c=t[l],h=c.geometry,p=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=r&&d<n)u.push(c);else if(!(d<r||f>=n)){var m=[];if("Point"===p||"MultiPoint"===p)ht(h,m,r,n,i);else if("LineString"===p)pt(h,m,r,n,i,!1,s.lineMetrics);else if("MultiLineString"===p)dt(h,m,r,n,i,!1);else if("Polygon"===p)dt(h,m,r,n,i,!0);else if("MultiPolygon"===p)for(var y=0;y<h.length;y++){var _=[];dt(h[y],_,r,n,i,!0),_.length&&m.push(_)}if(m.length){if(s.lineMetrics&&"LineString"===p){for(y=0;y<m.length;y++)u.push(rt(c.id,p,m[y],c.tags));continue}"LineString"!==p&&"MultiLineString"!==p||(1===m.length?(p="LineString",m=m[0]):p="MultiLineString"),"Point"!==p&&"MultiPoint"!==p||(p=3===m.length?"Point":"MultiPoint"),u.push(rt(c.id,p,m,c.tags))}}}return u.length?u:null}function ht(t,e,r,n,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=r&&a<=n&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function pt(t,e,r,n,i,o,a){for(var s,u,l=ft(t),c=0===i?yt:_t,h=t.start,p=0;p<t.length-3;p+=3){var f=t[p],d=t[p+1],m=t[p+2],y=t[p+3],_=t[p+4],g=0===i?f:d,v=0===i?y:_,x=!1;a&&(s=Math.sqrt(Math.pow(f-y,2)+Math.pow(d-_,2))),g<r?v>r&&(u=c(l,f,d,y,_,r),a&&(l.start=h+s*u)):g>n?v<n&&(u=c(l,f,d,y,_,n),a&&(l.start=h+s*u)):mt(l,f,d,m),v<r&&g>=r&&(u=c(l,f,d,y,_,r),x=!0),v>n&&g<=n&&(u=c(l,f,d,y,_,n),x=!0),!o&&x&&(a&&(l.end=h+s*u),e.push(l),l=ft(t)),a&&(h+=s)}var b=t.length-3;f=t[b],d=t[b+1],m=t[b+2],(g=0===i?f:d)>=r&&g<=n&&mt(l,f,d,m),b=l.length-3,o&&b>=3&&(l[b]!==l[0]||l[b+1]!==l[1])&&mt(l,l[0],l[1],l[2]),l.length&&e.push(l)}function ft(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function dt(t,e,r,n,i,o){for(var a=0;a<t.length;a++)pt(t[a],e,r,n,i,o,!1)}function mt(t,e,r,n){t.push(e),t.push(r),t.push(n)}function yt(t,e,r,n,i,o){var a=(o-e)/(n-e);return t.push(o),t.push(r+(i-r)*a),t.push(1),a}function _t(t,e,r,n,i,o){var a=(o-r)/(i-r);return t.push(e+(n-e)*a),t.push(o),t.push(1),a}function gt(t,e){for(var r=[],n=0;n<t.length;n++){var i,o=t[n],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=vt(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(vt(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(vt(o.geometry[s][l],e));i.push(u)}r.push(rt(o.id,a,i,o.tags))}return r}function vt(t,e){var r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);for(var n=0;n<t.length;n+=3)r.push(t[n]+e,t[n+1],t[n+2]);return r}function xt(t,e){if(t.transformed)return t;var r,n,i,o=1<<t.z,a=t.x,s=t.y;for(r=0;r<t.features.length;r++){var u=t.features[r],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(n=0;n<l.length;n+=2)u.geometry.push(bt(l[n],l[n+1],e,o,a,s));else for(n=0;n<l.length;n++){var h=[];for(i=0;i<l[n].length;i+=2)h.push(bt(l[n][i],l[n][i+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function bt(t,e,r,n,i,o){return[Math.round(r*(t*n-i)),Math.round(r*(e*n-o))]}function wt(t,e,r,n,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,Et(a,t[s],o,i);var u=t[s].minX,l=t[s].minY,c=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),h>a.maxY&&(a.maxY=h)}return a}function Et(t,e,r,n){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)At(a,i,t,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)At(a,i[s],t,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)At(a,l[s],t,r,!0,0===s)}if(a.length){var c=e.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in c={},e.tags)c[h]=e.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==e.id&&(p.id=e.id),t.features.push(p)}}function At(t,e,r,n,i,o){var a=n*n;if(n>0&&e.size<(i?a:n))r.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===n||e[u+2]>a)&&(r.numSimplified++,s.push(e[u]),s.push(e[u+1])),r.numPoints++;i&&function(t,e){for(var r=0,n=0,i=t.length,o=i-2;n<i;o=n,n+=2)r+=(t[n]-t[o])*(t[n+1]+t[o+1]);if(r>0===e)for(n=0,i=t.length;n<i/2;n+=2){var a=t[n],s=t[n+1];t[n]=t[i-2-n],t[n+1]=t[i-1-n],t[i-2-n]=a,t[i-1-n]=s}}(s,o),t.push(s)}}function Tt(t,e){var r=(e=this.options=function(t,e){for(var r in e)t[r]=e[r];return t}(Object.create(this.options),e)).debug;if(r&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(t,e){var r=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)it(r,t.features[n],e,n);else it(r,"Feature"===t.type?t:{geometry:t},e);return r}(t,e);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(t,e){var r=e.buffer/e.extent,n=t,i=ct(t,1,-1-r,r,0,-1,2,e),o=ct(t,1,1-r,2+r,0,-1,2,e);return(i||o)&&(n=ct(t,1,-r,1+r,0,-1,2,e)||[],i&&(n=gt(i,1).concat(n)),o&&(n=n.concat(gt(o,-1)))),n}(n,e)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Mt(t,e,r){return 32*((1<<t)*r+e)+t}function St(t,e){var r=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return e(null,null);var i=new E(n.features),o=R(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}H.prototype.load=function(t){var e=this.options,r=e.log,n=e.minZoom,i=e.maxZoom,o=e.nodeSize;r&&console.time("total time");var a="prepare "+t.length+" points";r&&console.time(a),this.points=t;for(var s=[],u=0;u<t.length;u++)t[u].geometry&&s.push(Y(t[u],u));this.trees[i+1]=new G(s,$,tt,o,Float32Array),r&&console.timeEnd(a);for(var l=i;l>=n;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new G(s,$,tt,o,Float32Array),r&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return r&&console.timeEnd("total time"),this},H.prototype.getClusters=function(t,e){var r=((t[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)r=-180,i=180;else if(r>i){var a=this.getClusters([r,n,180,o],e),s=this.getClusters([-180,n,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],l=[],c=0,h=u.range(K(r),J(o),K(i),J(n));c<h.length;c+=1){var p=u.points[h[c]];l.push(p.numPoints?Z(p):this.points[p.index])}return l},H.prototype.getChildren=function(t){var e=t>>5,r=t%32,n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);var o=i.points[e];if(!o)throw new Error(n);for(var a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=i.points[l[u]];c.parentId===t&&s.push(c.numPoints?Z(c):this.points[c.index])}if(0===s.length)throw new Error(n);return s},H.prototype.getLeaves=function(t,e,r){var n=[];return this._appendLeaves(n,t,e=e||10,r=r||0,0),n},H.prototype.getTile=function(t,e,r){var n=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(r-a)/i,u=(r+1+a)/i,l={features:[]};return this._addTileFeatures(n.range((e-a)/i,s,(e+1+a)/i,u),n.points,e,r,i,l),0===e&&this._addTileFeatures(n.range(1-a/i,s,1,u),n.points,i,r,i,l),e===i-1&&this._addTileFeatures(n.range(0,s,a/i,u),n.points,-1,r,i,l),l.features.length?l:null},H.prototype.getClusterExpansionZoom=function(t){for(var e=t%32-1;e<=this.options.maxZoom;){var r=this.getChildren(t);if(e++,1!==r.length)break;t=r[0].properties.cluster_id}return e},H.prototype._appendLeaves=function(t,e,r,n,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=n?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,r,n,i):i<n?i++:t.push(s),t.length===r)break}return i},H.prototype._addTileFeatures=function(t,e,r,n,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],l={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-r)),Math.round(this.options.extent*(u.y*i-n))]],tags:u.numPoints?W(u):this.points[u.index].properties},c=u.numPoints?u.id:this.points[u.index].id;void 0!==c&&(l.id=c),o.features.push(l)}},H.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},H.prototype._cluster=function(t,e){for(var r=[],n=this.options,i=n.reduce,o=n.radius/(n.extent*Math.pow(2,e)),a=0;a<t.length;a++){var s=t[a];if(!(s.zoom<=e)){s.zoom=e;for(var u=this.trees[e+1],l=u.within(s.x,s.y,o),c=s.numPoints||1,h=s.x*c,p=s.y*c,f=i&&c>1?this._map(s,!0):null,d=(a<<5)+(e+1),m=0,y=l;m<y.length;m+=1){var _=u.points[y[m]];if(!(_.zoom<=e)){_.zoom=e;var g=_.numPoints||1;h+=_.x*g,p+=_.y*g,c+=g,_.parentId=d,i&&(f||(f=this._map(s,!0)),i(f,this._map(_)))}}1===c?r.push(s):(s.parentId=d,r.push(X(h/c,p/c,d,c,f)))}}return r},H.prototype._map=function(t,e){if(t.numPoints)return e?Q({},t.properties):t.properties;var r=this.points[t.index].properties,n=this.options.map(r);return e&&n===r?Q({},n):n},Tt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Tt.prototype.splitTile=function(t,e,r,n,i,o,a){for(var s=[t,e,r,n],u=this.options,l=u.debug;s.length;){n=s.pop(),r=s.pop(),e=s.pop(),t=s.pop();var c=1<<e,h=Mt(e,r,n),p=this.tiles[h];if(!p&&(l>1&&console.time("creation"),p=this.tiles[h]=wt(t,e,r,n,u),this.tileCoords.push({z:e,x:r,y:n}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,r,n,p.numFeatures,p.numPoints,p.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(p.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(r!==Math.floor(o/d)||n!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||p.numPoints<=u.indexMaxPoints)continue;if(p.source=null,0!==t.length){l>1&&console.time("clipping");var m,y,_,g,v,x,b=.5*u.buffer/u.extent,w=.5-b,E=.5+b,A=1+b;m=y=_=g=null,v=ct(t,c,r-b,r+E,0,p.minX,p.maxX,u),x=ct(t,c,r+w,r+A,0,p.minX,p.maxX,u),t=null,v&&(m=ct(v,c,n-b,n+E,1,p.minY,p.maxY,u),y=ct(v,c,n+w,n+A,1,p.minY,p.maxY,u),v=null),x&&(_=ct(x,c,n-b,n+E,1,p.minY,p.maxY,u),g=ct(x,c,n+w,n+A,1,p.minY,p.maxY,u),x=null),l>1&&console.timeEnd("clipping"),s.push(m||[],e+1,2*r,2*n),s.push(y||[],e+1,2*r,2*n+1),s.push(_||[],e+1,2*r+1,2*n),s.push(g||[],e+1,2*r+1,2*n+1)}}},Tt.prototype.getTile=function(t,e,r){var n=this.options,i=n.extent,o=n.debug;if(t<0||t>24)return null;var a=1<<t,s=Mt(t,e=(e%a+a)%a,r);if(this.tiles[s])return xt(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,r);for(var u,l=t,c=e,h=r;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[Mt(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,t,e,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?xt(this.tiles[s],i):null):null};var Rt=function(e){function r(t,r,n,i){e.call(this,t,r,n,St),i&&(this.loadGeoJSON=i)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},r.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var r=this._pendingCallback,n=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(n&&n.request&&n.request.collectResourceTiming)&&new u.Performance(n.request);this.loadGeoJSON(n,function(o,a){if(o||!a)return r(o);if("object"!=typeof a)return r(new Error("Input data given to '"+n.source+"' is not a valid GeoJSON object."));!function t(e,r){switch(e&&e.type||null){case"FeatureCollection":return e.features=e.features.map(g(t,r)),e;case"GeometryCollection":return e.geometries=e.geometries.map(g(t,r)),e;case"Feature":return e.geometry=t(e.geometry,r),e;case"Polygon":case"MultiPolygon":return function(t,e){return"Polygon"===t.type?t.coordinates=v(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(g(v,e))),t}(e,r);default:return e}}(a,!0);try{e._geoJSONIndex=n.cluster?new H(function(e){var r=e.superclusterOptions,n=e.clusterProperties;if(!n||!r)return r;for(var i={},o={},a={accumulated:null,zoom:0},s={properties:null},u=Object.keys(n),l=0,c=u;l<c.length;l+=1){var h=c[l],p=n[h],f=p[0],d=t.createExpression(p[1]),m=t.createExpression("string"==typeof f?[f,["accumulated"],["get",h]]:f);i[h]=d.value,o[h]=m.value}return r.map=function(t){s.properties=t;for(var e={},r=0,n=u;r<n.length;r+=1){var o=n[r];e[o]=i[o].evaluate(a,s)}return e},r.reduce=function(t,e){s.properties=e;for(var r=0,n=u;r<n.length;r+=1){var i=n[r];a.accumulated=t[i],t[i]=o[i].evaluate(a,s)}},r}(n)).load(a.features):new Tt(a,n.geojsonVtOptions)}catch(o){return r(o)}e.loaded={};var s={};if(i){var u=i.finish();u&&(s.resourceTiming={},s.resourceTiming[n.source]=JSON.parse(JSON.stringify(u)))}r(null,s)})}},r.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},r.prototype.reloadTile=function(t,r){var n=this.loaded;return n&&n[t.uid]?e.prototype.reloadTile.call(this,t,r):this.loadTile(t,r)},r.prototype.loadGeoJSON=function(e,r){if(e.request)t.getJSON(e.request,r);else{if("string"!=typeof e.data)return r(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return r(null,JSON.parse(e.data))}catch(t){return r(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},r.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},r.prototype.getClusterExpansionZoom=function(t,e){e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))},r.prototype.getClusterChildren=function(t,e){e(null,this._geoJSONIndex.getChildren(t.clusterId))},r.prototype.getClusterLeaves=function(t,e){e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))},r}(h),It=function(e){var r=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:h,geojson:Rt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(r.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');r.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isLoaded())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return It.prototype.setReferrer=function(t,e){this.referrer=e},It.prototype.setImages=function(t,e,r){this.availableImages[t]=e,r()},It.prototype.setLayers=function(t,e,r){this.getLayerIndex(t).replace(e),r()},It.prototype.updateLayers=function(t,e,r){this.getLayerIndex(t).update(e.layers,e.removedIds),r()},It.prototype.loadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).loadTile(e,r)},It.prototype.loadDEMTile=function(t,e,r){this.getDEMWorkerSource(t,e.source).loadTile(e,r)},It.prototype.reloadTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).reloadTile(e,r)},It.prototype.abortTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).abortTile(e,r)},It.prototype.removeTile=function(t,e,r){this.getWorkerSource(t,e.type,e.source).removeTile(e,r)},It.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},It.prototype.removeSource=function(t,e,r){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var n=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==n.removeSource?n.removeSource(e,r):r()}},It.prototype.loadWorkerSource=function(t,e,r){try{this.self.importScripts(e.url),r()}catch(t){r(t.toString())}},It.prototype.loadRTLTextPlugin=function(e,r,n){try{t.plugin.isLoaded()||(this.self.importScripts(r),n(t.plugin.isLoaded()?null:new Error("RTL Text Plugin failed to import scripts from "+r)))}catch(t){n(t.toString())}},It.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},It.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new n),e},It.prototype.getWorkerSource=function(t,e,r){var n=this;(this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][r])||(this.workerSources[t][e][r]=new this.workerSourceTypes[e]({send:function(e,r,i){n.actor.send(e,r,i,t)}},this.getLayerIndex(t),this.getAvailableImages(t)));return this.workerSources[t][e][r]},It.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new p),this.demWorkerSources[t][e]},It.prototype.enforceCacheSizeLimit=function(e,r){t.enforceCacheSizeLimit(r)},"undefined"!=typeof WorkerGlobalScope&&void 0!==t.window&&t.window instanceof WorkerGlobalScope&&(t.window.worker=new It(t.window)),It}),n(0,function(t){var e=t.createCommonjsModule(function(t){function e(t){return!!("undefined"!=typeof window&&"undefined"!=typeof document&&Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray&&Function.prototype&&Function.prototype.bind&&Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions&&"JSON"in window&&"parse"in JSON&&"stringify"in JSON&&function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,r=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(r);try{e=new Worker(n),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(n),t}()&&"Uint8ClampedArray"in window&&ArrayBuffer.isView&&function(t){return void 0===r[t]&&(r[t]=function(t){var r=document.createElement("canvas"),n=Object.create(e.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,r.probablySupportsContext?r.probablySupportsContext("webgl",n)||r.probablySupportsContext("experimental-webgl",n):r.supportsContext?r.supportsContext("webgl",n)||r.supportsContext("experimental-webgl",n):r.getContext("webgl",n)||r.getContext("experimental-webgl",n)}(t)),r[t]}(t&&t.failIfMajorPerformanceCaveat))}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e);var r={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),r={create:function(e,r,n){var i=t.window.document.createElement(e);return void 0!==r&&(i.className=r),n&&n.appendChild(i),i},createNS:function(e,r){return t.window.document.createElementNS(e,r)}},n=t.window.document.documentElement.style;function i(t){if(!n)return t[0];for(var e=0;e<t.length;e++)if(t[e]in n)return t[e];return t[0]}var o,a=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);r.disableDrag=function(){n&&a&&(o=n[a],n[a]="none")},r.enableDrag=function(){n&&a&&(n[a]=o)};var s=i(["transform","WebkitTransform"]);r.setTransform=function(t,e){t.style[s]=e};var u=!1;try{var l=Object.defineProperty({},"passive",{get:function(){u=!0}});t.window.addEventListener("test",l,l),t.window.removeEventListener("test",l,l)}catch(t){u=!1}r.addEventListener=function(t,e,r,n){void 0===n&&(n={}),t.addEventListener(e,r,"passive"in n&&u?n:n.capture)},r.removeEventListener=function(t,e,r,n){void 0===n&&(n={}),t.removeEventListener(e,r,"passive"in n&&u?n:n.capture)};var c=function(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",c,!0)};function h(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}r.suppressClick=function(){t.window.addEventListener("click",c,!0),t.window.setTimeout(function(){t.window.removeEventListener("click",c,!0)},0)},r.mousePos=function(e,r){var n=e.getBoundingClientRect(),i=t.window.TouchEvent&&r instanceof t.window.TouchEvent?r.touches[0]:r;return new t.Point(i.clientX-n.left-e.clientLeft,i.clientY-n.top-e.clientTop)},r.touchPos=function(e,r){for(var n=e.getBoundingClientRect(),i=[],o="touchend"===r.type?r.changedTouches:r.touches,a=0;a<o.length;a++)i.push(new t.Point(o[a].clientX-n.left-e.clientLeft,o[a].clientY-n.top-e.clientTop));return i},r.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},r.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function r(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.isLoaded=function(){return this.loaded},r.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,r=this.requestors;e<r.length;e+=1){var n=r[e];this._notify(n.ids,n.callback)}this.requestors=[]}},r.prototype.getImage=function(t){return this.images[t]},r.prototype.addImage=function(t,e){this.images[t]=e},r.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},r.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},r.prototype.listImages=function(){return Object.keys(this.images)},r.prototype.getImages=function(t,e){var r=!0;if(!this.isLoaded())for(var n=0,i=t;n<i.length;n+=1){this.images[i[n]]||(r=!1)}this.isLoaded()||r?this._notify(t,e):this.requestors.push({ids:t,callback:e})},r.prototype._notify=function(e,r){for(var n={},i=0,o=e;i<o.length;i+=1){var a=o[i];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?n[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}r(null,n)},r.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},r.prototype.getPattern=function(e){var r=this.patterns[e],n=this.getImage(e);if(!n)return null;if(r&&r.position.version===n.version)return r.position;if(r)r.position.version=n.version;else{var i={w:n.data.width+2,h:n.data.height+2,x:0,y:0},o=new t.ImagePosition(i,n);this.patterns[e]={bin:i,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},r.prototype.bind=function(e){var r=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,r.RGBA),this.atlasTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)},r.prototype._updatePatternAtlas=function(){var e=[];for(var r in this.patterns)e.push(this.patterns[r].bin);var n=t.potpack(e),i=n.w,o=n.h,a=this.atlasImage;for(var s in a.resize({width:i||1,height:o||1}),this.patterns){var u=this.patterns[s].bin,l=u.x+1,c=u.y+1,h=this.images[s].data,p=h.width,f=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c},{width:p,height:f}),t.RGBAImage.copy(h,a,{x:0,y:f-1},{x:l,y:c-1},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:l,y:c+f},{width:p,height:1}),t.RGBAImage.copy(h,a,{x:p-1,y:0},{x:l-1,y:c},{width:1,height:f}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:l+p,y:c},{width:1,height:f})}this.dirty=!0},r.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},r.prototype.dispatchRenderCallbacks=function(t){for(var e=0,r=t;e<r.length;e+=1){var n=r[e];if(!this.callbackDispatchedThisFrame[n]){this.callbackDispatchedThisFrame[n]=!0;var i=this.images[n];h(i)&&this.updateImage(n,i)}}},r}(t.Evented),f=y,d=y,m=1e20;function y(t,e,r,n,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=n||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=r||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function _(t,e,r,n,i,o,a){for(var s=0;s<e;s++){for(var u=0;u<r;u++)n[u]=t[u*e+s];for(g(n,i,o,a,r),u=0;u<r;u++)t[u*e+s]=i[u]}for(u=0;u<r;u++){for(s=0;s<e;s++)n[s]=t[u*e+s];for(g(n,i,o,a,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(i[s])}}function g(t,e,r,n,i){r[0]=0,n[0]=-m,n[1]=+m;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[r[a]]+r[a]*r[a]))/(2*o-2*r[a]);s<=n[a];)s=(t[o]+o*o-(t[r[--a]]+r[a]*r[a]))/(2*o-2*r[a]);r[++a]=o,n[a]=s,n[a+1]=+m}for(o=0,a=0;o<i;o++){for(;n[a+1]<o;)a++;e[o]=(o-r[a])*(o-r[a])+t[r[a]]}}y.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),r=new Uint8ClampedArray(this.size*this.size),n=0;n<this.size*this.size;n++){var i=e.data[4*n+3]/255;this.gridOuter[n]=1===i?0:0===i?m:Math.pow(Math.max(0,.5-i),2),this.gridInner[n]=1===i?m:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(_(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),_(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),n=0;n<this.size*this.size;n++){r[n]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[n]-this.gridInner[n])/this.radius+this.cutoff))))}return r},f.default=d;var v=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};v.prototype.setURL=function(t){this.url=t},v.prototype.getGlyphs=function(e,r){var n=this,i=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1){i.push({stack:o,id:s[a]})}t.asyncAll(i,function(t,e){var r=t.stack,i=t.id,o=n.entries[r];o||(o=n.entries[r]={glyphs:{},requests:{}});var a=o.glyphs[i];if(void 0===a){if(a=n._tinySDF(o,r,i))return o.glyphs[i]=a,void e(null,{stack:r,id:i,glyph:a});var s=Math.floor(i/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else{var u=o.requests[s];u||(u=o.requests[s]=[],v.loadGlyphRange(r,s,n.url,n.requestManager,function(t,e){if(e)for(var r in e)n._doesCharSupportLocalGlyph(+r)||(o.glyphs[+r]=e[+r]);for(var i=0,a=u;i<a.length;i+=1)(0,a[i])(t,e);delete o.requests[s]})),u.push(function(t,n){t?e(t):n&&e(null,{stack:r,id:i,glyph:n[i]||null})})}}else e(null,{stack:r,id:i,glyph:a})},function(t,e){if(t)r(t);else if(e){for(var n={},i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.stack,u=a.id,l=a.glyph;(n[s]||(n[s]={}))[u]=l&&{id:l.id,bitmap:l.bitmap.clone(),metrics:l.metrics}}r(null,n)}})},v.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},v.prototype._tinySDF=function(e,r,n){var i=this.localIdeographFontFamily;if(i&&this._doesCharSupportLocalGlyph(n)){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(r)?a="900":/medium/i.test(r)?a="500":/light/i.test(r)&&(a="200"),o=e.tinySDF=new v.TinySDF(24,3,8,.25,i,a)}return{id:n,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(n))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},v.loadGlyphRange=function(e,r,n,i,o){var a=256*r,s=a+255,u=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,function(e,r){if(e)o(e);else if(r){for(var n={},i=0,a=t.parseGlyphPBF(r);i<a.length;i+=1){var s=a[i];n[s.id]=s}o(null,n)}})},v.TinySDF=f;var x=function(){this.specification=t.styleSpec.light.position};x.prototype.possiblyEvaluate=function(e,r){return t.sphericalToCartesian(e.expression.evaluate(r))},x.prototype.interpolate=function(e,r,n){return{x:t.number(e.x,r.x,n),y:t.number(e.y,r.y,n),z:t.number(e.z,r.z,n)}};var b=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new x,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),w=function(e){function r(r){e.call(this),this._transitionable=new t.Transitionable(b),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getLight=function(){return this._transitionable.serialize()},r.prototype.setLight=function(e,r){if(void 0===r&&(r={}),!this._validate(t.validateLight,e,r))for(var n in e){var i=e[n];t.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-"-transition".length),i):this._transitionable.setValue(n,i)}},r.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},r.prototype.hasTransition=function(){return this._transitioning.hasTransition()},r.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},r.prototype._validate=function(e,r,n){return(!n||!1!==n.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:r,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},r}(t.Evented),E=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};E.prototype.getDash=function(t,e){var r=t.join(",")+String(e);return this.positions[r]||(this.positions[r]=this.addDash(t,e)),this.positions[r]},E.prototype.addDash=function(e,r){var n=r?7:0,i=2*n+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];for(var s=this.width/o,u=s/2,l=e.length%2==1,c=-n;c<=n;c++)for(var h=this.width*(this.nextRow+n+c),p=l?-e[e.length-1]:0,f=e[0],d=1,m=0;m<this.width;m++){for(;f<m/s;)p=f,f+=e[d],l&&d===e.length-1&&(f+=e[0]),d++;var y=Math.abs(m-p*s),_=Math.abs(m-f*s),g=Math.min(y,_),v=d%2==1,x=void 0;if(r){var b=n?c/n*(u+1):0;if(v){var w=u-Math.abs(b);x=Math.sqrt(g*g+w*w)}else x=u-Math.sqrt(g*g+b*b)}else x=(v?1:-1)*g;this.data[3+4*(h+m)]=Math.max(0,Math.min(255,x+128))}var E={y:(this.nextRow+n+.5)/this.height,height:2*n/this.height,width:o};return this.nextRow+=i,this.dirty=!0,E},E.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,this.data))};var A=function e(r,n){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=new e.Actor(i[o],n,this.id);a.name="Worker "+o,this.actors.push(a)}};function T(e,r,n){var i=function(i,o){if(i)return n(i);if(o){var a=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map(function(t){return t.id})),e.url&&(a.tiles=r.canonicalizeTileset(a,e.url)),n(null,a)}};return e.url?t.getJSON(r.transformRequest(r.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame(function(){return i(null,e)})}A.prototype.broadcast=function(e,r,n){t.asyncAll(this.actors,function(t,n){t.send(e,r,n)},n=n||function(){})},A.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},A.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},A.Actor=t.Actor;var M=function(e,r,n){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=r||0,this.maxzoom=n||24};M.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},M.prototype.contains=function(e){var r=Math.pow(2,e.z),n=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*r),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*r),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*r),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*r);return e.x>=n&&e.x<o&&e.y>=i&&e.y<a};var S=function(e){function r(r,n,i,o){if(e.call(this),this.id=r,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(n,["url","scheme","tileSize"])),this._options=t.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,function(r,n){e._tileJSONRequest=null,e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new M(n.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(n.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(n.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})},r.prototype.loaded=function(){return this._loaded},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.loadTile=function(e,r){var n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,null),i={request:this.map._requestManager.transformRequest(n,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes};function o(n,i){return delete e.request,e.aborted?r(null):n&&404!==n.status?r(n):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=r:e.request=e.actor.send("reloadTile",i,o.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,o.bind(this)))},r.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},r.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},r.prototype.hasTransition=function(){return!1},r}(t.Evented),R=function(e){function r(r,n,i,o){e.call(this),this.id=r,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},n),t.extend(this,t.pick(n,["url","scheme","tileSize"]))}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,function(r,n){e._tileJSONRequest=null,e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):n&&(t.extend(e,n),n.bounds&&(e.tileBounds=new M(n.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(n.tiles),t.postMapLoadEvent(n.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})},r.prototype.loaded=function(){return this._loaded},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},r.prototype.serialize=function(){return t.extend({},this._options)},r.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},r.prototype.loadTile=function(e,r){var n=this,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),function(i,o){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(i)e.state="errored",r(i);else if(o){n.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=n.map.painter.context,s=a.gl;e.texture=n.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(n.dispatcher),r(null)}})},r.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},r.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},r.prototype.hasTransition=function(){return!1},r}(t.Evented),I=function(e){function r(r,n,i,o){e.call(this,r,n,i,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},r.prototype.loadTile=function(e,r){var n=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.url,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(n,t.ResourceType.Tile),function(n,i){if(delete e.request,e.aborted)e.state="unloaded",r(null);else if(n)e.state="errored",r(n);else if(i){this.map._refreshExpiredTiles&&e.setExpiryData(i),delete i.cacheControl,delete i.expires;var o=t.browser.getImageData(i,1),a={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:o,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",a,function(t,n){t&&(e.state="errored",r(t)),n&&(e.dem=n,e.needsHillshadePrepare=!0,e.state="loaded",r(null))}.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},r.prototype._getNeighboringTiles=function(e){var r=e.canonical,n=Math.pow(2,r.z),i=(r.x-1+n)%n,o=0===r.x?e.wrap-1:e.wrap,a=(r.x+1+n)%n,s=r.x+1===n?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y).key]={backfilled:!1},r.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y-1).key]={backfilled:!1}),r.y+1<n&&(u[new t.OverscaledTileID(e.overscaledZ,o,r.z,i,r.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,r.z,a,r.y+1).key]={backfilled:!1}),u},r.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},r}(R),C=function(e){function r(r,n,i,o){e.call(this),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=n.data,this._options=t.extend({},n),this._collectResourceTiming=n.collectResourceTiming,this._resourceTiming=[],void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution);var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*a,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?Math.min(n.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,extent:t.EXTENT,radius:(n.clusterRadius||50)*a,log:!1},clusterProperties:n.clusterProperties},n.workerOptions)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(r){if(r)e.fire(new t.ErrorEvent(r));else{var n={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(n.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",n))}})},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setData=function(e){var r=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(e){if(e)r.fire(new t.ErrorEvent(e));else{var n={dataType:"source",sourceDataType:"content"};r._collectResourceTiming&&r._resourceTiming&&r._resourceTiming.length>0&&(n.resourceTiming=r._resourceTiming,r._resourceTiming=[]),r.fire(new t.Event("data",n))}}),this},r.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},r.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},r.prototype.getClusterLeaves=function(t,e,r,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:r},n),this},r.prototype._updateWorkerData=function(e){var r=this;this._loaded=!1;var n=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(n.request=this.map._requestManager.transformRequest(t.browser.resolveURL(i),t.ResourceType.Source),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(i),this.actor.send(this.type+".loadData",n,function(t,i){r._removed||i&&i.abandoned||(r._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[r.id]&&(r._resourceTiming=i.resourceTiming[r.id].slice(0)),r.actor.send(r.type+".coalesce",{source:n.source},null),e(t))})},r.prototype.loaded=function(){return this._loaded},r.prototype.loadTile=function(e,r){var n=this,i=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(i,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes},function(t,o){return delete e.request,e.unloadVectorData(),e.aborted?r(null):t?r(t):(e.loadVectorData(o,n.map.painter,"reloadTile"===i),r(null))})},r.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},r.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},r.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},r.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},r.prototype.hasTransition=function(){return!1},r}(t.Evented),P=function(e){function r(t,r,n,i){e.call(this),this.id=t,this.dispatcher=n,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=r}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(e,r){var n=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),function(i,o){n._loaded=!0,i?n.fire(new t.ErrorEvent(i)):o&&(n.image=o,e&&(n.coordinates=e),r&&r(),n._finishLoading())})},r.prototype.loaded=function(){return this._loaded},r.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,function(){e.texture=null}),this):this},r.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},r.prototype.onAdd=function(t){this.map=t,this.load()},r.prototype.setCoordinates=function(e){var r=this;this.coordinates=e;var n=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var r=1/0,n=1/0,i=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var u=s[a];r=Math.min(r,u.x),n=Math.min(n,u.y),i=Math.max(i,u.x),o=Math.max(o,u.y)}var l=Math.max(i-r,o-n),c=Math.max(0,Math.floor(-Math.log(l)/Math.LN2)),h=Math.pow(2,c);return new t.CanonicalTileID(c,Math.floor((r+i)/2*h),Math.floor((n+o)/2*h))}(n),this.minzoom=this.maxzoom=this.tileID.z;var i=n.map(function(t){return r.tileID.getTilePoint(t)._round()});return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},r.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,r=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},r.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},r.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return!1},r}(t.Evented),D=function(e){function r(t,r,n,i){e.call(this,t,r,n,i),this.roundZoom=!0,this.type="video",this.options=r}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){var e=this;this._loaded=!1;var r=this.options;this.urls=[];for(var n=0,i=r.urls;n<i.length;n+=1){this.urls.push(this.map._requestManager.transformRequest(i[n],t.ResourceType.Source).url)}t.getVideo(this.urls,function(r,n){e._loaded=!0,r?e.fire(new t.ErrorEvent(r)):n&&(e.video=n,e.video.loop=!0,e.video.addEventListener("playing",function(){e.map.triggerRepaint()}),e.map&&e.video.play(),e._finishLoading())})},r.prototype.pause=function(){this.video&&this.video.pause()},r.prototype.play=function(){this.video&&this.video.play()},r.prototype.seek=function(e){if(this.video){var r=this.video.seekable;e<r.start(0)||e>r.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("Playback for this video can be set only between the "+r.start(0)+" and "+r.end(0)+"-second mark."))):this.video.currentTime=e}},r.prototype.getVideo=function(){return this.video},r.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},r.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,r=e.gl;for(var n in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[n];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this.video&&!this.video.paused},r}(P),L=function(e){function r(r,n,i,o){e.call(this,r,n,i,o),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(function(t){return!Array.isArray(t)||2!==t.length||t.some(function(t){return"number"!=typeof t})})||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+r,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},r.prototype.getCanvas=function(){return this.canvas},r.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},r.prototype.onRemove=function(){this.pause()},r.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var r=this.map.painter.context,n=r.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,t.rasterBoundsAttributes.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(r,this.canvas,n.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},r.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},r.prototype.hasTransition=function(){return this._playing},r.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var r=e[t];if(isNaN(r)||r<=0)return!0}return!1},r}(P),O={vector:S,raster:R,"raster-dem":I,geojson:C,video:D,image:P,canvas:L},k=function(e,r,n,i){var o=new O[r.type](e,r,n,i);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o};function F(e,r){var n=t.identity([]);return t.translate(n,n,[1,1,0]),t.scale(n,n,[.5*e.width,.5*e.height,1]),t.multiply(n,n,e.calculatePosMatrix(r.toUnwrapped()))}function B(t,e,r,n,i){var o=function(t,e,r){if(t)for(var n=0,i=t;n<i.length;n+=1){var o=e[i[n]];if(o&&o.source===r&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===r&&"fill-extrusion"===s.type)return!0}return!1}(n&&n.layers,e,t.id),a=i.maxPitchScaleFactor(),s=t.tilesIn(r,a,o);s.sort(N);for(var u=[],l=0,c=s;l<c.length;l+=1){var h=c[l];u.push({wrappedTileID:h.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,t._state,h.queryGeometry,h.cameraQueryGeometry,h.scale,n,i,a,F(t.transform,h.tileID))})}var p=function(t){for(var e={},r={},n=0,i=t;n<i.length;n+=1){var o=i[n],a=o.queryResults,s=o.wrappedTileID,u=r[s]=r[s]||{};for(var l in a)for(var c=a[l],h=u[l]=u[l]||{},p=e[l]=e[l]||[],f=0,d=c;f<d.length;f+=1){var m=d[f];h[m.featureIndex]||(h[m.featureIndex]=!0,p.push(m))}}return e}(u);for(var f in p)p[f].forEach(function(e){var r=e.feature,n=t.getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=n});return p}function N(t,e){var r=t.tileID,n=e.tileID;return r.overscaledZ-n.overscaledZ||r.canonical.y-n.canonical.y||r.wrap-n.wrap||r.canonical.x-n.canonical.x}var z=function(t,e){this.max=t,this.onRemove=e,this.reset()};z.prototype.reset=function(){for(var t in this.data)for(var e=0,r=this.data[t];e<r.length;e+=1){var n=r[e];n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value)}return this.data={},this.order=[],this},z.prototype.add=function(t,e,r){var n=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:e,timeout:void 0};if(void 0!==r&&(o.timeout=setTimeout(function(){n.remove(t,o)},r)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},z.prototype.has=function(t){return t.wrapped().key in this.data},z.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},z.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},z.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},z.prototype.remove=function(t,e){if(!this.has(t))return this;var r=t.wrapped().key,n=void 0===e?0:this.data[r].indexOf(e),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this},z.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this};var U=function(t,e,r){this.context=t;var n=t.gl;this.buffer=n.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?n.DYNAMIC_DRAW:n.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};U.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},U.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},U.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var V={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},j=function(t,e,r,n){this.length=e.length,this.attributes=r,this.itemSize=e.bytesPerElement,this.dynamicDraw=n,this.context=t;var i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};j.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},j.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},j.prototype.enableAttributes=function(t,e){for(var r=0;r<this.attributes.length;r++){var n=e.attributes[this.attributes[r].name];void 0!==n&&t.enableVertexAttribArray(n)}},j.prototype.setVertexAttribPointers=function(t,e,r){for(var n=0;n<this.attributes.length;n++){var i=this.attributes[n],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[V[i.type]],!1,this.itemSize,i.offset+this.itemSize*(r||0))}},j.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var G=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};G.prototype.get=function(){return this.current},G.prototype.set=function(t){},G.prototype.getDefault=function(){return this.default},G.prototype.setDefault=function(){this.set(this.default)};var q=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(G),H=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(G),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(G),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),Z=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(G),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(G),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(G),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(G),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(G),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(G),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(G),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(G),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),it=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getDefault=function(){return t.Color.transparent},r.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},r}(G),ot=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(G),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(G),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(G),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(G),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(G),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(G),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(G),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(G),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(G),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(G),yt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(G),_t=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(G),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(G),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),bt=function(t){function e(e,r){t.call(this,e),this.context=e,this.parent=r}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(G),wt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(bt),Et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(bt),At=function(t,e,r){this.context=t,this.width=e,this.height=r;var n=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new wt(t,n),this.depthAttachment=new Et(t,n)};At.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();e&&t.deleteTexture(e);var r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r),t.deleteFramebuffer(this.framebuffer)};var Tt=function(t,e,r){this.func=t,this.mask=e,this.range=r};Tt.ReadOnly=!1,Tt.ReadWrite=!0,Tt.disabled=new Tt(519,Tt.ReadOnly,[0,1]);var Mt=function(t,e,r,n,i,o){this.test=t,this.ref=e,this.mask=r,this.fail=n,this.depthFail=i,this.pass=o};Mt.disabled=new Mt({func:519,mask:0},0,0,7680,7680,7680);var St=function(t,e,r){this.blendFunction=t,this.blendColor=e,this.mask=r};St.disabled=new St(St.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),St.unblended=new St(St.Replace,t.Color.transparent,[!0,!0,!0,!0]),St.alphaBlended=new St([1,771],t.Color.transparent,[!0,!0,!0,!0]);var Rt=function(t,e,r){this.enable=t,this.mode=e,this.frontFace=r};Rt.disabled=new Rt(!1,1029,2305),Rt.backCCW=new Rt(!0,1029,2305);var It=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new q(this),this.clearDepth=new H(this),this.clearStencil=new X(this),this.colorMask=new Y(this),this.depthMask=new Z(this),this.stencilMask=new W(this),this.stencilFunc=new K(this),this.stencilOp=new J(this),this.stencilTest=new Q(this),this.depthRange=new $(this),this.depthTest=new tt(this),this.depthFunc=new et(this),this.blend=new rt(this),this.blendFunc=new nt(this),this.blendColor=new it(this),this.blendEquation=new ot(this),this.cullFace=new at(this),this.cullFaceSide=new st(this),this.frontFace=new ut(this),this.program=new lt(this),this.activeTexture=new ct(this),this.viewport=new ht(this),this.bindFramebuffer=new pt(this),this.bindRenderbuffer=new ft(this),this.bindTexture=new dt(this),this.bindVertexBuffer=new mt(this),this.bindElementBuffer=new yt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new _t(this),this.pixelStoreUnpack=new gt(this),this.pixelStoreUnpackPremultiplyAlpha=new vt(this),this.pixelStoreUnpackFlipY=new xt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&t.getExtension("OES_texture_half_float_linear")};It.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},It.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},It.prototype.createIndexBuffer=function(t,e){return new U(this,t,e)},It.prototype.createVertexBuffer=function(t,e,r){return new j(this,t,e,r)},It.prototype.createRenderbuffer=function(t,e,r){var n=this.gl,i=n.createRenderbuffer();return this.bindRenderbuffer.set(i),n.renderbufferStorage(n.RENDERBUFFER,t,e,r),this.bindRenderbuffer.set(null),i},It.prototype.createFramebuffer=function(t,e){return new At(this,t,e)},It.prototype.clear=function(t){var e=t.color,r=t.depth,n=this.gl,i=0;e&&(i|=n.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==r&&(i|=n.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),n.clear(i)},It.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},It.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},It.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},It.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,St.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},It.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ct=function(e){function r(r,n,i){var o=this;e.call(this),this.id=r,this.dispatcher=i,this.on("data",function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))}),this.on("error",function(){o._sourceErrored=!0}),this._source=k(r,n,i,this),this._tiles={},this._cache=new z(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},r.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},r.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},r.prototype.getSource=function(){return this._source},r.prototype.pause=function(){this._paused=!0},r.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},r.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},r.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,function(){})},r.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,function(){})},r.prototype.serialize=function(){return this._source.serialize()},r.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var r=this._tiles[e];r.upload(t),r.prepare(this.map.style.imageManager)}},r.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(Pt)},r.prototype.getRenderableIds=function(e){var r=this,n=[];for(var i in this._tiles)this._isIdRenderable(+i,e)&&n.push(+i);return n.sort(e?function(e,n){var i=r._tiles[e].tileID,o=r._tiles[n].tileID,a=new t.Point(i.canonical.x,i.canonical.y)._rotate(r.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(r.transform.angle);return i.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x}:Pt)},r.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},r.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},r.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},r.prototype._reloadTile=function(t,e){var r=this._tiles[t];r&&("loading"!==r.state&&(r.state=e),this._loadTile(r,this._tileLoaded.bind(this,r,t,e)))},r.prototype._tileLoaded=function(e,r,n,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new t.ErrorEvent(i,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},r.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),r=0;r<e.length;r++){var n=e[r];if(t.neighboringTiles&&t.neighboringTiles[n]){var i=this.getTileByID(n);o(t,i),o(i,t)}}function o(t,e){t.needsHillshadePrepare=!0;var r=e.tileID.canonical.x-t.tileID.canonical.x,n=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,r,n),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},r.prototype.getTile=function(t){return this.getTileByID(t.key)},r.prototype.getTileByID=function(t){return this._tiles[t]},r.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},r.prototype._retainLoadedChildren=function(t,e,r,n){for(var i in this._tiles){var o=this._tiles[i];if(!(n[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>r)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var u=a;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){n[a.key]=a;break}}}},r.prototype.findLoadedParent=function(t,e){for(var r=t.overscaledZ-1;r>=e;r--){var n=t.scaledTo(r);if(!n)return;var i=String(n.key),o=this._tiles[i];if(o&&o.hasData())return o;if(this._cache.has(n))return this._cache.get(n)}},r.prototype.updateCacheSize=function(t){var e=(Math.ceil(t.width/this._source.tileSize)+1)*(Math.ceil(t.height/this._source.tileSize)+1),r=Math.floor(5*e),n="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(n)},r.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var r={};for(var n in this._tiles){var i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),r[i.tileID.key]=i}for(var o in this._tiles=r,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles){this._setTileReloadTimer(a,this._tiles[a])}}},r.prototype.update=function(e){var n=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)}):(i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter(function(t){return n._source.hasTile(t)}))):i=[];var o=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(e)),a=Math.max(o-r.maxOverzooming,this._source.minzoom),s=Math.max(o+r.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(i,o);if(Dt(this._source.type)){for(var l={},c={},h=0,p=Object.keys(u);h<p.length;h+=1){var f=p[h],d=u[f],m=this._tiles[f];if(m&&!(m.fadeEndTime&&m.fadeEndTime<=t.browser.now())){var y=this.findLoadedParent(d,a);y&&(this._addTile(y.tileID),l[y.tileID.key]=y.tileID),c[f]=d}}for(var _ in this._retainLoadedChildren(c,o,s,u),l)u[_]||(this._coveredTiles[_]=!0,u[_]=l[_])}for(var g in u)this._tiles[g].clearFadeHold();for(var v=0,x=t.keysDifference(this._tiles,u);v<x.length;v+=1){var b=x[v],w=this._tiles[b];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(b)}}},r.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},r.prototype._updateRetainedTiles=function(t,e){for(var n={},i={},o=Math.max(e-r.maxOverzooming,this._source.minzoom),a=Math.max(e+r.maxUnderzooming,this._source.minzoom),s={},u=0,l=t;u<l.length;u+=1){var c=l[u],h=this._addTile(c);n[c.key]=c,h.hasData()||e<this._source.maxzoom&&(s[c.key]=c)}this._retainLoadedChildren(s,e,a,n);for(var p=0,f=t;p<f.length;p+=1){var d=f[p],m=this._tiles[d.key];if(!m.hasData()){if(e+1>this._source.maxzoom){var y=d.children(this._source.maxzoom)[0],_=this.getTile(y);if(_&&_.hasData()){n[y.key]=y;continue}}else{var g=d.children(this._source.maxzoom);if(n[g[0].key]&&n[g[1].key]&&n[g[2].key]&&n[g[3].key])continue}for(var v=m.wasRequested(),x=d.overscaledZ-1;x>=o;--x){var b=d.scaledTo(x);if(i[b.key])break;if(i[b.key]=!0,!(m=this.getTile(b))&&v&&(m=this._addTile(b)),m&&(n[b.key]=b,v=m.wasRequested(),m.hasData()))break}}}return n},r.prototype._addTile=function(e){var r=this._tiles[e.key];if(r)return r;(r=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));var n=Boolean(r);return n||(r=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))),r?(r.uses++,this._tiles[e.key]=r,n||this._source.fire(new t.Event("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null},r.prototype._setTileReloadTimer=function(t,e){var r=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(function(){r._reloadTile(t,"expired"),delete r._timers[t]},n))},r.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},r.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},r.prototype.tilesIn=function(e,r,n){var i=this,o=[],a=this.transform;if(!a)return o;for(var s=n?a.getCameraQueryGeometry(e):e,u=e.map(function(t){return a.pointCoordinate(t)}),l=s.map(function(t){return a.pointCoordinate(t)}),c=this.getIds(),h=1/0,p=1/0,f=-1/0,d=-1/0,m=0,y=l;m<y.length;m+=1){var _=y[m];h=Math.min(h,_.x),p=Math.min(p,_.y),f=Math.max(f,_.x),d=Math.max(d,_.y)}for(var g=function(e){var n=i._tiles[c[e]];if(!n.holdingForFade()){var s=n.tileID,m=Math.pow(2,a.zoom-n.tileID.overscaledZ),y=r*n.queryPadding*t.EXTENT/n.tileSize/m,_=[s.getTilePoint(new t.MercatorCoordinate(h,p)),s.getTilePoint(new t.MercatorCoordinate(f,d))];if(_[0].x-y<t.EXTENT&&_[0].y-y<t.EXTENT&&_[1].x+y>=0&&_[1].y+y>=0){var g=u.map(function(t){return s.getTilePoint(t)}),v=l.map(function(t){return s.getTilePoint(t)});o.push({tile:n,tileID:s,queryGeometry:g,cameraQueryGeometry:v,scale:m})}}},v=0;v<c.length;v++)g(v);return o},r.prototype.getVisibleCoordinates=function(t){for(var e=this,r=this.getRenderableIds(t).map(function(t){return e._tiles[t].tileID}),n=0,i=r;n<i.length;n+=1){var o=i[n];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return r},r.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Dt(this._source.type))for(var e in this._tiles){var r=this._tiles[e];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=t.browser.now())return!0}return!1},r.prototype.setFeatureState=function(t,e,r){this._state.updateState(t=t||"_geojsonTileLayer",e,r)},r.prototype.removeFeatureState=function(t,e,r){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,r)},r.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},r}(t.Evented);function Pt(t,e){return t%32-e%32||e-t}function Dt(t){return"raster"===t||"image"===t||"video"===t}function Lt(){return new t.window.Worker(ei.workerUrl)}Ct.maxOverzooming=10,Ct.maxUnderzooming=3;var Ot=function(){this.active={}};Ot.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Ot.workerCount;)this.workers.push(new Lt);return this.active[t]=!0,this.workers.slice()},Ot.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)};var kt,Ft=Math.floor(t.browser.hardwareConcurrency/2);function Bt(e,r){var n={};for(var i in e)"ref"!==i&&(n[i]=e[i]);return t.refProperties.forEach(function(t){t in r&&(n[t]=r[t])}),n}function Nt(t){t=t.slice();for(var e=Object.create(null),r=0;r<t.length;r++)e[t[r].id]=t[r];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=Bt(t[n],e[t[n].ref]));return t}Ot.workerCount=Math.max(Math.min(Ft,6),1);var zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Ut(t,e,r){r.push({command:zt.addSource,args:[t,e[t]]})}function Vt(t,e,r){e.push({command:zt.removeSource,args:[t]}),r[t]=!0}function jt(t,e,r,n){Vt(t,r,n),Ut(t,e,r)}function Gt(e,r,n){var i;for(i in e[n])if(e[n].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[n][i],r[n][i]))return!1;for(i in r[n])if(r[n].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[n][i],r[n][i]))return!1;return!0}function qt(e,r,n,i,o,a){var s;for(s in r=r||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||n.push({command:a,args:[i,s,r[s],o]}));for(s in r)r.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],r[s])||n.push({command:a,args:[i,s,r[s],o]}))}function Ht(t){return t.id}function Xt(t,e){return t[e.id]=e,t}var Yt=function(t,e,r){var n=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(e/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)n.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Zt(e,r,n,i,o){var a=t.create();return r?(t.scale(a,a,[1/o,1/o,1]),n||t.rotateZ(a,a,i.angle)):t.multiply(a,i.labelPlaneMatrix,e),a}function Wt(e,r,n,i,o){if(r){var a=t.clone(e);return t.scale(a,a,[o,o,1]),n||t.rotateZ(a,a,-i.angle),a}return i.glCoordMatrix}function Kt(e,r){var n=[e.x,e.y,0,1];ae(n,n,r);var i=n[3];return{point:new t.Point(n[0]/i,n[1]/i),signedDistanceFromCamera:i}}function Jt(t,e){var r=t[0]/t[3],n=t[1]/t[3];return r>=-e[0]&&r<=e[0]&&n>=-e[1]&&n<=e[1]}function Qt(e,r,n,i,o,a,s,u){var l=i?e.textSizeData:e.iconSizeData,c=t.evaluateSizeForZoom(l,n.transform.zoom),h=[256/n.width*2+1,256/n.height*2+1],p=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;p.clear();for(var f=e.lineVertexArray,d=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,m=n.transform.width/n.transform.height,y=!1,_=0;_<d.length;_++){var g=d.get(_);if(g.hidden||g.writingMode===t.WritingMode.vertical&&!y)oe(g.numGlyphs,p);else{y=!1;var v=[g.anchorX,g.anchorY,0,1];if(t.transformMat4(v,v,r),Jt(v,h)){var x=.5+v[3]/n.transform.cameraToCenterDistance*.5,b=t.evaluateSizeForFeature(l,c,g),w=s?b*x:b/x,E=new t.Point(g.anchorX,g.anchorY),A=Kt(E,o).point,T={},M=ee(g,w,!1,u,r,o,a,e.glyphOffsetArray,f,p,A,E,T,m);y=M.useVertical,(M.notEnoughRoom||y||M.needsFlipping&&ee(g,w,!0,u,r,o,a,e.glyphOffsetArray,f,p,A,E,T,m).notEnoughRoom)&&oe(g.numGlyphs,p)}else oe(g.numGlyphs,p)}}i?e.text.dynamicLayoutVertexBuffer.updateData(p):e.icon.dynamicLayoutVertexBuffer.updateData(p)}function $t(t,e,r,n,i,o,a,s,u,l,c,h){var p=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,d=s.lineStartIndex+s.lineLength,m=e.getoffsetX(s.glyphStartIndex),y=e.getoffsetX(p-1),_=ne(t*m,r,n,i,o,a,s.segment,f,d,u,l,c,h);if(!_)return null;var g=ne(t*y,r,n,i,o,a,s.segment,f,d,u,l,c,h);return g?{first:_,last:g}:null}function te(e,r,n,i){return e===t.WritingMode.horizontal&&Math.abs(n.y-r.y)>Math.abs(n.x-r.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?r.y<n.y:r.x>n.x)?{needsFlipping:!0}:null}function ee(e,r,n,i,o,a,s,u,l,c,h,p,f,d){var m,y=r/24,_=e.lineOffsetX*y,g=e.lineOffsetY*y;if(e.numGlyphs>1){var v=e.glyphStartIndex+e.numGlyphs,x=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,w=$t(y,u,_,g,n,h,p,e,l,a,f,!1);if(!w)return{notEnoughRoom:!0};var E=Kt(w.first.point,s).point,A=Kt(w.last.point,s).point;if(i&&!n){var T=te(e.writingMode,E,A,d);if(T)return T}m=[w.first];for(var M=e.glyphStartIndex+1;M<v-1;M++)m.push(ne(y*u.getoffsetX(M),_,g,n,h,p,e.segment,x,b,l,a,f,!1));m.push(w.last)}else{if(i&&!n){var S=Kt(p,o).point,R=e.lineStartIndex+e.segment+1,I=new t.Point(l.getx(R),l.gety(R)),C=Kt(I,o),P=C.signedDistanceFromCamera>0?C.point:re(p,I,S,1,o),D=te(e.writingMode,S,P,d);if(D)return D}var L=ne(y*u.getoffsetX(e.glyphStartIndex),_,g,n,h,p,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,a,f,!1);if(!L)return{notEnoughRoom:!0};m=[L]}for(var O=0,k=m;O<k.length;O+=1){var F=k[O];t.addDynamicAttributes(c,F.point,F.angle)}return{}}function re(t,e,r,n,i){var o=Kt(t.add(t.sub(e)._unit()),i).point,a=r.sub(o);return r.add(a._mult(n/a.mag()))}function ne(e,r,n,i,o,a,s,u,l,c,h,p,f){var d=i?e-r:e+r,m=d>0?1:-1,y=0;i&&(m*=-1,y=Math.PI),m<0&&(y+=Math.PI);for(var _=m>0?u+s:u+s+1,g=_,v=o,x=o,b=0,w=0,E=Math.abs(d);b+w<=E;){if((_+=m)<u||_>=l)return null;if(x=v,void 0===(v=p[_])){var A=new t.Point(c.getx(_),c.gety(_)),T=Kt(A,h);if(T.signedDistanceFromCamera>0)v=p[_]=T.point;else{var M=_-m;v=re(0===b?a:new t.Point(c.getx(M),c.gety(M)),A,x,E-b+1,h)}}b+=w,w=x.dist(v)}var S=(E-b)/w,R=v.sub(x),I=R.mult(S)._add(x);return I._add(R._unit()._perp()._mult(n*m)),{point:I,angle:y+Math.atan2(v.y-x.y,v.x-x.x),tileDistance:f?{prevTileDistance:_-m===g?0:c.gettileUnitDistanceFromAnchor(_-m),lastSegmentViewportDistance:E-b}:null}}Yt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Yt.prototype.insert=function(t,e,r,n,i){this._forEachCell(e,r,n,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},Yt.prototype.insertCircle=function(t,e,r,n){this._forEachCell(e-n,r-n,e+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(r),this.circles.push(n)},Yt.prototype._insertBoxCell=function(t,e,r,n,i,o){this.boxCells[i].push(o)},Yt.prototype._insertCircleCell=function(t,e,r,n,i,o){this.circleCells[i].push(o)},Yt.prototype._query=function(t,e,r,n,i,o){if(r<0||t>this.width||n<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var l=this.circles[3*u],c=this.circles[3*u+1],h=this.circles[3*u+2];a.push({key:this.circleKeys[u],x1:l-h,y1:c-h,x2:l+h,y2:c+h})}return o?a.filter(o):a}return this._forEachCell(t,e,r,n,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a},Yt.prototype._queryCircle=function(t,e,r,n,i){var o=t-r,a=t+r,s=e-r,u=e+r;if(a<0||o>this.width||u<0||s>this.height)return!n&&[];var l=[];return this._forEachCell(o,s,a,u,this._queryCellCircle,l,{hitTest:n,circle:{x:t,y:e,radius:r},seenUids:{box:{},circle:{}}},i),n?l.length>0:l},Yt.prototype.query=function(t,e,r,n,i){return this._query(t,e,r,n,!1,i)},Yt.prototype.hitTest=function(t,e,r,n,i){return this._query(t,e,r,n,!0,i)},Yt.prototype.hitTestCircle=function(t,e,r,n){return this._queryCircle(t,e,r,!0,n)},Yt.prototype._queryCell=function(t,e,r,n,i,o,a,s){var u=a.seenUids,l=this.boxCells[i];if(null!==l)for(var c=this.bboxes,h=0,p=l;h<p.length;h+=1){var f=p[h];if(!u.box[f]){u.box[f]=!0;var d=4*f;if(t<=c[d+2]&&e<=c[d+3]&&r>=c[d+0]&&n>=c[d+1]&&(!s||s(this.boxKeys[f]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[f],x1:c[d],y1:c[d+1],x2:c[d+2],y2:c[d+3]})}}}var m=this.circleCells[i];if(null!==m)for(var y=this.circles,_=0,g=m;_<g.length;_+=1){var v=g[_];if(!u.circle[v]){u.circle[v]=!0;var x=3*v;if(this._circleAndRectCollide(y[x],y[x+1],y[x+2],t,e,r,n)&&(!s||s(this.circleKeys[v]))){if(a.hitTest)return o.push(!0),!0;var b=y[x],w=y[x+1],E=y[x+2];o.push({key:this.circleKeys[v],x1:b-E,y1:w-E,x2:b+E,y2:w+E})}}}},Yt.prototype._queryCellCircle=function(t,e,r,n,i,o,a,s){var u=a.circle,l=a.seenUids,c=this.boxCells[i];if(null!==c)for(var h=this.bboxes,p=0,f=c;p<f.length;p+=1){var d=f[p];if(!l.box[d]){l.box[d]=!0;var m=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[m+0],h[m+1],h[m+2],h[m+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var y=this.circleCells[i];if(null!==y)for(var _=this.circles,g=0,v=y;g<v.length;g+=1){var x=v[g];if(!l.circle[x]){l.circle[x]=!0;var b=3*x;if(this._circlesCollide(_[b],_[b+1],_[b+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[x])))return o.push(!0),!0}}},Yt.prototype._forEachCell=function(t,e,r,n,i,o,a,s){for(var u=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),c=this._convertToXCellCoord(r),h=this._convertToYCellCoord(n),p=u;p<=c;p++)for(var f=l;f<=h;f++){if(i.call(this,t,e,r,n,this.xCellCount*f+p,o,a,s))return}},Yt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Yt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Yt.prototype._circlesCollide=function(t,e,r,n,i,o){var a=n-t,s=i-e,u=r+o;return u*u>a*a+s*s},Yt.prototype._circleAndRectCollide=function(t,e,r,n,i,o,a){var s=(o-n)/2,u=Math.abs(t-(n+s));if(u>s+r)return!1;var l=(a-i)/2,c=Math.abs(e-(i+l));if(c>l+r)return!1;if(u<=s||c<=l)return!0;var h=u-s,p=c-l;return h*h+p*p<=r*r};var ie=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function oe(t,e){for(var r=0;r<t;r++){var n=e.length;e.resize(n+4),e.float32.set(ie,3*n)}}function ae(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t[3]=r[3]*n+r[7]*i+r[15],t}var se=function(t,e,r){void 0===e&&(e=new Yt(t.width+200,t.height+200,25)),void 0===r&&(r=new Yt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function ue(t,e,r){t[e+4]=r?1:0}function le(e,r,n){return r*(t.EXTENT/(e.tileSize*Math.pow(2,n-e.tileID.overscaledZ)))}se.prototype.placeCollisionBox=function(t,e,r,n,i){var o=this.projectAndGetPerspectiveRatio(n,t.anchorPointX,t.anchorPointY),a=r*o.perspectiveRatio,s=t.x1*a+o.point.x,u=t.y1*a+o.point.y,l=t.x2*a+o.point.x,c=t.y2*a+o.point.y;return!this.isInsideGrid(s,u,l,c)||!e&&this.grid.hitTest(s,u,l,c,i)?{box:[],offscreen:!1}:{box:[s,u,l,c],offscreen:this.isOffscreen(s,u,l,c)}},se.prototype.approximateTileDistance=function(t,e,r,n,i){var o=t.lastSegmentViewportDistance*r;return t.prevTileDistance+o+((i?1:n/this.pitchfactor)-1)*o*Math.abs(Math.sin(e))},se.prototype.placeCollisionCircles=function(e,r,n,i,o,a,s,u,l,c,h,p,f){var d=[],m=this.projectAnchor(l,o.anchorX,o.anchorY),y=u/24,_=o.lineOffsetX*u,g=o.lineOffsetY*u,v=new t.Point(o.anchorX,o.anchorY),x=$t(y,s,_,g,!1,Kt(v,c).point,v,o,a,c,{},!0),b=!1,w=!1,E=!0,A=m.perspectiveRatio*i,T=1/(i*n),M=0,S=0;x&&(M=this.approximateTileDistance(x.first.tileDistance,x.first.angle,T,m.cameraDistance,p),S=this.approximateTileDistance(x.last.tileDistance,x.last.angle,T,m.cameraDistance,p));for(var R=0;R<e.length;R+=5){var I=e[R],C=e[R+1],P=e[R+2],D=e[R+3];if(!x||D<-M||D>S)ue(e,R,!1);else{var L=this.projectPoint(l,I,C),O=P*A;if(d.length>0){var k=L.x-d[d.length-4],F=L.y-d[d.length-3];if(O*O*2>k*k+F*F&&R+8<e.length){var B=e[R+8];if(B>-M&&B<S){ue(e,R,!1);continue}}}d.push(L.x,L.y,O,R/5),ue(e,R,!0);var N=L.x-O,z=L.y-O,U=L.x+O,V=L.y+O;if(E=E&&this.isOffscreen(N,z,U,V),w=w||this.isInsideGrid(N,z,U,V),!r&&this.grid.hitTestCircle(L.x,L.y,O,f)){if(!h)return{circles:[],offscreen:!1};b=!0}}}return{circles:b||!w?[]:d,offscreen:E}},se.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var r=[],n=1/0,i=1/0,o=-1/0,a=-1/0,s=0,u=e;s<u.length;s+=1){var l=u[s],c=new t.Point(l.x+100,l.y+100);n=Math.min(n,c.x),i=Math.min(i,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y),r.push(c)}for(var h={},p={},f=0,d=this.grid.query(n,i,o,a).concat(this.ignoredGrid.query(n,i,o,a));f<d.length;f+=1){var m=d[f],y=m.key;if(void 0===h[y.bucketInstanceId]&&(h[y.bucketInstanceId]={}),!h[y.bucketInstanceId][y.featureIndex]){var _=[new t.Point(m.x1,m.y1),new t.Point(m.x2,m.y1),new t.Point(m.x2,m.y2),new t.Point(m.x1,m.y2)];t.polygonIntersectsPolygon(r,_)&&(h[y.bucketInstanceId][y.featureIndex]=!0,void 0===p[y.bucketInstanceId]&&(p[y.bucketInstanceId]=[]),p[y.bucketInstanceId].push(y.featureIndex))}}return p},se.prototype.insertCollisionBox=function(t,e,r,n,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:i},t[0],t[1],t[2],t[3])},se.prototype.insertCollisionCircles=function(t,e,r,n,i){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:i},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},se.prototype.projectAnchor=function(t,e,r){var n=[e,r,0,1];return ae(n,n,t),{perspectiveRatio:.5+this.transform.cameraToCenterDistance/n[3]*.5,cameraDistance:n[3]}},se.prototype.projectPoint=function(e,r,n){var i=[r,n,0,1];return ae(i,i,e),new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100)},se.prototype.projectAndGetPerspectiveRatio=function(e,r,n){var i=[r,n,0,1];return ae(i,i,e),{point:new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},se.prototype.isOffscreen=function(t,e,r,n){return r<100||t>=this.screenRightBoundary||n<100||e>this.screenBottomBoundary},se.prototype.isInsideGrid=function(t,e,r,n){return r>=0&&t<this.gridRightBoundary&&n>=0&&e<this.gridBottomBoundary};var ce=function(t,e,r,n){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):n&&r?1:0,this.placed=r};ce.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var he=function(t,e,r,n,i){this.text=new ce(t?t.text:null,e,r,i),this.icon=new ce(t?t.icon:null,e,n,i)};he.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var pe=function(t,e,r){this.text=t,this.icon=e,this.skipFade=r},fe=function(t,e,r,n,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=i},de=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function me(e,r,n,i,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*r,u=-(a.verticalAlign-.5)*n,l=t.evaluateVariableOffset(e,i);return new t.Point(s+l[0]*o,u+l[1]*o)}function ye(e,r,n,i,o,a){var s=e.x1,u=e.x2,l=e.y1,c=e.y2,h=e.anchorPointX,p=e.anchorPointY,f=new t.Point(r,n);return i&&f._rotate(o?a:-a),{x1:s+f.x,y1:l+f.y,x2:u+f.x,y2:c+f.y,anchorPointX:h,anchorPointY:p}}de.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var _e=function(t,e,r,n){this.transform=t.clone(),this.collisionIndex=new se(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new de(r),this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={}};function ge(t,e,r,n,i){t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0),t.emplaceBack(e?1:0,r?1:0,n||0,i||0)}_e.prototype.placeLayerTile=function(e,r,n,i){var o=r.getBucket(e),a=r.latestFeatureIndex;if(o&&a&&e.id===o.layerIds[0]){var s=r.collisionBoxArray,u=o.layers[0].layout,l=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),p=Zt(h,"map"===u.get("text-pitch-alignment"),"map"===u.get("text-rotation-alignment"),this.transform,le(r,1,this.transform.zoom)),f=Zt(h,"map"===u.get("icon-pitch-alignment"),"map"===u.get("icon-rotation-alignment"),this.transform,le(r,1,this.transform.zoom));this.retainedQueryData[o.bucketInstanceId]=new fe(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID),this.placeLayerBucket(o,h,p,f,l,c,n,r.holdingForFade(),i,s)}},_e.prototype.attemptAnchorPlacement=function(t,e,r,n,i,o,a,s,u,l,c,h,p,f){var d,m=[h.textOffset0,h.textOffset1],y=me(t,r,n,m,i),_=this.collisionIndex.placeCollisionBox(ye(e,y.x,y.y,o,a,this.transform.angle),c,s,u,l.predicate);if(_.box.length>0)return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(d=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:m,width:r,height:n,anchor:t,textBoxScale:i,prevAnchor:d},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:y,placedGlyphBoxes:_}},_e.prototype.placeLayerBucket=function(e,r,n,i,o,a,s,u,l,c){var h=this,p=e.layers[0].layout,f=t.evaluateSizeForZoom(e.textSizeData,this.transform.zoom),d=p.get("text-optional"),m=p.get("icon-optional"),y=p.get("text-allow-overlap"),_=p.get("icon-allow-overlap"),g=y&&(_||!e.hasIconData()||m),v=_&&(y||!e.hasTextData()||d),x=this.collisionGroups.get(e.sourceID),b="map"===p.get("text-rotation-alignment"),w="map"===p.get("text-pitch-alignment"),E="none"!==p.get("icon-text-fit"),A="viewport-y"===p.get("symbol-z-order");!e.collisionArrays&&c&&e.deserializeCollisionBoxes(c);var T=function(i,c){if(!l[i.crossTileID])if(u)h.placements[i.crossTileID]=new pe(!1,!1,!1);else{var _,A=!1,T=!1,M=!0,S=null,R={box:null,offscreen:null},I={box:null,offscreen:null},C=null,P=null,D=0,L=0,O=0;c.textFeatureIndex&&(D=c.textFeatureIndex),c.verticalTextFeatureIndex&&(L=c.verticalTextFeatureIndex);var k=c.textBox;if(k){var F=function(r){var n=t.WritingMode.horizontal;if(e.allowVerticalPlacement&&!r&&h.prevPlacement){var o=h.prevPlacement.placedOrientations[i.crossTileID];o&&(h.placedOrientations[i.crossTileID]=o,h.markUsedOrientation(e,n=o,i))}return n},B=function(r,n){if(e.allowVerticalPlacement&&i.numVerticalGlyphVertices>0&&c.verticalTextBox)for(var o=0,a=e.writingModes;o<a.length&&(a[o]===t.WritingMode.vertical?(R=n(),I=R):R=r(),!(R&&R.box&&R.box.length));o+=1);else R=r()};if(p.get("text-variable-anchor")){var N=p.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[i.crossTileID]){var z=h.prevPlacement.variableOffsets[i.crossTileID];N.indexOf(z.anchor)>0&&(N=N.filter(function(t){return t!==z.anchor})).unshift(z.anchor)}var U=function(t,n){for(var o=t.x2-t.x1,s=t.y2-t.y1,u=i.textBoxScale,l={box:[],offscreen:!1},c=y?2*N.length:N.length,p=0;p<c;++p){var f=h.attemptAnchorPlacement(N[p%N.length],t,o,s,u,b,w,a,r,x,p>=N.length,i,e,n);if(f&&(l=f.placedGlyphBoxes)&&l.box&&l.box.length){A=!0,S=f.shift;break}}return l};B(function(){return U(k,t.WritingMode.horizontal)},function(){var r=c.verticalTextBox;return e.allowVerticalPlacement&&!(R&&R.box&&R.box.length)&&i.numVerticalGlyphVertices>0&&r?U(r,t.WritingMode.vertical):{box:null,offscreen:null}}),R&&(A=R.box,M=R.offscreen);var V=F(R&&R.box);if(!A&&h.prevPlacement){var j=h.prevPlacement.variableOffsets[i.crossTileID];j&&(h.variableOffsets[i.crossTileID]=j,h.markUsedJustification(e,j.anchor,i,V))}}else{var G=function(t,n){var o=h.collisionIndex.placeCollisionBox(t,p.get("text-allow-overlap"),a,r,x.predicate);return o&&o.box&&o.box.length&&(h.markUsedOrientation(e,n,i),h.placedOrientations[i.crossTileID]=n),o};B(function(){return G(k,t.WritingMode.horizontal)},function(){var r=c.verticalTextBox;return e.allowVerticalPlacement&&i.numVerticalGlyphVertices>0&&r?G(r,t.WritingMode.vertical):{box:null,offscreen:null}}),F(R&&R.box&&R.box.length)}}A=(_=R)&&_.box&&_.box.length>0,M=_&&_.offscreen;var q=c.textCircles;if(q){var H=e.text.placedSymbolArray.get(i.centerJustifiedTextSymbolIndex),X=t.evaluateSizeForFeature(e.textSizeData,f,H);C=h.collisionIndex.placeCollisionCircles(q,p.get("text-allow-overlap"),o,a,H,e.lineVertexArray,e.glyphOffsetArray,X,r,n,s,w,x.predicate),A=p.get("text-allow-overlap")||C.circles.length>0,M=M&&C.offscreen}if(c.iconFeatureIndex&&(O=c.iconFeatureIndex),c.iconBox){var Y=E&&S?ye(c.iconBox,S.x,S.y,b,w,h.transform.angle):c.iconBox;T=(P=h.collisionIndex.placeCollisionBox(Y,p.get("icon-allow-overlap"),a,r,x.predicate)).box.length>0,M=M&&P.offscreen}var Z=d||0===i.numHorizontalGlyphVertices&&0===i.numVerticalGlyphVertices,W=m||0===i.numIconVertices;Z||W?W?Z||(T=T&&A):A=T&&A:T=A=T&&A,A&&_&&_.box&&h.collisionIndex.insertCollisionBox(_.box,p.get("text-ignore-placement"),e.bucketInstanceId,I&&I.box&&L?L:D,x.ID),T&&P&&h.collisionIndex.insertCollisionBox(P.box,p.get("icon-ignore-placement"),e.bucketInstanceId,O,x.ID),A&&C&&h.collisionIndex.insertCollisionCircles(C.circles,p.get("text-ignore-placement"),e.bucketInstanceId,D,x.ID),h.placements[i.crossTileID]=new pe(A||g,T||v,M||e.justReloaded),l[i.crossTileID]=!0}};if(A)for(var M=e.getSortedSymbolIndexes(this.transform.angle),S=M.length-1;S>=0;--S){var R=M[S];T(e.symbolInstances.get(R),e.collisionArrays[R])}else for(var I=0;I<e.symbolInstances.length;++I)T(e.symbolInstances.get(I),e.collisionArrays[I]);e.justReloaded=!1},_e.prototype.markUsedJustification=function(e,r,n,i){var o;o=i===t.WritingMode.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(r)];for(var a=0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];a<s.length;a+=1){var u=s[a];u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=o>=0&&u!==o?0:n.crossTileID)}},_e.prototype.markUsedOrientation=function(e,r,n){for(var i=r===t.WritingMode.horizontal||r===t.WritingMode.horizontalOnly?r:0,o=r===t.WritingMode.vertical?r:0,a=0,s=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];a<s.length;a+=1){e.text.placedSymbolArray.get(s[a]).placedOrientation=i}n.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=o)},_e.prototype.commit=function(t){this.commitTime=t;var e=this.prevPlacement,r=!1,n=e&&0!==this.fadeDuration?(this.commitTime-e.commitTime)/this.fadeDuration:1,i=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],l=i[s];l?(this.opacities[s]=new he(l,n,u.text,u.icon),r=r||u.text!==l.text.placed||u.icon!==l.icon.placed):(this.opacities[s]=new he(null,n,u.text,u.icon,u.skipFade),r=r||u.text||u.icon)}for(var c in i){var h=i[c];if(!this.opacities[c]){var p=new he(h,n,!1,!1);p.isHidden()||(this.opacities[c]=p,r=r||h.text.placed||h.icon.placed)}}for(var f in o)this.variableOffsets[f]||!this.opacities[f]||this.opacities[f].isHidden()||(this.variableOffsets[f]=o[f]);for(var d in a)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=a[d]);r?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},_e.prototype.updateLayerOpacities=function(t,e){for(var r={},n=0,i=e;n<i.length;n+=1){var o=i[n],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,r,o.collisionBoxArray)}},_e.prototype.updateBucketOpacities=function(e,r,n){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear(),e.hasIconCollisionCircleData()&&e.iconCollisionCircle.collisionVertexArray.clear(),e.hasTextCollisionCircleData()&&e.textCollisionCircle.collisionVertexArray.clear();var i=e.layers[0].layout,o=new he(null,0,!1,!1,!0),a=i.get("text-allow-overlap"),s=i.get("icon-allow-overlap"),u=i.get("text-variable-anchor"),l="map"===i.get("text-rotation-alignment"),c="map"===i.get("text-pitch-alignment"),h="none"!==i.get("icon-text-fit"),p=new he(null,0,a&&(s||!e.hasIconData()||i.get("icon-optional")),s&&(a||!e.hasTextData()||i.get("text-optional")),!0);!e.collisionArrays&&n&&(e.hasIconCollisionBoxData()||e.hasIconCollisionCircleData()||e.hasTextCollisionBoxData()||e.hasTextCollisionCircleData())&&e.deserializeCollisionBoxes(n);for(var f=0;f<e.symbolInstances.length;f++){var d=e.symbolInstances.get(f),m=d.numHorizontalGlyphVertices,y=d.numVerticalGlyphVertices,_=d.crossTileID,g=r[_],v=this.opacities[_];g?v=o:v||(this.opacities[_]=v=p),r[_]=!0;var x=d.numIconVertices>0;if(m>0||y>0){for(var b=Me(v.text),w=(m+y)/4,E=0;E<w;E++)e.text.opacityVertexArray.emplaceBack(b);var A=v.text.isHidden()?1:0,T=this.placedOrientations[d.crossTileID],M=T===t.WritingMode.horizontal||T===t.WritingMode.horizontalOnly?1:0,S=T===t.WritingMode.vertical?1:0;[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach(function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=A||S)}),d.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).hidden=A||M);var R=this.variableOffsets[d.crossTileID];R&&this.markUsedJustification(e,R.anchor,d,T);var I=this.placedOrientations[d.crossTileID];I&&(this.markUsedJustification(e,"left",d,I),this.markUsedOrientation(e,I,d))}if(x){for(var C=Me(v.icon),P=0;P<d.numIconVertices/4;P++)e.icon.opacityVertexArray.emplaceBack(C);e.icon.placedSymbolArray.get(f).hidden=v.icon.isHidden()}if(e.hasIconCollisionBoxData()||e.hasIconCollisionCircleData()||e.hasTextCollisionBoxData()||e.hasTextCollisionCircleData()){var D=e.collisionArrays[f];if(D){var L=new t.Point(0,0);if(D.textBox){var O=!0;if(u){var k=this.variableOffsets[_];k?(L=me(k.anchor,k.width,k.height,k.textOffset,k.textBoxScale),l&&L._rotate(c?this.transform.angle:-this.transform.angle)):O=!1}ge(e.textCollisionBox.collisionVertexArray,v.text.placed,!O,L.x,L.y)}D.iconBox&&ge(e.iconCollisionBox.collisionVertexArray,v.icon.placed,!1,h?L.x:0,h?L.y:0);var F=D.textCircles;if(F&&e.hasTextCollisionCircleData())for(var B=0;B<F.length;B+=5){ge(e.textCollisionCircle.collisionVertexArray,v.text.placed,g||0===F[B+4])}}}}e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.hasIconCollisionCircleData()&&e.iconCollisionCircle.collisionVertexBuffer&&e.iconCollisionCircle.collisionVertexBuffer.updateData(e.iconCollisionCircle.collisionVertexArray),e.hasTextCollisionCircleData()&&e.textCollisionCircle.collisionVertexBuffer&&e.textCollisionCircle.collisionVertexBuffer.updateData(e.textCollisionCircle.collisionVertexArray)},_e.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration},_e.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},_e.prototype.stillRecent=function(t){return this.commitTime+this.fadeDuration>t},_e.prototype.setStale=function(){this.stale=!0};var ve=Math.pow(2,25),xe=Math.pow(2,24),be=Math.pow(2,17),we=Math.pow(2,16),Ee=Math.pow(2,9),Ae=Math.pow(2,8),Te=Math.pow(2,1);function Me(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,r=Math.floor(127*t.opacity);return r*ve+e*xe+r*be+e*we+r*Ee+e*Ae+r*Te+e}var Se=function(){this._currentTileIndex=0,this._seenCrossTileIDs={}};Se.prototype.continuePlacement=function(t,e,r,n,i){for(;this._currentTileIndex<t.length;){if(e.placeLayerTile(n,t[this._currentTileIndex],r,this._seenCrossTileIDs),this._currentTileIndex++,i())return!0}};var Re=function(t,e,r,n,i,o,a){this.placement=new _e(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1};Re.prototype.isDone=function(){return this._done},Re.prototype.continuePlacement=function(e,r,n){for(var i=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!i._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=r[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Se),this._inProgressLayer.continuePlacement(n[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Re.prototype.commit=function(t){return this.placement.commit(t),this.placement};var Ie=512/t.EXTENT/2,Ce=function(t,e,r){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=r;for(var n=0;n<e.length;n++){var i=e.get(n),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}};Ce.prototype.getScaledCoordinates=function(e,r){var n=Ie/Math.pow(2,r.canonical.z-this.tileID.canonical.z);return{x:Math.floor((r.canonical.x*t.EXTENT+e.anchorX)*n),y:Math.floor((r.canonical.y*t.EXTENT+e.anchorY)*n)}},Ce.prototype.findMatches=function(t,e,r){for(var n=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var o=t.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),u=0,l=a;u<l.length;u+=1){var c=l[u];if(Math.abs(c.coord.x-s.x)<=n&&Math.abs(c.coord.y-s.y)<=n&&!r[c.crossTileID]){r[c.crossTileID]=!0,o.crossTileID=c.crossTileID;break}}}}};var Pe=function(){this.maxCrossTileID=0};Pe.prototype.generate=function(){return++this.maxCrossTileID};var De=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};De.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var r in this.indexes){var n=this.indexes[r],i={};for(var o in n){var a=n[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),i[a.tileID.key]=a}this.indexes[r]=i}this.lng=t},De.prototype.addBucket=function(t,e,r){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var n=0;n<e.symbolInstances.length;n++)e.symbolInstances.get(n).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var u=a[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,i)}else{var l=a[t.scaledTo(Number(o)).key];l&&l.findMatches(e.symbolInstances,t,i)}}for(var c=0;c<e.symbolInstances.length;c++){var h=e.symbolInstances.get(c);h.crossTileID||(h.crossTileID=r.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ce(t,e.symbolInstances,e.bucketInstanceId),!0},De.prototype.removeBucketCrossTileIDs=function(t,e){for(var r in e.indexedSymbolInstances)for(var n=0,i=e.indexedSymbolInstances[r];n<i.length;n+=1){delete this.usedCrossTileIDs[t][i[n].crossTileID]}},De.prototype.removeStaleBuckets=function(t){var e=!1;for(var r in this.indexes){var n=this.indexes[r];for(var i in n)t[n[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[i]),delete n[i],e=!0)}return e};var Le=function(){this.layerIndexes={},this.crossTileIDs=new Pe,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Le.prototype.addLayer=function(t,e,r){var n=this.layerIndexes[t.id];void 0===n&&(n=this.layerIndexes[t.id]=new De);var i=!1,o={};n.handleWrapJump(r);for(var a=0,s=e;a<s.length;a+=1){var u=s[a],l=u.getBucket(t);l&&t.id===l.layerIds[0]&&(l.bucketInstanceId||(l.bucketInstanceId=++this.maxBucketInstanceId),n.addBucket(u.tileID,l,this.crossTileIDs)&&(i=!0),o[l.bucketInstanceId]=!0)}return n.removeStaleBuckets(o)&&(i=!0),i},Le.prototype.pruneUnusedLayers=function(t){var e={};for(var r in t.forEach(function(t){e[t]=!0}),this.layerIndexes)e[r]||delete this.layerIndexes[r]};var Oe=function(e,r){return t.emitValidationErrors(e,r&&r.filter(function(t){return"source.canvas"!==t.identifier}))},ke=t.pick(zt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Fe=t.pick(zt,["setCenter","setZoom","setBearing","setPitch"]),Be=function(e){function r(n,i){var o=this;void 0===i&&(i={}),e.call(this),this.map=n,this.dispatcher=new A((kt||(kt=new Ot),kt),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new v(n._requestManager,i.localIdeographFontFamily),this.lineAtlas=new E(256,512),this.crossTileSymbolIndex=new Le,this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=r.registerForPluginAvailability(function(t){for(var e in a.dispatcher.broadcast("loadRTLTextPlugin",t.pluginURL,t.completionCallback),a.sourceCaches)a.sourceCaches[e].reload()}),this.on("data",function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var r=e.getSource();if(r&&r.vectorLayerIds)for(var n in o._layers){var i=o._layers[n];i.source===r.id&&o._validateLayer(i)}}}})}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.loadURL=function(e,r){var n=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof r.validate?r.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,r.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,function(e,r){n._request=null,e?n.fire(new t.ErrorEvent(e)):r&&n._load(r,i)})},r.prototype.loadJSON=function(e,r){var n=this;void 0===r&&(r={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame(function(){n._request=null,n._load(e,!1!==r.validate)})},r.prototype._load=function(e,r){var n=this;if(!r||!Oe(this,t.validateStyle(e))){for(var i in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(i,e.sources[i],{validate:!1});e.sprite?this._spriteRequest=function(e,r,n){var i,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(r.transformRequest(r.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),function(t,e){u=null,a||(a=t,i=e,c())}),l=t.getImage(r.transformRequest(r.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),function(t,e){l=null,a||(a=t,o=e,c())});function c(){if(a)n(a);else if(i&&o){var e=t.browser.getImageData(o),r={};for(var s in i){var u=i[s],l=u.width,c=u.height,h=u.x,p=u.y,f=u.sdf,d=u.pixelRatio,m=new t.RGBAImage({width:l,height:c});t.RGBAImage.copy(e,m,{x:h,y:p},{x:0,y:0},{width:l,height:c}),r[s]={data:m,pixelRatio:d,sdf:f}}n(null,r)}}return{cancel:function(){u&&(u.cancel(),u=null),l&&(l.cancel(),l=null)}}}(e.sprite,this.map._requestManager,function(e,r){if(n._spriteRequest=null,e)n.fire(new t.ErrorEvent(e));else if(r)for(var i in r)n.imageManager.addImage(i,r[i]);n.imageManager.setLoaded(!0),n.dispatcher.broadcast("setImages",n.imageManager.listImages()),n.fire(new t.Event("data",{dataType:"style"}))}):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var o=Nt(this.stylesheet.layers);this._order=o.map(function(t){return t.id}),this._layers={};for(var a=0,s=o;a<s.length;a+=1){var u=s[a];(u=t.createStyleLayer(u)).setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=u}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},r.prototype._validateLayer=function(e){var r=this.sourceCaches[e.source];if(r){var n=e.sourceLayer;if(n){var i=r.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(n))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+n+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')))}}},r.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},r.prototype._serializeLayers=function(t){for(var e=[],r=0,n=t;r<n.length;r+=1){var i=this._layers[n[r]];"custom"!==i.type&&e.push(i.serialize())}return e},r.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},r.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},r.prototype.update=function(e){if(this._loaded){var r=this._changed;if(this._changed){var n=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var o in(n.length||i.length)&&this._updateWorkerLayers(n,i),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}for(var u in this.sourceCaches)this.sourceCaches[u].used=!1;for(var l=0,c=this._order;l<c.length;l+=1){var h=this._layers[c[l]];h.recalculate(e,this.imageManager.listImages()),!h.isHidden(e.zoom)&&h.source&&(this.sourceCaches[h.source].used=!0)}this.light.recalculate(e),this.z=e.zoom,r&&this.fire(new t.Event("data",{dataType:"style"}))}},r.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},r.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={}},r.prototype.setState=function(e){var r=this;if(this._checkLoaded(),Oe(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Nt(e.layers);var n=function(e,r){if(!e)return[{command:zt.setStyle,args:[r]}];var n=[];try{if(!t.deepEqual(e.version,r.version))return[{command:zt.setStyle,args:[r]}];t.deepEqual(e.center,r.center)||n.push({command:zt.setCenter,args:[r.center]}),t.deepEqual(e.zoom,r.zoom)||n.push({command:zt.setZoom,args:[r.zoom]}),t.deepEqual(e.bearing,r.bearing)||n.push({command:zt.setBearing,args:[r.bearing]}),t.deepEqual(e.pitch,r.pitch)||n.push({command:zt.setPitch,args:[r.pitch]}),t.deepEqual(e.sprite,r.sprite)||n.push({command:zt.setSprite,args:[r.sprite]}),t.deepEqual(e.glyphs,r.glyphs)||n.push({command:zt.setGlyphs,args:[r.glyphs]}),t.deepEqual(e.transition,r.transition)||n.push({command:zt.setTransition,args:[r.transition]}),t.deepEqual(e.light,r.light)||n.push({command:zt.setLight,args:[r.light]});var i={},o=[];!function(e,r,n,i){var o;for(o in r=r||{},e=e||{})e.hasOwnProperty(o)&&(r.hasOwnProperty(o)||Vt(o,n,i));for(o in r)r.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],r[o])||("geojson"===e[o].type&&"geojson"===r[o].type&&Gt(e,r,o)?n.push({command:zt.setGeoJSONSourceData,args:[o,r[o].data]}):jt(o,r,n,i)):Ut(o,r,n))}(e.sources,r.sources,o,i);var a=[];e.layers&&e.layers.forEach(function(t){i[t.source]?n.push({command:zt.removeLayer,args:[t.id]}):a.push(t)}),n=n.concat(o),function(e,r,n){r=r||[];var i,o,a,s,u,l,c,h=(e=e||[]).map(Ht),p=r.map(Ht),f=e.reduce(Xt,{}),d=r.reduce(Xt,{}),m=h.slice(),y=Object.create(null);for(i=0,o=0;i<h.length;i++)d.hasOwnProperty(a=h[i])?o++:(n.push({command:zt.removeLayer,args:[a]}),m.splice(m.indexOf(a,o),1));for(i=0,o=0;i<p.length;i++)m[m.length-1-i]!==(a=p[p.length-1-i])&&(f.hasOwnProperty(a)?(n.push({command:zt.removeLayer,args:[a]}),m.splice(m.lastIndexOf(a,m.length-o),1)):o++,n.push({command:zt.addLayer,args:[d[a],l=m[m.length-i]]}),m.splice(m.length-i,0,a),y[a]=!0);for(i=0;i<p.length;i++)if(s=f[a=p[i]],u=d[a],!y[a]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(c in qt(s.layout,u.layout,n,a,null,zt.setLayoutProperty),qt(s.paint,u.paint,n,a,null,zt.setPaintProperty),t.deepEqual(s.filter,u.filter)||n.push({command:zt.setFilter,args:[a,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||n.push({command:zt.setLayerZoomRange,args:[a,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?qt(s[c],u[c],n,a,c.slice(6),zt.setPaintProperty):t.deepEqual(s[c],u[c])||n.push({command:zt.setLayerProperty,args:[a,c,u[c]]}));for(c in u)u.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?qt(s[c],u[c],n,a,c.slice(6),zt.setPaintProperty):t.deepEqual(s[c],u[c])||n.push({command:zt.setLayerProperty,args:[a,c,u[c]]}))}else n.push({command:zt.removeLayer,args:[a]}),l=m[m.lastIndexOf(a)+1],n.push({command:zt.addLayer,args:[u,l]})}(a,r.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:zt.setStyle,args:[r]}]}return n}(this.serialize(),e).filter(function(t){return!(t.command in Fe)});if(0===n.length)return!1;var i=n.filter(function(t){return!(t.command in ke)});if(i.length>0)throw new Error("Unimplemented: "+i.map(function(t){return t.command}).join(", ")+".");return n.forEach(function(t){"setTransition"!==t.command&&r[t.command].apply(r,t.args)}),this.stylesheet=e,!0},r.prototype.addImage=function(e,r){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,r),this.fire(new t.Event("data",{dataType:"style"}))},r.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},r.prototype.getImage=function(t){return this.imageManager.getImage(t)},r.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this.fire(new t.Event("data",{dataType:"style"}))},r.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},r.prototype.addSource=function(e,r,n){var i=this;if(void 0===n&&(n={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!r.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(r).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,r,null,n))){this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);var o=this.sourceCaches[e]=new Ct(e,r,this.dispatcher);o.style=this,o.setEventedParent(this,function(){return{isSourceLoaded:i.loaded(),source:o.serialize(),sourceId:e}}),o.onAdd(this.map),this._changed=!0}},r.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var r in this._layers)if(this._layers[r].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+r+'" is using it.')));var n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.clearTiles(),n.onRemove&&n.onRemove(this.map),this._changed=!0},r.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},r.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},r.prototype.addLayer=function(e,r,n){void 0===n&&(n={}),this._checkLoaded();var i=e.id;if(this.getLayer(i))this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var o;if("custom"===e.type){if(Oe(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},n))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}})}var a=r?this._order.indexOf(r):this._order.length;if(r&&-1===a)this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.')));else{if(this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=o,this._removedLayers[i]&&o.source&&"custom"!==o.type){var s=this._removedLayers[i];delete this._removedLayers[i],s.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map)}}},r.prototype.moveLayer=function(e,r){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==r){var n=this._order.indexOf(e);this._order.splice(n,1);var i=r?this._order.indexOf(r):this._order.length;r&&-1===i?this.fire(new t.ErrorEvent(new Error('Layer with id "'+r+'" does not exist on this map.'))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},r.prototype.removeLayer=function(e){this._checkLoaded();var r=this._layers[e];if(r){r.setEventedParent(null);var n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=r,delete this._layers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],r.onRemove&&r.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},r.prototype.getLayer=function(t){return this._layers[t]},r.prototype.setLayerZoomRange=function(e,r,n){this._checkLoaded();var i=this.getLayer(e);i?i.minzoom===r&&i.maxzoom===n||(null!=r&&(i.minzoom=r),null!=n&&(i.maxzoom=n),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},r.prototype.setFilter=function(e,r,n){void 0===n&&(n={}),this._checkLoaded();var i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,r))return null==r?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,"layers."+i.id+".filter",r,null,n)||(i.filter=t.clone$1(r),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},r.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},r.prototype.setLayoutProperty=function(e,r,n,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(r),n)||(o.setLayoutProperty(r,n,i),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getLayoutProperty=function(e,r){var n=this.getLayer(e);if(n)return n.getLayoutProperty(r);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},r.prototype.setPaintProperty=function(e,r,n,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(r),n)||(o.setPaintProperty(r,n,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},r.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},r.prototype.setFeatureState=function(e,r){this._checkLoaded();var n=e.source,i=e.sourceLayer,o=this.sourceCaches[n],a=parseInt(e.id,10);if(void 0!==o){var s=o.getSource().type;"geojson"===s&&i?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==s||i?isNaN(a)||a<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative."))):o.setFeatureState(i,a,r):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},r.prototype.removeFeatureState=function(e,r){this._checkLoaded();var n=e.source,i=this.sourceCaches[n];if(void 0!==i){var o=i.getSource().type,a="vector"===o?e.sourceLayer:void 0,s=parseInt(e.id,10);"vector"!==o||a?void 0!==e.id&&isNaN(s)||s<0?this.fire(new t.ErrorEvent(new Error("The feature id parameter must be non-negative."))):r&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is requred to remove its specific state property."))):i.removeFeatureState(a,s,r):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},r.prototype.getFeatureState=function(e){this._checkLoaded();var r=e.source,n=e.sourceLayer,i=this.sourceCaches[r],o=parseInt(e.id,10);if(void 0!==i)if("vector"!==i.getSource().type||n){if(!(isNaN(o)||o<0))return i.getFeatureState(n,o);this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided and non-negative.")))}else this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},r.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},r.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._serializeLayers(this._order)},function(t){return void 0!==t})},r.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},r.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,r=function(t){return"fill-extrusion"===e._layers[t].type},n={},i=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(r(a)){n[a]=o;for(var s=0,u=t;s<u.length;s+=1){var l=u[s][a];if(l)for(var c=0,h=l;c<h.length;c+=1){i.push(h[c])}}}}i.sort(function(t,e){return e.intersectionZ-t.intersectionZ});for(var p=[],f=this._order.length-1;f>=0;f--){var d=this._order[f];if(r(d))for(var m=i.length-1;m>=0;m--){var y=i[m].feature;if(n[y.layer.id]<f)break;p.push(y),i.pop()}else for(var _=0,g=t;_<g.length;_+=1){var v=g[_][d];if(v)for(var x=0,b=v;x<b.length;x+=1){p.push(b[x].feature)}}}return p},r.prototype.queryRenderedFeatures=function(e,r,n){r&&r.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",r.filter,null,r);var i={};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=r.layers;o<a.length;o+=1){var s=a[o],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[u.source]=!0}}var l=[];for(var c in this.sourceCaches)r.layers&&!i[c]||l.push(B(this.sourceCaches[c],this._layers,e,r,n));return this.placement&&l.push(function(t,e,r,n,i,o){for(var a={},s=i.queryRenderedSymbols(r),u=[],l=0,c=Object.keys(s).map(Number);l<c.length;l+=1){u.push(o[c[l]])}u.sort(N);for(var h=function(){var e=f[p],r=e.featureIndex.lookupSymbolFeatures(s[e.bucketInstanceId],e.bucketIndex,e.sourceLayerIndex,n.filter,n.layers,t);for(var i in r){var o=a[i]=a[i]||[],u=r[i];u.sort(function(t,r){var n=e.featureSortOrder;if(n){var i=n.indexOf(t.featureIndex);return n.indexOf(r.featureIndex)-i}return r.featureIndex-t.featureIndex});for(var l=0,c=u;l<c.length;l+=1){o.push(c[l])}}},p=0,f=u;p<f.length;p+=1)h();var d=function(r){a[r].forEach(function(n){var i=n.feature,o=e[t[r].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o})};for(var m in a)d(m);return a}(this._layers,this.sourceCaches,e,r,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(l)},r.prototype.querySourceFeatures=function(e,r){r&&r.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",r.filter,null,r);var n=this.sourceCaches[e];return n?function(t,e){for(var r=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),n=[],i={},o=0;o<r.length;o++){var a=r[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(n,e))}return n}(n,r):[]},r.prototype.addSourceType=function(t,e,n){return r.getSourceType(t)?n(new Error('A source type called "'+t+'" already exists.')):(r.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))},r.prototype.getLight=function(){return this.light.getLight()},r.prototype.setLight=function(e,r){void 0===r&&(r={}),this._checkLoaded();var n=this.light.getLight(),i=!1;for(var o in e)if(!t.deepEqual(e[o],n[o])){i=!0;break}if(i){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,r),this.light.updateTransitions(a)}},r.prototype._validate=function(e,r,n,i,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&Oe(this,e.call(t.validateStyle,t.extend({key:r,style:this.serialize(),value:n,styleSpec:t.styleSpec},i)))},r.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginAvailable",this._rtlTextPluginCallback),this.sourceCaches)this.sourceCaches[e].clearTiles();this.dispatcher.remove()},r.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},r.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},r.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},r.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},r.prototype._updatePlacement=function(e,r,n,i){for(var o=!1,a=!1,s={},u=0,l=this._order;u<l.length;u+=1){var c=this._layers[l[u]];if("symbol"===c.type){if(!s[c.source]){var h=this.sourceCaches[c.source];s[c.source]=h.getRenderableIds(!0).map(function(t){return h.getTileByID(t)}).sort(function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)})}var p=this.crossTileSymbolIndex.addLayer(c,s[c.source],e.center.lng);o=o||p}}this.crossTileSymbolIndex.pruneUnusedLayers(this._order);var f=this._layerOrderChanged||0===n;if((f||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now()))&&(this.pauseablePlacement=new Re(e,this._order,f,r,n,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,s),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),a=!0),o&&this.pauseablePlacement.placement.setStale()),a||o)for(var d=0,m=this._order;d<m.length;d+=1){var y=this._layers[m[d]];"symbol"===y.type&&this.placement.updateLayerOpacities(y,s[y.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},r.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},r.prototype.getImages=function(t,e,r){this.imageManager.getImages(e.icons,r)},r.prototype.getGlyphs=function(t,e,r){this.glyphManager.getGlyphs(e.stacks,r)},r.prototype.getResource=function(e,r,n){return t.makeRequest(r,n)},r}(t.Evented);Be.getSourceType=function(t){return O[t]},Be.setSourceType=function(t,e){O[t]=e},Be.registerForPluginAvailability=t.registerForPluginAvailability;var Ne=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),ze=cr("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),Ue=cr("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Ve=cr("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),je=cr("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ge=cr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),qe=cr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),He=cr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Xe=cr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Ye=cr("uniform float u_overscale_factor;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {float alpha=0.5;vec4 color=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {color=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {color*=.2;}float extrude_scale_length=length(v_extrude_scale);float extrude_length=length(v_extrude)*extrude_scale_length;float stroke_width=15.0*extrude_scale_length/u_overscale_factor;float radius=v_radius*extrude_scale_length;float distance_to_edge=abs(extrude_length-radius);float opacity_t=smoothstep(-stroke_width,0.0,-distance_to_edge);gl_FragColor=opacity_t*color;}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;varying float v_radius;varying vec2 v_extrude;varying vec2 v_extrude_scale;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);highp float padding_factor=1.2;gl_Position.xy+=a_extrude*u_extrude_scale*padding_factor*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;v_radius=abs(a_extrude.y);v_extrude=a_extrude*padding_factor;v_extrude_scale=u_extrude_scale*u_camera_to_center_distance*collision_perspective_ratio;}"),Ze=cr("uniform highp vec4 u_color;void main() {gl_FragColor=u_color;}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),We=cr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),Ke=cr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Je=cr("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),Qe=cr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec4 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),$e=cr("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),tr=cr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec4 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),er=cr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform float u_maxzoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggeration=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/ pow(2.0,(u_zoom-u_maxzoom)*exaggeration+19.2562-u_zoom);gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),rr=cr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),nr=cr("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),ir=cr("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,vec2(v_lineprogress,0.5));gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define MAX_LINE_DISTANCE 32767.0\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_lineprogress;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_lineprogress=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0/MAX_LINE_DISTANCE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),or=cr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec4 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float pixelRatio=u_scale.x;float tileZoomRatio=u_scale.y;float fromScale=u_scale.z;float toScale=u_scale.w;vec2 display_size_a=vec2((pattern_br_a.x-pattern_tl_a.x)/pixelRatio,(pattern_br_a.y-pattern_tl_a.y)/pixelRatio);vec2 display_size_b=vec2((pattern_br_b.x-pattern_tl_b.x)/pixelRatio,(pattern_br_b.y-pattern_tl_b.y)/pixelRatio);vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x,1.0);float x_b=mod(v_linesofar/pattern_size_b.x,1.0);float y_a=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_a.y+2.0)/2.0)/pattern_size_a.y);float y_b=0.5+(v_normal.y*clamp(v_width2.s,0.0,(pattern_size_b.y+2.0)/2.0)/pattern_size_b.y);vec2 pos_a=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,vec2(x_a,y_a));vec2 pos_b=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,vec2(x_b,y_b));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);}"),ar=cr("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),sr=cr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),ur=cr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size[0],a_size[1],u_size_t)/256.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size[0]/256.0;} else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {size=u_size;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),lr=cr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size[0],a_size[1],u_size_t)/256.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size[0]/256.0;} else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {size=u_size;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=vec2(tex.x,tex.y);v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}");function cr(t,e){var r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n={};return{fragmentSource:t=t.replace(r,function(t,e,r,i,o){return n[o]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nvarying "+r+" "+i+" "+o+";\n#else\nuniform "+r+" "+i+" u_"+o+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+o+"\n    "+r+" "+i+" "+o+" = u_"+o+";\n#endif\n"}),vertexSource:e=e.replace(r,function(t,e,r,i,o){var a="float"===i?"vec2":"vec4",s=o.match(/color/)?"color":a;return n[o]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float u_"+o+"_t;\nattribute "+r+" "+a+" a_"+o+";\nvarying "+r+" "+i+" "+o+";\n#else\nuniform "+r+" "+i+" u_"+o+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+o+" = a_"+o+";\n#else\n    "+r+" "+i+" "+o+" = u_"+o+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+o+" = unpack_mix_"+s+"(a_"+o+", u_"+o+"_t);\n#else\n    "+r+" "+i+" "+o+" = u_"+o+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+o+"\nuniform lowp float u_"+o+"_t;\nattribute "+r+" "+a+" a_"+o+";\n#else\nuniform "+r+" "+i+" u_"+o+";\n#endif\n":"vec4"===s?"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+r+" "+i+" "+o+" = a_"+o+";\n#else\n    "+r+" "+i+" "+o+" = u_"+o+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+o+"\n    "+r+" "+i+" "+o+" = unpack_mix_"+s+"(a_"+o+", u_"+o+"_t);\n#else\n    "+r+" "+i+" "+o+" = u_"+o+";\n#endif\n"})}}var hr=Object.freeze({prelude:ze,background:Ue,backgroundPattern:Ve,circle:je,clippingMask:Ge,heatmap:qe,heatmapTexture:He,collisionBox:Xe,collisionCircle:Ye,debug:Ze,fill:We,fillOutline:Ke,fillOutlinePattern:Je,fillPattern:Qe,fillExtrusion:$e,fillExtrusionPattern:tr,hillshadePrepare:er,hillshade:rr,line:nr,lineGradient:ir,linePattern:or,lineSDF:ar,raster:sr,symbolIcon:ur,symbolSDF:lr}),pr=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};pr.prototype.bind=function(t,e,r,n,i,o,a,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==n.length,l=0;!u&&l<n.length;l++)this.boundPaintVertexBuffers[l]!==n[l]&&(u=!0);!t.extVertexArrayObject||(!this.vao||this.boundProgram!==e||this.boundLayoutVertexBuffer!==r||u||this.boundIndexBuffer!==i||this.boundVertexOffset!==o||this.boundDynamicVertexBuffer!==a||this.boundDynamicVertexBuffer2!==s)?this.freshBind(e,r,n,i,o,a,s):(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind())},pr.prototype.freshBind=function(t,e,r,n,i,o,a){var s,u=t.numAttributes,l=this.context,c=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=l.currentNumAttributes||0;for(var h=u;h<s;h++)c.disableVertexAttribArray(h)}e.enableAttributes(c,t);for(var p=0,f=r;p<f.length;p+=1)f[p].enableAttributes(c,t);o&&o.enableAttributes(c,t),a&&a.enableAttributes(c,t),e.bind(),e.setVertexAttribPointers(c,t,i);for(var d=0,m=r;d<m.length;d+=1){var y=m[d];y.bind(),y.setVertexAttribPointers(c,t,i)}o&&(o.bind(),o.setVertexAttribPointers(c,t,i)),n&&n.bind(),a&&(a.bind(),a.setVertexAttribPointers(c,t,i)),l.currentNumAttributes=u},pr.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var fr=function(t,e,r,n,i){var o=t.gl;this.program=o.createProgram();var a=r.defines();i&&a.push("#define OVERDRAW_INSPECTOR;");var s=a.concat(ze.fragmentSource,e.fragmentSource).join("\n"),u=a.concat(ze.vertexSource,e.vertexSource).join("\n"),l=o.createShader(o.FRAGMENT_SHADER);o.shaderSource(l,s),o.compileShader(l),o.attachShader(this.program,l);var c=o.createShader(o.VERTEX_SHADER);o.shaderSource(c,u),o.compileShader(c),o.attachShader(this.program,c);for(var h=r.layoutAttributes||[],p=0;p<h.length;p++)o.bindAttribLocation(this.program,p,h[p].name);o.linkProgram(this.program),this.numAttributes=o.getProgramParameter(this.program,o.ACTIVE_ATTRIBUTES),this.attributes={};for(var f={},d=0;d<this.numAttributes;d++){var m=o.getActiveAttrib(this.program,d);m&&(this.attributes[m.name]=o.getAttribLocation(this.program,m.name))}for(var y=o.getProgramParameter(this.program,o.ACTIVE_UNIFORMS),_=0;_<y;_++){var g=o.getActiveUniform(this.program,_);g&&(f[g.name]=o.getUniformLocation(this.program,g.name))}this.fixedUniforms=n(t,f),this.binderUniforms=r.getUniforms(t,f)};function dr(e,r,n){var i=1/le(n,1,r.transform.tileZoom),o=Math.pow(2,n.tileID.overscaledZ),a=n.tileSize*Math.pow(2,r.transform.tileZoom)/o,s=a*(n.tileID.canonical.x+n.tileID.wrap*o),u=a*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[t.browser.devicePixelRatio,i,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[s>>16,u>>16],u_pixel_coord_lower:[65535&s,65535&u]}}fr.prototype.draw=function(t,e,r,n,i,o,a,s,u,l,c,h,p,f,d,m){var y,_=t.gl;for(var g in t.program.set(this.program),t.setDepthMode(r),t.setStencilMode(n),t.setColorMode(i),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[g].set(a[g]);f&&f.setUniforms(t,this.binderUniforms,h,{zoom:p});for(var v=(y={},y[_.LINES]=2,y[_.TRIANGLES]=3,y[_.LINE_STRIP]=1,y)[e],x=0,b=c.get();x<b.length;x+=1){var w=b[x],E=w.vaos||(w.vaos={});(E[s]||(E[s]=new pr)).bind(t,this,u,f?f.getPaintVertexBuffers():[],l,w.vertexOffset,d,m),_.drawElements(e,w.primitiveLength*v,_.UNSIGNED_SHORT,w.primitiveOffset*v*2)}};var mr=function(e,r,n,i){var o=r.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],u=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(u,-r.transform.angle),t.transformMat3(s,s,u);var l=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[l.r,l.g,l.b],u_vertical_gradient:+n,u_opacity:i}},yr=function(e,r,n,i,o,a,s){return t.extend(mr(e,r,n,i),dr(a,r,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},_r=function(t){return{u_matrix:t}},gr=function(e,r,n,i){return t.extend(_r(e),dr(n,r,i))},vr=function(t,e){return{u_matrix:t,u_world:e}},xr=function(e,r,n,i,o){return t.extend(gr(e,r,n,i),{u_world:o})},br=function(e,r,n,i){var o,a,s=e.transform;if("map"===i.paint.get("circle-pitch-alignment")){var u=le(n,1,s.zoom);o=!0,a=[u,u]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(r.posMatrix,n,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},wr=function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,r.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,r.u_overscale_factor)}},Er=function(t,e,r){var n=le(r,1,e.zoom),i=Math.pow(2,e.zoom-r.tileID.overscaledZ),o=r.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:n,u_extrude_scale:[e.pixelsToGLUnits[0]/(n*i),e.pixelsToGLUnits[1]/(n*i)],u_overscale_factor:o}},Ar=function(t,e){return{u_matrix:t,u_color:e}},Tr=function(t){return{u_matrix:t}},Mr=function(t,e,r,n){return{u_matrix:t,u_extrude_scale:le(e,1,r),u_intensity:n}},Sr=function(t,e,r){var n=r.paint.get("hillshade-shadow-color"),i=r.paint.get("hillshade-highlight-color"),o=r.paint.get("hillshade-accent-color"),a=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);var s=!t.options.moving;return{u_matrix:t.transform.calculatePosMatrix(e.tileID.toUnwrapped(),s),u_image:0,u_latrange:Ir(t,e.tileID),u_light:[r.paint.get("hillshade-exaggeration"),a],u_shadow:n,u_highlight:i,u_accent:o}},Rr=function(e,r,n){var i=r.stride,o=t.create();return t.ortho(o,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(o,o,[0,-t.EXTENT,0]),{u_matrix:o,u_image:1,u_dimension:[i,i],u_zoom:e.overscaledZ,u_maxzoom:n,u_unpack:r.getUnpackVector()}};function Ir(e,r){var n=Math.pow(2,r.canonical.z),i=r.canonical.y;return[new t.MercatorCoordinate(0,i/n).toLngLat().lat,new t.MercatorCoordinate(0,(i+1)/n).toLngLat().lat]}var Cr=function(e,r,n){var i=e.transform;return{u_matrix:kr(e,r,n),u_ratio:1/le(r,1,i.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},Pr=function(e,r,n){return t.extend(Cr(e,r,n),{u_image:0})},Dr=function(e,r,n,i){var o=e.transform,a=Or(r,o);return{u_matrix:kr(e,r,n),u_texsize:r.imageAtlasTexture.size,u_ratio:1/le(r,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[t.browser.devicePixelRatio,a,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Lr=function(e,r,n,i,o){var a=e.lineAtlas,s=Or(r,e.transform),u="round"===n.layout.get("line-cap"),l=a.getDash(i.from,u),c=a.getDash(i.to,u),h=l.width*o.fromScale,p=c.width*o.toScale;return t.extend(Cr(e,r,n),{u_patternscale_a:[s/h,-l.height/2],u_patternscale_b:[s/p,-c.height/2],u_sdfgamma:a.width/(256*Math.min(h,p)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:l.y,u_tex_y_b:c.y,u_mix:o.t})};function Or(t,e){return 1/le(t,1,e.tileZoom)}function kr(t,e,r){return t.translatePosMatrix(e.tileID.posMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}var Fr=function(t,e,r,n,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:r,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Br(i.paint.get("raster-hue-rotate"))};var o,a};function Br(t){t*=Math.PI/180;var e=Math.sin(t),r=Math.cos(t);return[(2*r+1)/3,(-Math.sqrt(3)*e-r+1)/3,(Math.sqrt(3)*e-r+1)/3]}var Nr=function(t,e,r,n,i,o,a,s,u,l){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+r,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+n,u_texsize:l,u_texture:0}},zr=function(e,r,n,i,o,a,s,u,l,c,h){var p=o.transform;return t.extend(Nr(e,r,n,i,o,a,s,u,l,c),{u_gamma_scale:i?Math.cos(p._pitch)*p.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},Ur=function(t,e,r){return{u_matrix:t,u_opacity:e,u_color:r}},Vr=function(e,r,n,i,o,a){return t.extend(function(t,e,r,n){var i=r.imageManager.getPattern(t.from.toString()),o=r.imageManager.getPattern(t.to.toString()),a=r.imageManager.getPixelSize(),s=a.width,u=a.height,l=Math.pow(2,n.tileID.overscaledZ),c=n.tileSize*Math.pow(2,r.transform.tileZoom)/l,h=c*(n.tileID.canonical.x+n.tileID.wrap*l),p=c*n.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/le(n,1,r.transform.tileZoom),u_pixel_coord_upper:[h>>16,p>>16],u_pixel_coord_lower:[65535&h,65535&p]}}(i,a,n,o),{u_matrix:e,u_opacity:r})},jr={fillExtrusion:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fillExtrusionPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_lightpos:new t.Uniform3f(e,r.u_lightpos),u_lightintensity:new t.Uniform1f(e,r.u_lightintensity),u_lightcolor:new t.Uniform3f(e,r.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,r.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,r.u_height_factor),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade),u_opacity:new t.Uniform1f(e,r.u_opacity)}},fill:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},fillPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},fillOutline:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world)}},fillOutlinePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_texsize:new t.Uniform2f(e,r.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},circle:function(e,r){return{u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,r.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,r.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},collisionBox:wr,collisionCircle:wr,debug:function(e,r){return{u_color:new t.UniformColor(e,r.u_color),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},clippingMask:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmap:function(e,r){return{u_extrude_scale:new t.Uniform1f(e,r.u_extrude_scale),u_intensity:new t.Uniform1f(e,r.u_intensity),u_matrix:new t.UniformMatrix4f(e,r.u_matrix)}},heatmapTexture:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_world:new t.Uniform2f(e,r.u_world),u_image:new t.Uniform1i(e,r.u_image),u_color_ramp:new t.Uniform1i(e,r.u_color_ramp),u_opacity:new t.Uniform1f(e,r.u_opacity)}},hillshade:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_latrange:new t.Uniform2f(e,r.u_latrange),u_light:new t.Uniform2f(e,r.u_light),u_shadow:new t.UniformColor(e,r.u_shadow),u_highlight:new t.UniformColor(e,r.u_highlight),u_accent:new t.UniformColor(e,r.u_accent)}},hillshadePrepare:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_image:new t.Uniform1i(e,r.u_image),u_dimension:new t.Uniform2f(e,r.u_dimension),u_zoom:new t.Uniform1f(e,r.u_zoom),u_maxzoom:new t.Uniform1f(e,r.u_maxzoom),u_unpack:new t.Uniform4f(e,r.u_unpack)}},line:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels)}},lineGradient:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_image:new t.Uniform1i(e,r.u_image)}},linePattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_texsize:new t.Uniform2f(e,r.u_texsize),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_image:new t.Uniform1i(e,r.u_image),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_scale:new t.Uniform4f(e,r.u_scale),u_fade:new t.Uniform1f(e,r.u_fade)}},lineSDF:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_ratio:new t.Uniform1f(e,r.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,r.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,r.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,r.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,r.u_sdfgamma),u_image:new t.Uniform1i(e,r.u_image),u_tex_y_a:new t.Uniform1f(e,r.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,r.u_tex_y_b),u_mix:new t.Uniform1f(e,r.u_mix)}},raster:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_tl_parent:new t.Uniform2f(e,r.u_tl_parent),u_scale_parent:new t.Uniform1f(e,r.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,r.u_buffer_scale),u_fade_t:new t.Uniform1f(e,r.u_fade_t),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image0:new t.Uniform1i(e,r.u_image0),u_image1:new t.Uniform1i(e,r.u_image1),u_brightness_low:new t.Uniform1f(e,r.u_brightness_low),u_brightness_high:new t.Uniform1f(e,r.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,r.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,r.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,r.u_spin_weights)}},symbolIcon:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1f(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture)}},symbolSDF:function(e,r){return{u_is_size_zoom_constant:new t.Uniform1i(e,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,r.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,r.u_size_t),u_size:new t.Uniform1f(e,r.u_size),u_camera_to_center_distance:new t.Uniform1f(e,r.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,r.u_pitch),u_rotate_symbol:new t.Uniform1i(e,r.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,r.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,r.u_fade_change),u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,r.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,r.u_coord_matrix),u_is_text:new t.Uniform1f(e,r.u_is_text),u_pitch_with_map:new t.Uniform1i(e,r.u_pitch_with_map),u_texsize:new t.Uniform2f(e,r.u_texsize),u_texture:new t.Uniform1i(e,r.u_texture),u_gamma_scale:new t.Uniform1f(e,r.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,r.u_device_pixel_ratio),u_is_halo:new t.Uniform1f(e,r.u_is_halo)}},background:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_color:new t.UniformColor(e,r.u_color)}},backgroundPattern:function(e,r){return{u_matrix:new t.UniformMatrix4f(e,r.u_matrix),u_opacity:new t.Uniform1f(e,r.u_opacity),u_image:new t.Uniform1i(e,r.u_image),u_pattern_tl_a:new t.Uniform2f(e,r.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,r.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,r.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,r.u_pattern_br_b),u_texsize:new t.Uniform2f(e,r.u_texsize),u_mix:new t.Uniform1f(e,r.u_mix),u_pattern_size_a:new t.Uniform2f(e,r.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,r.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,r.u_scale_a),u_scale_b:new t.Uniform1f(e,r.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,r.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,r.u_tile_units_to_pixels)}}};function Gr(e,r){for(var n=e.sort(function(t,e){return t.tileID.isLessThan(e.tileID)?-1:e.tileID.isLessThan(t.tileID)?1:0}),i=0;i<n.length;i++){var o={},a=n[i],s=n.slice(i+1);qr(a.tileID.wrapped(),a.tileID,s,new t.OverscaledTileID(0,a.tileID.wrap+1,0,0,0),o),a.setMask(o,r)}}function qr(e,r,n,i,o){for(var a=0;a<n.length;a++){var s=n[a];if(i.isLessThan(s.tileID))break;if(r.key===s.tileID.key)return;if(s.tileID.isChildOf(r)){for(var u=r.children(1/0),l=0;l<u.length;l++)qr(e,u[l],n.slice(a),i,o);return}}var c=r.overscaledZ-e.overscaledZ,h=new t.CanonicalTileID(c,r.canonical.x-(e.canonical.x<<c),r.canonical.y-(e.canonical.y<<c));o[h.key]=o[h.key]||h}function Hr(t,e,r,n,i,o,a,s){for(var u=t.context,l=u.gl,c=t.useProgram(i?"collisionCircle":"collisionBox"),h=0;h<n.length;h++){var p=n[h],f=e.getTile(p),d=f.getBucket(r);if(d){var m=i?s?d.textCollisionCircle:d.iconCollisionCircle:s?d.textCollisionBox:d.iconCollisionBox;if(m){var y=p.posMatrix;0===o[0]&&0===o[1]||(y=t.translatePosMatrix(p.posMatrix,f,o,a)),c.draw(u,i?l.TRIANGLES:l.LINES,Tt.disabled,Mt.disabled,t.colorModeForRenderPass(),Rt.disabled,Er(y,t.transform,f),r.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,null,t.transform.zoom,null,null,m.collisionVertexBuffer)}}}}function Xr(t,e,r,n,i,o,a){Hr(t,e,r,n,!1,i,o,a),Hr(t,e,r,n,!0,i,o,a)}var Yr=t.identity(new Float32Array(16));function Zr(e,r,n,i,o,a){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*r,l=-(s.verticalAlign-.5)*n,c=t.evaluateVariableOffset(e,i);return new t.Point((u/o+c[0])*a,(l/o+c[1])*a)}function Wr(e,r,n,i,o,a,s,u,l,c,h){var p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,d=e.icon.dynamicLayoutVertexArray,m={};f.clear();for(var y=0;y<p.length;y++){var _=p.get(y),g=_.hidden||!_.crossTileID||e.allowVerticalPlacement&&!_.placedOrientation?null:i[_.crossTileID];if(g){var v=new t.Point(_.anchorX,_.anchorY),x=Kt(v,n?u:s),b=.5+a.cameraToCenterDistance/x.signedDistanceFromCamera*.5,w=o.evaluateSizeForFeature(e.textSizeData,c,_)*b/t.ONE_EM;n&&(w*=e.tilePixelRatio/l);for(var E=Zr(g.anchor,g.width,g.height,g.textOffset,g.textBoxScale,w),A=n?Kt(v.add(E),s).point:x.point.add(r?E.rotate(-a.angle):E),T=e.allowVerticalPlacement&&_.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,M=0;M<_.numGlyphs;M++)t.addDynamicAttributes(f,A,T);h&&_.associatedIconIndex>=0&&(m[_.associatedIconIndex]={shiftedAnchor:A,angle:T})}else oe(_.numGlyphs,f)}if(h){d.clear();for(var S=e.icon.placedSymbolArray,R=0;R<S.length;R++){var I=S.get(R);if(I.hidden)oe(I.numGlyphs,d);else{var C=m[R];if(C)for(var P=0;P<I.numGlyphs;P++)t.addDynamicAttributes(d,C.shiftedAnchor,C.angle);else oe(I.numGlyphs,d)}}e.icon.dynamicLayoutVertexBuffer.updateData(d)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function Kr(e){var r=e.text.placedSymbolArray,n=e.text.dynamicLayoutVertexArray;n.clear();for(var i=0;i<r.length;i++){var o=r.get(i);if(o.hidden||!o.placedOrientation)oe(o.numGlyphs,n);else for(var a=new t.Point(o.anchorX,o.anchorY),s=e.allowVerticalPlacement&&o.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,u=0;u<o.numGlyphs;u++)t.addDynamicAttributes(n,a,s)}e.text.dynamicLayoutVertexBuffer.updateData(n)}function Jr(e,r,n,i,o,a,s,u,l,c,h,p){for(var f,d,m=e.context,y=m.gl,_=e.transform,g="map"===u,v="map"===l,x=g&&"point"!==n.layout.get("symbol-placement"),b=g&&!v&&!x,w=void 0!==n.layout.get("symbol-sort-key").constantOr(1),E=e.depthModeForSublayer(0,Tt.ReadOnly),A=n.layout.get("text-variable-anchor"),T=[],M=0,S=i;M<S.length;M+=1){var R=S[M],I=r.getTile(R),C=I.getBucket(n);if(C){var P=o?C.text:C.icon;if(P&&P.segments.get().length){var D=P.programConfigurations.get(n.id),L=o||C.sdfIcons,O=o?C.textSizeData:C.iconSizeData;f||(f=e.useProgram(L?"symbolSDF":"symbolIcon",D),d=t.evaluateSizeForZoom(O,_.zoom)),m.activeTexture.set(y.TEXTURE0);var k=void 0,F=void 0,B=void 0;if(o)F=I.glyphAtlasTexture,B=y.LINEAR,k=I.glyphAtlasTexture.size;else{var N=1!==n.layout.get("icon-size").constantOr(0)||C.iconsNeedLinear;F=I.imageAtlasTexture,B=L||e.options.rotating||e.options.zooming||N||(v||0!==_.pitch)?y.LINEAR:y.NEAREST,k=I.imageAtlasTexture.size}var z=le(I,1,e.transform.zoom),U=Zt(R.posMatrix,v,g,e.transform,z),V=Wt(R.posMatrix,v,g,e.transform,z),j=A&&C.hasTextData(),G="none"!==n.layout.get("icon-text-fit")&&j&&C.hasIconData();x?Qt(C,R.posMatrix,e,o,U,V,v,c):o&&d&&C.allowVerticalPlacement&&!A&&Kr(C);var q=e.translatePosMatrix(R.posMatrix,I,a,s),H=x||o&&A||G?Yr:U,X=e.translatePosMatrix(V,I,a,s,!0),Y=L&&0!==n.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),Z={program:f,buffers:P,uniformValues:L?zr(O.kind,d,b,v,e,q,H,X,o,k,!0):Nr(O.kind,d,b,v,e,q,H,X,o,k),atlasTexture:F,atlasInterpolation:B,isSDF:L,hasHalo:Y};if(w)for(var W=0,K=P.segments.get();W<K.length;W+=1){var J=K[W];T.push({segments:new t.SegmentVector([J]),sortKey:J.sortKey,state:Z})}else T.push({segments:P.segments,sortKey:0,state:Z})}}}w&&T.sort(function(t,e){return t.sortKey-e.sortKey});for(var Q=0,$=T;Q<$.length;Q+=1){var tt=$[Q],et=tt.state;if(et.atlasTexture.bind(et.atlasInterpolation,y.CLAMP_TO_EDGE),et.isSDF){var rt=et.uniformValues;et.hasHalo&&(rt.u_is_halo=1,Qr(et.buffers,tt.segments,n,e,et.program,E,h,p,rt)),rt.u_is_halo=0}Qr(et.buffers,tt.segments,n,e,et.program,E,h,p,et.uniformValues)}}function Qr(t,e,r,n,i,o,a,s,u){var l=n.context;i.draw(l,l.gl.TRIANGLES,o,a,s,Rt.disabled,u,r.id,t.layoutVertexBuffer,t.indexBuffer,e,r.paint,n.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function $r(t,e,r,n,i,o,a){var s,u,l,c,h,p=t.context.gl,f=r.paint.get("fill-pattern"),d=f&&f.constantOr(1),m=r.getCrossfadeParameters();a?(u=d&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=p.LINES):(u=d?"fillPattern":"fill",s=p.TRIANGLES);for(var y=0,_=n;y<_.length;y+=1){var g=_[y],v=e.getTile(g);if(!d||v.patternsLoaded()){var x=v.getBucket(r);if(x){var b=x.programConfigurations.get(r.id),w=t.useProgram(u,b);d&&(t.context.activeTexture.set(p.TEXTURE0),v.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),b.updatePatternPaintBuffers(m));var E=f.constantOr(null);if(E&&v.imageAtlas){var A=v.imageAtlas,T=A.patternPositions[E.to.toString()],M=A.patternPositions[E.from.toString()];T&&M&&b.setConstantPatternPositions(T,M)}var S=t.translatePosMatrix(g.posMatrix,v,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(a){c=x.indexBuffer2,h=x.segments2;var R=[p.drawingBufferWidth,p.drawingBufferHeight];l="fillOutlinePattern"===u&&d?xr(S,t,m,v,R):vr(S,R)}else c=x.indexBuffer,h=x.segments,l=d?gr(S,t,m,v):_r(S);w.draw(t.context,s,i,t.stencilModeForClipping(g),o,Rt.disabled,l,r.id,x.layoutVertexBuffer,c,h,r.paint,t.transform.zoom,b)}}}}function tn(t,e,r,n,i,o,a){for(var s=t.context,u=s.gl,l=r.paint.get("fill-extrusion-pattern"),c=l.constantOr(1),h=r.getCrossfadeParameters(),p=r.paint.get("fill-extrusion-opacity"),f=0,d=n;f<d.length;f+=1){var m=d[f],y=e.getTile(m),_=y.getBucket(r);if(_){var g=_.programConfigurations.get(r.id),v=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",g);c&&(t.context.activeTexture.set(u.TEXTURE0),y.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),g.updatePatternPaintBuffers(h));var x=l.constantOr(null);if(x&&y.imageAtlas){var b=y.imageAtlas,w=b.patternPositions[x.to.toString()],E=b.patternPositions[x.from.toString()];w&&E&&g.setConstantPatternPositions(w,E)}var A=t.translatePosMatrix(m.posMatrix,y,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),T=r.paint.get("fill-extrusion-vertical-gradient"),M=c?yr(A,t,T,p,m,h,y):mr(A,t,T,p);v.draw(s,s.gl.TRIANGLES,i,o,a,Rt.backCCW,M,r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,r.paint,t.transform.zoom,g)}}}function en(t,e,r,n,i,o){var a=t.context,s=a.gl,u=e.fbo;if(u){var l=t.useProgram("hillshade");a.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,u.colorAttachment.get());var c=Sr(t,e,r);e.maskedBoundsBuffer&&e.maskedIndexBuffer&&e.segments?l.draw(a,s.TRIANGLES,n,i,o,Rt.disabled,c,r.id,e.maskedBoundsBuffer,e.maskedIndexBuffer,e.segments):l.draw(a,s.TRIANGLES,n,i,o,Rt.disabled,c,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function rn(e,r,n,i,o,a,s){var u=e.context,l=u.gl,c=r.dem;if(c&&c.data){var h=c.dim,p=c.stride,f=c.getPixels();if(u.activeTexture.set(l.TEXTURE1),u.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||e.getTileTexture(p),r.demTexture){var d=r.demTexture;d.update(f,{premultiply:!1}),d.bind(l.NEAREST,l.CLAMP_TO_EDGE)}else r.demTexture=new t.Texture(u,f,l.RGBA,{premultiply:!1}),r.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);u.activeTexture.set(l.TEXTURE0);var m=r.fbo;if(!m){var y=new t.Texture(u,{width:h,height:h,data:null},l.RGBA);y.bind(l.LINEAR,l.CLAMP_TO_EDGE),(m=r.fbo=u.createFramebuffer(h,h)).colorAttachment.set(y.texture)}u.bindFramebuffer.set(m.framebuffer),u.viewport.set([0,0,h,h]),e.useProgram("hillshadePrepare").draw(u,l.TRIANGLES,o,a,s,Rt.disabled,Rr(r.tileID,c,i),n.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function nn(e,r,n,i,o){var a=i.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),u=(s-e.timeAdded)/a,l=r?(s-r.timeAdded)/a:-1,c=n.getSource(),h=o.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),p=!r||Math.abs(r.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),f=p&&e.refreshedUponExpiration?1:t.clamp(p?u:1-l,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),r?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}function on(e,r,n){var i=e.context,o=i.gl,a=n.posMatrix,s=e.useProgram("debug"),u=Tt.disabled,l=Mt.disabled,c=e.colorModeForRenderPass(),h="$debug";s.draw(i,o.LINE_STRIP,u,l,c,Rt.disabled,Ar(a,t.Color.red),h,e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);for(var p=r.getTileByID(n.key).latestRawTileData,f=Math.floor((p&&p.byteLength||0)/1024),d=r.getTile(n).tileSize,m=512/Math.min(d,512),y=function(t,e,r,n){n=n||1;var i,o,a,s,u,l,c,h,p=[];for(i=0,o=t.length;i<o;i++)if(u=an[t[i]]){for(h=null,a=0,s=u[1].length;a<s;a+=2)-1===u[1][a]&&-1===u[1][a+1]?h=null:(l=e+u[1][a]*n,c=r-u[1][a+1]*n,h&&p.push(h.x,h.y,l,c),h={x:l,y:c});e+=u[0]*n}return p}(n.toString()+" "+f+"kb",50,200*m,5*m),_=new t.StructArrayLayout2i4,g=new t.StructArrayLayout2ui4,v=0;v<y.length;v+=2)_.emplaceBack(y[v],y[v+1]),g.emplaceBack(v,v+1);for(var x=i.createVertexBuffer(_,Ne.members),b=i.createIndexBuffer(g),w=t.SegmentVector.simpleSegment(0,0,_.length/2,_.length/2),E=t.EXTENT/(Math.pow(2,e.transform.zoom-n.overscaledZ)*d*m),A=[],T=-1;T<=1;T++)for(var M=-1;M<=1&&(0!==T||0!==M);M++)A.push([T,M]);for(var S=0;S<A.length;S++){var R=A[S];s.draw(i,o.LINES,u,l,c,Rt.disabled,Ar(t.translate([],a,[E*R[0],E*R[1],0]),t.Color.white),h,x,b,w)}s.draw(i,o.LINES,u,l,c,Rt.disabled,Ar(a,t.Color.black),h,x,b,w)}var an={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]},sn={symbol:function(e,r,n,i,o){if("translucent"===e.renderPass){var a=Mt.disabled,s=e.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(e,r,n,i,o,a,s){for(var u=r.transform,l="map"===o,c="map"===a,h=0,p=e;h<p.length;h+=1){var f=p[h],d=i.getTile(f),m=d.getBucket(n);if(m&&m.text&&m.text.segments.get().length){var y=t.evaluateSizeForZoom(m.textSizeData,u.zoom),_=le(d,1,r.transform.zoom),g=Zt(f.posMatrix,c,l,r.transform,_),v="none"!==n.layout.get("icon-text-fit")&&m.hasIconData();if(y){var x=Math.pow(2,u.zoom-d.tileID.overscaledZ);Wr(m,l,c,s,t.symbolSize,u,g,f.posMatrix,x,y,v)}}}}(i,e,n,r,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),o),0!==n.paint.get("icon-opacity").constantOr(1)&&Jr(e,r,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),a,s),0!==n.paint.get("text-opacity").constantOr(1)&&Jr(e,r,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),a,s),r.map.showCollisionBoxes&&(Xr(e,r,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Xr(e,r,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))}},circle:function(e,r,n,i){if("translucent"===e.renderPass){var o=n.paint.get("circle-opacity"),a=n.paint.get("circle-stroke-width"),s=n.paint.get("circle-stroke-opacity"),u=void 0!==n.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var l=e.context,c=l.gl,h=e.depthModeForSublayer(0,Tt.ReadOnly),p=Mt.disabled,f=e.colorModeForRenderPass(),d=[],m=0;m<i.length;m++){var y=i[m],_=r.getTile(y),g=_.getBucket(n);if(g){var v=g.programConfigurations.get(n.id),x={programConfiguration:v,program:e.useProgram("circle",v),layoutVertexBuffer:g.layoutVertexBuffer,indexBuffer:g.indexBuffer,uniformValues:br(e,y,_,n)};if(u)for(var b=0,w=g.segments.get();b<w.length;b+=1){var E=w[b];d.push({segments:new t.SegmentVector([E]),sortKey:E.sortKey,state:x})}else d.push({segments:g.segments,sortKey:0,state:x})}}u&&d.sort(function(t,e){return t.sortKey-e.sortKey});for(var A=0,T=d;A<T.length;A+=1){var M=T[A],S=M.state;S.program.draw(l,c.TRIANGLES,h,p,f,Rt.disabled,S.uniformValues,n.id,S.layoutVertexBuffer,S.indexBuffer,M.segments,n.paint,e.transform.zoom,S.programConfiguration)}}}},heatmap:function(e,r,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=e.depthModeForSublayer(0,Tt.ReadOnly),u=Mt.disabled,l=new St([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,r){var n=t.gl;t.activeTexture.set(n.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=r.heatmapFbo;if(i)n.bindTexture(n.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var o=n.createTexture();n.bindTexture(n.TEXTURE_2D,o),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),i=r.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4),function t(e,r,n,i){var o=e.gl;o.texImage2D(o.TEXTURE_2D,0,o.RGBA,r.width/4,r.height/4,0,o.RGBA,e.extTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:o.UNSIGNED_BYTE,null),i.colorAttachment.set(n),e.extTextureHalfFloat&&o.checkFramebufferStatus(o.FRAMEBUFFER)!==o.FRAMEBUFFER_COMPLETE&&(e.extTextureHalfFloat=null,i.colorAttachment.setDirty(),t(e,r,n,i))}(t,e,o,i)}}(o,e,n),o.clear({color:t.Color.transparent});for(var c=0;c<i.length;c++){var h=i[c];if(!r.hasRenderableParent(h)){var p=r.getTile(h),f=p.getBucket(n);if(f){var d=f.programConfigurations.get(n.id);e.useProgram("heatmap",d).draw(o,a.TRIANGLES,s,u,l,Rt.disabled,Mr(h.posMatrix,p,e.transform.zoom,n.paint.get("heatmap-intensity")),n.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,n.paint,e.transform.zoom,d)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,r){var n=e.context,i=n.gl,o=r.heatmapFbo;if(o){n.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),n.activeTexture.set(i.TEXTURE1);var a=r.colorRampTexture;a||(a=r.colorRampTexture=new t.Texture(n,r.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(n,i.TRIANGLES,Tt.disabled,Mt.disabled,e.colorModeForRenderPass(),Rt.disabled,function(e,r,n,i){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:n,u_color_ramp:i,u_opacity:r.paint.get("heatmap-opacity")}}(e,r,0,1),r.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,r.paint,e.transform.zoom)}}(e,n))},line:function(e,r,n,i){if("translucent"===e.renderPass){var o=n.paint.get("line-opacity"),a=n.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1)){var s=e.depthModeForSublayer(0,Tt.ReadOnly),u=e.colorModeForRenderPass(),l=n.paint.get("line-dasharray"),c=n.paint.get("line-pattern"),h=c.constantOr(1),p=n.paint.get("line-gradient"),f=n.getCrossfadeParameters(),d=l?"lineSDF":h?"linePattern":p?"lineGradient":"line",m=e.context,y=m.gl,_=!0;if(p){m.activeTexture.set(y.TEXTURE0);var g=n.gradientTexture;if(!n.gradient)return;g||(g=n.gradientTexture=new t.Texture(m,n.gradient,y.RGBA)),g.bind(y.LINEAR,y.CLAMP_TO_EDGE)}for(var v=0,x=i;v<x.length;v+=1){var b=x[v],w=r.getTile(b);if(!h||w.patternsLoaded()){var E=w.getBucket(n);if(E){var A=E.programConfigurations.get(n.id),T=e.context.program.get(),M=e.useProgram(d,A),S=_||M.program!==T,R=c.constantOr(null);if(R&&w.imageAtlas){var I=w.imageAtlas,C=I.patternPositions[R.to.toString()],P=I.patternPositions[R.from.toString()];C&&P&&A.setConstantPatternPositions(C,P)}var D=l?Lr(e,w,n,l,f):h?Dr(e,w,n,f):p?Pr(e,w,n):Cr(e,w,n);l&&(S||e.lineAtlas.dirty)?(m.activeTexture.set(y.TEXTURE0),e.lineAtlas.bind(m)):h&&(m.activeTexture.set(y.TEXTURE0),w.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),A.updatePatternPaintBuffers(f)),M.draw(m,y.TRIANGLES,s,e.stencilModeForClipping(b),u,Rt.disabled,D,n.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,n.paint,e.transform.zoom,A),_=!1}}}}}},fill:function(e,r,n,i){var o=n.paint.get("fill-color"),a=n.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),u=n.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){var c=e.depthModeForSublayer(1,"opaque"===e.renderPass?Tt.ReadWrite:Tt.ReadOnly);$r(e,r,n,i,c,s,!1)}if("translucent"===e.renderPass&&n.paint.get("fill-antialias")){var h=e.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,Tt.ReadOnly);$r(e,r,n,i,h,s,!0)}}},"fill-extrusion":function(t,e,r,n){var i=r.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var o=new Tt(t.context.gl.LEQUAL,Tt.ReadWrite,t.depthRangeFor3D);if(1!==i||r.paint.get("fill-extrusion-pattern").constantOr(1))tn(t,e,r,n,o,Mt.disabled,St.disabled),tn(t,e,r,n,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();tn(t,e,r,n,o,Mt.disabled,a)}}},hillshade:function(t,e,r,n){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,o=e.getSource().maxzoom,a=t.depthModeForSublayer(0,Tt.ReadOnly),s=Mt.disabled,u=t.colorModeForRenderPass(),l=0,c=n;l<c.length;l+=1){var h=e.getTile(c[l]);h.needsHillshadePrepare&&"offscreen"===t.renderPass?rn(t,h,r,o,a,s,u):"translucent"===t.renderPass&&en(t,h,r,a,s,u)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,r,n){if("translucent"===t.renderPass&&0!==r.paint.get("raster-opacity"))for(var i=t.context,o=i.gl,a=e.getSource(),s=t.useProgram("raster"),u=Mt.disabled,l=t.colorModeForRenderPass(),c=n.length&&n[0].overscaledZ,h=!t.options.moving,p=0,f=n;p<f.length;p+=1){var d=f[p],m=t.depthModeForSublayer(d.overscaledZ-c,1===r.paint.get("raster-opacity")?Tt.ReadWrite:Tt.ReadOnly,o.LESS),y=e.getTile(d),_=t.transform.calculatePosMatrix(d.toUnwrapped(),h);y.registerFadeDuration(r.paint.get("raster-fade-duration"));var g=e.findLoadedParent(d,0),v=nn(y,g,e,r,t.transform),x=void 0,b=void 0,w="nearest"===r.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),y.texture.bind(w,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),g?(g.texture.bind(w,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),x=Math.pow(2,g.tileID.overscaledZ-y.tileID.overscaledZ),b=[y.tileID.canonical.x*x%1,y.tileID.canonical.y*x%1]):y.texture.bind(w,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var E=Fr(_,b||[0,0],x||1,v,r);a instanceof P?s.draw(i,o.TRIANGLES,m,u,l,Rt.disabled,E,r.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):y.maskedBoundsBuffer&&y.maskedIndexBuffer&&y.segments?s.draw(i,o.TRIANGLES,m,u,l,Rt.disabled,E,r.id,y.maskedBoundsBuffer,y.maskedIndexBuffer,y.segments,r.paint,t.transform.zoom):s.draw(i,o.TRIANGLES,m,u,l,Rt.disabled,E,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,r){var n=r.paint.get("background-color"),i=r.paint.get("background-opacity");if(0!==i){var o=t.context,a=o.gl,s=t.transform,u=s.tileSize,l=r.paint.get("background-pattern");if(!t.isPatternMissing(l)){var c=!l&&1===n.a&&1===i&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===c){var h=Mt.disabled,p=t.depthModeForSublayer(0,"opaque"===c?Tt.ReadWrite:Tt.ReadOnly),f=t.colorModeForRenderPass(),d=t.useProgram(l?"backgroundPattern":"background"),m=s.coveringTiles({tileSize:u});l&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var y=r.getCrossfadeParameters(),_=0,g=m;_<g.length;_+=1){var v=g[_],x=t.transform.calculatePosMatrix(v.toUnwrapped()),b=l?Vr(x,i,t,l,{tileID:v,tileSize:u},y):Ur(x,i,n);d.draw(o,a.TRIANGLES,p,h,f,Rt.disabled,b,r.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,r){for(var n=0;n<r.length;n++)on(t,e,r[n])},custom:function(t,e,r){var n=t.context,i=r.implementation;if("offscreen"===t.renderPass){var o=i.prerender;o&&(t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),o.call(i,n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),n.setColorMode(t.colorModeForRenderPass()),n.setStencilMode(Mt.disabled);var a="3d"===i.renderingMode?new Tt(t.context.gl.LEQUAL,Tt.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Tt.ReadOnly);n.setDepthMode(a),i.render(n.gl,t.transform.customLayerMatrix()),n.setDirty(),t.setBaseState(),n.bindFramebuffer.set(null)}}},un=function(e,r){this.context=new It(e),this.transform=r,this._tileTextures={},this.setup(),this.numSublayers=Ct.maxUnderzooming+Ct.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.depthRboNeedsClear=!0,this.emptyProgramConfiguration=new t.ProgramConfiguration,this.crossTileSymbolIndex=new Le};function ln(t,e){if(t.y>e.y){var r=t;t=e,e=r}return{x0:t.x,y0:t.y,x1:e.x,y1:e.y,dx:e.x-t.x,dy:e.y-t.y}}function cn(t,e,r,n,i){var o=Math.max(r,Math.floor(e.y0)),a=Math.min(n,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var u=t.dx/t.dy,l=e.dx/e.dy,c=t.dx>0,h=e.dx<0,p=o;p<a;p++){var f=u*Math.max(0,Math.min(t.dy,p+c-t.y0))+t.x0,d=l*Math.max(0,Math.min(e.dy,p+h-e.y0))+e.x0;i(Math.floor(d),Math.ceil(f),p)}}function hn(t,e,r,n,i,o){var a,s=ln(t,e),u=ln(e,r),l=ln(r,t);s.dy>u.dy&&(a=s,s=u,u=a),s.dy>l.dy&&(a=s,s=l,l=a),u.dy>l.dy&&(a=u,u=l,l=a),s.dy&&cn(l,s,n,i,o),u.dy&&cn(l,u,n,i,o)}un.prototype.resize=function(e,r){var n=this.context.gl;if(this.width=e*t.browser.devicePixelRatio,this.height=r*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var i=0,o=this.style._order;i<o.length;i+=1){this.style._layers[o[i]].resize()}this.depthRbo&&(n.deleteRenderbuffer(this.depthRbo),this.depthRbo=null)},un.prototype.setup=function(){var e=this.context,r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(r,Ne.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(n,Ne.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,t.rasterBoundsAttributes.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,Ne.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);var u=this.context.gl;this.stencilClearMode=new Mt({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},un.prototype.clearStencil=function(){var e=this.context,r=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var n=t.create();t.ortho(n,0,this.width,this.height,0,0,1),t.scale(n,n,[r.drawingBufferWidth,r.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,r.TRIANGLES,Tt.disabled,this.stencilClearMode,St.disabled,Rt.disabled,Tr(n),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},un.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var r=this.context,n=r.gl;this.nextStencilID+e.length>256&&this.clearStencil(),r.setColorMode(St.disabled),r.setDepthMode(Tt.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(r,n.TRIANGLES,Tt.disabled,new Mt({func:n.ALWAYS,mask:0},u,255,n.KEEP,n.KEEP,n.REPLACE),St.disabled,Rt.disabled,Tr(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},un.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new Mt({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},un.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Mt({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},un.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new St([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?St.unblended:St.alphaBlended},un.prototype.depthModeForSublayer=function(t,e,r){if(!this.opaquePassEnabledForLayer())return Tt.disabled;var n=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Tt(r||this.context.gl.LEQUAL,e,[n,n])},un.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},un.prototype.render=function(e,r){this.style=e,this.options=r,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var n=this.style._order,i=this.style.sourceCaches;for(var o in i){var a=i[o];a.used&&a.prepare(this.context)}var s={},u={},l={};for(var c in i){var h=i[c];s[c]=h.getVisibleCoordinates(),u[c]=s[c].slice().reverse(),l[c]=h.getVisibleCoordinates(!0).reverse()}for(var p in i){var f=i[p],d=f.getSource();if("raster"===d.type||"raster-dem"===d.type){for(var m=[],y=0,_=s[p];y<_.length;y+=1){m.push(f.getTile(_[y]))}Gr(m,this.context)}}this.opaquePassCutoff=1/0;for(var g=0;g<n.length;g++){if(this.style._layers[n[g]].is3D()){this.opaquePassCutoff=g;break}}this.renderPass="offscreen",this.depthRboNeedsClear=!0;for(var v=0,x=n;v<x.length;v+=1){var b=this.style._layers[x[v]];if(b.hasOffscreenPass()&&!b.isHidden(this.transform.zoom)){var w=u[b.source];("custom"===b.type||w.length)&&this.renderLayer(this,i[b.source],b,w)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:r.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=n.length-1;this.currentLayer>=0;this.currentLayer--){var E=this.style._layers[n[this.currentLayer]],A=i[E.source],T=s[E.source];this._renderTileClippingMasks(E,T),this.renderLayer(this,A,E,T)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<n.length;this.currentLayer++){var M=this.style._layers[n[this.currentLayer]],S=i[M.source],R=("symbol"===M.type?l:u)[M.source];this._renderTileClippingMasks(M,s[M.source]),this.renderLayer(this,S,M,R)}if(this.options.showTileBoundaries)for(var I in i){sn.debug(this,i[I],s[I]);break}this.context.setDefault()},un.prototype.setupOffscreenDepthRenderbuffer=function(){var t=this.context;this.depthRbo||(this.depthRbo=t.createRenderbuffer(t.gl.DEPTH_COMPONENT16,this.width,this.height))},un.prototype.renderLayer=function(t,e,r,n){r.isHidden(this.transform.zoom)||("background"===r.type||"custom"===r.type||n.length)&&(this.id=r.id,sn[r.type](t,e,r,n,this.style.placement.variableOffsets))},un.prototype.translatePosMatrix=function(e,r,n,i,o){if(!n[0]&&!n[1])return e;var a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var s=Math.sin(a),u=Math.cos(a);n=[n[0]*u-n[1]*s,n[0]*s+n[1]*u]}var l=[o?n[0]:le(r,n[0],this.transform.zoom),o?n[1]:le(r,n[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,l),c},un.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},un.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},un.prototype.isPatternMissing=function(t){if(!t)return!1;var e=this.imageManager.getPattern(t.from.toString()),r=this.imageManager.getPattern(t.to.toString());return!e||!r},un.prototype.useProgram=function(t,e){void 0===e&&(e=this.emptyProgramConfiguration),this.cache=this.cache||{};var r=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[r]||(this.cache[r]=new fr(this.context,hr[t],e,jr[t],this._showOverdrawInspector)),this.cache[r]},un.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},un.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)};var pn=function(e,r,n){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===n||n,this._minZoom=e||0,this._maxZoom=r||22,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._posMatrixCache={},this._alignedPosMatrixCache={}},fn={minZoom:{configurable:!0},maxZoom:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerPoint:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};pn.prototype.clone=function(){var t=new pn(this._minZoom,this._maxZoom,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._calcMatrices(),t},fn.minZoom.get=function(){return this._minZoom},fn.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},fn.maxZoom.get=function(){return this._maxZoom},fn.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},fn.renderWorldCopies.get=function(){return this._renderWorldCopies},fn.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},fn.worldSize.get=function(){return this.tileSize*this.scale},fn.centerPoint.get=function(){return this.size._div(2)},fn.size.get=function(){return new t.Point(this.width,this.height)},fn.bearing.get=function(){return-this.angle/Math.PI*180},fn.bearing.set=function(e){var r=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},fn.pitch.get=function(){return this._pitch/Math.PI*180},fn.pitch.set=function(e){var r=t.clamp(e,0,60)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())},fn.fov.get=function(){return this._fov/Math.PI*180},fn.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},fn.zoom.get=function(){return this._zoom},fn.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},fn.center.get=function(){return this._center},fn.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},pn.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},pn.prototype.getVisibleUnwrappedCoordinates=function(e){var r=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var n=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(n.x,i.x,o.x,a.x)),u=Math.floor(Math.max(n.x,i.x,o.x,a.x)),l=s-1;l<=u+1;l++)0!==l&&r.push(new t.UnwrappedTileID(l,e));return r},pn.prototype.coveringTiles=function(e){var r=this.coveringZoomLevel(e),n=r;if(void 0!==e.minzoom&&r<e.minzoom)return[];void 0!==e.maxzoom&&r>e.maxzoom&&(r=e.maxzoom);var i=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,r),a=new t.Point(o*i.x-.5,o*i.y-.5);return function(e,r,n,i){void 0===i&&(i=!0);var o=1<<e,a={};function s(r,s,u){var l,c,h;if(u>=0&&u<=o)for(l=r;l<s;l++)0!==(c=Math.floor(l/o))&&!0!==i||(h=new t.OverscaledTileID(n,c,e,(l%o+o)%o,u),a[h.key]=h)}var u=r.map(function(e){return new t.Point(e.x,e.y)._mult(o)});return hn(u[0],u[1],u[2],0,o,s),hn(u[2],u[3],u[0],0,o,s),Object.keys(a).map(function(t){return a[t]})}(r,[this.pointCoordinate(new t.Point(0,0)),this.pointCoordinate(new t.Point(this.width,0)),this.pointCoordinate(new t.Point(this.width,this.height)),this.pointCoordinate(new t.Point(0,this.height))],e.reparseOverscaled?n:r,this._renderWorldCopies).sort(function(t,e){return a.dist(t.canonical)-a.dist(e.canonical)})},pn.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},fn.unmodified.get=function(){return this._unmodified},pn.prototype.zoomScale=function(t){return Math.pow(2,t)},pn.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},pn.prototype.project=function(e){var r=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(r)*this.worldSize)},pn.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},fn.point.get=function(){return this.project(this.center)},pn.prototype.setLocationAtPoint=function(e,r){var n=this.pointCoordinate(r),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(n.x-i.x),o.y-(n.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},pn.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},pn.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},pn.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},pn.prototype.coordinateLocation=function(t){return t.toLngLat()},pn.prototype.pointCoordinate=function(e){var r=[e.x,e.y,0,1],n=[e.x,e.y,1,1];t.transformMat4(r,r,this.pixelMatrixInverse),t.transformMat4(n,n,this.pixelMatrixInverse);var i=r[3],o=n[3],a=r[1]/i,s=n[1]/o,u=r[2]/i,l=n[2]/o,c=u===l?0:(0-u)/(l-u);return new t.MercatorCoordinate(t.number(r[0]/i,n[0]/o,c)/this.worldSize,t.number(a,s,c)/this.worldSize)},pn.prototype.coordinatePoint=function(e){var r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix),new t.Point(r[0]/r[3],r[1]/r[3])},pn.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},pn.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},pn.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},pn.prototype.calculatePosMatrix=function(e,r){void 0===r&&(r=!1);var n=e.key,i=r?this._alignedPosMatrixCache:this._posMatrixCache;if(i[n])return i[n];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*a,o.y*a,0]),t.scale(u,u,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(u,r?this.alignedProjMatrix:this.projMatrix,u),i[n]=new Float32Array(u),i[n]},pn.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},pn.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,r,n,i,o=-90,a=90,s=-180,u=180,l=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<l.y?l.y/(a-o):0}if(this.lngRange){var p=this.lngRange;s=t.mercatorXfromLng(p[0])*this.worldSize,r=(u=t.mercatorXfromLng(p[1])*this.worldSize)-s<l.x?l.x/(u-s):0}var f=this.point,d=Math.max(r||0,e||0);if(d)return this.center=this.unproject(new t.Point(r?(u+s)/2:f.x,e?(a+o)/2:f.y)),this.zoom+=this.scaleZoom(d),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var m=f.y,y=l.y/2;m-y<o&&(i=o+y),m+y>a&&(i=a-y)}if(this.lngRange){var _=f.x,g=l.x/2;_-g<s&&(n=s+g),_+g>u&&(n=u-g)}void 0===n&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==n?n:f.x,void 0!==i?i:f.y))),this._unmodified=c,this._constraining=!1}},pn.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var e=this._fov/2,r=Math.PI/2+this._pitch,n=Math.sin(e)*this.cameraToCenterDistance/Math.sin(Math.PI-r-e),i=this.point,o=i.x,a=i.y,s=1.01*(Math.cos(Math.PI/2-this._pitch)*n+this.cameraToCenterDistance),u=this.height/50,l=new Float64Array(16);t.perspective(l,this._fov,this.width/this.height,u,s),t.scale(l,l,[1,-1,1]),t.translate(l,l,[0,0,-this.cameraToCenterDistance]),t.rotateX(l,l,this._pitch),t.rotateZ(l,l,this.angle),t.translate(l,l,[-o,-a,0]),this.mercatorMatrix=t.scale([],l,[this.worldSize,this.worldSize,this.worldSize]),t.scale(l,l,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=l;var c=this.width%2/2,h=this.height%2/2,p=Math.cos(this.angle),f=Math.sin(this.angle),d=o-Math.round(o)+p*c+f*h,m=a-Math.round(a)+p*h+f*c,y=new Float64Array(l);if(t.translate(y,y,[d>.5?d-1:d,m>.5?m-1:m,0]),this.alignedProjMatrix=y,l=t.create(),t.scale(l,l,[this.width/2,-this.height/2,1]),t.translate(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=t.create(),t.scale(l,l,[1,-1,1]),t.translate(l,l,[-1,-1,0]),t.scale(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(l=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={}}},pn.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),r=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(r,r,this.pixelMatrix)[3]/this.cameraToCenterDistance},pn.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},pn.prototype.getCameraQueryGeometry=function(e){var r=this.getCameraPoint();if(1===e.length)return[e[0],r];for(var n=r.x,i=r.y,o=r.x,a=r.y,s=0,u=e;s<u.length;s+=1){var l=u[s];n=Math.min(n,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),a=Math.max(a,l.y)}return[new t.Point(n,i),new t.Point(o,i),new t.Point(o,a),new t.Point(n,a),new t.Point(n,i)]},Object.defineProperties(pn.prototype,fn);var dn=function(){var e,r,n,i;t.bindAll(["_onHashChange","_updateHash"],this),this._updateHash=(e=this._updateHashUnthrottled.bind(this),300,r=!1,n=null,i=function(){n=null,r&&(e(),n=setTimeout(i,300),r=!1)},function(){return r=!0,n||i(),n})};dn.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},dn.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},dn.prototype.getHashString=function(t){var e=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,n=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lng*i)/i,a=Math.round(e.lat*i)/i,s=this._map.getBearing(),u=this._map.getPitch(),l="";return l+=t?"#/"+o+"/"+a+"/"+r:"#"+r+"/"+a+"/"+o,(s||u)&&(l+="/"+Math.round(10*s)/10),u&&(l+="/"+Math.round(u)),l},dn.prototype._onHashChange=function(){var e=t.window.location.hash.replace("#","").split("/");return e.length>=3&&(this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:+(e[3]||0),pitch:+(e[4]||0)}),!0)},dn.prototype._updateHashUnthrottled=function(){var e=this.getHashString();try{t.window.history.replaceState(t.window.history.state,"",e)}catch(t){}};var mn=function(e){function n(n,i,o,a){void 0===a&&(a={});var s=r.mousePos(i.getCanvasContainer(),o),u=i.unproject(s);e.call(this,n,t.extend({point:s,lngLat:u,originalEvent:o},a)),this._defaultPrevented=!1,this.target=i}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={defaultPrevented:{configurable:!0}};return n.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(n.prototype,i),n}(t.Event),yn=function(e){function n(n,i,o){var a=r.touchPos(i.getCanvasContainer(),o),s=a.map(function(t){return i.unproject(t)}),u=a.reduce(function(t,e,r,n){return t.add(e.div(n.length))},new t.Point(0,0)),l=i.unproject(u);e.call(this,n,{points:a,point:u,lngLats:s,lngLat:l,originalEvent:o}),this._defaultPrevented=!1}e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n;var i={defaultPrevented:{configurable:!0}};return n.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(n.prototype,i),n}(t.Event),_n=function(t){function e(e,r,n){t.call(this,e,{originalEvent:n}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var r={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},r.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,r),e}(t.Event),gn=function(e){this._map=e,this._el=e.getCanvasContainer(),this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onWheel","_onTimeout","_onScrollFrame","_onScrollFinished"],this)};gn.prototype.setZoomRate=function(t){this._defaultZoomRate=t},gn.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},gn.prototype.isEnabled=function(){return!!this._enabled},gn.prototype.isActive=function(){return!!this._active},gn.prototype.isZooming=function(){return!!this._zooming},gn.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},gn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},gn.prototype.onWheel=function(e){if(this.isEnabled()){var r=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=t.browser.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==r&&r%4.000244140625==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=r,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),e.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=e,this._delta-=r,this.isActive()||this._start(e)),e.preventDefault()}},gn.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this.isActive()||this._start(t)},gn.prototype._start=function(e){if(this._delta){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0,this._map.fire(new t.Event("movestart",{originalEvent:e})),this._map.fire(new t.Event("zoomstart",{originalEvent:e}))),this._finishTimeout&&clearTimeout(this._finishTimeout);var n=r.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(n)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame))}},gn.prototype._onScrollFrame=function(){var e=this;if(this._frameId=null,this.isActive()){var r=this._map.transform;if(0!==this._delta){var n="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==i&&(i=1/i);var o="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a="number"==typeof this._targetZoom?this._targetZoom:r.zoom,s=this._startZoom,u=this._easing,l=!1;if("wheel"===this._type&&s&&u){var c=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),h=u(c);r.zoom=t.number(s,a,h),c<1?this._frameId||(this._frameId=this._map._requestRenderFrame(this._onScrollFrame)):l=!0}else r.zoom=a,l=!0;r.setLocationAtPoint(this._around,this._aroundPoint),this._map.fire(new t.Event("move",{originalEvent:this._lastWheelEvent})),this._map.fire(new t.Event("zoom",{originalEvent:this._lastWheelEvent})),l&&(this._active=!1,this._finishTimeout=setTimeout(function(){e._zooming=!1,e._map.fire(new t.Event("zoomend",{originalEvent:e._lastWheelEvent})),e._map.fire(new t.Event("moveend",{originalEvent:e._lastWheelEvent})),delete e._targetZoom},200))}},gn.prototype._smoothOutEasing=function(e){var r=t.ease;if(this._prevEase){var n=this._prevEase,i=(t.browser.now()-n.start)/n.duration,o=n.easing(i+.01)-n.easing(i),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);r=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:r},r};var vn=function(e,r){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=r.clickTolerance||1,t.bindAll(["_onMouseMove","_onMouseUp","_onKeyDown"],this)};vn.prototype.isEnabled=function(){return!!this._enabled},vn.prototype.isActive=function(){return!!this._active},vn.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},vn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},vn.prototype.onMouseDown=function(e){this.isEnabled()&&e.shiftKey&&0===e.button&&(t.window.document.addEventListener("mousemove",this._onMouseMove,!1),t.window.document.addEventListener("keydown",this._onKeyDown,!1),t.window.document.addEventListener("mouseup",this._onMouseUp,!1),r.disableDrag(),this._startPos=this._lastPos=r.mousePos(this._el,e),this._active=!0)},vn.prototype._onMouseMove=function(t){var e=r.mousePos(this._el,t);if(!(this._lastPos.equals(e)||!this._box&&e.dist(this._startPos)<this._clickTolerance)){var n=this._startPos;this._lastPos=e,this._box||(this._box=r.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var i=Math.min(n.x,e.x),o=Math.max(n.x,e.x),a=Math.min(n.y,e.y),s=Math.max(n.y,e.y);r.setTransform(this._box,"translate("+i+"px,"+a+"px)"),this._box.style.width=o-i+"px",this._box.style.height=s-a+"px"}},vn.prototype._onMouseUp=function(e){if(0===e.button){var n=this._startPos,i=r.mousePos(this._el,e);this._finish(),r.suppressClick(),n.x===i.x&&n.y===i.y?this._fireEvent("boxzoomcancel",e):this._map.fitScreenCoordinates(n,i,this._map.getBearing(),{linear:!0}).fire(new t.Event("boxzoomend",{originalEvent:e}))}},vn.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},vn.prototype._finish=function(){this._active=!1,t.window.document.removeEventListener("mousemove",this._onMouseMove,!1),t.window.document.removeEventListener("keydown",this._onKeyDown,!1),t.window.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(r.remove(this._box),this._box=null),r.enableDrag(),delete this._startPos,delete this._lastPos},vn.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,{originalEvent:r}))};var xn=t.bezier(0,0,.25,1),bn=function(e,r){this._map=e,this._el=r.element||e.getCanvasContainer(),this._state="disabled",this._button=r.button||"right",this._bearingSnap=r.bearingSnap||0,this._pitchWithRotate=!1!==r.pitchWithRotate,t.bindAll(["onMouseDown","_onMouseMove","_onMouseUp","_onBlur","_onDragFrame"],this)};bn.prototype.isEnabled=function(){return"disabled"!==this._state},bn.prototype.isActive=function(){return"active"===this._state},bn.prototype.enable=function(){this.isEnabled()||(this._state="enabled")},bn.prototype.disable=function(){if(this.isEnabled())switch(this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend"),this._pitchWithRotate&&this._fireEvent("pitchend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},bn.prototype.onMouseDown=function(e){if("enabled"===this._state){var n="touchstart"===e.type;if(n)this._startTime=Date.now();else if("right"===this._button){if(this._eventButton=r.mouseButton(e),this._eventButton!==(e.ctrlKey?0:2))return}else{if(e.ctrlKey||0!==r.mouseButton(e))return;this._eventButton=0}r.disableDrag(),n?(t.window.document.addEventListener("touchmove",this._onMouseMove,{capture:!0}),t.window.document.addEventListener("touchend",this._onMouseUp)):(t.window.document.addEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.addEventListener("mouseup",this._onMouseUp)),t.window.addEventListener("blur",this._onBlur),this._state="pending",this._inertia=[[t.browser.now(),this._map.getBearing()]],this._startPos=this._prevPos=this._lastPos=r.mousePos(this._el,e),this._center=this._map.transform.centerPoint,e.preventDefault()}},bn.prototype._onMouseMove=function(t){var e=r.mousePos(this._el,t);this._lastPos.equals(e)||(this._lastMoveEvent=t,this._lastPos=e,"pending"===this._state&&(this._state="active",this._fireEvent("rotatestart",t),this._fireEvent("movestart",t),this._pitchWithRotate&&this._fireEvent("pitchstart",t)),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},bn.prototype._onDragFrame=function(){this._frameId=null;var e=this._lastMoveEvent;if(e){var r=this._map.transform,n=this._prevPos,i=this._lastPos,o=r.bearing-.8*(n.x-i.x),a=r.pitch- -.5*(n.y-i.y),s=this._inertia,u=s[s.length-1];this._drainInertiaBuffer(),s.push([t.browser.now(),this._map._normalizeBearing(o,u[1])]),r.bearing=o,this._pitchWithRotate&&(this._fireEvent("pitch",e),r.pitch=a),this._fireEvent("rotate",e),this._fireEvent("move",e),delete this._lastMoveEvent,this._prevPos=this._lastPos}},bn.prototype._onMouseUp=function(t){if("touchend"===t.type&&this._startPos===this._lastPos&&Date.now()-this._startTime<300&&this._el.click(),r.mouseButton(t)===this._eventButton)switch(this._state){case"active":this._state="enabled",r.suppressClick(),this._unbind(),this._deactivate(),this._inertialRotate(t);break;case"pending":this._state="enabled",this._unbind()}},bn.prototype._onBlur=function(t){switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._fireEvent("rotateend",t),this._pitchWithRotate&&this._fireEvent("pitchend",t),this._fireEvent("moveend",t);break;case"pending":this._state="enabled",this._unbind()}},bn.prototype._unbind=function(){t.window.document.removeEventListener("mousemove",this._onMouseMove,{capture:!0}),t.window.document.removeEventListener("mouseup",this._onMouseUp),t.window.document.removeEventListener("touchmove",this._onMouseMove,{capture:!0}),t.window.document.removeEventListener("touchend",this._onMouseUp),t.window.removeEventListener("blur",this._onBlur),r.enableDrag()},bn.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._prevPos,delete this._lastPos},bn.prototype._inertialRotate=function(t){var e=this;this._fireEvent("rotateend",t),this._drainInertiaBuffer();var r=this._map,n=r.getBearing(),i=this._inertia,o=function(){Math.abs(n)<e._bearingSnap?r.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t),e._pitchWithRotate&&e._fireEvent("pitchend",t)};if(i.length<2)o();else{var a=i[0],s=i[i.length-1],u=r._normalizeBearing(n,i[i.length-2][1]),l=s[1]-a[1],c=l<0?-1:1,h=(s[0]-a[0])/1e3;if(0!==l&&0!==h){var p=Math.abs(l*(.25/h));p>180&&(p=180);var f=p/180;u+=c*p*(f/2),Math.abs(r._normalizeBearing(u,0))<this._bearingSnap&&(u=r._normalizeBearing(0,u)),r.rotateTo(u,{duration:1e3*f,easing:xn,noMoveStart:!0},{originalEvent:t})}else o()}},bn.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,r?{originalEvent:r}:{}))},bn.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,r=t.browser.now();e.length>0&&r-e[0][0]>160;)e.shift()};var wn=t.bezier(0,0,.3,1),En=function(e,r){this._map=e,this._el=e.getCanvasContainer(),this._state="disabled",this._clickTolerance=r.clickTolerance||1,t.bindAll(["_onMove","_onMouseUp","_onTouchEnd","_onBlur","_onDragFrame"],this)};En.prototype.isEnabled=function(){return"disabled"!==this._state},En.prototype.isActive=function(){return"active"===this._state},En.prototype.enable=function(){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-drag-pan"),this._state="enabled")},En.prototype.disable=function(){if(this.isEnabled())switch(this._el.classList.remove("mapboxgl-touch-drag-pan"),this._state){case"active":this._state="disabled",this._unbind(),this._deactivate(),this._fireEvent("dragend"),this._fireEvent("moveend");break;case"pending":this._state="disabled",this._unbind();break;default:this._state="disabled"}},En.prototype.onMouseDown=function(e){"enabled"===this._state&&(e.ctrlKey||0!==r.mouseButton(e)||(r.addEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),r.addEventListener(t.window.document,"mouseup",this._onMouseUp),this._start(e)))},En.prototype.onTouchStart=function(e){this.isEnabled()&&(e.touches&&e.touches.length>1&&("pending"===this._state||"active"===this._state)||(r.addEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),r.addEventListener(t.window.document,"touchend",this._onTouchEnd),this._start(e)))},En.prototype._start=function(e){t.window.addEventListener("blur",this._onBlur),this._state="pending",this._startPos=this._mouseDownPos=this._prevPos=this._lastPos=r.mousePos(this._el,e),this._startTouch=this._lastTouch=t.window.TouchEvent&&e instanceof t.window.TouchEvent?r.touchPos(this._el,e):null,this._inertia=[[t.browser.now(),this._startPos]]},En.prototype._touchesMatch=function(t,e){return!(!t||!e||t.length!==e.length)&&t.every(function(t,r){return e[r]===t})},En.prototype._onMove=function(e){e.preventDefault();var n=t.window.TouchEvent&&e instanceof t.window.TouchEvent?r.touchPos(this._el,e):null,i=r.mousePos(this._el,e);(n?this._touchesMatch(this._lastTouch,n):this._lastPos.equals(i))||"pending"===this._state&&i.dist(this._mouseDownPos)<this._clickTolerance||(this._lastMoveEvent=e,this._lastPos=i,this._lastTouch=n,this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),this._lastPos]),"pending"===this._state&&(this._state="active",this._shouldStart=!0),this._frameId||(this._frameId=this._map._requestRenderFrame(this._onDragFrame)))},En.prototype._onDragFrame=function(){this._frameId=null;var t=this._lastMoveEvent;if(t)if(this._map.touchZoomRotate.isActive())this._abort(t);else if(this._shouldStart&&(this._fireEvent("dragstart",t),this._fireEvent("movestart",t),this._shouldStart=!1),this.isActive()){var e=this._map.transform;e.setLocationAtPoint(e.pointLocation(this._prevPos),this._lastPos),this._fireEvent("drag",t),this._fireEvent("move",t),this._prevPos=this._lastPos,delete this._lastMoveEvent}},En.prototype._onMouseUp=function(t){if(0===r.mouseButton(t))switch(this._state){case"active":this._state="enabled",r.suppressClick(),this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind()}},En.prototype._onTouchEnd=function(t){if(t.touches&&0!==t.touches.length)switch(this._state){case"pending":case"active":break;case"enabled":this.onTouchStart(t)}else switch(this._state){case"active":this._state="enabled",this._unbind(),this._deactivate(),this._inertialPan(t);break;case"pending":this._state="enabled",this._unbind();break;case"enabled":this._unbind()}},En.prototype._abort=function(e){switch(this._state){case"active":this._state="enabled",this._shouldStart||(this._fireEvent("dragend",e),this._fireEvent("moveend",e)),this._unbind(),this._deactivate(),t.window.TouchEvent&&e instanceof t.window.TouchEvent&&e.touches.length>1&&r.addEventListener(t.window.document,"touchend",this._onTouchEnd);break;case"pending":this._state="enabled",this._unbind();break;case"enabled":this._unbind()}},En.prototype._onBlur=function(t){this._abort(t)},En.prototype._unbind=function(){r.removeEventListener(t.window.document,"touchmove",this._onMove,{capture:!0,passive:!1}),r.removeEventListener(t.window.document,"touchend",this._onTouchEnd),r.removeEventListener(t.window.document,"mousemove",this._onMove,{capture:!0}),r.removeEventListener(t.window.document,"mouseup",this._onMouseUp),r.removeEventListener(t.window,"blur",this._onBlur)},En.prototype._deactivate=function(){this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._lastMoveEvent,delete this._startPos,delete this._prevPos,delete this._mouseDownPos,delete this._lastPos,delete this._startTouch,delete this._lastTouch,delete this._shouldStart},En.prototype._inertialPan=function(t){this._fireEvent("dragend",t),this._drainInertiaBuffer();var e=this._inertia;if(e.length<2)this._fireEvent("moveend",t);else{var r=e[e.length-1],n=e[0],i=r[1].sub(n[1]),o=(r[0]-n[0])/1e3;if(0===o||r[1].equals(n[1]))this._fireEvent("moveend",t);else{var a=i.mult(.3/o),s=a.mag();s>1400&&(s=1400,a._unit()._mult(s));var u=s/750,l=a.mult(-u/2);this._map.panBy(l,{duration:1e3*u,easing:wn,noMoveStart:!0},{originalEvent:t})}}},En.prototype._fireEvent=function(e,r){return this._map.fire(new t.Event(e,r?{originalEvent:r}:{}))},En.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,r=t.browser.now();e.length>0&&r-e[0][0]>160;)e.shift()};var An=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onKeyDown"],this)};function Tn(t){return t*(2-t)}An.prototype.isEnabled=function(){return!!this._enabled},An.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},An.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},An.prototype._onKeyDown=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,r=0,n=0,i=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),i=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),i=1);break;case 38:t.shiftKey?n=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?n=-1:(o=1,t.preventDefault());break;default:return}var a=this._map,s=a.getZoom(),u={duration:300,delayEndEvents:500,easing:Tn,zoom:e?Math.round(s)+e*(t.shiftKey?2:1):s,bearing:a.getBearing()+15*r,pitch:a.getPitch()+10*n,offset:[100*-i,100*-o],center:a.getCenter()};a.easeTo(u,{originalEvent:t})}};var Mn=function(e){this._map=e,t.bindAll(["_onDblClick","_onZoomEnd"],this)};Mn.prototype.isEnabled=function(){return!!this._enabled},Mn.prototype.isActive=function(){return!!this._active},Mn.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Mn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Mn.prototype.onTouchStart=function(t){var e=this;if(this.isEnabled()&&!(t.points.length>1))if(this._tapped){var r=this._tappedPoint;if(r&&r.dist(t.points[0])<=30){t.originalEvent.preventDefault();var n=function(){e._tapped&&e._zoom(t),e._map.off("touchcancel",i),e._resetTapped()},i=function(){e._map.off("touchend",n),e._resetTapped()};this._map.once("touchend",n),this._map.once("touchcancel",i)}else this._resetTapped()}else this._tappedPoint=t.points[0],this._tapped=setTimeout(function(){e._tapped=null,e._tappedPoint=null},300)},Mn.prototype._resetTapped=function(){clearTimeout(this._tapped),this._tapped=null,this._tappedPoint=null},Mn.prototype.onDblClick=function(t){this.isEnabled()&&(t.originalEvent.preventDefault(),this._zoom(t))},Mn.prototype._zoom=function(t){this._active=!0,this._map.on("zoomend",this._onZoomEnd),this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},Mn.prototype._onZoomEnd=function(){this._active=!1,this._map.off("zoomend",this._onZoomEnd)};var Sn=t.bezier(0,0,.15,1),Rn=function(e){this._map=e,this._el=e.getCanvasContainer(),t.bindAll(["_onMove","_onEnd","_onTouchFrame"],this)};Rn.prototype.isEnabled=function(){return!!this._enabled},Rn.prototype.enable=function(t){this.isEnabled()||(this._el.classList.add("mapboxgl-touch-zoom-rotate"),this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around)},Rn.prototype.disable=function(){this.isEnabled()&&(this._el.classList.remove("mapboxgl-touch-zoom-rotate"),this._enabled=!1)},Rn.prototype.disableRotation=function(){this._rotationDisabled=!0},Rn.prototype.enableRotation=function(){this._rotationDisabled=!1},Rn.prototype.isActive=function(){return this.isEnabled()&&!!this._gestureIntent},Rn.prototype.onStart=function(e){if(this.isEnabled()&&2===e.touches.length){var n=r.mousePos(this._el,e.touches[0]),i=r.mousePos(this._el,e.touches[1]),o=n.add(i).div(2);this._startVec=n.sub(i),this._startAround=this._map.transform.pointLocation(o),this._gestureIntent=void 0,this._inertia=[],r.addEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),r.addEventListener(t.window.document,"touchend",this._onEnd)}},Rn.prototype._getTouchEventData=function(t){var e=r.mousePos(this._el,t.touches[0]),n=r.mousePos(this._el,t.touches[1]),i=e.sub(n);return{vec:i,center:e.add(n).div(2),scale:i.mag()/this._startVec.mag(),bearing:this._rotationDisabled?0:180*i.angleWith(this._startVec)/Math.PI}},Rn.prototype._onMove=function(e){if(2===e.touches.length){var r=this._getTouchEventData(e),n=r.vec,i=r.scale,o=r.bearing;if(!this._gestureIntent){var a=this._rotationDisabled&&1!==i||Math.abs(1-i)>.15;Math.abs(o)>10?this._gestureIntent="rotate":a&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._map.fire(new t.Event(this._gestureIntent+"start",{originalEvent:e})),this._map.fire(new t.Event("movestart",{originalEvent:e})),this._startVec=n)}this._lastTouchEvent=e,this._frameId||(this._frameId=this._map._requestRenderFrame(this._onTouchFrame)),e.preventDefault()}},Rn.prototype._onTouchFrame=function(){this._frameId=null;var e=this._gestureIntent;if(e){var r=this._map.transform;this._startScale||(this._startScale=r.scale,this._startBearing=r.bearing);var n=this._getTouchEventData(this._lastTouchEvent),i=n.center,o=n.bearing,a=n.scale,s=r.pointLocation(i),u=r.locationPoint(s);"rotate"===e&&(r.bearing=this._startBearing+o),r.zoom=r.scaleZoom(this._startScale*a),r.setLocationAtPoint(this._startAround,u),this._map.fire(new t.Event(e,{originalEvent:this._lastTouchEvent})),this._map.fire(new t.Event("move",{originalEvent:this._lastTouchEvent})),this._drainInertiaBuffer(),this._inertia.push([t.browser.now(),a,i])}},Rn.prototype._onEnd=function(e){r.removeEventListener(t.window.document,"touchmove",this._onMove,{passive:!1}),r.removeEventListener(t.window.document,"touchend",this._onEnd);var n=this._gestureIntent,i=this._startScale;if(this._frameId&&(this._map._cancelRenderFrame(this._frameId),this._frameId=null),delete this._gestureIntent,delete this._startScale,delete this._startBearing,delete this._lastTouchEvent,n){this._map.fire(new t.Event(n+"end",{originalEvent:e})),this._drainInertiaBuffer();var o=this._inertia,a=this._map;if(o.length<2)a.snapToNorth({},{originalEvent:e});else{var s=o[o.length-1],u=o[0],l=a.transform.scaleZoom(i*s[1]),c=a.transform.scaleZoom(i*u[1]),h=(s[0]-u[0])/1e3,p=s[2];if(0!==h&&l!==c){var f=.15*(l-c)/h;Math.abs(f)>2.5&&(f=f>0?2.5:-2.5);var d=1e3*Math.abs(f/(12*.15)),m=l+f*d/2e3;m<0&&(m=0),a.easeTo({zoom:m,duration:d,easing:Sn,around:this._aroundCenter?a.getCenter():a.unproject(p),noMoveStart:!0},{originalEvent:e})}else a.snapToNorth({},{originalEvent:e})}}},Rn.prototype._drainInertiaBuffer=function(){for(var e=this._inertia,r=t.browser.now();e.length>2&&r-e[0][0]>160;)e.shift()};var In={scrollZoom:gn,boxZoom:vn,dragRotate:bn,dragPan:En,keyboard:An,doubleClickZoom:Mn,touchZoomRotate:Rn},Cn=function(e){function r(r,n){e.call(this),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=n.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},r.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},r.prototype.panBy=function(e,r,n){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},r),n)},r.prototype.panTo=function(e,r,n){return this.easeTo(t.extend({center:e},r),n)},r.prototype.getZoom=function(){return this.transform.zoom},r.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},r.prototype.zoomTo=function(e,r,n){return this.easeTo(t.extend({zoom:e},r),n)},r.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},r.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},r.prototype.getBearing=function(){return this.transform.bearing},r.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},r.prototype.rotateTo=function(e,r,n){return this.easeTo(t.extend({bearing:e},r),n)},r.prototype.resetNorth=function(e,r){return this.rotateTo(0,t.extend({duration:1e3},e),r),this},r.prototype.resetNorthPitch=function(e,r){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),r),this},r.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},r.prototype.getPitch=function(){return this.transform.pitch},r.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},r.prototype.cameraForBounds=function(e,r){return e=t.LngLatBounds.convert(e),this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),0,r)},r.prototype._cameraForBoxAndBearing=function(e,r,n,i){if("number"==typeof(i=t.extend({padding:{top:0,bottom:0,right:0,left:0},offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var o=i.padding;i.padding={top:o,bottom:o,right:o,left:o}}if(t.deepEqual(Object.keys(i.padding).sort(function(t,e){return t<e?-1:t>e?1:0}),["bottom","left","right","top"])){var a=this.transform,s=a.project(t.LngLat.convert(e)),u=a.project(t.LngLat.convert(r)),l=s.rotate(-n*Math.PI/180),c=u.rotate(-n*Math.PI/180),h=new t.Point(Math.max(l.x,c.x),Math.max(l.y,c.y)),p=new t.Point(Math.min(l.x,c.x),Math.min(l.y,c.y)),f=h.sub(p),d=(a.width-i.padding.left-i.padding.right)/f.x,m=(a.height-i.padding.top-i.padding.bottom)/f.y;if(!(m<0||d<0)){var y=Math.min(a.scaleZoom(a.scale*Math.min(d,m)),i.maxZoom),_=t.Point.convert(i.offset),g=new t.Point(_.x+(i.padding.left-i.padding.right)/2,_.y+(i.padding.top-i.padding.bottom)/2).mult(a.scale/a.zoomScale(y));return{center:a.unproject(s.add(u).div(2).sub(g)),zoom:y,bearing:n}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}else t.warnOnce("options.padding must be a positive number, or an Object with keys 'bottom', 'left', 'right', 'top'")},r.prototype.fitBounds=function(t,e,r){return this._fitInternal(this.cameraForBounds(t,e),e,r)},r.prototype.fitScreenCoordinates=function(e,r,n,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(r)),n,i),i,o)},r.prototype._fitInternal=function(e,r,n){return e?(r=t.extend(e,r)).linear?this.easeTo(r,n):this.flyTo(r,n):this},r.prototype.jumpTo=function(e,r){this.stop();var n=this.transform,i=!1,o=!1,a=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(i=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=t.LngLat.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(o=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(a=!0,n.pitch=+e.pitch),this.fire(new t.Event("movestart",r)).fire(new t.Event("move",r)),i&&this.fire(new t.Event("zoomstart",r)).fire(new t.Event("zoom",r)).fire(new t.Event("zoomend",r)),o&&this.fire(new t.Event("rotatestart",r)).fire(new t.Event("rotate",r)).fire(new t.Event("rotateend",r)),a&&this.fire(new t.Event("pitchstart",r)).fire(new t.Event("pitch",r)).fire(new t.Event("pitchend",r)),this.fire(new t.Event("moveend",r))},r.prototype.easeTo=function(e,r){var n=this;this.stop(),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||t.browser.prefersReducedMotion)&&(e.duration=0);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u="zoom"in e?+e.zoom:o,l="bearing"in e?this._normalizeBearing(e.bearing,a):a,c="pitch"in e?+e.pitch:s,h=i.centerPoint.add(t.Point.convert(e.offset)),p=i.pointLocation(h),f=t.LngLat.convert(e.center||p);this._normalizeCenter(f);var d,m,y=i.project(p),_=i.project(f).sub(y),g=i.zoomScale(u-o);return e.around&&(d=t.LngLat.convert(e.around),m=i.locationPoint(d)),this._zooming=u!==o,this._rotating=a!==l,this._pitching=c!==s,this._prepareEase(r,e.noMoveStart),clearTimeout(this._easeEndTimeoutID),this._ease(function(e){if(n._zooming&&(i.zoom=t.number(o,u,e)),n._rotating&&(i.bearing=t.number(a,l,e)),n._pitching&&(i.pitch=t.number(s,c,e)),d)i.setLocationAtPoint(d,m);else{var p=i.zoomScale(i.zoom-o),f=u>o?Math.min(2,g):Math.max(.5,g),v=Math.pow(f,1-e),x=i.unproject(y.add(_.mult(e*v)).mult(p));i.setLocationAtPoint(i.renderWorldCopies?x.wrap():x,h)}n._fireMoveEvents(r)},function(){e.delayEndEvents?n._easeEndTimeoutID=setTimeout(function(){return n._afterEase(r)},e.delayEndEvents):n._afterEase(r)},e),this},r.prototype._prepareEase=function(e,r){this._moving=!0,r||this.fire(new t.Event("movestart",e)),this._zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&this.fire(new t.Event("pitchstart",e))},r.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},r.prototype._afterEase=function(e){var r=this._zooming,n=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,r&&this.fire(new t.Event("zoomend",e)),n&&this.fire(new t.Event("rotateend",e)),i&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))},r.prototype.flyTo=function(e,r){var n=this;if(t.browser.prefersReducedMotion){var i=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,r)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,a=this.getZoom(),s=this.getBearing(),u=this.getPitch(),l="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):a,c="bearing"in e?this._normalizeBearing(e.bearing,s):s,h="pitch"in e?+e.pitch:u,p=o.zoomScale(l-a),f=o.centerPoint.add(t.Point.convert(e.offset)),d=o.pointLocation(f),m=t.LngLat.convert(e.center||d);this._normalizeCenter(m);var y=o.project(d),_=o.project(m).sub(y),g=e.curve,v=Math.max(o.width,o.height),x=v/p,b=_.mag();if("minZoom"in e){var w=t.clamp(Math.min(e.minZoom,a,l),o.minZoom,o.maxZoom),E=v/o.zoomScale(w-a);g=Math.sqrt(E/b*2)}var A=g*g;function T(t){var e=(x*x-v*v+(t?-1:1)*A*A*b*b)/(2*(t?x:v)*A*b);return Math.log(Math.sqrt(e*e+1)-e)}function M(t){return(Math.exp(t)-Math.exp(-t))/2}function S(t){return(Math.exp(t)+Math.exp(-t))/2}var R=T(0),I=function(t){return S(R)/S(R+g*t)},C=function(t){return v*((S(R)*(M(e=R+g*t)/S(e))-M(R))/A)/b;var e},P=(T(1)-R)/g;if(Math.abs(b)<1e-6||!isFinite(P)){if(Math.abs(v-x)<1e-6)return this.easeTo(e,r);var D=x<v?-1:1;P=Math.abs(Math.log(x/v))/g,C=function(){return 0},I=function(t){return Math.exp(D*g*t)}}"duration"in e?e.duration=+e.duration:e.duration=1e3*P/("screenSpeed"in e?+e.screenSpeed/g:+e.speed);return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==c,this._pitching=h!==u,this._prepareEase(r,!1),this._ease(function(e){var i=e*P,p=1/I(i);o.zoom=1===e?l:a+o.scaleZoom(p),n._rotating&&(o.bearing=t.number(s,c,e)),n._pitching&&(o.pitch=t.number(u,h,e));var d=1===e?m:o.unproject(y.add(_.mult(C(i))).mult(p));o.setLocationAtPoint(o.renderWorldCopies?d.wrap():d,f),n._fireMoveEvents(r)},function(){return n._afterEase(r)},e),this},r.prototype.isEasing=function(){return!!this._easeFrameId},r.prototype.stop=function(){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var t=this._onEaseEnd;delete this._onEaseEnd,t.call(this)}return this},r.prototype._ease=function(e,r,n){!1===n.animate||0===n.duration?(e(1),r()):(this._easeStart=t.browser.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},r.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},r.prototype._normalizeBearing=function(e,r){e=t.wrap(e,-180,180);var n=Math.abs(e-r);return Math.abs(e-360-r)<n&&(e-=360),Math.abs(e+360-r)<n&&(e+=360),e},r.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var r=t.lng-e.center.lng;t.lng+=r>180?-360:r<-180?360:0}},r}(t.Evented),Pn=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};Pn.prototype.getDefaultPosition=function(){return"bottom-right"},Pn.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._innerContainer=r.create("div","mapboxgl-ctrl-attrib-inner",this._container),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Pn.prototype.onRemove=function(){r.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},Pn.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var n=r.reduce(function(t,e,n){return e.value&&(t+=e.key+"="+e.value+(n<r.length-1?"&":"")),t},"?");e.href=t.config.FEEDBACK_URL+"/"+n+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow"}},Pn.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},Pn.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(function(t){return"string"!=typeof t?"":t})):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var r=this._map.style.sourceCaches;for(var n in r){var i=r[n];if(i.used){var o=i.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort(function(t,e){return t.length-e.length});var a=(t=t.filter(function(e,r){for(var n=r+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0})).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Pn.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact")};var Dn=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};Dn.prototype.onAdd=function(t){this._map=t,this._container=r.create("div","mapboxgl-ctrl");var e=r.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label","Mapbox logo"),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Dn.prototype.onRemove=function(){r.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Dn.prototype.getDefaultPosition=function(){return"bottom-left"},Dn.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},Dn.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},Dn.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var Ln=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ln.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},Ln.prototype.remove=function(t){for(var e=this._currentlyRunning,r=0,n=e?this._queue.concat(e):this._queue;r<n.length;r+=1){var i=n[r];if(i.id===t)return void(i.cancelled=!0)}},Ln.prototype.run=function(){var t=this._currentlyRunning=this._queue;this._queue=[];for(var e=0,r=t;e<r.length;e+=1){var n=r[e];if(!n.cancelled&&(n.callback(),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ln.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var On=t.window.HTMLImageElement,kn=t.window.HTMLElement,Fn={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:0,maxZoom:22,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,clickTolerance:3,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Bn=function(n){function i(e){var i=this;if(null!=(e=t.extend({},Fn,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than minZoom");var o=new pn(e.minZoom,e.maxZoom,e.renderWorldCopies);if(n.call(this,o,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new Ln,this._controls=[],this._mapId=t.uniqueId(),this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof kn))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return i._update(!1)}),this.on("moveend",function(){return i._update(!1)}),this.on("zoom",function(){return i._update(!0)}),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1)),function(t,e){var n=t.getCanvasContainer(),i=null,o=!1,a=null;for(var s in In)t[s]=new In[s](t,e),e.interactive&&e[s]&&t[s].enable(e[s]);r.addEventListener(n,"mouseout",function(e){t.fire(new mn("mouseout",t,e))}),r.addEventListener(n,"mousedown",function(i){o=!0,a=r.mousePos(n,i);var s=new mn("mousedown",t,i);t.fire(s),s.defaultPrevented||(e.interactive&&!t.doubleClickZoom.isActive()&&t.stop(),t.boxZoom.onMouseDown(i),t.boxZoom.isActive()||t.dragPan.isActive()||t.dragRotate.onMouseDown(i),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onMouseDown(i))}),r.addEventListener(n,"mouseup",function(e){var r=t.dragRotate.isActive();i&&!r&&t.fire(new mn("contextmenu",t,i)),i=null,o=!1,t.fire(new mn("mouseup",t,e))}),r.addEventListener(n,"mousemove",function(e){if(!t.dragPan.isActive()&&!t.dragRotate.isActive()){for(var r=e.target;r&&r!==n;)r=r.parentNode;r===n&&t.fire(new mn("mousemove",t,e))}}),r.addEventListener(n,"mouseover",function(e){for(var r=e.target;r&&r!==n;)r=r.parentNode;r===n&&t.fire(new mn("mouseover",t,e))}),r.addEventListener(n,"touchstart",function(r){var n=new yn("touchstart",t,r);t.fire(n),n.defaultPrevented||(e.interactive&&t.stop(),t.boxZoom.isActive()||t.dragRotate.isActive()||t.dragPan.onTouchStart(r),t.touchZoomRotate.onStart(r),t.doubleClickZoom.onTouchStart(n))},{passive:!1}),r.addEventListener(n,"touchmove",function(e){t.fire(new yn("touchmove",t,e))},{passive:!1}),r.addEventListener(n,"touchend",function(e){t.fire(new yn("touchend",t,e))}),r.addEventListener(n,"touchcancel",function(e){t.fire(new yn("touchcancel",t,e))}),r.addEventListener(n,"click",function(i){var o=r.mousePos(n,i);(!a||o.equals(a)||o.dist(a)<e.clickTolerance)&&t.fire(new mn("click",t,i))}),r.addEventListener(n,"dblclick",function(e){var r=new mn("dblclick",t,e);t.fire(r),r.defaultPrevented||t.doubleClickZoom.onDblClick(r)}),r.addEventListener(n,"contextmenu",function(e){var r=t.dragRotate.isActive();o||r?o&&(i=e):t.fire(new mn("contextmenu",t,e)),(t.dragRotate.isEnabled()||t.listens("contextmenu"))&&e.preventDefault()}),r.addEventListener(n,"wheel",function(r){e.interactive&&t.stop();var n=new _n("wheel",t,r);t.fire(n),n.defaultPrevented||t.scrollZoom.onWheel(r)},{passive:!1})}(this,e),this._hash=e.hash&&(new dn).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new Pn({customAttribution:e.customAttribution})),this.addControl(new Dn,e.logoPosition),this.on("style.load",function(){i.transform.unmodified&&i.jumpTo(i.style.stylesheet)}),this.on("data",function(e){i._update("style"===e.dataType),i.fire(new t.Event(e.dataType+"data",e))}),this.on("dataloading",function(e){i.fire(new t.Event(e.dataType+"dataloading",e))})}n&&(i.__proto__=n),(i.prototype=Object.create(n&&n.prototype)).constructor=i;var o={showTileBoundaries:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(e,r){if(void 0===r&&e.getDefaultPosition&&(r=e.getDefaultPosition()),void 0===r&&(r="top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var n=e.onAdd(this);this._controls.push(e);var i=this._controlPositions[r];return-1!==r.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this},i.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var r=this._controls.indexOf(e);return r>-1&&this._controls.splice(r,1),e.onRemove(this),this},i.prototype.resize=function(e){var r=this._containerDimensions(),n=r[0],i=r[1];return this._resizeCanvas(n,i),this.transform.resize(n,i),this.painter.resize(n,i),this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)).fire(new t.Event("resize",e)).fire(new t.Event("moveend",e)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},i.prototype.setMinZoom=function(t){if((t=null==t?0:t)>=0&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between 0 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},i.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},i.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},i.prototype.isMoving=function(){return this._moving||this.dragPan.isActive()||this.dragRotate.isActive()||this.scrollZoom.isActive()},i.prototype.isZooming=function(){return this._zooming||this.scrollZoom.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.dragRotate.isActive()},i.prototype.on=function(t,e,r){var i=this;if(void 0===r)return n.prototype.on.call(this,t,e);var o=function(){var n;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:r,delegates:{mousemove:function(n){var a=i.getLayer(e)?i.queryRenderedFeatures(n.point,{layers:[e]}):[];a.length?o||(o=!0,r.call(i,new mn(t,i,n.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:r,delegates:{mousemove:function(n){(i.getLayer(e)?i.queryRenderedFeatures(n.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,r.call(i,new mn(t,i,n.originalEvent)))},mouseout:function(e){a&&(a=!1,r.call(i,new mn(t,i,e.originalEvent)))}}}}return{layer:e,listener:r,delegates:(n={},n[t]=function(t){var n=i.getLayer(e)?i.queryRenderedFeatures(t.point,{layers:[e]}):[];n.length&&(t.features=n,r.call(i,t),delete t.features)},n)}}();for(var a in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(o),o.delegates)this.on(a,o.delegates[a]);return this},i.prototype.off=function(t,e,r){if(void 0===r)return n.prototype.off.call(this,t,e);if(this._delegatedListeners&&this._delegatedListeners[t])for(var i=this._delegatedListeners[t],o=0;o<i.length;o++){var a=i[o];if(a.layer===e&&a.listener===r){for(var s in a.delegates)this.off(s,a.delegates[s]);return i.splice(o,1),this}}return this},i.prototype.queryRenderedFeatures=function(e,r){if(!this.style)return[];var n;if(void 0!==r||void 0===e||e instanceof t.Point||Array.isArray(e)||(r=e,e=void 0),r=r||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])n=[t.Point.convert(e)];else{var i=t.Point.convert(e[0]),o=t.Point.convert(e[1]);n=[i,new t.Point(o.x,i.y),o,new t.Point(i.x,o.y),i]}return this.style.queryRenderedFeatures(n,r,this.transform)},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(e,r){return!1!==(r=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(e,r))},i.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Be(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype._diffStyle=function(e,r){var n=this;if("string"==typeof e){var i=this._requestManager.normalizeStyleURL(e),o=this._requestManager.transformRequest(i,t.ResourceType.Style);t.getJSON(o,function(e,i){e?n.fire(new t.ErrorEvent(e)):i&&n._updateDiff(i,r)})}else"object"==typeof e&&this._updateDiff(e,r)},i.prototype._updateDiff=function(e,r){try{this.style.setState(e)&&this._update(!0)}catch(n){t.warnOnce("Unable to perform style diff: "+(n.message||n.error||n)+".  Rebuilding the style from scratch."),this._updateStyle(e,r)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0)},i.prototype.isSourceLoaded=function(e){var r=this.style&&this.style.sourceCaches[e];if(void 0!==r)return r.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var r=t[e]._tiles;for(var n in r){var i=r[n];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,r){return this.style.addSourceType(t,e,r)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(e,r,n){void 0===n&&(n={});var i=n.pixelRatio;void 0===i&&(i=1);var o=n.sdf;if(void 0===o&&(o=!1),r instanceof On){var a=t.browser.getImageData(r);this.style.addImage(e,{data:new t.RGBAImage({width:a.width,height:a.height},a.data),pixelRatio:i,sdf:o,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var s=r;this.style.addImage(e,{data:new t.RGBAImage({width:r.width,height:r.height},new Uint8Array(r.data)),pixelRatio:i,sdf:o,version:0,userImage:s}),s.onAdd&&s.onAdd(this,e)}},i.prototype.updateImage=function(e,r){var n=this.style.getImage(e);if(!n)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=r instanceof On?t.browser.getImageData(r):r,o=i.width,a=i.height,s=i.data;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==n.data.width||a!==n.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(n.data.replace(s,!(r instanceof On)),void this.style.updateImage(e,n))},i.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(e,r){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),r)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0)},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setLayerZoomRange=function(t,e,r){return this.style.setLayerZoomRange(t,e,r),this._update(!0)},i.prototype.setFilter=function(t,e,r){return void 0===r&&(r={}),this.style.setFilter(t,e,r),this._update(!0)},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,r,n){return void 0===n&&(n={}),this.style.setPaintProperty(t,e,r,n),this._update(!0)},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,r,n){return void 0===n&&(n={}),this.style.setLayoutProperty(t,e,r,n),this._update(!0)},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t,e){return void 0===e&&(e={}),this.style.setLight(t,e),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},i.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},i.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=r.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=r.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=r.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map");var n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);var i=this._controlContainer=r.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){o[t]=r.create("div","mapboxgl-ctrl-"+t,i)})},i.prototype._resizeCanvas=function(e,r){var n=t.window.devicePixelRatio||1;this._canvas.width=n*e,this._canvas.height=n*r,this._canvas.style.width=e+"px",this._canvas.style.height=r+"px"},i.prototype._setupPainter=function(){var r=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",r)||this._canvas.getContext("experimental-webgl",r);n?(this.painter=new un(n,this.transform),t.webpSupported.testSupport(n)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},i.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},i.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},i.prototype._render=function(){this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run();var e=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var r=this.transform.zoom,n=t.browser.now();this.style.zoomHistory.update(r,n);var i=new t.EvaluationParameters(r,{now:n,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),o=i.crossFadingFactor();1===o&&o===this._crossFadingFactor||(e=!0,this._crossFadingFactor=o),this.style.update(i)}return this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||e)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this._sourcesDirty||this._repaint||this._styleDirty||this._placementDirty?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),this},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,r=this._controls;e<r.length;e+=1)r[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var n=this.painter.context.gl.getExtension("WEBGL_lose_context");n&&n.loseContext(),Nn(this._canvasContainer),Nn(this._controlContainer),Nn(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this.fire(new t.Event("remove"))},i.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame(function(){e._frame=null,e._render()}))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(t){this._vertices=t,this._update()},i.prototype._setCacheLimits=function(e,r){t.setCacheLimits(e,r)},o.version.get=function(){return t.version},Object.defineProperties(i.prototype,o),i}(Cn);function Nn(t){t.parentNode&&t.parentNode.removeChild(t)}var zn={showCompass:!0,showZoom:!0,visualizePitch:!1},Un=function(e){var n=this;this.options=t.extend({},zn,e),this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this.options.showZoom&&(t.bindAll(["_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-in","Zoom in",function(t){return n._map.zoomIn({},{originalEvent:t})}),this._zoomOutButton=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-zoom-out","Zoom out",function(t){return n._map.zoomOut({},{originalEvent:t})})),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-icon mapboxgl-ctrl-compass","Reset bearing to north",function(t){n.options.visualizePitch?n._map.resetNorthPitch({},{originalEvent:t}):n._map.resetNorth({},{originalEvent:t})}),this._compassArrow=r.create("span","mapboxgl-ctrl-compass-arrow",this._compass))};function Vn(e,r,n){if(e=new t.LngLat(e.lng,e.lat),r){var i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=n.locationPoint(e).distSqr(r);n.locationPoint(i).distSqr(r)<a?e=i:n.locationPoint(o).distSqr(r)<a&&(e=o)}for(;Math.abs(e.lng-n.center.lng)>180;){var s=n.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=n.width&&s.y<=n.height)break;e.lng>n.center.lng?e.lng-=360:e.lng+=360}return e}Un.prototype._updateZoomButtons=function(){var t=this._map.getZoom();t===this._map.getMaxZoom()?this._zoomInButton.classList.add("mapboxgl-ctrl-icon-disabled"):this._zoomInButton.classList.remove("mapboxgl-ctrl-icon-disabled"),t===this._map.getMinZoom()?this._zoomOutButton.classList.add("mapboxgl-ctrl-icon-disabled"):this._zoomOutButton.classList.remove("mapboxgl-ctrl-icon-disabled")},Un.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},Un.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bn(t,{button:"left",element:this._compass}),r.addEventListener(this._compass,"mousedown",this._handler.onMouseDown),r.addEventListener(this._compass,"touchstart",this._handler.onMouseDown,{passive:!1}),this._handler.enable()),this._container},Un.prototype.onRemove=function(){r.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),r.removeEventListener(this._compass,"mousedown",this._handler.onMouseDown),r.removeEventListener(this._compass,"touchstart",this._handler.onMouseDown,{passive:!1}),this._handler.disable(),delete this._handler),delete this._map},Un.prototype._createButton=function(t,e,n){var i=r.create("button",t,this._container);return i.type="button",i.title=e,i.setAttribute("aria-label",e),i.addEventListener("click",n),i};var jn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gn(t,e,r){var n=t.classList;for(var i in jn)n.remove("mapboxgl-"+r+"-anchor-"+i);n.add("mapboxgl-"+r+"-anchor-"+e)}var qn,Hn=function(e){function n(n,i){if(e.call(this),(n instanceof t.window.HTMLElement||i)&&(n=t.extend({element:n},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._draggable=n&&n.draggable||!1,this._state="inactive",n&&n.element)this._element=n.element,this._offset=t.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=r.create("div");var o=r.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=r.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=r.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=r.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var l=0,c=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];l<c.length;l+=1){var h=c[l],p=r.createNS("http://www.w3.org/2000/svg","ellipse");p.setAttributeNS(null,"opacity","0.04"),p.setAttributeNS(null,"cx","10.5"),p.setAttributeNS(null,"cy","5.80029008"),p.setAttributeNS(null,"rx",h.rx),p.setAttributeNS(null,"ry",h.ry),u.appendChild(p)}var f=r.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill",this._color);var d=r.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),f.appendChild(d);var m=r.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"opacity","0.25"),m.setAttributeNS(null,"fill","#000000");var y=r.createNS("http://www.w3.org/2000/svg","path");y.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),m.appendChild(y);var _=r.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_.setAttributeNS(null,"fill","#FFFFFF");var g=r.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(8.0, 8.0)");var v=r.createNS("http://www.w3.org/2000/svg","circle");v.setAttributeNS(null,"fill","#000000"),v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"cx","5.5"),v.setAttributeNS(null,"cy","5.5"),v.setAttributeNS(null,"r","5.4999962");var x=r.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#FFFFFF"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962"),g.appendChild(v),g.appendChild(x),s.appendChild(u),s.appendChild(f),s.appendChild(m),s.appendChild(_),s.appendChild(g),o.appendChild(s),this._element.appendChild(o),this._offset=t.Point.convert(n&&n.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(t){t.preventDefault()}),Gn(this._element,this._anchor,"marker"),this._popup=null}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},n.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),r.remove(this._element),this._popup&&this._popup.remove(),this},n.prototype.getLngLat=function(){return this._lngLat},n.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},n.prototype.getElement=function(){return this._element},n.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat)}return this},n.prototype._onMapClick=function(t){var e=t.originalEvent.target,r=this._element;this._popup&&(e===r||r.contains(e))&&this.togglePopup()},n.prototype.getPopup=function(){return this._popup},n.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},n.prototype._update=function(t){this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=Vn(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset),t&&"moveend"!==t.type||(this._pos=this._pos.round()),r.setTransform(this._element,jn[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px)"))},n.prototype.getOffset=function(){return this._offset},n.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},n.prototype._onMove=function(e){this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag"))},n.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},n.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},n.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},n.prototype.isDraggable=function(){return this._draggable},n}(t.Evented),Xn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showUserLocation:!0},Yn=function(e){function n(r){e.call(this),this.options=t.extend({},Xn,r),t.bindAll(["_onSuccess","_onError","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(e){var n;return this._map=e,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==qn?n(qn):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then(function(t){n(qn="denied"!==t.state)}):n(qn=!!t.window.navigator.geolocation),this._container},n.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),r.remove(this._container),this._map=void 0},n.prototype._onSuccess=function(e){if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()},n.prototype._updateCamera=function(e){var r=new t.LngLat(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(n),o,{geolocateSource:!0})},n.prototype._updateMarker=function(t){t?this._userLocationDotMarker.setLngLat([t.coords.longitude,t.coords.latitude]).addTo(this._map):this._userLocationDotMarker.remove()},n.prototype._onError=function(e){if(this.options.trackUserLocation)if(1===e.code)this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),void 0!==this._geolocationWatchID&&this._clearWatch();else switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()},n.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},n.prototype._setupUI=function(e){var n=this;!1!==e?(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=r.create("button","mapboxgl-ctrl-icon mapboxgl-ctrl-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.title="Find my location",this._geolocateButton.setAttribute("aria-label","Find my location"),this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=r.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Hn(this._dotElement),this.options.trackUserLocation&&(this._watchState="OFF")),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(e){e.geolocateSource||"ACTIVE_LOCK"!==n._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(n._watchState="BACKGROUND",n._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),n._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),n.fire(new t.Event("trackuserlocationend")))})):t.warnOnce("Geolocation support is not available, the GeolocateControl will not be visible.")},n.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}"OFF"===this._watchState&&void 0!==this._geolocationWatchID?this._clearWatch():void 0===this._geolocationWatchID&&(this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,this.options.positionOptions))}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},n.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},n}(t.Evented),Zn={maxWidth:100,unit:"metric"},Wn=function(e){this.options=t.extend({},Zn,e),t.bindAll(["_onMove","setUnit"],this)};function Kn(t,e,r){var n,i,o,a,s,u,l=r&&r.maxWidth||100,c=t._container.clientHeight/2,h=(n=t.unproject([0,c]),i=t.unproject([l,c]),o=Math.PI/180,a=n.lat*o,s=i.lat*o,u=Math.sin(a)*Math.sin(s)+Math.cos(a)*Math.cos(s)*Math.cos((i.lng-n.lng)*o),6371e3*Math.acos(Math.min(u,1)));if(r&&"imperial"===r.unit){var p=3.2808*h;p>5280?Jn(e,l,p/5280,"mi"):Jn(e,l,p,"ft")}else r&&"nautical"===r.unit?Jn(e,l,h/1852,"nm"):Jn(e,l,h,"m")}function Jn(t,e,r,n){var i,o,a,s=(i=r,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=(a=i/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a))),u=s/r;"m"===n&&s>=1e3&&(s/=1e3,n="km"),t.style.width=e*u+"px",t.innerHTML=s+n}Wn.prototype.getDefaultPosition=function(){return"bottom-left"},Wn.prototype._onMove=function(){Kn(this._map,this._container,this.options)},Wn.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Wn.prototype.onRemove=function(){r.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Wn.prototype.setUnit=function(t){this.options.unit=t,Kn(this._map,this._container,this.options)};var Qn=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange"),this._className="mapboxgl-ctrl"};Qn.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=r.create("div",this._className+" mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Qn.prototype.onRemove=function(){r.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Qn.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Qn.prototype._setupUI=function(){(this._fullscreenButton=r.create("button",this._className+"-icon "+this._className+"-fullscreen",this._controlContainer)).type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Qn.prototype._updateTitle=function(){var t=this._isFullscreen()?"Exit fullscreen":"Enter fullscreen";this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Qn.prototype._isFullscreen=function(){return this._fullscreen},Qn.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle(this._className+"-shrink"),this._fullscreenButton.classList.toggle(this._className+"-fullscreen"),this._updateTitle())},Qn.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var $n={closeButton:!0,closeOnClick:!0,className:"",maxWidth:"240px"},ti=function(e){function n(r){e.call(this),this.options=t.extend(Object.create($n),r),t.bindAll(["_update","_onClickClose","remove"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.addTo=function(e){var r=this;return this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._map.on("remove",this.remove),this._update(),this._trackPointer?(this._map.on("mousemove",function(t){r._update(t.point)}),this._map.on("mouseup",function(t){r._update(t.point)}),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},n.prototype.isOpen=function(){return!!this._map},n.prototype.remove=function(){return this._content&&r.remove(this._content),this._container&&(r.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),this._map.off("remove",this.remove),this._map.off("mousemove"),delete this._map),this.fire(new t.Event("close")),this},n.prototype.getLngLat=function(){return this._lngLat},n.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove"),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},n.prototype.trackPointer=function(){var t=this;return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",function(e){t._update(e.point)}),this._map.on("drag",function(e){t._update(e.point)}),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},n.prototype.getElement=function(){return this._container},n.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},n.prototype.setHTML=function(e){var r,n=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");for(i.innerHTML=e;r=i.firstChild;)n.appendChild(r);return this.setDOMContent(n)},n.prototype.getMaxWidth=function(){return this._container.style.maxWidth},n.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},n.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},n.prototype._createContent=function(){this._content&&r.remove(this._content),this._content=r.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=r.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},n.prototype._update=function(e){var n=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=r.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=r.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(t){return n._container.classList.add(t)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vn(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var i=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),o=this.options.anchor,a=function e(r){if(r){if("number"==typeof r){var n=Math.round(Math.sqrt(.5*Math.pow(r,2)));return{center:new t.Point(0,0),top:new t.Point(0,r),"top-left":new t.Point(n,n),"top-right":new t.Point(-n,n),bottom:new t.Point(0,-r),"bottom-left":new t.Point(n,-n),"bottom-right":new t.Point(-n,-n),left:new t.Point(r,0),right:new t.Point(-r,0)}}if(r instanceof t.Point||Array.isArray(r)){var i=t.Point.convert(r);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.Point.convert(r.center||[0,0]),top:t.Point.convert(r.top||[0,0]),"top-left":t.Point.convert(r["top-left"]||[0,0]),"top-right":t.Point.convert(r["top-right"]||[0,0]),bottom:t.Point.convert(r.bottom||[0,0]),"bottom-left":t.Point.convert(r["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(r["bottom-right"]||[0,0]),left:t.Point.convert(r.left||[0,0]),right:t.Point.convert(r.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!o){var s,u=this._container.offsetWidth,l=this._container.offsetHeight;s=i.y+a.bottom.y<l?["top"]:i.y>this._map.transform.height-l?["bottom"]:[],i.x<u/2?s.push("left"):i.x>this._map.transform.width-u/2&&s.push("right"),o=0===s.length?"bottom":s.join("-")}var c=i.add(a[o]).round();r.setTransform(this._container,jn[o]+" translate("+c.x+"px,"+c.y+"px)"),Gn(this._container,o,"popup")}},n.prototype._onClickClose=function(){this.remove()},n}(t.Evented),ei={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,Map:Bn,NavigationControl:Un,GeolocateControl:Yn,AttributionControl:Pn,ScaleControl:Wn,FullscreenControl:Qn,Popup:ti,Marker:Hn,Style:Be,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Ot.workerCount},set workerCount(t){Ot.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return ei}),r},"object"==typeof r&&void 0!==e?e.exports=i():"function"==typeof define&&define.amd?define(i):(n=n||self).mapboxgl=i()},{}],181:[function(t,e,r){var n=t("./normalize"),i=t("gl-mat4/create"),o=t("gl-mat4/clone"),a=t("gl-mat4/determinant"),s=t("gl-mat4/invert"),u=t("gl-mat4/transpose"),l={length:t("gl-vec3/length"),normalize:t("gl-vec3/normalize"),dot:t("gl-vec3/dot"),cross:t("gl-vec3/cross")},c=i(),h=i(),p=[0,0,0,0],f=[[0,0,0],[0,0,0],[0,0,0]],d=[0,0,0];function m(t,e,r,n,i){t[0]=e[0]*n+r[0]*i,t[1]=e[1]*n+r[1]*i,t[2]=e[2]*n+r[2]*i}e.exports=function(t,e,r,i,y,_){if(e||(e=[0,0,0]),r||(r=[0,0,0]),i||(i=[0,0,0]),y||(y=[0,0,0,1]),_||(_=[0,0,0,1]),!n(c,t))return!1;if(o(h,c),h[3]=0,h[7]=0,h[11]=0,h[15]=1,Math.abs(a(h)<1e-8))return!1;var g,v,x,b,w,E,A,T=c[3],M=c[7],S=c[11],R=c[12],I=c[13],C=c[14],P=c[15];if(0!==T||0!==M||0!==S){if(p[0]=T,p[1]=M,p[2]=S,p[3]=P,!s(h,h))return!1;u(h,h),(g=y)[0]=(x=h)[0]*(b=(v=p)[0])+x[4]*(w=v[1])+x[8]*(E=v[2])+x[12]*(A=v[3]),g[1]=x[1]*b+x[5]*w+x[9]*E+x[13]*A,g[2]=x[2]*b+x[6]*w+x[10]*E+x[14]*A,g[3]=x[3]*b+x[7]*w+x[11]*E+x[15]*A}else y[0]=y[1]=y[2]=0,y[3]=1;if(e[0]=R,e[1]=I,e[2]=C,function(t,e){t[0][0]=e[0],t[0][1]=e[1],t[0][2]=e[2],t[1][0]=e[4],t[1][1]=e[5],t[1][2]=e[6],t[2][0]=e[8],t[2][1]=e[9],t[2][2]=e[10]}(f,c),r[0]=l.length(f[0]),l.normalize(f[0],f[0]),i[0]=l.dot(f[0],f[1]),m(f[1],f[1],f[0],1,-i[0]),r[1]=l.length(f[1]),l.normalize(f[1],f[1]),i[0]/=r[1],i[1]=l.dot(f[0],f[2]),m(f[2],f[2],f[0],1,-i[1]),i[2]=l.dot(f[1],f[2]),m(f[2],f[2],f[1],1,-i[2]),r[2]=l.length(f[2]),l.normalize(f[2],f[2]),i[1]/=r[2],i[2]/=r[2],l.cross(d,f[1],f[2]),l.dot(f[0],d)<0)for(var D=0;D<3;D++)r[D]*=-1,f[D][0]*=-1,f[D][1]*=-1,f[D][2]*=-1;return _[0]=.5*Math.sqrt(Math.max(1+f[0][0]-f[1][1]-f[2][2],0)),_[1]=.5*Math.sqrt(Math.max(1-f[0][0]+f[1][1]-f[2][2],0)),_[2]=.5*Math.sqrt(Math.max(1-f[0][0]-f[1][1]+f[2][2],0)),_[3]=.5*Math.sqrt(Math.max(1+f[0][0]+f[1][1]+f[2][2],0)),f[2][1]>f[1][2]&&(_[0]=-_[0]),f[0][2]>f[2][0]&&(_[1]=-_[1]),f[1][0]>f[0][1]&&(_[2]=-_[2]),!0}},{"./normalize":182,"gl-mat4/clone":32,"gl-mat4/create":34,"gl-mat4/determinant":35,"gl-mat4/invert":47,"gl-mat4/transpose":60,"gl-vec3/cross":114,"gl-vec3/dot":119,"gl-vec3/length":129,"gl-vec3/normalize":136}],182:[function(t,e,r){e.exports=function(t,e){var r=e[15];if(0===r)return!1;for(var n=1/r,i=0;i<16;i++)t[i]=e[i]*n;return!0}},{}],183:[function(t,e,r){var n=t("gl-vec3/lerp"),i=t("mat4-recompose"),o=t("mat4-decompose"),a=t("gl-mat4/determinant"),s=t("quat-slerp"),u=h(),l=h(),c=h();function h(){return{translate:p(),scale:p(1),skew:p(),perspective:[0,0,0,1],quaternion:[0,0,0,1]}}function p(t){return[t||0,t||0,t||0]}e.exports=function(t,e,r,h){if(0===a(e)||0===a(r))return!1;var p=o(e,u.translate,u.scale,u.skew,u.perspective,u.quaternion),f=o(r,l.translate,l.scale,l.skew,l.perspective,l.quaternion);return!(!p||!f||(n(c.translate,u.translate,l.translate,h),n(c.skew,u.skew,l.skew,h),n(c.scale,u.scale,l.scale,h),n(c.perspective,u.perspective,l.perspective,h),s(c.quaternion,u.quaternion,l.quaternion,h),i(t,c.translate,c.scale,c.skew,c.perspective,c.quaternion),0))}},{"gl-mat4/determinant":35,"gl-vec3/lerp":130,"mat4-decompose":181,"mat4-recompose":184,"quat-slerp":203}],184:[function(t,e,r){var n={identity:t("gl-mat4/identity"),translate:t("gl-mat4/translate"),multiply:t("gl-mat4/multiply"),create:t("gl-mat4/create"),scale:t("gl-mat4/scale"),fromRotationTranslation:t("gl-mat4/fromRotationTranslation")},i=(n.create(),n.create());e.exports=function(t,e,r,o,a,s){return n.identity(t),n.fromRotationTranslation(t,s,e),t[3]=a[0],t[7]=a[1],t[11]=a[2],t[15]=a[3],n.identity(i),0!==o[2]&&(i[9]=o[2],n.multiply(t,t,i)),0!==o[1]&&(i[9]=0,i[8]=o[1],n.multiply(t,t,i)),0!==o[0]&&(i[8]=0,i[4]=o[0],n.multiply(t,t,i)),n.scale(t,t,r),t}},{"gl-mat4/create":34,"gl-mat4/fromRotationTranslation":38,"gl-mat4/identity":45,"gl-mat4/multiply":49,"gl-mat4/scale":57,"gl-mat4/translate":59}],185:[function(t,e,r){"use strict";var n=t("binary-search-bounds"),i=t("mat4-interpolate"),o=t("gl-mat4/invert"),a=t("gl-mat4/rotateX"),s=t("gl-mat4/rotateY"),u=t("gl-mat4/rotateZ"),l=t("gl-mat4/lookAt"),c=t("gl-mat4/translate"),h=(t("gl-mat4/scale"),t("gl-vec3/normalize")),p=[0,0,0];function f(t){this._components=t.slice(),this._time=[0],this.prevMatrix=t.slice(),this.nextMatrix=t.slice(),this.computedMatrix=t.slice(),this.computedInverse=t.slice(),this.computedEye=[0,0,0],this.computedUp=[0,0,0],this.computedCenter=[0,0,0],this.computedRadius=[0],this._limits=[-Infinity,Infinity]}e.exports=function(t){return new f((t=t||{}).matrix||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])};var d=f.prototype;d.recalcMatrix=function(t){var e=this._time,r=n.le(e,t),a=this.computedMatrix;if(!(r<0)){var s=this._components;if(r===e.length-1)for(var u=16*r,l=0;l<16;++l)a[l]=s[u++];else{var c=e[r+1]-e[r],p=(u=16*r,this.prevMatrix),f=!0;for(l=0;l<16;++l)p[l]=s[u++];var d=this.nextMatrix;for(l=0;l<16;++l)d[l]=s[u++],f=f&&p[l]===d[l];if(c<1e-6||f)for(l=0;l<16;++l)a[l]=p[l];else i(a,p,d,(t-e[r])/c)}var m=this.computedUp;m[0]=a[1],m[1]=a[5],m[2]=a[9],h(m,m);var y=this.computedInverse;o(y,a);var _=this.computedEye,g=y[15];_[0]=y[12]/g,_[1]=y[13]/g,_[2]=y[14]/g;var v=this.computedCenter,x=Math.exp(this.computedRadius[0]);for(l=0;l<3;++l)v[l]=_[l]-a[2+4*l]*x}},d.idle=function(t){if(!(t<this.lastT())){for(var e=this._components,r=e.length-16,n=0;n<16;++n)e.push(e[r++]);this._time.push(t)}},d.flush=function(t){var e=n.gt(this._time,t)-2;e<0||(this._time.splice(0,e),this._components.splice(0,16*e))},d.lastT=function(){return this._time[this._time.length-1]},d.lookAt=function(t,e,r,n){this.recalcMatrix(t),this.setMatrix(t,l(this.computedMatrix,e=e||this.computedEye,r=r||p,n=n||this.computedUp));for(var i=0,o=0;o<3;++o)i+=Math.pow(r[o]-e[o],2);i=Math.log(Math.sqrt(i)),this.computedRadius[0]=i},d.rotate=function(t,e,r,n){this.recalcMatrix(t);var i=this.computedInverse;e&&s(i,i,e),r&&a(i,i,r),n&&u(i,i,n),this.setMatrix(t,o(this.computedMatrix,i))};var m=[0,0,0];d.pan=function(t,e,r,n){m[0]=-(e||0),m[1]=-(r||0),m[2]=-(n||0),this.recalcMatrix(t);var i=this.computedInverse;c(i,i,m),this.setMatrix(t,o(i,i))},d.translate=function(t,e,r,n){m[0]=e||0,m[1]=r||0,m[2]=n||0,this.recalcMatrix(t);var i=this.computedMatrix;c(i,i,m),this.setMatrix(t,i)},d.setMatrix=function(t,e){if(!(t<this.lastT())){this._time.push(t);for(var r=0;r<16;++r)this._components.push(e[r])}},d.setDistance=function(t,e){this.computedRadius[0]=e},d.setDistanceLimits=function(t,e){var r=this._limits;r[0]=t,r[1]=e},d.getDistanceLimits=function(t){var e=this._limits;return t?(t[0]=e[0],t[1]=e[1],t):e}},{"binary-search-bounds":9,"gl-mat4/invert":47,"gl-mat4/lookAt":48,"gl-mat4/rotateX":54,"gl-mat4/rotateY":55,"gl-mat4/rotateZ":56,"gl-mat4/scale":57,"gl-mat4/translate":59,"gl-vec3/normalize":136,"mat4-interpolate":183}],186:[function(t,e,r){e.exports=function(t){var e=[],r=[],n=0,i=0;for(;n<t.length;)r.push([i++,i++,i++]),e.push([t[n++],t[n++],t[n++]],[t[n++],t[n++],t[n++]],[t[n++],t[n++],t[n++]]);return{positions:e,cells:r}}},{}],187:[function(t,e,r){"use strict";e.exports=function(t,e){e||(e=t,t=window);var r=0,i=0,o=0,a={shift:!1,alt:!1,control:!1,meta:!1},s=!1;function u(t){var e=!1;return"altKey"in t&&(e=e||t.altKey!==a.alt,a.alt=!!t.altKey),"shiftKey"in t&&(e=e||t.shiftKey!==a.shift,a.shift=!!t.shiftKey),"ctrlKey"in t&&(e=e||t.ctrlKey!==a.control,a.control=!!t.ctrlKey),"metaKey"in t&&(e=e||t.metaKey!==a.meta,a.meta=!!t.metaKey),e}function l(t,s){var l=n.x(s),c=n.y(s);"buttons"in s&&(t=0|s.buttons),(t!==r||l!==i||c!==o||u(s))&&(r=0|t,i=l||0,o=c||0,e&&e(r,i,o,a))}function c(t){l(0,t)}function h(){(r||i||o||a.shift||a.alt||a.meta||a.control)&&(i=o=0,r=0,a.shift=a.alt=a.control=a.meta=!1,e&&e(0,0,0,a))}function p(t){u(t)&&e&&e(r,i,o,a)}function f(t){0===n.buttons(t)?l(0,t):l(r,t)}function d(t){l(r|n.buttons(t),t)}function m(t){l(r&~n.buttons(t),t)}function y(){s||(s=!0,t.addEventListener("mousemove",f),t.addEventListener("mousedown",d),t.addEventListener("mouseup",m),t.addEventListener("mouseleave",c),t.addEventListener("mouseenter",c),t.addEventListener("mouseout",c),t.addEventListener("mouseover",c),t.addEventListener("blur",h),t.addEventListener("keyup",p),t.addEventListener("keydown",p),t.addEventListener("keypress",p),t!==window&&(window.addEventListener("blur",h),window.addEventListener("keyup",p),window.addEventListener("keydown",p),window.addEventListener("keypress",p)))}y();var _={element:t};return Object.defineProperties(_,{enabled:{get:function(){return s},set:function(e){e?y():s&&(s=!1,t.removeEventListener("mousemove",f),t.removeEventListener("mousedown",d),t.removeEventListener("mouseup",m),t.removeEventListener("mouseleave",c),t.removeEventListener("mouseenter",c),t.removeEventListener("mouseout",c),t.removeEventListener("mouseover",c),t.removeEventListener("blur",h),t.removeEventListener("keyup",p),t.removeEventListener("keydown",p),t.removeEventListener("keypress",p),t!==window&&(window.removeEventListener("blur",h),window.removeEventListener("keyup",p),window.removeEventListener("keydown",p),window.removeEventListener("keypress",p)))},enumerable:!0},buttons:{get:function(){return r},enumerable:!0},x:{get:function(){return i},enumerable:!0},y:{get:function(){return o},enumerable:!0},mods:{get:function(){return a},enumerable:!0}}),_};var n=t("mouse-event")},{"mouse-event":189}],188:[function(t,e,r){var n={left:0,top:0};e.exports=function(t,e,r){e=e||t.currentTarget||t.srcElement,Array.isArray(r)||(r=[0,0]);var i=t.clientX||0,o=t.clientY||0,a=(s=e,s===window||s===document||s===document.body?n:s.getBoundingClientRect());var s;return r[0]=i-a.left,r[1]=o-a.top,r}},{}],189:[function(t,e,r){"use strict";function n(t){return t.target||t.srcElement||window}r.buttons=function(t){if("object"==typeof t){if("buttons"in t)return t.buttons;if("which"in t){if(2===(e=t.which))return 4;if(3===e)return 2;if(e>0)return 1<<e-1}else if("button"in t){var e;if(1===(e=t.button))return 4;if(2===e)return 2;if(e>=0)return 1<<e}}return 0},r.element=n,r.x=function(t){if("object"==typeof t){if("offsetX"in t)return t.offsetX;var e=n(t).getBoundingClientRect();return t.clientX-e.left}return 0},r.y=function(t){if("object"==typeof t){if("offsetY"in t)return t.offsetY;var e=n(t).getBoundingClientRect();return t.clientY-e.top}return 0}},{}],190:[function(t,e,r){"use strict";var n=t("to-px");e.exports=function(t,e,r){"function"==typeof t&&(r=!!e,e=t,t=window);var i=n("ex",t),o=function(t){r&&t.preventDefault();var n=t.deltaX||0,o=t.deltaY||0,a=t.deltaZ||0,s=t.deltaMode,u=1;switch(s){case 1:u=i;break;case 2:u=window.innerHeight}if(o*=u,a*=u,(n*=u)||o||a)return e(n,o,a,t)};return t.addEventListener("wheel",o),o}},{"to-px":209}],191:[function(t,e,r){var n=t("iota-array"),i=t("is-buffer"),o="undefined"!=typeof Float64Array;function a(t,e){return t[0]-e[0]}function s(){var t,e=this.stride,r=new Array(e.length);for(t=0;t<r.length;++t)r[t]=[Math.abs(e[t]),t];r.sort(a);var n=new Array(r.length);for(t=0;t<n.length;++t)n[t]=r[t][1];return n}function u(t,e){var r=["View",e,"d",t].join("");e<0&&(r="View_Nil"+t);var i="generic"===t;if(-1===e){var o="function "+r+"(a){this.data=a;};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+r+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+r+"(a){return new "+r+"(a);}";return new Function(o)()}if(0===e){o="function "+r+"(a,d) {this.data = a;this.offset = d};var proto="+r+".prototype;proto.dtype='"+t+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+r+"_copy() {return new "+r+"(this.data,this.offset)};proto.pick=function "+r+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+r+"_get(){return "+(i?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+r+"_set(v){return "+(i?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+r+"(a,b,c,d){return new "+r+"(a,d)}";return new Function("TrivialArray",o)(l[t][0])}o=["'use strict'"];var a=n(e),u=a.map(function(t){return"i"+t}),c="this.offset+"+a.map(function(t){return"this.stride["+t+"]*i"+t}).join("+"),h=a.map(function(t){return"b"+t}).join(","),p=a.map(function(t){return"c"+t}).join(",");o.push("function "+r+"(a,"+h+","+p+",d){this.data=a","this.shape=["+h+"]","this.stride=["+p+"]","this.offset=d|0}","var proto="+r+".prototype","proto.dtype='"+t+"'","proto.dimension="+e),o.push("Object.defineProperty(proto,'size',{get:function "+r+"_size(){return "+a.map(function(t){return"this.shape["+t+"]"}).join("*"),"}})"),1===e?o.push("proto.order=[0]"):(o.push("Object.defineProperty(proto,'order',{get:"),e<4?(o.push("function "+r+"_order(){"),2===e?o.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===e&&o.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):o.push("ORDER})")),o.push("proto.set=function "+r+"_set("+u.join(",")+",v){"),o.push(i?"return this.data.set("+c+",v)}":"return this.data["+c+"]=v}"),o.push("proto.get=function "+r+"_get("+u.join(",")+"){"),o.push(i?"return this.data.get("+c+")}":"return this.data["+c+"]}"),o.push("proto.index=function "+r+"_index(",u.join(),"){return "+c+"}"),o.push("proto.hi=function "+r+"_hi("+u.join(",")+"){return new "+r+"(this.data,"+a.map(function(t){return["(typeof i",t,"!=='number'||i",t,"<0)?this.shape[",t,"]:i",t,"|0"].join("")}).join(",")+","+a.map(function(t){return"this.stride["+t+"]"}).join(",")+",this.offset)}");var f=a.map(function(t){return"a"+t+"=this.shape["+t+"]"}),d=a.map(function(t){return"c"+t+"=this.stride["+t+"]"});o.push("proto.lo=function "+r+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+f.join(",")+","+d.join(","));for(var m=0;m<e;++m)o.push("if(typeof i"+m+"==='number'&&i"+m+">=0){d=i"+m+"|0;b+=c"+m+"*d;a"+m+"-=d}");o.push("return new "+r+"(this.data,"+a.map(function(t){return"a"+t}).join(",")+","+a.map(function(t){return"c"+t}).join(",")+",b)}"),o.push("proto.step=function "+r+"_step("+u.join(",")+"){var "+a.map(function(t){return"a"+t+"=this.shape["+t+"]"}).join(",")+","+a.map(function(t){return"b"+t+"=this.stride["+t+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(m=0;m<e;++m)o.push("if(typeof i"+m+"==='number'){d=i"+m+"|0;if(d<0){c+=b"+m+"*(a"+m+"-1);a"+m+"=ceil(-a"+m+"/d)}else{a"+m+"=ceil(a"+m+"/d)}b"+m+"*=d}");o.push("return new "+r+"(this.data,"+a.map(function(t){return"a"+t}).join(",")+","+a.map(function(t){return"b"+t}).join(",")+",c)}");var y=new Array(e),_=new Array(e);for(m=0;m<e;++m)y[m]="a[i"+m+"]",_[m]="b[i"+m+"]";o.push("proto.transpose=function "+r+"_transpose("+u+"){"+u.map(function(t,e){return t+"=("+t+"===undefined?"+e+":"+t+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+r+"(this.data,"+y.join(",")+","+_.join(",")+",this.offset)}"),o.push("proto.pick=function "+r+"_pick("+u+"){var a=[],b=[],c=this.offset");for(m=0;m<e;++m)o.push("if(typeof i"+m+"==='number'&&i"+m+">=0){c=(c+this.stride["+m+"]*i"+m+")|0}else{a.push(this.shape["+m+"]);b.push(this.stride["+m+"])}");return o.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),o.push("return function construct_"+r+"(data,shape,stride,offset){return new "+r+"(data,"+a.map(function(t){return"shape["+t+"]"}).join(",")+","+a.map(function(t){return"stride["+t+"]"}).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",o.join("\n"))(l[t],s)}var l={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};e.exports=function(t,e,r,n){if(void 0===t)return(0,l.array[0])([]);"number"==typeof t&&(t=[t]),void 0===e&&(e=[t.length]);var a=e.length;if(void 0===r){r=new Array(a);for(var s=a-1,c=1;s>=0;--s)r[s]=c,c*=e[s]}if(void 0===n)for(n=0,s=0;s<a;++s)r[s]<0&&(n-=(e[s]-1)*r[s]);for(var h=function(t){if(i(t))return"buffer";if(o)switch(Object.prototype.toString.call(t)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(t)?"array":"generic"}(t),p=l[h];p.length<=a+1;)p.push(u(h,p.length-1));return(0,p[a+1])(t,e,r,n)}},{"iota-array":157,"is-buffer":159}],192:[function(t,e,r){e.exports=[["#69d2e7","#a7dbd8","#e0e4cc","#f38630","#fa6900"],["#fe4365","#fc9d9a","#f9cdad","#c8c8a9","#83af9b"],["#ecd078","#d95b43","#c02942","#542437","#53777a"],["#556270","#4ecdc4","#c7f464","#ff6b6b","#c44d58"],["#774f38","#e08e79","#f1d4af","#ece5ce","#c5e0dc"],["#e8ddcb","#cdb380","#036564","#033649","#031634"],["#490a3d","#bd1550","#e97f02","#f8ca00","#8a9b0f"],["#594f4f","#547980","#45ada8","#9de0ad","#e5fcc2"],["#00a0b0","#6a4a3c","#cc333f","#eb6841","#edc951"],["#e94e77","#d68189","#c6a49a","#c6e5d9","#f4ead5"],["#3fb8af","#7fc7af","#dad8a7","#ff9e9d","#ff3d7f"],["#d9ceb2","#948c75","#d5ded9","#7a6a53","#99b2b7"],["#ffffff","#cbe86b","#f2e9e1","#1c140d","#cbe86b"],["#efffcd","#dce9be","#555152","#2e2633","#99173c"],["#343838","#005f6b","#008c9e","#00b4cc","#00dffc"],["#413e4a","#73626e","#b38184","#f0b49e","#f7e4be"],["#ff4e50","#fc913a","#f9d423","#ede574","#e1f5c4"],["#99b898","#fecea8","#ff847c","#e84a5f","#2a363b"],["#655643","#80bca3","#f6f7bd","#e6ac27","#bf4d28"],["#00a8c6","#40c0cb","#f9f2e7","#aee239","#8fbe00"],["#351330","#424254","#64908a","#e8caa4","#cc2a41"],["#554236","#f77825","#d3ce3d","#f1efa5","#60b99a"],["#ff9900","#424242","#e9e9e9","#bcbcbc","#3299bb"],["#5d4157","#838689","#a8caba","#cad7b2","#ebe3aa"],["#8c2318","#5e8c6a","#88a65e","#bfb35a","#f2c45a"],["#fad089","#ff9c5b","#f5634a","#ed303c","#3b8183"],["#ff4242","#f4fad2","#d4ee5e","#e1edb9","#f0f2eb"],["#d1e751","#ffffff","#000000","#4dbce9","#26ade4"],["#f8b195","#f67280","#c06c84","#6c5b7b","#355c7d"],["#1b676b","#519548","#88c425","#bef202","#eafde6"],["#bcbdac","#cfbe27","#f27435","#f02475","#3b2d38"],["#5e412f","#fcebb6","#78c0a8","#f07818","#f0a830"],["#452632","#91204d","#e4844a","#e8bf56","#e2f7ce"],["#eee6ab","#c5bc8e","#696758","#45484b","#36393b"],["#f0d8a8","#3d1c00","#86b8b1","#f2d694","#fa2a00"],["#f04155","#ff823a","#f2f26f","#fff7bd","#95cfb7"],["#2a044a","#0b2e59","#0d6759","#7ab317","#a0c55f"],["#bbbb88","#ccc68d","#eedd99","#eec290","#eeaa88"],["#b9d7d9","#668284","#2a2829","#493736","#7b3b3b"],["#b3cc57","#ecf081","#ffbe40","#ef746f","#ab3e5b"],["#a3a948","#edb92e","#f85931","#ce1836","#009989"],["#67917a","#170409","#b8af03","#ccbf82","#e33258"],["#e8d5b7","#0e2430","#fc3a51","#f5b349","#e8d5b9"],["#aab3ab","#c4cbb7","#ebefc9","#eee0b7","#e8caaf"],["#300030","#480048","#601848","#c04848","#f07241"],["#ab526b","#bca297","#c5ceae","#f0e2a4","#f4ebc3"],["#607848","#789048","#c0d860","#f0f0d8","#604848"],["#a8e6ce","#dcedc2","#ffd3b5","#ffaaa6","#ff8c94"],["#3e4147","#fffedf","#dfba69","#5a2e2e","#2a2c31"],["#b6d8c0","#c8d9bf","#dadabd","#ecdbbc","#fedcba"],["#fc354c","#29221f","#13747d","#0abfbc","#fcf7c5"],["#1c2130","#028f76","#b3e099","#ffeaad","#d14334"],["#edebe6","#d6e1c7","#94c7b6","#403b33","#d3643b"],["#cc0c39","#e6781e","#c8cf02","#f8fcc1","#1693a7"],["#dad6ca","#1bb0ce","#4f8699","#6a5e72","#563444"],["#a7c5bd","#e5ddcb","#eb7b59","#cf4647","#524656"],["#fdf1cc","#c6d6b8","#987f69","#e3ad40","#fcd036"],["#5c323e","#a82743","#e15e32","#c0d23e","#e5f04c"],["#230f2b","#f21d41","#ebebbc","#bce3c5","#82b3ae"],["#b9d3b0","#81bda4","#b28774","#f88f79","#f6aa93"],["#3a111c","#574951","#83988e","#bcdea5","#e6f9bc"],["#5e3929","#cd8c52","#b7d1a3","#dee8be","#fcf7d3"],["#1c0113","#6b0103","#a30006","#c21a01","#f03c02"],["#382f32","#ffeaf2","#fcd9e5","#fbc5d8","#f1396d"],["#e3dfba","#c8d6bf","#93ccc6","#6cbdb5","#1a1f1e"],["#000000","#9f111b","#b11623","#292c37","#cccccc"],["#c1b398","#605951","#fbeec2","#61a6ab","#accec0"],["#8dccad","#988864","#fea6a2","#f9d6ac","#ffe9af"],["#f6f6f6","#e8e8e8","#333333","#990100","#b90504"],["#1b325f","#9cc4e4","#e9f2f9","#3a89c9","#f26c4f"],["#5e9fa3","#dcd1b4","#fab87f","#f87e7b","#b05574"],["#951f2b","#f5f4d7","#e0dfb1","#a5a36c","#535233"],["#413d3d","#040004","#c8ff00","#fa023c","#4b000f"],["#eff3cd","#b2d5ba","#61ada0","#248f8d","#605063"],["#2d2d29","#215a6d","#3ca2a2","#92c7a3","#dfece6"],["#cfffdd","#b4dec1","#5c5863","#a85163","#ff1f4c"],["#4e395d","#827085","#8ebe94","#ccfc8e","#dc5b3e"],["#9dc9ac","#fffec7","#f56218","#ff9d2e","#919167"],["#a1dbb2","#fee5ad","#faca66","#f7a541","#f45d4c"],["#ffefd3","#fffee4","#d0ecea","#9fd6d2","#8b7a5e"],["#a8a7a7","#cc527a","#e8175d","#474747","#363636"],["#ffedbf","#f7803c","#f54828","#2e0d23","#f8e4c1"],["#f8edd1","#d88a8a","#474843","#9d9d93","#c5cfc6"],["#f38a8a","#55443d","#a0cab5","#cde9ca","#f1edd0"],["#4e4d4a","#353432","#94ba65","#2790b0","#2b4e72"],["#0ca5b0","#4e3f30","#fefeeb","#f8f4e4","#a5b3aa"],["#a70267","#f10c49","#fb6b41","#f6d86b","#339194"],["#9d7e79","#ccac95","#9a947c","#748b83","#5b756c"],["#edf6ee","#d1c089","#b3204d","#412e28","#151101"],["#046d8b","#309292","#2fb8ac","#93a42a","#ecbe13"],["#4d3b3b","#de6262","#ffb88c","#ffd0b3","#f5e0d3"],["#fffbb7","#a6f6af","#66b6ab","#5b7c8d","#4f2958"],["#ff003c","#ff8a00","#fabe28","#88c100","#00c176"],["#fcfef5","#e9ffe1","#cdcfb7","#d6e6c3","#fafbe3"],["#9cddc8","#bfd8ad","#ddd9ab","#f7af63","#633d2e"],["#30261c","#403831","#36544f","#1f5f61","#0b8185"],["#d1313d","#e5625c","#f9bf76","#8eb2c5","#615375"],["#ffe181","#eee9e5","#fad3b2","#ffba7f","#ff9c97"],["#aaff00","#ffaa00","#ff00aa","#aa00ff","#00aaff"],["#c2412d","#d1aa34","#a7a844","#a46583","#5a1e4a"]]},{}],193:[function(t,e,r){r.vertexNormals=function(t,e,r){for(var n=e.length,i=new Array(n),o=void 0===r?1e-6:r,a=0;a<n;++a)i[a]=[0,0,0];for(a=0;a<t.length;++a)for(var s=t[a],u=s[s.length-1],l=s[0],c=0;c<s.length;++c){for(var h=e[u],p=e[u=l],f=e[l=s[(c+1)%s.length]],d=new Array(3),m=0,y=new Array(3),_=0,g=0;g<3;++g)d[g]=h[g]-p[g],m+=d[g]*d[g],y[g]=f[g]-p[g],_+=y[g]*y[g];if(m*_>o){var v=i[u],x=1/Math.sqrt(m*_);for(g=0;g<3;++g){var b=(g+1)%3,w=(g+2)%3;v[g]+=x*(y[b]*d[w]-y[w]*d[b])}}}for(a=0;a<n;++a){v=i[a];var E=0;for(g=0;g<3;++g)E+=v[g]*v[g];if(E>o)for(x=1/Math.sqrt(E),g=0;g<3;++g)v[g]*=x;else for(g=0;g<3;++g)v[g]=0}return i},r.faceNormals=function(t,e,r){for(var n=t.length,i=new Array(n),o=void 0===r?1e-6:r,a=0;a<n;++a){for(var s=t[a],u=new Array(3),l=0;l<3;++l)u[l]=e[s[l]];var c=new Array(3),h=new Array(3);for(l=0;l<3;++l)c[l]=u[1][l]-u[0][l],h[l]=u[2][l]-u[0][l];var p=new Array(3),f=0;for(l=0;l<3;++l){var d=(l+1)%3,m=(l+2)%3;p[l]=c[d]*h[m]-c[m]*h[d],f+=p[l]*p[l]}f=f>o?1/Math.sqrt(f):0;for(l=0;l<3;++l)p[l]*=f;i[a]=p}return i}},{}],194:[function(t,e,r){"use strict";e.exports=function(t,e,r,n,i,o,a,s,u,l){var c=e+o+l;if(h>0){var h=Math.sqrt(c+1);t[0]=.5*(a-u)/h,t[1]=.5*(s-n)/h,t[2]=.5*(r-o)/h,t[3]=.5*h}else{var p=Math.max(e,o,l),h=Math.sqrt(2*p-c+1);e>=p?(t[0]=.5*h,t[1]=.5*(i+r)/h,t[2]=.5*(s+n)/h,t[3]=.5*(a-u)/h):o>=p?(t[0]=.5*(r+i)/h,t[1]=.5*h,t[2]=.5*(u+a)/h,t[3]=.5*(s-n)/h):(t[0]=.5*(n+s)/h,t[1]=.5*(a+u)/h,t[2]=.5*h,t[3]=.5*(r-i)/h)}return t}},{}],195:[function(t,e,r){"use strict";e.exports=function(t){var e=(t=t||{}).center||[0,0,0],r=t.rotation||[0,0,0,1],n=t.radius||1;e=[].slice.call(e,0,3),c(r=[].slice.call(r,0,4),r);var i=new h(r,e,Math.log(n));i.setDistanceLimits(t.zoomMin,t.zoomMax),("eye"in t||"up"in t)&&i.lookAt(0,t.eye,t.center,t.up);return i};var n=t("filtered-vector"),i=t("gl-mat4/lookAt"),o=t("gl-mat4/fromQuat"),a=t("gl-mat4/invert"),s=t("./lib/quatFromFrame");function u(t,e,r){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2)+Math.pow(r,2))}function l(t,e,r,n){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2)+Math.pow(r,2)+Math.pow(n,2))}function c(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=l(r,n,i,o);a>1e-6?(t[0]=r/a,t[1]=n/a,t[2]=i/a,t[3]=o/a):(t[0]=t[1]=t[2]=0,t[3]=1)}function h(t,e,r){this.radius=n([r]),this.center=n(e),this.rotation=n(t),this.computedRadius=this.radius.curve(0),this.computedCenter=this.center.curve(0),this.computedRotation=this.rotation.curve(0),this.computedUp=[.1,0,0],this.computedEye=[.1,0,0],this.computedMatrix=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.recalcMatrix(0)}var p=h.prototype;p.lastT=function(){return Math.max(this.radius.lastT(),this.center.lastT(),this.rotation.lastT())},p.recalcMatrix=function(t){this.radius.curve(t),this.center.curve(t),this.rotation.curve(t);var e=this.computedRotation;c(e,e);var r=this.computedMatrix;o(r,e);var n=this.computedCenter,i=this.computedEye,a=this.computedUp,s=Math.exp(this.computedRadius[0]);i[0]=n[0]+s*r[2],i[1]=n[1]+s*r[6],i[2]=n[2]+s*r[10],a[0]=r[1],a[1]=r[5],a[2]=r[9];for(var u=0;u<3;++u){for(var l=0,h=0;h<3;++h)l+=r[u+4*h]*i[h];r[12+u]=-l}},p.getMatrix=function(t,e){this.recalcMatrix(t);var r=this.computedMatrix;if(e){for(var n=0;n<16;++n)e[n]=r[n];return e}return r},p.idle=function(t){this.center.idle(t),this.radius.idle(t),this.rotation.idle(t)},p.flush=function(t){this.center.flush(t),this.radius.flush(t),this.rotation.flush(t)},p.pan=function(t,e,r,n){e=e||0,r=r||0,n=n||0,this.recalcMatrix(t);var i=this.computedMatrix,o=i[1],a=i[5],s=i[9],l=u(o,a,s),c=i[0],h=i[4],p=i[8],f=c*(o/=l)+h*(a/=l)+p*(s/=l),d=u(c-=o*f,h-=a*f,p-=s*f),m=i[2],y=i[6],_=i[10],g=m*o+y*a+_*s,v=m*(c/=d)+y*(h/=d)+_*(p/=d),x=u(m-=g*o+v*c,y-=g*a+v*h,_-=g*s+v*p);m/=x,y/=x,_/=x,this.center.move(t,c*e+o*r,h*e+a*r,p*e+s*r);var b=Math.exp(this.computedRadius[0]);b=Math.max(1e-4,b+n),this.radius.set(t,Math.log(b))},p.rotate=function(t,e,r,n){this.recalcMatrix(t);var i=this.computedMatrix,o=i[2],a=i[6],s=i[10],c=(e=e||0)*i[0]+(r=r||0)*i[1],h=e*i[4]+r*i[5],p=e*i[8]+r*i[9],f=-(a*p-s*h),d=-(s*c-o*p),m=-(o*h-a*c),y=Math.sqrt(Math.max(0,1-Math.pow(f,2)-Math.pow(d,2)-Math.pow(m,2))),_=l(f,d,m,y);_>1e-6?(f/=_,d/=_,m/=_,y/=_):(f=d=m=0,y=1);var g=this.computedRotation,v=g[0],x=g[1],b=g[2],w=g[3],E=v*y+w*f+x*m-b*d,A=x*y+w*d+b*f-v*m,T=b*y+w*m+v*d-x*f,M=w*y-v*f-x*d-b*m;if(n){f=o,d=a,m=s;var S=Math.sin(n)/u(f,d,m);f*=S,d*=S,m*=S,M=M*(y=Math.cos(e))-(E=E*y+M*f+A*m-T*d)*f-(A=A*y+M*d+T*f-E*m)*d-(T=T*y+M*m+E*d-A*f)*m}var R=l(E,A,T,M);R>1e-6?(E/=R,A/=R,T/=R,M/=R):(E=A=T=0,M=1),this.rotation.set(t,E,A,T,M)},p.lookAt=function(t,e,r,n){this.recalcMatrix(t);var o=this.computedMatrix;i(o,e=e||this.computedEye,r=r||this.computedCenter,n=n||this.computedUp);var a=this.computedRotation;s(a,o[0],o[1],o[2],o[4],o[5],o[6],o[8],o[9],o[10]),c(a,a),this.rotation.set(t,a[0],a[1],a[2],a[3]);for(var u=0,l=0;l<3;++l)u+=Math.pow(r[l]-e[l],2);this.radius.set(t,.5*Math.log(Math.max(u,1e-6))),this.center.set(t,r[0],r[1],r[2])},p.translate=function(t,e,r,n){this.center.move(t,e||0,r||0,n||0)},p.setMatrix=function(t,e){var r=this.computedRotation;s(r,e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]),c(r,r),this.rotation.set(t,r[0],r[1],r[2],r[3]);var n=this.computedMatrix;a(n,e);var i=n[15];if(Math.abs(i)>1e-6){var o=n[12]/i,u=n[13]/i,l=n[14]/i;this.recalcMatrix(t);var h=Math.exp(this.computedRadius[0]);this.center.set(t,o-n[2]*h,u-n[6]*h,l-n[10]*h),this.radius.idle(t)}else this.center.idle(t),this.radius.idle(t)},p.setDistance=function(t,e){e>0&&this.radius.set(t,Math.log(e))},p.setDistanceLimits=function(t,e){t=t>0?Math.log(t):-Infinity,e=e>0?Math.log(e):Infinity,e=Math.max(e,t),this.radius.bounds[0][0]=t,this.radius.bounds[1][0]=e},p.getDistanceLimits=function(t){var e=this.radius.bounds;return t?(t[0]=Math.exp(e[0][0]),t[1]=Math.exp(e[1][0]),t):[Math.exp(e[0][0]),Math.exp(e[1][0])]},p.toJSON=function(){return this.recalcMatrix(this.lastT()),{center:this.computedCenter.slice(),rotation:this.computedRotation.slice(),distance:Math.log(this.computedRadius[0]),zoomMin:this.radius.bounds[0][0],zoomMax:this.radius.bounds[1][0]}},p.fromJSON=function(t){var e=this.lastT(),r=t.center;r&&this.center.set(e,r[0],r[1],r[2]);var n=t.rotation;n&&this.rotation.set(e,n[0],n[1],n[2],n[3]);var i=t.distance;i&&i>0&&this.radius.set(e,Math.log(i)),this.setDistanceLimits(t.zoomMin,t.zoomMax)}},{"./lib/quatFromFrame":194,"filtered-vector":24,"gl-mat4/fromQuat":36,"gl-mat4/invert":47,"gl-mat4/lookAt":48}],196:[function(t,e,r){e.exports=function(t,e){e||(e=[0,""]),t=String(t);var r=parseFloat(t,10);return e[0]=r,e[1]=t.match(/[\d.\-\+]*\s*(.*)/)[1]||"",e}},{}],197:[function(t,e,r){var n,i;n=window,i=function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=6)}({6:function(t,e,r){"use strict";r.r(e);var n={};r.r(n),r.d(n,"create",function(){return l}),r.d(n,"clone",function(){return c}),r.d(n,"copy",function(){return h}),r.d(n,"fromValues",function(){return p}),r.d(n,"set",function(){return f}),r.d(n,"identity",function(){return d}),r.d(n,"transpose",function(){return m}),r.d(n,"invert",function(){return y}),r.d(n,"adjoint",function(){return _}),r.d(n,"determinant",function(){return g}),r.d(n,"multiply",function(){return v}),r.d(n,"translate",function(){return x}),r.d(n,"scale",function(){return b}),r.d(n,"rotate",function(){return w}),r.d(n,"rotateX",function(){return E}),r.d(n,"rotateY",function(){return A}),r.d(n,"rotateZ",function(){return T}),r.d(n,"fromTranslation",function(){return M}),r.d(n,"fromScaling",function(){return S}),r.d(n,"fromRotation",function(){return R}),r.d(n,"fromXRotation",function(){return I}),r.d(n,"fromYRotation",function(){return C}),r.d(n,"fromZRotation",function(){return P}),r.d(n,"fromRotationTranslation",function(){return D}),r.d(n,"fromQuat2",function(){return L}),r.d(n,"getTranslation",function(){return O}),r.d(n,"getScaling",function(){return k}),r.d(n,"getRotation",function(){return F}),r.d(n,"fromRotationTranslationScale",function(){return B}),r.d(n,"fromRotationTranslationScaleOrigin",function(){return N}),r.d(n,"fromQuat",function(){return z}),r.d(n,"frustum",function(){return U}),r.d(n,"perspective",function(){return V}),r.d(n,"perspectiveFromFieldOfView",function(){return j}),r.d(n,"ortho",function(){return G}),r.d(n,"lookAt",function(){return q}),r.d(n,"targetTo",function(){return H}),r.d(n,"str",function(){return X}),r.d(n,"frob",function(){return Y}),r.d(n,"add",function(){return Z}),r.d(n,"subtract",function(){return W}),r.d(n,"multiplyScalar",function(){return K}),r.d(n,"multiplyScalarAndAdd",function(){return J}),r.d(n,"exactEquals",function(){return Q}),r.d(n,"equals",function(){return $}),r.d(n,"mul",function(){return tt}),r.d(n,"sub",function(){return et});var i={};r.r(i),r.d(i,"create",function(){return rt}),r.d(i,"clone",function(){return nt}),r.d(i,"length",function(){return it}),r.d(i,"fromValues",function(){return ot}),r.d(i,"copy",function(){return at}),r.d(i,"set",function(){return st}),r.d(i,"add",function(){return ut}),r.d(i,"subtract",function(){return lt}),r.d(i,"multiply",function(){return ct}),r.d(i,"divide",function(){return ht}),r.d(i,"ceil",function(){return pt}),r.d(i,"floor",function(){return ft}),r.d(i,"min",function(){return dt}),r.d(i,"max",function(){return mt}),r.d(i,"round",function(){return yt}),r.d(i,"scale",function(){return _t}),r.d(i,"scaleAndAdd",function(){return gt}),r.d(i,"distance",function(){return vt}),r.d(i,"squaredDistance",function(){return xt}),r.d(i,"squaredLength",function(){return bt}),r.d(i,"negate",function(){return wt}),r.d(i,"inverse",function(){return Et}),r.d(i,"normalize",function(){return At}),r.d(i,"dot",function(){return Tt}),r.d(i,"cross",function(){return Mt}),r.d(i,"lerp",function(){return St}),r.d(i,"hermite",function(){return Rt}),r.d(i,"bezier",function(){return It}),r.d(i,"random",function(){return Ct}),r.d(i,"transformMat4",function(){return Pt}),r.d(i,"transformMat3",function(){return Dt}),r.d(i,"transformQuat",function(){return Lt}),r.d(i,"rotateX",function(){return Ot}),r.d(i,"rotateY",function(){return kt}),r.d(i,"rotateZ",function(){return Ft}),r.d(i,"angle",function(){return Bt}),r.d(i,"zero",function(){return Nt}),r.d(i,"str",function(){return zt}),r.d(i,"exactEquals",function(){return Ut}),r.d(i,"equals",function(){return Vt}),r.d(i,"sub",function(){return Gt}),r.d(i,"mul",function(){return qt}),r.d(i,"div",function(){return Ht}),r.d(i,"dist",function(){return Xt}),r.d(i,"sqrDist",function(){return Yt}),r.d(i,"len",function(){return Zt}),r.d(i,"sqrLen",function(){return Wt}),r.d(i,"forEach",function(){return Kt});var o={};r.r(o),r.d(o,"create",function(){return Jt}),r.d(o,"clone",function(){return Qt}),r.d(o,"fromValues",function(){return $t}),r.d(o,"copy",function(){return te}),r.d(o,"set",function(){return ee}),r.d(o,"add",function(){return re}),r.d(o,"subtract",function(){return ne}),r.d(o,"multiply",function(){return ie}),r.d(o,"divide",function(){return oe}),r.d(o,"ceil",function(){return ae}),r.d(o,"floor",function(){return se}),r.d(o,"min",function(){return ue}),r.d(o,"max",function(){return le}),r.d(o,"round",function(){return ce}),r.d(o,"scale",function(){return he}),r.d(o,"scaleAndAdd",function(){return pe}),r.d(o,"distance",function(){return fe}),r.d(o,"squaredDistance",function(){return de}),r.d(o,"length",function(){return me}),r.d(o,"squaredLength",function(){return ye}),r.d(o,"negate",function(){return _e}),r.d(o,"inverse",function(){return ge}),r.d(o,"normalize",function(){return ve}),r.d(o,"dot",function(){return xe}),r.d(o,"cross",function(){return be}),r.d(o,"lerp",function(){return we}),r.d(o,"random",function(){return Ee}),r.d(o,"transformMat4",function(){return Ae}),r.d(o,"transformQuat",function(){return Te}),r.d(o,"zero",function(){return Me}),r.d(o,"str",function(){return Se}),r.d(o,"exactEquals",function(){return Re}),r.d(o,"equals",function(){return Ie}),r.d(o,"sub",function(){return Ce}),r.d(o,"mul",function(){return Pe}),r.d(o,"div",function(){return De}),r.d(o,"dist",function(){return Le}),r.d(o,"sqrDist",function(){return Oe}),r.d(o,"len",function(){return ke}),r.d(o,"sqrLen",function(){return Fe}),r.d(o,"forEach",function(){return Be});var a=1e-6,s="undefined"!=typeof Float32Array?Float32Array:Array,u=Math.random;function l(){var t=new s(16);return s!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function c(t){var e=new s(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function h(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function p(t,e,r,n,i,o,a,u,l,c,h,p,f,d,m,y){var _=new s(16);return _[0]=t,_[1]=e,_[2]=r,_[3]=n,_[4]=i,_[5]=o,_[6]=a,_[7]=u,_[8]=l,_[9]=c,_[10]=h,_[11]=p,_[12]=f,_[13]=d,_[14]=m,_[15]=y,_}function f(t,e,r,n,i,o,a,s,u,l,c,h,p,f,d,m,y){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=c,t[10]=h,t[11]=p,t[12]=f,t[13]=d,t[14]=m,t[15]=y,t}function d(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function m(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function y(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15],g=r*s-n*a,v=r*u-i*a,x=r*l-o*a,b=n*u-i*s,w=n*l-o*s,E=i*l-o*u,A=c*m-h*d,T=c*y-p*d,M=c*_-f*d,S=h*y-p*m,R=h*_-f*m,I=p*_-f*y,C=g*I-v*R+x*S+b*M-w*T+E*A;return C?(t[0]=(s*I-u*R+l*S)*(C=1/C),t[1]=(i*R-n*I-o*S)*C,t[2]=(m*E-y*w+_*b)*C,t[3]=(p*w-h*E-f*b)*C,t[4]=(u*M-a*I-l*T)*C,t[5]=(r*I-i*M+o*T)*C,t[6]=(y*x-d*E-_*v)*C,t[7]=(c*E-p*x+f*v)*C,t[8]=(a*R-s*M+l*A)*C,t[9]=(n*M-r*R-o*A)*C,t[10]=(d*w-m*x+_*g)*C,t[11]=(h*x-c*w-f*g)*C,t[12]=(s*T-a*S-u*A)*C,t[13]=(r*S-n*T+i*A)*C,t[14]=(m*v-d*b-y*g)*C,t[15]=(c*b-h*v+p*g)*C,t):null}function _(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],p=e[10],f=e[11],d=e[12],m=e[13],y=e[14],_=e[15];return t[0]=s*(p*_-f*y)-h*(u*_-l*y)+m*(u*f-l*p),t[1]=-(n*(p*_-f*y)-h*(i*_-o*y)+m*(i*f-o*p)),t[2]=n*(u*_-l*y)-s*(i*_-o*y)+m*(i*l-o*u),t[3]=-(n*(u*f-l*p)-s*(i*f-o*p)+h*(i*l-o*u)),t[4]=-(a*(p*_-f*y)-c*(u*_-l*y)+d*(u*f-l*p)),t[5]=r*(p*_-f*y)-c*(i*_-o*y)+d*(i*f-o*p),t[6]=-(r*(u*_-l*y)-a*(i*_-o*y)+d*(i*l-o*u)),t[7]=r*(u*f-l*p)-a*(i*f-o*p)+c*(i*l-o*u),t[8]=a*(h*_-f*m)-c*(s*_-l*m)+d*(s*f-l*h),t[9]=-(r*(h*_-f*m)-c*(n*_-o*m)+d*(n*f-o*h)),t[10]=r*(s*_-l*m)-a*(n*_-o*m)+d*(n*l-o*s),t[11]=-(r*(s*f-l*h)-a*(n*f-o*h)+c*(n*l-o*s)),t[12]=-(a*(h*y-p*m)-c*(s*y-u*m)+d*(s*p-u*h)),t[13]=r*(h*y-p*m)-c*(n*y-i*m)+d*(n*p-i*h),t[14]=-(r*(s*y-u*m)-a*(n*y-i*m)+d*(n*u-i*s)),t[15]=r*(s*p-u*h)-a*(n*p-i*h)+c*(n*u-i*s),t}function g(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],p=t[11],f=t[12],d=t[13],m=t[14],y=t[15];return(e*a-r*o)*(h*y-p*m)-(e*s-n*o)*(c*y-p*d)+(e*u-i*o)*(c*m-h*d)+(r*s-n*a)*(l*y-p*f)-(r*u-i*a)*(l*m-h*f)+(n*u-i*s)*(l*d-c*f)}function v(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],m=e[12],y=e[13],_=e[14],g=e[15],v=r[0],x=r[1],b=r[2],w=r[3];return t[0]=v*n+x*s+b*h+w*m,t[1]=v*i+x*u+b*p+w*y,t[2]=v*o+x*l+b*f+w*_,t[3]=v*a+x*c+b*d+w*g,t[4]=(v=r[4])*n+(x=r[5])*s+(b=r[6])*h+(w=r[7])*m,t[5]=v*i+x*u+b*p+w*y,t[6]=v*o+x*l+b*f+w*_,t[7]=v*a+x*c+b*d+w*g,t[8]=(v=r[8])*n+(x=r[9])*s+(b=r[10])*h+(w=r[11])*m,t[9]=v*i+x*u+b*p+w*y,t[10]=v*o+x*l+b*f+w*_,t[11]=v*a+x*c+b*d+w*g,t[12]=(v=r[12])*n+(x=r[13])*s+(b=r[14])*h+(w=r[15])*m,t[13]=v*i+x*u+b*p+w*y,t[14]=v*o+x*l+b*f+w*_,t[15]=v*a+x*c+b*d+w*g,t}function x(t,e,r){var n,i,o,a,s,u,l,c,h,p,f,d,m=r[0],y=r[1],_=r[2];return e===t?(t[12]=e[0]*m+e[4]*y+e[8]*_+e[12],t[13]=e[1]*m+e[5]*y+e[9]*_+e[13],t[14]=e[2]*m+e[6]*y+e[10]*_+e[14],t[15]=e[3]*m+e[7]*y+e[11]*_+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],p=e[9],f=e[10],d=e[11],t[0]=n=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=c,t[8]=h,t[9]=p,t[10]=f,t[11]=d,t[12]=n*m+s*y+h*_+e[12],t[13]=i*m+u*y+p*_+e[13],t[14]=o*m+l*y+f*_+e[14],t[15]=a*m+c*y+d*_+e[15]),t}function b(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function w(t,e,r,n){var i,o,s,u,l,c,h,p,f,d,m,y,_,g,v,x,b,w,E,A,T,M,S,R,I=n[0],C=n[1],P=n[2],D=Math.hypot(I,C,P);return D<a?null:(I*=D=1/D,C*=D,P*=D,i=Math.sin(r),s=1-(o=Math.cos(r)),l=e[1],c=e[2],h=e[3],f=e[5],d=e[6],m=e[7],_=e[9],g=e[10],v=e[11],E=I*C*s-P*i,A=C*C*s+o,T=P*C*s+I*i,M=I*P*s+C*i,S=C*P*s-I*i,R=P*P*s+o,t[0]=(u=e[0])*(x=I*I*s+o)+(p=e[4])*(b=C*I*s+P*i)+(y=e[8])*(w=P*I*s-C*i),t[1]=l*x+f*b+_*w,t[2]=c*x+d*b+g*w,t[3]=h*x+m*b+v*w,t[4]=u*E+p*A+y*T,t[5]=l*E+f*A+_*T,t[6]=c*E+d*A+g*T,t[7]=h*E+m*A+v*T,t[8]=u*M+p*S+y*R,t[9]=l*M+f*S+_*R,t[10]=c*M+d*S+g*R,t[11]=h*M+m*S+v*R,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function E(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*n,t[5]=a*i+c*n,t[6]=s*i+h*n,t[7]=u*i+p*n,t[8]=l*i-o*n,t[9]=c*i-a*n,t[10]=h*i-s*n,t[11]=p*i-u*n,t}function A(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*n,t[1]=a*i-c*n,t[2]=s*i-h*n,t[3]=u*i-p*n,t[8]=o*n+l*i,t[9]=a*n+c*i,t[10]=s*n+h*i,t[11]=u*n+p*i,t}function T(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*n,t[1]=a*i+c*n,t[2]=s*i+h*n,t[3]=u*i+p*n,t[4]=l*i-o*n,t[5]=c*i-a*n,t[6]=h*i-s*n,t[7]=p*i-u*n,t}function M(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function S(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function R(t,e,r){var n,i,o,s=r[0],u=r[1],l=r[2],c=Math.hypot(s,u,l);return c<a?null:(s*=c=1/c,u*=c,l*=c,n=Math.sin(e),o=1-(i=Math.cos(e)),t[0]=s*s*o+i,t[1]=u*s*o+l*n,t[2]=l*s*o-u*n,t[3]=0,t[4]=s*u*o-l*n,t[5]=u*u*o+i,t[6]=l*u*o+s*n,t[7]=0,t[8]=s*l*o+u*n,t[9]=u*l*o-s*n,t[10]=l*l*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function I(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function C(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function P(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function D(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,u=i+i,l=o+o,c=n*s,h=n*u,p=n*l,f=i*u,d=i*l,m=o*l,y=a*s,_=a*u,g=a*l;return t[0]=1-(f+m),t[1]=h+g,t[2]=p-_,t[3]=0,t[4]=h-g,t[5]=1-(c+m),t[6]=d+y,t[7]=0,t[8]=p+_,t[9]=d-y,t[10]=1-(c+f),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function L(t,e){var r=new s(3),n=-e[0],i=-e[1],o=-e[2],a=e[3],u=e[4],l=e[5],c=e[6],h=e[7],p=n*n+i*i+o*o+a*a;return p>0?(r[0]=2*(u*a+h*n+l*o-c*i)/p,r[1]=2*(l*a+h*i+c*n-u*o)/p,r[2]=2*(c*a+h*o+u*i-l*n)/p):(r[0]=2*(u*a+h*n+l*o-c*i),r[1]=2*(l*a+h*i+c*n-u*o),r[2]=2*(c*a+h*o+u*i-l*n)),D(t,e,r),t}function O(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function k(t,e){var r=e[4],n=e[5],i=e[6],o=e[8],a=e[9],s=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(r,n,i),t[2]=Math.hypot(o,a,s),t}function F(t,e){var r=new s(3);k(r,e);var n=1/r[0],i=1/r[1],o=1/r[2],a=e[0]*n,u=e[1]*i,l=e[2]*o,c=e[4]*n,h=e[5]*i,p=e[6]*o,f=e[8]*n,d=e[9]*i,m=e[10]*o,y=a+h+m,_=0;return y>0?(_=2*Math.sqrt(y+1),t[3]=.25*_,t[0]=(p-d)/_,t[1]=(f-l)/_,t[2]=(u-c)/_):a>h&&a>m?(_=2*Math.sqrt(1+a-h-m),t[3]=(p-d)/_,t[0]=.25*_,t[1]=(u+c)/_,t[2]=(f+l)/_):h>m?(_=2*Math.sqrt(1+h-a-m),t[3]=(f-l)/_,t[0]=(u+c)/_,t[1]=.25*_,t[2]=(p+d)/_):(_=2*Math.sqrt(1+m-a-h),t[3]=(u-c)/_,t[0]=(f+l)/_,t[1]=(p+d)/_,t[2]=.25*_),t}function B(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,l=o+o,c=a+a,h=i*u,p=i*l,f=i*c,d=o*l,m=o*c,y=a*c,_=s*u,g=s*l,v=s*c,x=n[0],b=n[1],w=n[2];return t[0]=(1-(d+y))*x,t[1]=(p+v)*x,t[2]=(f-g)*x,t[3]=0,t[4]=(p-v)*b,t[5]=(1-(h+y))*b,t[6]=(m+_)*b,t[7]=0,t[8]=(f+g)*w,t[9]=(m-_)*w,t[10]=(1-(h+d))*w,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function N(t,e,r,n,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,c=a+a,h=s+s,p=o*l,f=o*c,d=o*h,m=a*c,y=a*h,_=s*h,g=u*l,v=u*c,x=u*h,b=n[0],w=n[1],E=n[2],A=i[0],T=i[1],M=i[2],S=(1-(m+_))*b,R=(f+x)*b,I=(d-v)*b,C=(f-x)*w,P=(1-(p+_))*w,D=(y+g)*w,L=(d+v)*E,O=(y-g)*E,k=(1-(p+m))*E;return t[0]=S,t[1]=R,t[2]=I,t[3]=0,t[4]=C,t[5]=P,t[6]=D,t[7]=0,t[8]=L,t[9]=O,t[10]=k,t[11]=0,t[12]=r[0]+A-(S*A+C*T+L*M),t[13]=r[1]+T-(R*A+P*T+O*M),t[14]=r[2]+M-(I*A+D*T+k*M),t[15]=1,t}function z(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,l=r*a,c=n*a,h=n*s,p=i*a,f=i*s,d=i*u,m=o*a,y=o*s,_=o*u;return t[0]=1-h-d,t[1]=c+_,t[2]=p-y,t[3]=0,t[4]=c-_,t[5]=1-l-d,t[6]=f+m,t[7]=0,t[8]=p+y,t[9]=f-m,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function U(t,e,r,n,i,o,a){var s=1/(r-e),u=1/(i-n),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t}function V(t,e,r,n,i){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+n)*(o=1/(n-i)),t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t}function j(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*l*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function G(t,e,r,n,i,o,a){var s=1/(e-r),u=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(a+o)*l,t[15]=1,t}function q(t,e,r,n){var i,o,s,u,l,c,h,p,f,m,y=e[0],_=e[1],g=e[2],v=n[0],x=n[1],b=n[2],w=r[0],E=r[1],A=r[2];return Math.abs(y-w)<a&&Math.abs(_-E)<a&&Math.abs(g-A)<a?d(t):(h=y-w,p=_-E,f=g-A,i=x*(f*=m=1/Math.hypot(h,p,f))-b*(p*=m),o=b*(h*=m)-v*f,s=v*p-x*h,(m=Math.hypot(i,o,s))?(i*=m=1/m,o*=m,s*=m):(i=0,o=0,s=0),u=p*s-f*o,l=f*i-h*s,c=h*o-p*i,(m=Math.hypot(u,l,c))?(u*=m=1/m,l*=m,c*=m):(u=0,l=0,c=0),t[0]=i,t[1]=u,t[2]=h,t[3]=0,t[4]=o,t[5]=l,t[6]=p,t[7]=0,t[8]=s,t[9]=c,t[10]=f,t[11]=0,t[12]=-(i*y+o*_+s*g),t[13]=-(u*y+l*_+c*g),t[14]=-(h*y+p*_+f*g),t[15]=1,t)}function H(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=n[0],u=n[1],l=n[2],c=i-r[0],h=o-r[1],p=a-r[2],f=c*c+h*h+p*p;f>0&&(c*=f=1/Math.sqrt(f),h*=f,p*=f);var d=u*p-l*h,m=l*c-s*p,y=s*h-u*c;return(f=d*d+m*m+y*y)>0&&(d*=f=1/Math.sqrt(f),m*=f,y*=f),t[0]=d,t[1]=m,t[2]=y,t[3]=0,t[4]=h*y-p*m,t[5]=p*d-c*y,t[6]=c*m-h*d,t[7]=0,t[8]=c,t[9]=h,t[10]=p,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function X(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Y(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Z(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function W(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function K(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function J(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function Q(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function $(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],p=t[9],f=t[10],d=t[11],m=t[12],y=t[13],_=t[14],g=t[15],v=e[0],x=e[1],b=e[2],w=e[3],E=e[4],A=e[5],T=e[6],M=e[7],S=e[8],R=e[9],I=e[10],C=e[11],P=e[12],D=e[13],L=e[14],O=e[15];return Math.abs(r-v)<=a*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(n-x)<=a*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(i-b)<=a*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-w)<=a*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(s-E)<=a*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-A)<=a*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-T)<=a*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-M)<=a*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(h-S)<=a*Math.max(1,Math.abs(h),Math.abs(S))&&Math.abs(p-R)<=a*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(f-I)<=a*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(d-C)<=a*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(m-P)<=a*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(y-D)<=a*Math.max(1,Math.abs(y),Math.abs(D))&&Math.abs(_-L)<=a*Math.max(1,Math.abs(_),Math.abs(L))&&Math.abs(g-O)<=a*Math.max(1,Math.abs(g),Math.abs(O))}Math,Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var tt=v,et=W;function rt(){var t=new s(3);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function nt(t){var e=new s(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function it(t){return Math.hypot(t[0],t[1],t[2])}function ot(t,e,r){var n=new s(3);return n[0]=t,n[1]=e,n[2]=r,n}function at(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function st(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function ut(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function lt(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function ct(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function ht(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function pt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function ft(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function dt(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function mt(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function yt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function _t(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function gt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function vt(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function xt(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function bt(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function wt(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Et(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function At(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function Tt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Mt(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2];return t[0]=i*u-o*s,t[1]=o*a-n*u,t[2]=n*s-i*a,t}function St(t,e,r,n){var i=e[0],o=e[1],a=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t}function Rt(t,e,r,n,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return t[0]=e[0]*s+r[0]*u+n[0]*l+i[0]*c,t[1]=e[1]*s+r[1]*u+n[1]*l+i[1]*c,t[2]=e[2]*s+r[2]*u+n[2]*l+i[2]*c,t}function It(t,e,r,n,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,h=3*u*a,p=u*o;return t[0]=e[0]*l+r[0]*c+n[0]*h+i[0]*p,t[1]=e[1]*l+r[1]*c+n[1]*h+i[1]*p,t[2]=e[2]*l+r[2]*c+n[2]*h+i[2]*p,t}function Ct(t,e){e=e||1;var r=2*u()*Math.PI,n=2*u()-1,i=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*i,t[1]=Math.sin(r)*i,t[2]=n*e,t}function Pt(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/(a=a||1),t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t}function Dt(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}function Lt(t,e,r){var n=r[0],i=r[1],o=r[2],a=e[0],s=e[1],u=e[2],l=i*u-o*s,c=o*a-n*u,h=n*s-i*a,p=i*h-o*c,f=o*l-n*h,d=n*c-i*l,m=2*r[3];return c*=m,h*=m,f*=2,d*=2,t[0]=a+(l*=m)+(p*=2),t[1]=s+c+f,t[2]=u+h+d,t}function Ot(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function kt(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function Ft(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t}function Bt(t,e){var r=ot(t[0],t[1],t[2]),n=ot(e[0],e[1],e[2]);At(r,r),At(n,n);var i=Tt(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)}function Nt(t){return t[0]=0,t[1]=0,t[2]=0,t}function zt(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Ut(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Vt(t,e){var r=t[0],n=t[1],i=t[2],o=e[0],s=e[1],u=e[2];return Math.abs(r-o)<=a*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-s)<=a*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=a*Math.max(1,Math.abs(i),Math.abs(u))}var jt,Gt=lt,qt=ct,Ht=ht,Xt=vt,Yt=xt,Zt=it,Wt=bt,Kt=(jt=rt(),function(t,e,r,n,i,o){var a,s;for(e||(e=3),r||(r=0),s=n?Math.min(n*e+r,t.length):t.length,a=r;a<s;a+=e)jt[0]=t[a],jt[1]=t[a+1],jt[2]=t[a+2],i(jt,jt,o),t[a]=jt[0],t[a+1]=jt[1],t[a+2]=jt[2];return t});function Jt(){var t=new s(4);return s!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Qt(t){var e=new s(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function $t(t,e,r,n){var i=new s(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function te(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ee(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function re(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function ne(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function ie(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function oe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function ae(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function se(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function ue(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function le(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function ce(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function he(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function pe(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function fe(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function de(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return r*r+n*n+i*i+o*o}function me(t){return Math.hypot(t[0],t[1],t[2],t[3])}function ye(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function _e(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function ge(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function ve(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=o*a,t}function xe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function be(t,e,r,n){var i=r[0]*n[1]-r[1]*n[0],o=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],s=r[1]*n[2]-r[2]*n[1],u=r[1]*n[3]-r[3]*n[1],l=r[2]*n[3]-r[3]*n[2],c=e[0],h=e[1],p=e[2],f=e[3];return t[0]=h*l-p*u+f*s,t[1]=-c*l+p*a-f*o,t[2]=c*u-h*a+f*i,t[3]=-c*s+h*o-p*i,t}function we(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t[3]=s+n*(r[3]-s),t}function Ee(t,e){var r,n,i,o,a,s;e=e||1;do{a=(r=2*u()-1)*r+(n=2*u()-1)*n}while(a>=1);do{s=(i=2*u()-1)*i+(o=2*u()-1)*o}while(s>=1);var l=Math.sqrt((1-a)/s);return t[0]=e*r,t[1]=e*n,t[2]=e*i*l,t[3]=e*o*l,t}function Ae(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}function Te(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2],l=r[3],c=l*n+s*o-u*i,h=l*i+u*n-a*o,p=l*o+a*i-s*n,f=-a*n-s*i-u*o;return t[0]=c*l+f*-a+h*-u-p*-s,t[1]=h*l+f*-s+p*-a-c*-u,t[2]=p*l+f*-u+c*-s-h*-a,t[3]=e[3],t}function Me(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Se(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Re(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Ie(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],s=e[0],u=e[1],l=e[2],c=e[3];return Math.abs(r-s)<=a*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-u)<=a*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-l)<=a*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(o-c)<=a*Math.max(1,Math.abs(o),Math.abs(c))}var Ce=ne,Pe=ie,De=oe,Le=fe,Oe=de,ke=me,Fe=ye,Be=function(){var t=Jt();return function(e,r,n,i,o,a){var s,u;for(r||(r=4),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;s<u;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}();r.d(e,"pico_mercator_highPrecisionMat4",function(){return Ke}),r.d(e,"pico_mercator_highPrecisionLngLat",function(){return Je}),r.d(e,"pico_mercator_injectGLSLProjection",function(){return Qe}),r.d(e,"pico_mercator_uniforms",function(){return $e}),r.d(e,"pico_mercator_mapboxViewMatrix",function(){return tr}),r.d(e,"pico_mercator_mapboxProjectionMatrix",function(){return er}),r.d(e,"pico_mercator_mapboxViewProjectionMatrix",function(){return rr}),r.d(e,"pico_mercator_pixelsPerMeter",function(){return nr}),r.d(e,"pico_mercator_pixelsPerDegree",function(){return ir}),r.d(e,"pico_mercator_lngLatToWorld",function(){return or}),r.d(e,"pico_mercator_worldToClip",function(){return ar}),r.d(e,"pico_mercator_lngLatToClip",function(){return sr}),r.d(e,"mat4",function(){return n});const Ne=Math.PI,ze=Ne/4,Ue=Ne/180,Ve=512,je=4003e4,Ge="\n#define PICO_MERCATOR_TILE_SIZE 512.0\n#define PICO_MERCATOR_PI 3.1415926536\n#define PICO_MERCATOR_WORLD_SCALE (PICO_MERCATOR_TILE_SIZE / (PICO_MERCATOR_PI * 2.0))\n#define PICO_MERCATOR_OFFSET_THRESHOLD 4096.0\n\nuniform vec2 pico_mercator_lngLatCenter;\nuniform vec3 pico_mercator_angleDerivatives;\nuniform vec2 pico_mercator_meterDerivatives;\nuniform float pico_mercator_scale;\nuniform vec4 pico_mercator_clipCenter;\nuniform mat4 pico_mercator_viewProjectionMatrix;\n\nvec4 pico_mercator_lngLatToWorld(vec3 lngLatElevation, vec2 lngLatPrecision) {\n    vec3 mercatorPosition;\n    if (pico_mercator_scale < PICO_MERCATOR_OFFSET_THRESHOLD) {\n        mercatorPosition.xy = vec2(\n            (radians(lngLatElevation.x) + PICO_MERCATOR_PI) * PICO_MERCATOR_WORLD_SCALE,\n            (PICO_MERCATOR_PI + log(tan(PICO_MERCATOR_PI * 0.25 + radians(lngLatElevation.y) * 0.5))) * PICO_MERCATOR_WORLD_SCALE\n        ) * pico_mercator_scale;\n        mercatorPosition.z = lngLatElevation.z * pico_mercator_meterDerivatives.x;\n    } else {\n        mercatorPosition.xy = (lngLatElevation.xy - pico_mercator_lngLatCenter) + lngLatPrecision;\n        float dy = mercatorPosition.y;\n        mercatorPosition = vec3(\n            mercatorPosition.x * pico_mercator_angleDerivatives.x,\n            mercatorPosition.y * (pico_mercator_angleDerivatives.y + dy * pico_mercator_angleDerivatives.z),\n            lngLatElevation.z * (pico_mercator_meterDerivatives.x + dy * pico_mercator_meterDerivatives.y)\n        );\n    }\n\n    return vec4(mercatorPosition, 1.0);\n}\n\nvec4 pico_mercator_lngLatToWorld(vec3 lngLatElevation) {\n    return pico_mercator_lngLatToWorld(lngLatElevation, vec2(0.0));\n}\n\nvec4 pico_mercator_lngLatToWorld(vec2 lngLat, vec2 lngLatPrecision) {\n    return pico_mercator_lngLatToWorld(vec3(lngLat, 0.0), lngLatPrecision);\n}\n\nvec4 pico_mercator_lngLatToWorld(vec2 lngLat) {\n    return pico_mercator_lngLatToWorld(vec3(lngLat, 0.0));\n}\n\nvec4 pico_mercator_worldToClip(vec4 worldPosition) {\n    if (pico_mercator_scale >= PICO_MERCATOR_OFFSET_THRESHOLD) {\n        worldPosition.w = 0.0;\n    }\n    vec4 clipPosition = pico_mercator_viewProjectionMatrix * worldPosition;\n    if (pico_mercator_scale >= PICO_MERCATOR_OFFSET_THRESHOLD) {\n        clipPosition += pico_mercator_clipCenter;\n    }\n\n    return clipPosition;\n}\n\nvec4 pico_mercator_lngLatToClip(vec2 lngLat, vec2 lngLatPrecision) {\n    return pico_mercator_worldToClip(pico_mercator_lngLatToWorld(lngLat, lngLatPrecision));\n}\n\nvec4 pico_mercator_lngLatToClip(vec2 lngLat) {\n    return pico_mercator_lngLatToClip(lngLat, vec2(0.0));\n}\n\n";let qe=new Float64Array(4),He=new Float64Array(3),Xe=new Float64Array(16),Ye=new Float64Array(16),Ze={pico_mercator_lngLatCenter:new Float32Array(2),pico_mercator_angleDerivatives:new Float32Array(3),pico_mercator_meterDerivatives:new Float32Array(2),pico_mercator_clipCenter:new Float32Array(4),pico_mercator_viewProjectionMatrix:new Float32Array(16),pico_mercator_scale:0},We=new Float32Array(2);function Ke(){return n.identity(new Float64Array(16))}function Je(t,e=2){let r=t.length/e,n=new Float32Array(2*r);for(let i=0;i<r;++i){let r=i*e,o=2*i;n[o]=t[r]-Math.fround(t[r]),n[o+1]=t[r+1]-Math.fround(t[r+1])}return n}function Qe(t){let e=t.match(/#version \d+(\s+es)?\s*\n/),r=e?e[0]:"";return t.replace(r,r+Ge)}function $e(t,e,r,n){let i=t[0],o=t[1];Ze.pico_mercator_scale=Math.pow(2,e),Ze.pico_mercator_lngLatCenter[0]=i,Ze.pico_mercator_lngLatCenter[1]=o;let a=Math.cos(o*Ue),s=Ue*Math.tan(o*Ue)/a;!function(t,e,r,n,i){ir(t,o,r,a),t[2]=t[0]*i/2}(Ze.pico_mercator_angleDerivatives,0,e,0,s),function(t,e,r,n,i){let o=Math.pow(2,r);t[0]=nr(e,r,n),t[1]=o*Ve/je*i}(Ze.pico_mercator_meterDerivatives,o,e,a,s),We[0]=i,We[1]=o,sr(Ze.pico_mercator_clipCenter,We,e,r),Ze.pico_mercator_viewProjectionMatrix.set(r),n(Ze)}function tr(t,e,r,o,a,s){return n.identity(t),He[2]=-1.5*s,n.translate(t,t,He),n.rotateX(t,t,-o*Ue),n.rotateZ(t,t,a*Ue),or(qe,e,r),n.translate(t,t,i.negate(qe,qe)),t}function er(t,e,r,i){let o=1.5*i,a=e*Ue,s=Math.atan(1/3),u=Math.sin(s)*o/Math.sin(Math.PI/2-a-s),l=2*s,c=r/i,h=.1*o,p=1.01*(Math.cos(Math.PI/2-a)*u+o);return n.perspective(t,l,c,h,p),t}function rr(t,e,r,i,o,a,s){return tr(Xe,e,r,i,o,s),er(Ye,i,a,s),n.multiply(t,Ye,Xe),t}function nr(t,e,r=Math.cos(t*Ue)){return Math.pow(2,e)*Ve/je/r}function ir(t,e,r,n=Math.cos(e*Ue)){let i=Math.pow(2,r);return t[0]=i*Ve/360,t[1]=t[0]/n,t}function or(t,e,r){let n=e[0],i=e[1],o=Math.pow(2,r),a=o*Ve*(n*Ue+Ne)/(2*Ne),s=o*Ve*(Ne+Math.log(Math.tan(ze+.5*(i*Ue))))/(2*Ne);return t[0]=a,t[1]=s,t[2]=0,t[3]=1,t}function ar(t,e,r){return o.transformMat4(t,e,r),t}function sr(t,e,r,n){return or(qe,e,r),ar(t,qe,n),t}}})},"object"==typeof r&&"object"==typeof e?e.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof r?r.PicoMercator=i():n.PicoMercator=i()},{}],198:[function(t,e,r){var n,i;n=window,i=function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);const n={DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33e3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,TIMEOUT_IGNORED:-1,MAX_CLIENT_WAIT_TIMEOUT_WEBGL:37447,QUERY_COUNTER_BITS_EXT:34916,TIME_ELAPSED_EXT:35007,TIMESTAMP_EXT:36392,GPU_DISJOINT_EXT:36795,TEXTURE_MAX_ANISOTROPY_EXT:34046,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,UNMASKED_VENDOR_WEBGL:37445,UNMASKED_RENDERER_WEBGL:37446,COMPLETION_STATUS_KHR:37297,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853},i={[n.BYTE]:1,[n.UNSIGNED_BYTE]:1,[n.SHORT]:2,[n.UNSIGNED_SHORT]:2,[n.INT]:4,[n.UNSIGNED_INT]:4,[n.FLOAT]:4},o={[n.R8]:[n.RED,n.UNSIGNED_BYTE],[n.R8_SNORM]:[n.RED,n.BYTE],[n.R16F]:[n.RED,n.FLOAT],[n.R32F]:[n.RED,n.FLOAT],[n.R8UI]:[n.RED_INTEGER,n.UNSIGNED_BYTE],[n.R8I]:[n.RED_INTEGER,n.BYTE],[n.R16UI]:[n.RED_INTEGER,n.UNSIGNED_SHORT],[n.R16I]:[n.RED_INTEGER,n.SHORT],[n.R32UI]:[n.RED_INTEGER,n.UNSIGNED_INT],[n.R32I]:[n.RED_INTEGER,n.INT],[n.RG8]:[n.RG,n.UNSIGNED_BYTE],[n.RG8_SNORM]:[n.RG,n.BYTE],[n.RG16F]:[n.RG,n.FLOAT],[n.RG32F]:[n.RG,n.FLOAT],[n.RG8UI]:[n.RG_INTEGER,n.UNSIGNED_BYTE],[n.RG8I]:[n.RG_INTEGER,n.BYTE],[n.RG16UI]:[n.RG_INTEGER,n.UNSIGNED_SHORT],[n.RG16I]:[n.RG_INTEGER,n.SHORT],[n.RG32UI]:[n.RG_INTEGER,n.UNSIGNED_INT],[n.RG32I]:[n.RG_INTEGER,n.INT],[n.RGB8]:[n.RGB,n.UNSIGNED_BYTE],[n.SRGB8]:[n.RGB,n.UNSIGNED_BYTE],[n.RGB565]:[n.RGB,n.UNSIGNED_SHORT_5_6_5],[n.RGB8_SNORM]:[n.RGB,n.BYTE],[n.R11F_G11F_B10F]:[n.RGB,n.UNSIGNED_INT_10F_11F_11F_REV],[n.RGB9_E5]:[n.RGB,n.UNSIGNED_INT_5_9_9_9_REV],[n.RGB16F]:[n.RGB,n.FLOAT],[n.RGB32F]:[n.RGB,n.FLOAT],[n.RGB8UI]:[n.RGB_INTEGER,n.UNSIGNED_BYTE],[n.RGB8I]:[n.RGB_INTEGER,n.BYTE],[n.RGB16UI]:[n.RGB_INTEGER,n.UNSIGNED_SHORT],[n.RGB16I]:[n.RGB_INTEGER,n.SHORT],[n.RGB32UI]:[n.RGB_INTEGER,n.UNSIGNED_INT],[n.RGB32I]:[n.RGB_INTEGER,n.INT],[n.RGBA8]:[n.RGBA,n.UNSIGNED_BYTE],[n.SRGB8_ALPHA8]:[n.RGBA,n.UNSIGNED_BYTE],[n.RGBA8_SNORM]:[n.RGBA,n.BYTE],[n.RGB5_A1]:[n.RGBA,n.UNSIGNED_SHORT_5_5_5_1],[n.RGBA4]:[n.RGBA,n.UNSIGNED_SHORT_4_4_4_4],[n.RGB10_A2]:[n.RGBA,n.UNSIGNED_INT_2_10_10_10_REV],[n.RGBA16F]:[n.RGBA,n.FLOAT],[n.RGBA32F]:[n.RGBA,n.FLOAT],[n.RGBA8UI]:[n.RGBA_INTEGER,n.UNSIGNED_BYTE],[n.RGBA8I]:[n.RGBA_INTEGER,n.BYTE],[n.RGB10_A2UI]:[n.RGBA_INTEGER,n.UNSIGNED_INT_2_10_10_10_REV],[n.RGBA16UI]:[n.RGBA_INTEGER,n.UNSIGNED_SHORT],[n.RGBA16I]:[n.RGBA_INTEGER,n.SHORT],[n.RGBA32I]:[n.RGBA_INTEGER,n.INT],[n.RGBA32UI]:[n.RGBA_INTEGER,n.UNSIGNED_INT],[n.DEPTH_COMPONENT16]:[n.DEPTH_COMPONENT,n.UNSIGNED_SHORT],[n.DEPTH_COMPONENT24]:[n.DEPTH_COMPONENT,n.UNSIGNED_INT],[n.DEPTH_COMPONENT32F]:[n.DEPTH_COMPONENT,n.FLOAT],[n.DEPTH24_STENCIL8]:[n.DEPTH_STENCIL,n.UNSIGNED_INT_24_8],[n.DEPTH32F_STENCIL8]:[n.DEPTH_STENCIL,n.FLOAT_32_UNSIGNED_INT_24_8_REV]},a={[n.COMPRESSED_RGB_S3TC_DXT1_EXT]:!0,[n.COMPRESSED_RGBA_S3TC_DXT1_EXT]:!0,[n.COMPRESSED_RGBA_S3TC_DXT3_EXT]:!0,[n.COMPRESSED_RGBA_S3TC_DXT5_EXT]:!0,[n.COMPRESSED_SRGB_S3TC_DXT1_EXT]:!0,[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT]:!0,[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT]:!0,[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT]:!0,[n.COMPRESSED_R11_EAC]:!0,[n.COMPRESSED_SIGNED_R11_EAC]:!0,[n.COMPRESSED_RG11_EAC]:!0,[n.COMPRESSED_SIGNED_RG11_EAC]:!0,[n.COMPRESSED_RGB8_ETC2]:!0,[n.COMPRESSED_SRGB8_ETC2]:!0,[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2]:!0,[n.COMPRESSED_RGBA8_ETC2_EAC]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC]:!0,[n.COMPRESSED_RGBA_ASTC_4x4_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_5x4_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_5x5_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_6x5_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_6x6_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_8x5_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_8x6_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_8x8_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_10x5_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_10x6_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_10x8_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_10x10_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_12x10_KHR]:!0,[n.COMPRESSED_RGBA_ASTC_12x12_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR]:!0,[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR]:!0,[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG]:!0,[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG]:!0,[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG]:!0,[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG]:!0},s={},u=new Array(1),l={},c={[n.UNSIGNED_BYTE]:{[n.RED]:n.R8,[n.RG]:n.RG8,[n.RGB]:n.RGB8,[n.RGBA]:n.RGBA8},[n.UNSIGNED_SHORT]:{[n.DEPTH_COMPONENT]:n.DEPTH_COMPONENT16},[n.FLOAT]:{[n.RED]:n.R16F,[n.RG]:n.RG16F,[n.RGB]:n.RGB16F,[n.RGBA]:n.RGBA16F,[n.DEPTH_COMPONENT]:n.DEPTH_COMPONENT32F}};class h{constructor(t,e,r){if(this.gl=t,this.texture=null,this.appState=e,this.compressed=a[r.internalFormat],void 0!==r.format&&(console.warn("Cubemap option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=Boolean(a[r.format]),void 0===r.type&&(r.type=r.format===n.DEPTH_COMPONENT?n.UNSIGNED_SHORT:n.UNSIGNED_BYTE),void 0===r.internalFormat&&(r.internalFormat=this.compressed?r.format:c[r.type][r.format])),this.compressed)this.internalFormat=r.internalFormat,this.format=r.internalFormat,this.type=n.UNSIGNED_BYTE;else{this.internalFormat=void 0!==r.internalFormat?r.internalFormat:n.RGBA8;let t=o[this.internalFormat];this.format=t[0],this.type=void 0!==r.type?r.type:t[1]}this.currentUnit=-1;let i=Array.isArray(r.negX),u=i?r.negX[0]:r.negX,{width:l=u.width,height:h=u.height,flipY:p=!1,premultiplyAlpha:f=!1,minFilter:d=(u?n.LINEAR_MIPMAP_NEAREST:n.NEAREST),magFilter:m=(u?n.LINEAR:n.NEAREST),wrapS:y=n.REPEAT,wrapT:_=n.REPEAT,compareMode:g=n.NONE,compareFunc:v=n.LEQUAL,minLOD:x=null,maxLOD:b=null,baseLevel:w=null,maxLevel:E=null,maxAnisotropy:A=1}=r;this.width=l,this.height=h,this.flipY=p,this.premultiplyAlpha=f,this.minFilter=d,this.magFilter=m,this.wrapS=y,this.wrapT=_,this.compareMode=g,this.compareFunc=v,this.minLOD=x,this.maxLOD=b,this.baseLevel=w,this.maxLevel=E,this.maxAnisotropy=Math.min(A,s.MAX_TEXTURE_ANISOTROPY),this.mipmaps=d===n.LINEAR_MIPMAP_NEAREST||d===n.LINEAR_MIPMAP_LINEAR,this.miplevelsProvided=i&&r.negX.length>1,this.levels=this.mipmaps?Math.floor(Math.log2(Math.min(this.width,this.height)))+1:1,this.restore(r)}restore(t=l){this.texture=this.gl.createTexture(),-1!==this.currentUnit&&(this.appState.textures[this.currentUnit]=null),this.bind(0),this.gl.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_COMPARE_MODE,this.compareMode),null!==this.baseLevel&&this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_BASE_LEVEL,this.baseLevel),null!==this.maxLevel&&this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAX_LEVEL,this.maxLevel),null!==this.minLOD&&this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_LOD,this.minLOD),null!==this.maxLOD&&this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAX_LOD,this.maxLOD),this.maxAnisotropy>1&&this.gl.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy),this.gl.texStorage2D(n.TEXTURE_CUBE_MAP,this.levels,this.internalFormat,this.width,this.height);let{negX:e,posX:r,negY:i,posY:o,negZ:a,posZ:s}=t;return e&&(this.faceData(n.TEXTURE_CUBE_MAP_NEGATIVE_X,e),this.faceData(n.TEXTURE_CUBE_MAP_POSITIVE_X,r),this.faceData(n.TEXTURE_CUBE_MAP_NEGATIVE_Y,i),this.faceData(n.TEXTURE_CUBE_MAP_POSITIVE_Y,o),this.faceData(n.TEXTURE_CUBE_MAP_NEGATIVE_Z,a),this.faceData(n.TEXTURE_CUBE_MAP_POSITIVE_Z,s)),this.mipmaps&&!this.miplevelsProvided&&this.gl.generateMipmap(n.TEXTURE_CUBE_MAP),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,this.appState.textures[this.currentUnit]=null,this.currentUnit=-1),this}faceData(t,e){Array.isArray(e)||(u[0]=e,e=u);let r,n=this.mipmaps?e.length:1,i=this.width,o=this.height;if(this.compressed)for(r=0;r<n;++r)this.gl.compressedTexSubImage2D(t,r,0,0,i,o,this.format,e[r]),i=Math.max(i>>1,1),o=Math.max(o>>1,1);else for(r=0;r<n;++r)this.gl.texSubImage2D(t,r,0,0,i,o,this.format,this.type,e[r]),i=Math.max(i>>1,1),o=Math.max(o>>1,1);return this}bind(t){let e=this.appState.textures[t];return e!==this&&(e&&(e.currentUnit=-1),-1!==this.currentUnit&&(this.appState.textures[this.currentUnit]=null),this.gl.activeTexture(n.TEXTURE0+t),this.gl.bindTexture(n.TEXTURE_CUBE_MAP,this.texture),this.appState.textures[t]=this,this.currentUnit=t),this}}class p{constructor(t,e,r,i=null,o){this.gl=t,this.currentProgram=r,this.drawPrimitive=n.TRIANGLES,this.currentVertexArray=i,this.currentTransformFeedback=null,this.appState=e,this.uniformIndices={},this.uniformNames=new Array(s.MAX_UNIFORMS),this.uniformValues=new Array(s.MAX_UNIFORMS),this.uniformCount=0,this.uniformBuffers=new Array(s.MAX_UNIFORM_BUFFERS),this.uniformBlockNames=new Array(s.MAX_UNIFORM_BUFFERS),this.uniformBlockCount=0,this.textures=new Array(s.MAX_TEXTURE_UNITS),this.textureCount=0,this.offsets=new Int32Array(1),this.numElements=new Int32Array(1),this.numInstances=new Int32Array(1),this.currentVertexArray&&(this.numElements[0]=this.currentVertexArray.numElements,this.numInstances[0]=this.currentVertexArray.numInstances),this.numDraws=1,void 0!==o&&(console.warn("Primitive argument to 'App.createDrawCall' is deprecated and will be removed. Use 'DrawCall.primitive' instead."),this.primitive(o))}primitive(t){return this.drawPrimitive=t,this}transformFeedback(t){return this.currentTransformFeedback=t,this}uniform(t,e){let r=this.uniformIndices[t];return void 0===r&&(r=this.uniformCount++,this.uniformIndices[t]=r,this.uniformNames[r]=t),this.uniformValues[r]=e,this}texture(t,e){return this.textures[this.currentProgram.samplers[t]]=e,this}uniformBlock(t,e){return this.uniformBuffers[this.currentProgram.uniformBlocks[t]]=e,this}drawRanges(...t){this.numDraws=t.length,this.offsets.length<this.numDraws&&(this.offsets=new Int32Array(this.numDraws)),this.numElements.length<this.numDraws&&(this.numElements=new Int32Array(this.numDraws)),this.numInstances.length<this.numDraws&&(this.numInstances=new Int32Array(this.numDraws));for(let e=0;e<this.numDraws;++e){let r=t[e];this.offsets[e]=r[0],this.numElements[e]=r[1],this.numInstances[e]=r[2]||1}return this}draw(){let t=this.uniformNames,e=this.uniformValues,r=this.uniformBuffers,i=this.currentProgram.uniformBlockCount,o=this.textures,a=this.currentProgram.samplerCount,u=!1;this.currentProgram.bind(),this.currentVertexArray&&(this.currentVertexArray.bind(),u=this.currentVertexArray.indexed);for(let r=0;r<this.uniformCount;++r)this.currentProgram.uniform(t[r],e[r]);for(let t=0;t<i;++t)r[t].bind(t);for(let t=0;t<a;++t)o[t].bind(t);if(this.currentTransformFeedback?(this.currentTransformFeedback.bind(),this.gl.beginTransformFeedback(this.drawPrimitive)):this.appState.transformFeedback&&(this.gl.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null),s.MULTI_DRAW_INSTANCED){let t=this.appState.extensions.multiDrawInstanced;u?t.multiDrawElementsInstancedWEBGL(this.drawPrimitive,this.numElements,0,this.currentVertexArray.indexType,this.offsets,0,this.numInstances,0,this.numDraws):t.multiDrawArraysInstancedWEBGL(this.drawPrimitive,this.offsets,0,this.numElements,0,this.numInstances,0,this.numDraws)}else if(u)for(let t=0;t<this.numDraws;++t)this.gl.drawElementsInstanced(this.drawPrimitive,this.numElements[t],this.currentVertexArray.indexType,this.offsets[t],this.numInstances[t]);else for(let t=0;t<this.numDraws;++t)this.gl.drawArraysInstanced(this.drawPrimitive,this.offsets[t],this.numElements[t],this.numInstances[t]);return this.currentTransformFeedback&&this.gl.endTransformFeedback(),this}}class f{constructor(t,e,r,i,u=i.width,h=i.height,p,f,d=l){if(this.gl=t,this.binding=r,this.texture=null,this.width=u||0,this.height=h||0,this.depth=p||0,this.is3D=f,this.appState=e,this.compressed=Boolean(a[d.internalFormat]),void 0!==d.format&&(console.warn("Texture option 'format' is deprecated and will be removed. Use 'internalFormat' with a sized format instead."),this.compressed=Boolean(a[d.format]),void 0===d.type&&(d.type=d.format===n.DEPTH_COMPONENT?n.UNSIGNED_SHORT:n.UNSIGNED_BYTE),void 0===d.internalFormat&&(d.internalFormat=this.compressed?d.format:c[d.type][d.format])),this.compressed)this.internalFormat=d.internalFormat,this.format=this.internalFormat,this.type=n.UNSIGNED_BYTE;else{this.internalFormat=void 0!==d.internalFormat?d.internalFormat:n.RGBA8;let t=o[this.internalFormat];this.format=t[0],this.type=void 0!==d.type?d.type:t[1]}this.currentUnit=-1;let{minFilter:m=(i?n.LINEAR_MIPMAP_NEAREST:n.NEAREST),magFilter:y=(i?n.LINEAR:n.NEAREST),wrapS:_=n.REPEAT,wrapT:g=n.REPEAT,wrapR:v=n.REPEAT,compareMode:x=n.NONE,compareFunc:b=n.LEQUAL,minLOD:w=null,maxLOD:E=null,baseLevel:A=null,maxLevel:T=null,maxAnisotropy:M=1,flipY:S=!1,premultiplyAlpha:R=!1}=d;this.minFilter=m,this.magFilter=y,this.wrapS=_,this.wrapT=g,this.wrapR=v,this.compareMode=x,this.compareFunc=b,this.minLOD=w,this.maxLOD=E,this.baseLevel=A,this.maxLevel=T,this.maxAnisotropy=Math.min(M,s.MAX_TEXTURE_ANISOTROPY),this.flipY=S,this.premultiplyAlpha=R,this.mipmaps=m===n.LINEAR_MIPMAP_NEAREST||m===n.LINEAR_MIPMAP_LINEAR,this.restore(i)}restore(t){return this.texture=null,this.resize(this.width,this.height,this.depth),t&&this.data(t),this}resize(t,e,r){if(r=r||0,this.texture&&t===this.width&&e===this.height&&r===this.depth)return this;let i;return this.gl.deleteTexture(this.texture),-1!==this.currentUnit&&(this.appState.textures[this.currentUnit]=null),this.texture=this.gl.createTexture(),this.bind(Math.max(this.currentUnit,0)),this.width=t,this.height=e,this.depth=r,this.gl.texParameteri(this.binding,n.TEXTURE_MIN_FILTER,this.minFilter),this.gl.texParameteri(this.binding,n.TEXTURE_MAG_FILTER,this.magFilter),this.gl.texParameteri(this.binding,n.TEXTURE_WRAP_S,this.wrapS),this.gl.texParameteri(this.binding,n.TEXTURE_WRAP_T,this.wrapT),this.gl.texParameteri(this.binding,n.TEXTURE_WRAP_R,this.wrapR),this.gl.texParameteri(this.binding,n.TEXTURE_COMPARE_FUNC,this.compareFunc),this.gl.texParameteri(this.binding,n.TEXTURE_COMPARE_MODE,this.compareMode),this.gl.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),null!==this.minLOD&&this.gl.texParameterf(this.binding,n.TEXTURE_MIN_LOD,this.minLOD),null!==this.maxLOD&&this.gl.texParameterf(this.binding,n.TEXTURE_MAX_LOD,this.maxLOD),null!==this.baseLevel&&this.gl.texParameteri(this.binding,n.TEXTURE_BASE_LEVEL,this.baseLevel),null!==this.maxLevel&&this.gl.texParameteri(this.binding,n.TEXTURE_MAX_LEVEL,this.maxLevel),this.maxAnisotropy>1&&this.gl.texParameteri(this.binding,n.TEXTURE_MAX_ANISOTROPY_EXT,this.maxAnisotropy),this.is3D?(i=this.mipmaps?Math.floor(Math.log2(Math.max(Math.max(this.width,this.height),this.depth)))+1:1,this.gl.texStorage3D(this.binding,i,this.internalFormat,this.width,this.height,this.depth)):(i=this.mipmaps?Math.floor(Math.log2(Math.max(this.width,this.height)))+1:1,this.gl.texStorage2D(this.binding,i,this.internalFormat,this.width,this.height)),this}data(t){Array.isArray(t)||(u[0]=t,t=u);let e,r=this.mipmaps?t.length:1,n=this.width,i=this.height,o=this.depth,a=this.mipmaps&&1===t.length;if(this.bind(Math.max(this.currentUnit,0)),this.compressed)if(this.is3D)for(e=0;e<r;++e)this.gl.compressedTexSubImage3D(this.binding,e,0,0,0,n,i,o,this.format,t[e]),n=Math.max(n>>1,1),i=Math.max(i>>1,1),o=Math.max(o>>1,1);else for(e=0;e<r;++e)this.gl.compressedTexSubImage2D(this.binding,e,0,0,n,i,this.format,t[e]),n=Math.max(n>>1,1),i=Math.max(i>>1,1);else if(this.is3D)for(e=0;e<r;++e)this.gl.texSubImage3D(this.binding,e,0,0,0,n,i,o,this.format,this.type,t[e]),n=Math.max(n>>1,1),i=Math.max(i>>1,1),o=Math.max(o>>1,1);else for(e=0;e<r;++e)this.gl.texSubImage2D(this.binding,e,0,0,n,i,this.format,this.type,t[e]),n=Math.max(n>>1,1),i=Math.max(i>>1,1);return a&&this.gl.generateMipmap(this.binding),this}delete(){return this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null,-1!==this.currentUnit&&this.appState.textures[this.currentUnit]===this&&(this.appState.textures[this.currentUnit]=null,this.currentUnit=-1)),this}bind(t){let e=this.appState.textures[t];return e!==this&&(e&&(e.currentUnit=-1),-1!==this.currentUnit&&(this.appState.textures[this.currentUnit]=null),this.gl.activeTexture(n.TEXTURE0+t),this.gl.bindTexture(this.binding,this.texture),this.appState.textures[t]=this,this.currentUnit=t),this}}class d{constructor(t,e,r,n,i=0){this.gl=t,this.renderbuffer=null,this.width=e,this.height=r,this.internalFormat=n,this.samples=i,this.restore()}restore(){return this.renderbuffer=this.gl.createRenderbuffer(),this.resize(this.width,this.height),this}resize(t,e){return this.width=t,this.height=e,this.gl.bindRenderbuffer(n.RENDERBUFFER,this.renderbuffer),this.gl.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,this.internalFormat,this.width,this.height),this.gl.bindRenderbuffer(n.RENDERBUFFER,null),this}delete(){return this.gl.deleteRenderbuffer(this.renderbuffer),this.renderbuffer=null,this}}class m{constructor(t,e){this.gl=t,this.framebuffer=null,this.appState=e,this.numColorTargets=0,this.colorAttachments=[],this.colorAttachmentEnums=[],this.colorAttachmentTargets=[],this.depthAttachment=null,this.depthAttachmentTarget=null,this.width=0,this.height=0,this.restore()}restore(){return this.appState.drawFramebuffer===this&&(this.appState.drawFramebuffer=null),this.appState.readFramebuffer===this&&(this.appState.readFramebuffer=null),this.framebuffer=this.gl.createFramebuffer(),this}colorTarget(t,e,r=(e.is3D?0:n.TEXTURE_2D)){if(t>=this.numColorTargets){let e=t+1;this.colorAttachmentEnums.length=e,this.colorAttachments.length=e,this.colorAttachmentTargets.length=e;for(let t=this.numColorTargets;t<e-1;++t)this.colorAttachmentEnums[t]=n.NONE,this.colorAttachments[t]=null,this.colorAttachmentTargets[t]=0;this.numColorTargets=e}this.colorAttachmentEnums[t]=n.COLOR_ATTACHMENT0+t,this.colorAttachments[t]=e,this.colorAttachmentTargets[t]=r;let i=this.bindAndCaptureState();return e instanceof d?this.gl.framebufferRenderbuffer(n.DRAW_FRAMEBUFFER,this.colorAttachmentEnums[t],n.RENDERBUFFER,e.renderbuffer):e.is3D?this.gl.framebufferTextureLayer(n.DRAW_FRAMEBUFFER,this.colorAttachmentEnums[t],e.texture,0,r):this.gl.framebufferTexture2D(n.DRAW_FRAMEBUFFER,this.colorAttachmentEnums[t],r,e.texture,0),this.gl.drawBuffers(this.colorAttachmentEnums),this.width=e.width,this.height=e.height,this.restoreState(i),this}depthTarget(t,e=(t.is3D?0:n.TEXTURE_2D)){let r=this.bindAndCaptureState();return this.depthAttachment=t,this.depthAttachmentTarget=e,t instanceof d?this.gl.framebufferRenderbuffer(n.DRAW_FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,t.renderbuffer):t.is3D?this.gl.framebufferTextureLayer(n.DRAW_FRAMEBUFFER,n.DEPTH_ATTACHMENT,t.texture,0,e):this.gl.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.DEPTH_ATTACHMENT,e,t.texture,0),this.width=t.width,this.height=t.height,this.restoreState(r),this}resize(t=this.gl.drawingBufferWidth,e=this.gl.drawingBufferHeight){let r=this.bindAndCaptureState();for(let r=0;r<this.numColorTargets;++r){let i=this.colorAttachments[r];i&&(i.resize(t,e),i instanceof f&&(i.is3D?this.gl.framebufferTextureLayer(n.DRAW_FRAMEBUFFER,this.colorAttachmentEnums[r],i.texture,0,this.colorAttachmentTargets[r]):this.gl.framebufferTexture2D(n.DRAW_FRAMEBUFFER,this.colorAttachmentEnums[r],this.colorAttachmentTargets[r],i.texture,0)))}return this.depthAttachment&&(this.depthAttachment.resize(t,e),this.depthAttachment instanceof f&&(this.depthAttachment.is3D?this.gl.framebufferTextureLayer(n.DRAW_FRAMEBUFFER,n.DEPTH_ATTACHMENT,this.depthAttachment.texture,0,this.depthAttachmentTarget):this.gl.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.DEPTH_ATTACHMENT,this.depthAttachmentTarget,this.depthAttachment.texture,0))),this.width=t,this.height=e,this.restoreState(r),this}delete(){return this.framebuffer&&(this.gl.deleteFramebuffer(this.framebuffer),this.framebuffer=null,this.appState.drawFramebuffer===this&&(this.gl.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),this.appState.drawFramebuffer=null),this.appState.readFramebuffer===this&&(this.gl.bindFramebuffer(n.READ_FRAMEBUFFER,null),this.appState.readFramebuffer=null)),this}getStatus(){let t=this.bindAndCaptureState(),e=this.gl.checkFramebufferStatus(n.DRAW_FRAMEBUFFER);return this.restoreState(t),e}bindForDraw(){return this.appState.drawFramebuffer!==this&&(this.gl.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.framebuffer),this.appState.drawFramebuffer=this),this}bindForRead(){return this.appState.readFramebuffer!==this&&(this.gl.bindFramebuffer(this.gl.READ_FRAMEBUFFER,this.framebuffer),this.appState.readFramebuffer=this),this}bindAndCaptureState(){let t=this.appState.drawFramebuffer;return t!==this&&this.gl.bindFramebuffer(n.DRAW_FRAMEBUFFER,this.framebuffer),t}restoreState(t){return t!==this&&this.gl.bindFramebuffer(n.DRAW_FRAMEBUFFER,t?t.framebuffer:null),this}get colorTextures(){return console.error("Framebuffer.colorTextures is deprecated and will be removed. Please use Framebuffer.colorAttachments."),this.colorAttachments}get depthTexture(){return console.error("Framebuffer.depthTexture is deprecated and will be removed. Please use Framebuffer.depthAttachment."),this.depthAttachment}}class y{constructor(t,e,r,n){this.gl=t,this.appState=e,this.shader=null,this.type=r,this.source=n,this.restore()}restore(){return this.shader=this.gl.createShader(this.type),this.gl.shaderSource(this.shader,this.source),this.gl.compileShader(this.shader),this}translatedSource(){return s.DEBUG_SHADERS?this.appState.extensions.debugShaders.getTranslatedShaderSource(this.shader):"(Unavailable)"}delete(){return this.shader&&(this.gl.deleteShader(this.shader),this.shader=null),this}checkCompilation(){if(!this.gl.getShaderParameter(this.shader,n.COMPILE_STATUS)){let t,e;for(console.error(this.gl.getShaderInfoLog(this.shader)),e=this.source.split("\n"),t=0;t<e.length;++t)console.error(`${t+1}: ${e[t]}`)}return this}}const _={};_[n.BOOL]="uniform1i",_[n.INT]="uniform1i",_[n.SAMPLER_2D]="uniform1i",_[n.INT_SAMPLER_2D]="uniform1i",_[n.UNSIGNED_INT_SAMPLER_2D]="uniform1i",_[n.SAMPLER_2D_SHADOW]="uniform1i",_[n.SAMPLER_2D_ARRAY]="uniform1i",_[n.INT_SAMPLER_2D_ARRAY]="uniform1i",_[n.UNSIGNED_INT_SAMPLER_2D_ARRAY]="uniform1i",_[n.SAMPLER_2D_ARRAY_SHADOW]="uniform1i",_[n.SAMPLER_CUBE]="uniform1i",_[n.INT_SAMPLER_CUBE]="uniform1i",_[n.UNSIGNED_INT_SAMPLER_CUBE]="uniform1i",_[n.SAMPLER_CUBE_SHADOW]="uniform1i",_[n.SAMPLER_3D]="uniform1i",_[n.INT_SAMPLER_3D]="uniform1i",_[n.UNSIGNED_INT_SAMPLER_3D]="uniform1i",_[n.UNSIGNED_INT]="uniform1ui",_[n.FLOAT]="uniform1f",_[n.FLOAT_VEC2]="uniform2f",_[n.FLOAT_VEC3]="uniform3f",_[n.FLOAT_VEC4]="uniform4f",_[n.INT_VEC2]="uniform2i",_[n.INT_VEC3]="uniform3i",_[n.INT_VEC4]="uniform4i",_[n.UNSIGNED_INT_VEC2]="uniform2ui",_[n.UNSIGNED_INT_VEC3]="uniform3ui",_[n.UNSIGNED_INT_VEC4]="uniform4ui",_[n.BOOL_VEC2]="uniform2i",_[n.BOOL_VEC3]="uniform3i",_[n.BOOL_VEC4]="uniform4i",_[n.FLOAT_MAT2]="uniformMatrix2fv",_[n.FLOAT_MAT3]="uniformMatrix3fv",_[n.FLOAT_MAT4]="uniformMatrix4fv",_[n.FLOAT_MAT2x3]="uniformMatrix2x3fv",_[n.FLOAT_MAT2x4]="uniformMatrix2x4fv",_[n.FLOAT_MAT3x2]="uniformMatrix3x2fv",_[n.FLOAT_MAT3x4]="uniformMatrix3x4fv",_[n.FLOAT_MAT4x2]="uniformMatrix4x2fv",_[n.FLOAT_MAT4x3]="uniformMatrix4x3fv";const g={};g[n.BOOL]=1,g[n.INT]=1,g[n.SAMPLER_2D]=1,g[n.INT_SAMPLER_2D]=1,g[n.UNSIGNED_INT_SAMPLER_2D]=1,g[n.SAMPLER_2D_SHADOW]=1,g[n.SAMPLER_2D_ARRAY]=1,g[n.INT_SAMPLER_2D_ARRAY]=1,g[n.UNSIGNED_INT_SAMPLER_2D_ARRAY]=1,g[n.SAMPLER_2D_ARRAY_SHADOW]=1,g[n.SAMPLER_CUBE]=1,g[n.INT_SAMPLER_CUBE]=1,g[n.UNSIGNED_INT_SAMPLER_CUBE]=1,g[n.SAMPLER_CUBE_SHADOW]=1,g[n.SAMPLER_3D]=1,g[n.INT_SAMPLER_3D]=1,g[n.UNSIGNED_INT_SAMPLER_3D]=1,g[n.UNSIGNED_INT]=1,g[n.FLOAT]=1,g[n.FLOAT_VEC2]=2,g[n.FLOAT_VEC3]=3,g[n.FLOAT_VEC4]=4,g[n.INT_VEC2]=2,g[n.INT_VEC3]=3,g[n.INT_VEC4]=4,g[n.UNSIGNED_INT_VEC2]=2,g[n.UNSIGNED_INT_VEC3]=3,g[n.UNSIGNED_INT_VEC4]=4,g[n.BOOL_VEC2]=2,g[n.BOOL_VEC3]=3,g[n.BOOL_VEC4]=4,g[n.FLOAT_MAT2]=4,g[n.FLOAT_MAT3]=9,g[n.FLOAT_MAT4]=16,g[n.FLOAT_MAT2x3]=6,g[n.FLOAT_MAT2x4]=8,g[n.FLOAT_MAT3x2]=6,g[n.FLOAT_MAT3x4]=12,g[n.FLOAT_MAT4x2]=8,g[n.FLOAT_MAT4x3]=12;const v={};v[n.INT]=Int32Array,v[n.SAMPLER_2D]=Int32Array,v[n.INT_SAMPLER_2D]=Int32Array,v[n.UNSIGNED_INT_SAMPLER_2D]=Int32Array,v[n.SAMPLER_2D_SHADOW]=Int32Array,v[n.SAMPLER_2D_ARRAY]=Int32Array,v[n.INT_SAMPLER_2D_ARRAY]=Int32Array,v[n.UNSIGNED_INT_SAMPLER_2D_ARRAY]=Int32Array,v[n.SAMPLER_2D_ARRAY_SHADOW]=Int32Array,v[n.SAMPLER_CUBE]=Int32Array,v[n.INT_SAMPLER_CUBE]=Int32Array,v[n.UNSIGNED_INT_SAMPLER_CUBE]=Int32Array,v[n.SAMPLER_CUBE_SHADOW]=Int32Array,v[n.SAMPLER_3D]=Int32Array,v[n.INT_SAMPLER_3D]=Int32Array,v[n.UNSIGNED_INT_SAMPLER_3D]=Int32Array,v[n.UNSIGNED_INT]=Uint32Array,v[n.FLOAT]=Float32Array,v[n.FLOAT_VEC2]=Float32Array,v[n.FLOAT_VEC3]=Float32Array,v[n.FLOAT_VEC4]=Float32Array,v[n.INT_VEC2]=Int32Array,v[n.INT_VEC3]=Int32Array,v[n.INT_VEC4]=Int32Array,v[n.UNSIGNED_INT_VEC2]=Uint32Array,v[n.UNSIGNED_INT_VEC3]=Uint32Array,v[n.UNSIGNED_INT_VEC4]=Uint32Array;class x{constructor(t,e,r){this.gl=t,this.handle=e,this.glFuncName=_[r],this.cache=r!==n.BOOL&&0}set(t){this.cache!==t&&(this.gl[this.glFuncName](this.handle,t),this.cache=t)}}class b{constructor(t,e,r,n){this.gl=t,this.handle=e,this.glFuncName=_[r]+"v",this.count=n,this.cache=new v[r](g[r]*n)}set(t){for(let e=0,r=t.length;e<r;++e)if(this.cache[e]!==t[e])return this.gl[this.glFuncName](this.handle,t),void this.cache.set(t)}}class w{constructor(t,e,r,n){this.gl=t,this.handle=e,this.glFuncName=_[r]+"v",this.count=n,this.cache=new Array(g[r]*n).fill(!1)}set(t){for(let e=0,r=t.length;e<r;++e)if(this.cache[e]!==t[e]){this.gl[this.glFuncName](this.handle,t);for(let n=e;n<r;n++)this.cache[n]=t[n];return}}}class E{constructor(t,e,r,n){this.gl=t,this.handle=e,this.glFuncName=_[r],this.count=n,this.cache=new Float32Array(g[r]*n)}set(t){for(let e=0,r=t.length;e<r;++e)if(this.cache[e]!==t[e])return this.gl[this.glFuncName](this.handle,!1,t),void this.cache.set(t)}}class A{constructor(t,e,r,n,i){this.gl=t,this.appState=e,this.program=null,this.transformFeedbackVaryings=i||null,this.uniforms={},this.uniformBlocks={},this.uniformBlockCount=0,this.samplers={},this.samplerCount=0,this.vertexSource=null,this.vertexShader=null,this.fragmentSource=null,this.fragmentShader=null,this.linked=!1,"string"==typeof r?this.vertexSource=r:this.vertexShader=r,"string"==typeof n?this.fragmentSource=n:this.fragmentShader=n,this.initialize()}restore(){return this.initialize(),this.link(),this.checkLinkage(),this}translatedVertexSource(){if(this.vertexShader)return this.vertexShader.translatedSource();{let t=new y(this.gl,this.appState,n.VERTEX_SHADER,this.vertexSource),e=t.translatedSource();return t.delete(),e}}translatedFragmentSource(){if(this.fragmentShader)return this.fragmentShader.translatedSource();{let t=new y(this.gl,this.appState,n.FRAGMENT_SHADER,this.fragmentSource),e=t.translatedSource();return t.delete(),e}}delete(){return this.program&&(this.gl.deleteProgram(this.program),this.program=null,this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null)),this}initialize(){return this.appState.program===this&&(this.gl.useProgram(null),this.appState.program=null),this.linked=!1,this.uniformBlockCount=0,this.samplerCount=0,this.vertexSource&&(this.vertexShader=new y(this.gl,this.appState,n.VERTEX_SHADER,this.vertexSource)),this.fragmentSource&&(this.fragmentShader=new y(this.gl,this.appState,n.FRAGMENT_SHADER,this.fragmentSource)),this.program=this.gl.createProgram(),this}link(){return this.gl.attachShader(this.program,this.vertexShader.shader),this.gl.attachShader(this.program,this.fragmentShader.shader),this.transformFeedbackVaryings&&this.gl.transformFeedbackVaryings(this.program,this.transformFeedbackVaryings,n.SEPARATE_ATTRIBS),this.gl.linkProgram(this.program),this}checkCompletion(){return!s.PARALLEL_SHADER_COMPILE||this.gl.getProgramParameter(this.program,n.COMPLETION_STATUS_KHR)}checkLinkage(){return this.linked?this:(this.gl.getProgramParameter(this.program,n.LINK_STATUS)?(this.linked=!0,this.initVariables()):(console.error(this.gl.getProgramInfoLog(this.program)),this.vertexShader.checkCompilation(),this.fragmentShader.checkCompilation()),this.vertexSource&&(this.vertexShader.delete(),this.vertexShader=null),this.fragmentSource&&(this.fragmentShader.delete(),this.fragmentShader=null),this)}initVariables(){this.bind();let t,e=this.gl.getProgramParameter(this.program,n.ACTIVE_UNIFORMS);for(let r=0;r<e;++r){let e=this.gl.getActiveUniform(this.program,r),i=this.gl.getUniformLocation(this.program,e.name),o=null,a=e.type,s=e.size;switch(a){case n.SAMPLER_2D:case n.INT_SAMPLER_2D:case n.UNSIGNED_INT_SAMPLER_2D:case n.SAMPLER_2D_SHADOW:case n.SAMPLER_2D_ARRAY:case n.INT_SAMPLER_2D_ARRAY:case n.UNSIGNED_INT_SAMPLER_2D_ARRAY:case n.SAMPLER_2D_ARRAY_SHADOW:case n.SAMPLER_CUBE:case n.INT_SAMPLER_CUBE:case n.UNSIGNED_INT_SAMPLER_CUBE:case n.SAMPLER_CUBE_SHADOW:case n.SAMPLER_3D:case n.INT_SAMPLER_3D:case n.UNSIGNED_INT_SAMPLER_3D:t=this.samplerCount++,this.samplers[e.name]=t,this.gl.uniform1i(i,t);break;case n.INT:case n.UNSIGNED_INT:case n.FLOAT:o=s>1?b:x;break;case n.BOOL:o=s>1?w:x;break;case n.FLOAT_VEC2:case n.INT_VEC2:case n.UNSIGNED_INT_VEC2:case n.FLOAT_VEC3:case n.INT_VEC3:case n.UNSIGNED_INT_VEC3:case n.FLOAT_VEC4:case n.INT_VEC4:case n.UNSIGNED_INT_VEC4:o=b;break;case n.BOOL_VEC2:case n.BOOL_VEC3:case n.BOOL_VEC4:o=w;break;case n.FLOAT_MAT2:case n.FLOAT_MAT3:case n.FLOAT_MAT4:case n.FLOAT_MAT2x3:case n.FLOAT_MAT2x4:case n.FLOAT_MAT3x2:case n.FLOAT_MAT3x4:case n.FLOAT_MAT4x2:case n.FLOAT_MAT4x3:o=E;break;default:console.error("Unrecognized type for uniform ",e.name)}o&&(this.uniforms[e.name]=new o(this.gl,i,a,s))}let r=this.gl.getProgramParameter(this.program,n.ACTIVE_UNIFORM_BLOCKS);for(let t=0;t<r;++t){let e=this.gl.getActiveUniformBlockName(this.program,t),r=this.gl.getUniformBlockIndex(this.program,e),n=this.uniformBlockCount++;this.gl.uniformBlockBinding(this.program,r,n),this.uniformBlocks[e]=n}}uniform(t,e){return this.uniforms[t]&&this.uniforms[t].set(e),this}bind(){return this.appState.program!==this&&(this.gl.useProgram(this.program),this.appState.program=this),this}}class T{constructor(t,e){this.gl=t,this.query=null,this.target=e,this.active=!1,this.result=null,this.restore()}restore(){return this.query=this.gl.createQuery(),this.active=!1,this.result=null,this}begin(){return this.active||(this.gl.beginQuery(this.target,this.query),this.result=null),this}end(){return this.active||(this.gl.endQuery(this.target),this.active=!0),this}ready(){return!(!this.active||!this.gl.getQueryParameter(this.query,n.QUERY_RESULT_AVAILABLE)||(this.active=!1,this.result=Number(this.gl.getQueryParameter(this.query,n.QUERY_RESULT)),0))}delete(){return this.query&&(this.gl.deleteQuery(this.query),this.query=null),this}}class M{constructor(t){this.gl=t,this.cpuTimer=window.performance||window.Date,this.gpuTimerQuery=null,this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this.restore()}restore(){return s.GPU_TIMER&&(this.gpuTimerQuery?this.gpuTimerQuery.restore():this.gpuTimerQuery=new T(this.gl,n.TIME_ELAPSED_EXT)),this.cpuStartTime=0,this.cpuTime=0,this.gpuTime=0,this}start(){return s.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.begin(),this.cpuStartTime=this.cpuTimer.now()):this.cpuStartTime=this.cpuTimer.now(),this}end(){return s.GPU_TIMER?this.gpuTimerQuery.active||(this.gpuTimerQuery.end(),this.cpuTime=this.cpuTimer.now()-this.cpuStartTime):this.cpuTime=this.cpuTimer.now()-this.cpuStartTime,this}ready(){if(s.GPU_TIMER){if(!this.gpuTimerQuery.active)return!1;var t=this.gpuTimerQuery.ready(),e=this.gl.getParameter(n.GPU_DISJOINT_EXT);return!(!t||e||(this.gpuTime=this.gpuTimerQuery.result/1e6,0))}return Boolean(this.cpuStartTime)}delete(){return this.gpuTimerQuery&&(this.gpuTimerQuery.delete(),this.gpuTimerQuery=null),this}}class S{constructor(t,e){this.gl=t,this.appState=e,this.transformFeedback=null,this.restore()}restore(){return this.appState.transformFeedback===this&&(this.appState.transformFeedback=null),this.transformFeedback=this.gl.createTransformFeedback(),this}feedbackBuffer(t,e){return this.gl.bindTransformFeedback(n.TRANSFORM_FEEDBACK,this.transformFeedback),this.gl.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,t,e.buffer),this.gl.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null),this.gl.bindBufferBase(n.TRANSFORM_FEEDBACK_BUFFER,t,null),this}delete(){return this.transformFeedback&&(this.gl.deleteTransformFeedback(this.transformFeedback),this.transformFeedback=null,this.appState.transformFeedback===this&&(this.gl.bindTransformFeedback(n.TRANSFORM_FEEDBACK,null),this.appState.transformFeedback=null)),this}bind(){return this.appState.transformFeedback!==this&&(this.gl.bindTransformFeedback(n.TRANSFORM_FEEDBACK,this.transformFeedback),this.appState.transformFeedback=this),this}}class R{constructor(t,e,r,i=t.DYNAMIC_DRAW){this.gl=t,this.buffer=null,this.dataViews={},this.offsets=new Array(r.length),this.sizes=new Array(r.length),this.types=new Array(r.length),this.size=0,this.usage=i,this.appState=e,this.currentBase=-1;for(let t=0,e=r.length;t<e;++t){let e=r[t];switch(e){case n.FLOAT:case n.INT:case n.UNSIGNED_INT:case n.BOOL:this.offsets[t]=this.size,this.sizes[t]=1,this.types[t]=e===n.INT?n.INT:e===n.UNSIGNED_INT?n.UNSIGNED_INT:n.FLOAT,this.size++;break;case n.FLOAT_VEC2:case n.INT_VEC2:case n.UNSIGNED_INT_VEC2:case n.BOOL_VEC2:this.size+=this.size%2,this.offsets[t]=this.size,this.sizes[t]=2,this.types[t]=e===n.INT_VEC2?n.INT:e===n.UNSIGNED_INT_VEC2?n.UNSIGNED_INT:n.FLOAT,this.size+=2;break;case n.FLOAT_VEC3:case n.INT_VEC3:case n.UNSIGNED_INT_VEC3:case n.BOOL_VEC3:case n.FLOAT_VEC4:case n.INT_VEC4:case n.UNSIGNED_INT_VEC4:case n.BOOL_VEC4:this.size+=(4-this.size%4)%4,this.offsets[t]=this.size,this.sizes[t]=4,this.types[t]=e===n.INT_VEC4||e===n.INT_VEC3?n.INT:e===n.UNSIGNED_INT_VEC4||e===n.UNSIGNED_INT_VEC3?n.UNSIGNED_INT:n.FLOAT,this.size+=4;break;case n.FLOAT_MAT2:case n.FLOAT_MAT2x3:case n.FLOAT_MAT2x4:this.size+=(4-this.size%4)%4,this.offsets[t]=this.size,this.sizes[t]=8,this.types[t]=n.FLOAT,this.size+=8;break;case n.FLOAT_MAT3:case n.FLOAT_MAT3x2:case n.FLOAT_MAT3x4:this.size+=(4-this.size%4)%4,this.offsets[t]=this.size,this.sizes[t]=12,this.types[t]=n.FLOAT,this.size+=12;break;case n.FLOAT_MAT4:case n.FLOAT_MAT4x2:case n.FLOAT_MAT4x3:this.size+=(4-this.size%4)%4,this.offsets[t]=this.size,this.sizes[t]=16,this.types[t]=n.FLOAT,this.size+=16;break;default:console.error("Unsupported type for uniform buffer.")}}this.size+=(4-this.size%4)%4,this.data=new Float32Array(this.size),this.dataViews[n.FLOAT]=this.data,this.dataViews[n.INT]=new Int32Array(this.data.buffer),this.dataViews[n.UNSIGNED_INT]=new Uint32Array(this.data.buffer),this.dirtyStart=this.size,this.dirtyEnd=0,this.restore()}restore(){return-1!==this.currentBase&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(n.UNIFORM_BUFFER,this.buffer),this.gl.bufferData(n.UNIFORM_BUFFER,4*this.size,this.usage),this.gl.bindBuffer(n.UNIFORM_BUFFER,null),this}set(t,e){let r=this.dataViews[this.types[t]],n=this.offsets[t],i=this.sizes[t];return 1===this.sizes[t]?r[n]=e:r.set(e,n),n<this.dirtyStart&&(this.dirtyStart=n),this.dirtyEnd<n+i&&(this.dirtyEnd=n+i),this}update(){if(this.dirtyStart>=this.dirtyEnd)return this;let t=this.data.subarray(this.dirtyStart,this.dirtyEnd),e=4*this.dirtyStart;return this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,this.buffer),this.gl.bufferSubData(this.gl.UNIFORM_BUFFER,e,t),this.gl.bindBuffer(this.gl.UNIFORM_BUFFER,null),this.dirtyStart=this.size,this.dirtyEnd=0,this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null,-1!==this.currentBase&&this.appState.uniformBuffers[this.currentBase]===this&&(this.appState.uniformBuffers[this.currentBase]=null)),this}bind(t){let e=this.appState.uniformBuffers[t];return e!==this&&(e&&(e.currentBase=-1),-1!==this.currentBase&&(this.appState.uniformBuffers[this.currentBase]=null),this.gl.bindBufferBase(this.gl.UNIFORM_BUFFER,t,this.buffer),this.appState.uniformBuffers[t]=this,this.currentBase=t),this}}class I{constructor(t,e){this.gl=t,this.appState=e,this.vertexArray=null,this.indexType=null,this.indexed=!1,this.numElements=0,this.numInstances=1,this.offsets=0,this.numDraws=1}restore(){return this.appState.vertexArray===this&&(this.appState.vertexArray=null),null!==this.vertexArray&&(this.vertexArray=this.gl.createVertexArray()),this}vertexAttributeBuffer(t,e,r=l){return this.attributeBuffer(t,e,r,!1),this}instanceAttributeBuffer(t,e,r=l){return this.attributeBuffer(t,e,r,!0),this}indexBuffer(t){return null===this.vertexArray&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.buffer),this.numElements=3*t.numItems,this.indexType=t.type,this.indexed=!0,this}delete(){return this.vertexArray&&(this.gl.deleteVertexArray(this.vertexArray),this.vertexArray=null,this.appState.vertexArray===this&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null)),this}bind(){return this.appState.vertexArray!==this&&(this.gl.bindVertexArray(this.vertexArray),this.appState.vertexArray=this),this}attributeBuffer(t,e,r={},o){null===this.vertexArray&&(this.vertexArray=this.gl.createVertexArray()),this.bind(),this.gl.bindBuffer(n.ARRAY_BUFFER,e.buffer);let{type:a=e.type,size:s=e.itemSize,stride:u=0,offset:l=0,normalized:c=!1,integer:h=Boolean(e.integer&&!c)}=r,p=e.numColumns;0===u&&(u=p*s*i[a]);for(let e=0;e<p;++e)h?this.gl.vertexAttribIPointer(t+e,s,a,u,l+e*s*i[a]):this.gl.vertexAttribPointer(t+e,s,a,c,u,l+e*s*i[a]),o&&this.gl.vertexAttribDivisor(t+e,1),this.gl.enableVertexAttribArray(t+e);return 1===this.numDraws&&(o?this.numInstances=e.numItems:this.numElements=this.numElements||e.numItems),this.gl.bindBuffer(n.ARRAY_BUFFER,null),this}}const C={[n.BYTE]:!0,[n.UNSIGNED_BYTE]:!0,[n.SHORT]:!0,[n.UNSIGNED_SHORT]:!0,[n.INT]:!0,[n.UNSIGNED_INT]:!0};class P{constructor(t,e,r,o,a,s=t.STATIC_DRAW,u){let l,c,h;switch(r){case n.FLOAT_MAT4:case n.FLOAT_MAT4x2:case n.FLOAT_MAT4x3:l=4;break;case n.FLOAT_MAT3:case n.FLOAT_MAT3x2:case n.FLOAT_MAT3x4:l=3;break;case n.FLOAT_MAT2:case n.FLOAT_MAT2x3:case n.FLOAT_MAT2x4:l=2;break;default:l=1}switch(r){case n.FLOAT_MAT4:case n.FLOAT_MAT3x4:case n.FLOAT_MAT2x4:o=4,r=n.FLOAT;break;case n.FLOAT_MAT3:case n.FLOAT_MAT4x3:case n.FLOAT_MAT2x3:o=3,r=n.FLOAT;break;case n.FLOAT_MAT2:case n.FLOAT_MAT3x2:case n.FLOAT_MAT4x2:o=2,r=n.FLOAT}"number"==typeof a?(c=a,r&&(a*=i[r]),h=a):(c=a.length,h=a.byteLength),this.gl=t,this.buffer=null,this.appState=e,this.type=r,this.itemSize=o,this.numItems=r?c/(o*l):h/o,this.numColumns=l,this.byteLength=h,this.usage=s,this.indexArray=Boolean(u),this.integer=Boolean(C[this.type]),this.binding=this.indexArray?n.ELEMENT_ARRAY_BUFFER:n.ARRAY_BUFFER,this.restore(a)}restore(t){return t||(t=this.byteLength),this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferData(this.binding,t,this.usage),this.gl.bindBuffer(this.binding,null),this}data(t){return this.appState.vertexArray&&(this.gl.bindVertexArray(null),this.appState.vertexArray=null),this.gl.bindBuffer(this.binding,this.buffer),this.gl.bufferSubData(this.binding,0,t),this.gl.bindBuffer(this.binding,null),this}delete(){return this.buffer&&(this.gl.deleteBuffer(this.buffer),this.buffer=null),this}}class D{constructor(t,e){this.canvas=e,this.gl=t,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewportX=0,this.viewportY=0,this.viewportWidth=0,this.viewportHeight=0,this.currentDrawCalls=null,this.emptyFragmentShader=null,this.state={program:null,vertexArray:null,transformFeedback:null,activeTexture:-1,textures:new Array(s.MAX_TEXTURE_UNITS),uniformBuffers:new Array(s.MAX_UNIFORM_BUFFERS),freeUniformBufferBases:[],drawFramebuffer:null,readFramebuffer:null,extensions:{}},this.clearBits=this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT,this.cpuTime=0,this.gpuTime=0,this.viewport(0,0,this.width,this.height),this.contextLostExt=null,this.contextRestoredHandler=null,this.initExtensions(),this.canvas.addEventListener("webglcontextlost",t=>{t.preventDefault()}),this.canvas.addEventListener("webglcontextrestored",()=>{this.initExtensions(),this.contextRestoredHandler&&this.contextRestoredHandler()})}loseContext(){return this.contextLostExt&&this.contextLostExt.loseContext(),this}restoreContext(){return this.contextLostExt&&this.contextLostExt.restoreContext(),this}onContextRestored(t){return this.contextRestoredHandler=t,this}colorMask(t,e,r,n){return this.gl.colorMask(t,e,r,n),this}clearColor(t,e,r,n){return this.gl.clearColor(t,e,r,n),this}clearMask(t){return this.clearBits=t,this}clear(){return this.gl.clear(this.clearBits),this}drawFramebuffer(t){return t.bindForDraw(),this}readFramebuffer(t){return t.bindForRead(),this}defaultDrawFramebuffer(){return null!==this.state.drawFramebuffer&&(this.gl.bindFramebuffer(this.gl.DRAW_FRAMEBUFFER,null),this.state.drawFramebuffer=null),this}defaultReadFramebuffer(){return null!==this.state.readFramebuffer&&(this.gl.bindFramebuffer(this.gl.READ_FRAMEBUFFER,null),this.state.readFramebuffer=null),this}blitFramebuffer(t,e=l){let r=this.state.readFramebuffer,i=this.state.drawFramebuffer,o=r?r.width:this.width,a=r?r.height:this.height,s=i?i.width:this.width,u=i?i.height:this.height,{srcStartX:c=0,srcStartY:h=0,srcEndX:p=o,srcEndY:f=a,dstStartX:d=0,dstStartY:m=0,dstEndX:y=s,dstEndY:_=u,filter:g=n.NEAREST}=e;return this.gl.blitFramebuffer(c,h,p,f,d,m,y,_,t,g),this}depthRange(t,e){return this.gl.depthRange(t,e),this}depthTest(){return this.gl.enable(this.gl.DEPTH_TEST),this}noDepthTest(){return this.gl.disable(this.gl.DEPTH_TEST),this}depthMask(t){return this.gl.depthMask(t),this}depthFunc(t){return this.gl.depthFunc(t),this}blend(){return this.gl.enable(this.gl.BLEND),this}noBlend(){return this.gl.disable(this.gl.BLEND),this}blendFunc(t,e){return this.gl.blendFunc(t,e),this}blendFuncSeparate(t,e,r,n){return this.gl.blendFuncSeparate(t,e,r,n),this}blendEquation(t){return this.gl.blendEquation(t),this}stencilTest(){return this.gl.enable(this.gl.STENCIL_TEST),this}noStencilTest(){return this.gl.disable(this.gl.STENCIL_TEST),this}scissorTest(){return this.gl.enable(this.gl.SCISSOR_TEST),this}noScissorTest(){return this.gl.disable(this.gl.SCISSOR_TEST),this}scissor(t,e,r,n){return this.gl.scissor(t,e,r,n),this}stencilMask(t){return this.gl.stencilMask(t),this}stencilMaskSeparate(t,e){return this.gl.stencilMaskSeparate(t,e),this}stencilFunc(t,e,r){return this.gl.stencilFunc(t,e,r),this}stencilFuncSeparate(t,e,r,n){return this.gl.stencilFuncSeparate(t,e,r,n),this}stencilOp(t,e,r){return this.gl.stencilOp(t,e,r),this}stencilOpSeparate(t,e,r,n){return this.gl.stencilOpSeparate(t,e,r,n),this}rasterize(){return this.gl.disable(this.gl.RASTERIZER_DISCARD),this}noRasterize(){return this.gl.enable(this.gl.RASTERIZER_DISCARD),this}cullBackfaces(){return this.gl.enable(this.gl.CULL_FACE),this}drawBackfaces(){return this.gl.disable(this.gl.CULL_FACE),this}readPixel(t,e,r,i=l){let{format:o=n.RGBA,type:a=n.UNSIGNED_BYTE}=i;return this.gl.readPixels(t,e,1,1,o,a,r),this}viewport(t,e,r,n){return this.viewportWidth===r&&this.viewportHeight===n&&this.viewportX===t&&this.viewportY===e||(this.viewportX=t,this.viewportY=e,this.viewportWidth=r,this.viewportHeight=n,this.gl.viewport(t,e,this.viewportWidth,this.viewportHeight)),this}defaultViewport(){return this.viewport(0,0,this.width,this.height),this}resize(t,e){return this.canvas.width=t,this.canvas.height=e,this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.viewport(0,0,this.width,this.height),this}createProgram(t,e,r){return new A(this.gl,this.state,t,e,r).link().checkLinkage()}createPrograms(...t){return new Promise((e,r)=>{let n=t.length,i=new Array(n),o=new Array(n),a=n;for(let e=0;e<n;++e){let r=t[e];i[e]=new A(this.gl,this.state,r[0],r[1],r[2]),o[e]=i[e]}for(let t=0;t<n;++t)i[t].link();let s=()=>{let t=0;for(let e=0;e<a;++e)if(o[e].checkCompletion()){if(o[e].checkLinkage(),!o[e].linked)return void r(new Error("Program linkage failed"));++t}else o[e-t]=o[e];0==(a-=t)?e(i):requestAnimationFrame(s)};s()})}restorePrograms(...t){return new Promise((e,r)=>{let n=t.length,i=t.slice(),o=n;for(let e=0;e<n;++e)t[e].initialize();for(let e=0;e<n;++e)t[e].link();for(let e=0;e<n;++e)t[e].checkCompletion();let a=()=>{let t=0;for(let e=0;e<o;++e)if(i[e].checkCompletion()){if(i[e].checkLinkage(),!i[e].linked)return void r(new Error("Program linkage failed"));++t}else i[e-t]=i[e];0==(o-=t)?e():requestAnimationFrame(a)};a()})}createShader(t,e){return new y(this.gl,this.state,t,e)}createVertexArray(){return new I(this.gl,this.state)}createTransformFeedback(){return new S(this.gl,this.state)}createVertexBuffer(t,e,r,n){return new P(this.gl,this.state,t,e,r,n)}createMatrixBuffer(t,e,r){return new P(this.gl,this.state,t,0,e,r)}createInterleavedBuffer(t,e,r){return new P(this.gl,this.state,null,t,e,r)}createIndexBuffer(t,e,r,n){return new P(this.gl,this.state,t,e,r,n,!0)}createUniformBuffer(t,e){return new R(this.gl,this.state,t,e)}createTexture2D(t,e,r,n){return"number"==typeof t?(n=r,r=e,e=t,t=null):void 0===r&&(n=e,e=t.width,r=t.height),new f(this.gl,this.state,this.gl.TEXTURE_2D,t,e,r,void 0,!1,n)}createTextureArray(t,e,r,n,i){return"number"==typeof t&&(i=n,n=r,r=e,e=t,t=null),new f(this.gl,this.state,this.gl.TEXTURE_2D_ARRAY,t,e,r,n,!0,i)}createTexture3D(t,e,r,n,i){return"number"==typeof t&&(i=n,n=r,r=e,e=t,t=null),new f(this.gl,this.state,this.gl.TEXTURE_3D,t,e,r,n,!0,i)}createCubemap(t){return new h(this.gl,this.state,t)}createRenderbuffer(t,e,r,n=0){return new d(this.gl,t,e,r,n)}createFramebuffer(){return new m(this.gl,this.state)}createQuery(t){return new T(this.gl,t)}createTimer(){return new M(this.gl)}createDrawCall(t,e,r){return new p(this.gl,this.state,t,e,r)}initExtensions(){this.gl.getExtension("EXT_color_buffer_float"),this.gl.getExtension("OES_texture_float_linear"),this.gl.getExtension("WEBGL_compressed_texture_s3tc"),this.gl.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.gl.getExtension("WEBGL_compressed_texture_etc"),this.gl.getExtension("WEBGL_compressed_texture_astc"),this.gl.getExtension("WEBGL_compressed_texture_pvrtc"),this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.gl.getExtension("EXT_disjoint_timer_query"),this.gl.getExtension("EXT_texture_filter_anisotropic"),this.state.extensions.debugShaders=this.gl.getExtension("WEBGL_debug_shaders"),this.contextLostExt=this.gl.getExtension("WEBGL_lose_context"),this.gl.getExtension("KHR_parallel_shader_compile"),this.state.extensions.multiDrawInstanced=this.gl.getExtension("WEBGL_multi_draw_instanced")}}r.d(e,"PicoGL",function(){return O});let L=!1;const O=Object.assign({version:"0.15.0",WEBGL_INFO:s,createApp(t,e){let r=t.getContext("webgl2",e);return L||(s.MAX_TEXTURE_UNITS=r.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS),s.MAX_UNIFORM_BUFFERS=r.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS),s.MAX_UNIFORMS=Math.min(r.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),r.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS)),s.SAMPLES=r.getParameter(n.SAMPLES),s.VENDOR="(Unknown)",s.RENDERER="(Unknown)",s.FLOAT_RENDER_TARGETS=Boolean(r.getExtension("EXT_color_buffer_float")),s.LINEAR_FLOAT_TEXTURES=Boolean(r.getExtension("OES_texture_float_linear")),s.S3TC_TEXTURES=Boolean(r.getExtension("WEBGL_compressed_texture_s3tc")),s.S3TC_SRGB_TEXTURES=Boolean(r.getExtension("WEBGL_compressed_texture_s3tc_srgb")),s.ETC_TEXTURES=Boolean(r.getExtension("WEBGL_compressed_texture_etc")),s.ASTC_TEXTURES=Boolean(r.getExtension("WEBGL_compressed_texture_astc")),s.PVRTC_TEXTURES=Boolean(r.getExtension("WEBGL_compressed_texture_pvrtc")),s.LOSE_CONTEXT=Boolean(r.getExtension("WEBGL_lose_context")),s.DEBUG_SHADERS=Boolean(r.getExtension("WEBGL_debug_shaders")),s.GPU_TIMER=Boolean(r.getExtension("EXT_disjoint_timer_query_webgl2")||r.getExtension("EXT_disjoint_timer_query")),s.TEXTURE_ANISOTROPY=Boolean(r.getExtension("EXT_texture_filter_anisotropic")),s.MAX_TEXTURE_ANISOTROPY=s.TEXTURE_ANISOTROPY?r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1,s.DEBUG_RENDERER_INFO=Boolean(r.getExtension("WEBGL_debug_renderer_info")),s.DEBUG_RENDERER_INFO&&(s.VENDOR=r.getParameter(n.UNMASKED_VENDOR_WEBGL),s.RENDERER=r.getParameter(n.UNMASKED_RENDERER_WEBGL)),s.PARALLEL_SHADER_COMPILE=Boolean(r.getExtension("KHR_parallel_shader_compile")),s.MULTI_DRAW_INSTANCED=Boolean(r.getExtension("WEBGL_multi_draw_instanced")),L=!0),new D(r,t)}},n)}]).PicoGL},"object"==typeof r&&"object"==typeof e?e.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof r?r.PicoGL=i():n.PicoGL=i()},{}],199:[function(t,e,r){var n=t("icosphere"),i=t("gl-vec3/normalize"),o=t("gl-vec3/scale"),a=t("./lib/fix-wrapped-uvs"),s=t("./lib/fix-pole-uvs");e.exports=function(t,e){t=void 0!==t?t:1;var r,u,l=n(void 0!==(e=e||{}).subdivisions?e.subdivisions:2),c=[],h=[];for(r=0;r<l.positions.length;r++){u=l.positions[r];var p=.5*(-Math.atan2(u[2],-u[0])/Math.PI+1),f=.5+Math.asin(u[1])/Math.PI;h.push([1-p,1-f])}var d={positions:l.positions,cells:l.cells,uvs:h,normals:c};for(s(d),a(d),r=0;r<d.positions.length;r++){var m=i([0,0,0],u=d.positions[r]);c.push(m),o(u,u,t)}return d}},{"./lib/fix-pole-uvs":200,"./lib/fix-wrapped-uvs":201,"gl-vec3/normalize":136,"gl-vec3/scale":142,icosphere:155}],200:[function(t,e,r){function n(t,e){for(var r=0;r<t.length;r++){if(Math.abs(t[r][1]-e)<=1e-4)return r}return-1}e.exports=function(t){var e=t.positions,r=t.cells,i=t.uvs,o=n(e,1),a=n(e,-1);if(-1===o||-1===a)return;for(var s=e.slice(),u=i.slice(),l=s.length-1,c=0;c<r.length;c++){var h=r[c],p=h[0],f=h[1],d=h[2];p===o?m(h,o,f,d):p===a&&m(h,a,f,d)}function m(t,r,n,o){var a=i[n],c=i[o];i[r][0]=(a[0]+c[0])/2,l++,s.push(e[r].slice()),u.push(i[r].slice()),t[0]=l}t.positions=s,t.uvs=u}},{}],201:[function(t,e,r){var n=t("./is-uv-seam"),i=.25,o=.75;e.exports=function(t){for(var e=t.positions,r=t.cells,a=t.uvs,s=e.slice(),u=a.slice(),l={},c=0;c<r.length;c++){var h=r[c],p=h[0],f=h[1],d=h[2];if(n(a,p,f,d)){var m=e[p],y=e[f],_=e[d],g=a[p],v=a[f],x=a[d];g[0]<i&&(p=b(l,p,g,m)),v[0]<i&&(f=b(l,f,v,y)),x[0]<i&&(d=b(l,d,x,_)),h[0]=p,h[1]=f,h[2]=d}}function b(t,e,r,n){if(e in t)return t[e];s.push(n.slice()),u.push(r.slice());var i=s.length-1;return t[e]=i,i}(function(t,e){for(var r=0;r<t.length;r++){var n=t[r],a=e[n[0]],s=e[n[1]],u=e[n[2]],l=Math.max(a[0],s[0],u[0]),c=Math.min(a[0],s[0],u[0]);l>o&&c<i&&(a[0]<i&&(a[0]+=1),s[0]<i&&(s[0]+=1),u[0]<i&&(u[0]+=1))}})(r,u),t.positions=s,t.uvs=u}},{"./is-uv-seam":202}],202:[function(t,e,r){var n=t("gl-vec2/cross"),i=t("gl-vec2/subtract"),o=[0,0,0],a=[0,0,0];e.exports=function(t,e,r,s){var u=t[e],l=t[s];return i(o,t[r],u),i(a,l,u),n(o,o,a),o[2]<0}},{"gl-vec2/cross":68,"gl-vec2/subtract":103}],203:[function(t,e,r){e.exports=t("gl-quat/slerp")},{"gl-quat/slerp":62}],204:[function(t,e,r){var n,i;n=this,i=function(){function t(t,e){this.id=V++,this.type=t,this.data=e}function e(t){return"["+function t(e){if(0===e.length)return[];var r=e.charAt(0),n=e.charAt(e.length-1);if(1<e.length&&r===n&&('"'===r||"'"===r))return['"'+e.substr(1,e.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e))return t(e.substr(0,r.index)).concat(t(r[1])).concat(t(e.substr(r.index+r[0].length)));if(1===(r=e.split(".")).length)return['"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(e=[],n=0;n<r.length;++n)e=e.concat(t(r[n]));return e}(t).join("][")+"]"}function r(t){return"string"==typeof t?t.split():t}function n(t){return"string"==typeof t?document.querySelector(t):t}function i(t){var e,i,o,a,s=t||{};t={};var u=[],l=[],c="undefined"==typeof window?1:window.devicePixelRatio,h=!1,p=function(t){},f=function(){};if("string"==typeof s?e=document.querySelector(s):"object"==typeof s&&("string"==typeof s.nodeName&&"function"==typeof s.appendChild&&"function"==typeof s.getBoundingClientRect?e=s:"function"==typeof s.drawArrays||"function"==typeof s.drawElements?o=(a=s).canvas:("gl"in s?a=s.gl:"canvas"in s?o=n(s.canvas):"container"in s&&(i=n(s.container)),"attributes"in s&&(t=s.attributes),"extensions"in s&&(u=r(s.extensions)),"optionalExtensions"in s&&(l=r(s.optionalExtensions)),"onDone"in s&&(p=s.onDone),"profile"in s&&(h=!!s.profile),"pixelRatio"in s&&(c=+s.pixelRatio))),e&&("canvas"===e.nodeName.toLowerCase()?o=e:i=e),!a){if(!o){if(!(e=function(t,e,r){function n(){var e=window.innerWidth,n=window.innerHeight;t!==document.body&&(e=(n=t.getBoundingClientRect()).right-n.left,n=n.bottom-n.top),i.width=r*e,i.height=r*n,U(i.style,{width:e+"px",height:n+"px"})}var i=document.createElement("canvas");return U(i.style,{border:0,margin:0,padding:0,top:0,left:0}),t.appendChild(i),t===document.body&&(i.style.position="absolute",U(t.style,{margin:0,padding:0})),window.addEventListener("resize",n,!1),n(),{canvas:i,onDestroy:function(){window.removeEventListener("resize",n),t.removeChild(i)}}}(i||document.body,0,c)))return null;o=e.canvas,f=e.onDestroy}a=function(t,e){function r(r){try{return t.getContext(r,e)}catch(t){return null}}return r("webgl")||r("experimental-webgl")||r("webgl-experimental")}(o,t)}return a?{gl:a,canvas:o,container:i,extensions:u,optionalExtensions:l,pixelRatio:c,profile:h,onDone:p,onDestroy:f}:(f(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function o(t,e){for(var r=Array(t),n=0;n<t;++n)r[n]=e(n);return r}function a(t){var e,r;return e=(65535<t)<<4,e|=r=(255<(t>>>=e))<<3,(e|=r=(15<(t>>>=r))<<2)|(r=(3<(t>>>=r))<<1)|t>>>r>>1}function s(){function t(t){t:{for(var e=16;268435456>=e;e*=16)if(t<=e){t=e;break t}t=0}return 0<(e=r[a(t)>>2]).length?e.pop():new ArrayBuffer(t)}function e(t){r[a(t.byteLength)>>2].push(t)}var r=o(8,function(){return[]});return{alloc:t,free:e,allocType:function(e,r){var n=null;switch(e){case 5120:n=new Int8Array(t(r),0,r);break;case 5121:n=new Uint8Array(t(r),0,r);break;case 5122:n=new Int16Array(t(2*r),0,r);break;case 5123:n=new Uint16Array(t(2*r),0,r);break;case 5124:n=new Int32Array(t(4*r),0,r);break;case 5125:n=new Uint32Array(t(4*r),0,r);break;case 5126:n=new Float32Array(t(4*r),0,r);break;default:return null}return n.length!==r?n.subarray(0,r):n},freeType:function(t){e(t.buffer)}}}function u(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||Y(t.data))}function l(t,e,r,n,i,o){for(var a=0;a<e;++a)for(var s=t[a],u=0;u<r;++u)for(var l=s[u],c=0;c<n;++c)i[o++]=l[c]}function c(t){return 0|K[Object.prototype.toString.call(t)]}function h(t,e){for(var r=0;r<e.length;++r)t[r]=e[r]}function p(t,e,r,n,i,o,a){for(var s=0,u=0;u<r;++u)for(var l=0;l<n;++l)t[s++]=e[i*u+o*l+a]}function f(t,e,r,n){function i(e){this.id=l++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,r.profile&&(this.stats={size:0})}function o(e,r,n){e.byteLength=r.byteLength,t.bufferData(e.type,r,n)}function a(t,e,r,n,i,a){if(t.usage=r,Array.isArray(e)){if(t.dtype=n||5126,0<e.length)if(Array.isArray(e[0])){i=tt(e);for(var s=n=1;s<i.length;++s)n*=i[s];t.dimension=n,o(t,e=$(e,i,t.dtype),r),a?t.persistentData=e:H.freeType(e)}else"number"==typeof e[0]?(t.dimension=i,h(i=H.allocType(t.dtype,e.length),e),o(t,i,r),a?t.persistentData=i:H.freeType(i)):Y(e[0])&&(t.dimension=e[0].length,t.dtype=n||c(e[0])||5126,o(t,e=$(e,[e.length,e[0].length],t.dtype),r),a?t.persistentData=e:H.freeType(e))}else if(Y(e))t.dtype=n||c(e),t.dimension=i,o(t,e,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(e.buffer)));else if(u(e)){var l=e.stride,f=(s=e.offset,0),d=0,m=0,y=0;1===(i=e.shape).length?(f=i[0],d=1,m=l[0],y=0):2===i.length&&(f=i[0],d=i[1],m=l[0],y=l[1]),t.dtype=n||c(e.data)||5126,t.dimension=d,p(i=H.allocType(t.dtype,f*d),e.data,f,d,m,y,s),o(t,i,r),a?t.persistentData=i:H.freeType(i)}}function s(r){e.bufferCount--;for(var i=0;i<n.state.length;++i){var o=n.state[i];o.buffer===r&&(t.disableVertexAttribArray(i),o.buffer=null)}t.deleteBuffer(r.buffer),r.buffer=null,delete f[r.id]}var l=0,f={};i.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},i.prototype.destroy=function(){s(this)};var d=[];return r.profile&&(e.getTotalBufferSize=function(){var t=0;return Object.keys(f).forEach(function(e){t+=f[e].stats.size}),t}),{create:function(n,o,l,d){function m(e){var n=35044,i=null,o=0,s=0,l=1;return Array.isArray(e)||Y(e)||u(e)?i=e:"number"==typeof e?o=0|e:e&&("data"in e&&(i=e.data),"usage"in e&&(n=Q[e.usage]),"type"in e&&(s=J[e.type]),"dimension"in e&&(l=0|e.dimension),"length"in e&&(o=0|e.length)),y.bind(),i?a(y,i,n,s,l,d):(o&&t.bufferData(y.type,o,n),y.dtype=s||5121,y.usage=n,y.dimension=l,y.byteLength=o),r.profile&&(y.stats.size=y.byteLength*et[y.dtype]),m}e.bufferCount++;var y=new i(o);return f[y.id]=y,l||m(n),m._reglType="buffer",m._buffer=y,m.subdata=function(e,r){var n,i=0|(r||0);if(y.bind(),Y(e))t.bufferSubData(y.type,i,e);else if(Array.isArray(e)){if(0<e.length)if("number"==typeof e[0]){var o=H.allocType(y.dtype,e.length);h(o,e),t.bufferSubData(y.type,i,o),H.freeType(o)}else(Array.isArray(e[0])||Y(e[0]))&&(n=tt(e),o=$(e,n,y.dtype),t.bufferSubData(y.type,i,o),H.freeType(o))}else if(u(e)){var a=e.stride,s=o=0,l=0,f=0;1===(n=e.shape).length?(o=n[0],s=1,l=a[0],f=0):2===n.length&&(o=n[0],s=n[1],l=a[0],f=a[1]),n=Array.isArray(e.data)?y.dtype:c(e.data),p(n=H.allocType(n,o*s),e.data,o,s,l,f,e.offset),t.bufferSubData(y.type,i,n),H.freeType(n)}return m},r.profile&&(m.stats=y.stats),m.destroy=function(){s(y)},m},createStream:function(t,e){var r=d.pop();return r||(r=new i(t)),r.bind(),a(r,e,35040,0,1,!1),r},destroyStream:function(t){d.push(t)},clear:function(){Z(f).forEach(s),d.forEach(s)},getBuffer:function(t){return t&&t._buffer instanceof i?t._buffer:null},restore:function(){Z(f).forEach(function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:a}}function d(t,e,r,n){function i(t){this.id=l++,s[this.id]=this,this.buffer=t,this.primType=4,this.type=this.vertCount=0}function o(n,i,o,a,s,l,c){if(n.buffer.bind(),i){var h=c;c||Y(i)&&(!u(i)||Y(i.data))||(h=e.oes_element_index_uint?5125:5123),r._initBuffer(n.buffer,i,o,h,3)}else t.bufferData(34963,l,o),n.buffer.dtype=h||5121,n.buffer.usage=o,n.buffer.dimension=3,n.buffer.byteLength=l;if(h=c,!c){switch(n.buffer.dtype){case 5121:case 5120:h=5121;break;case 5123:case 5122:h=5123;break;case 5125:case 5124:h=5125}n.buffer.dtype=h}n.type=h,0>(i=s)&&(i=n.buffer.byteLength,5123===h?i>>=1:5125===h&&(i>>=2)),n.vertCount=i,i=a,0>a&&(i=4,1===(a=n.buffer.dimension)&&(i=0),2===a&&(i=1),3===a&&(i=4)),n.primType=i}function a(t){n.elementsCount--,delete s[t.id],t.buffer.destroy(),t.buffer=null}var s={},l=0,c={uint8:5121,uint16:5123};e.oes_element_index_uint&&(c.uint32=5125),i.prototype.bind=function(){this.buffer.bind()};var h=[];return{create:function(t,e){function s(t){if(t)if("number"==typeof t)l(t),h.primType=4,h.vertCount=0|t,h.type=5121;else{var e=null,r=35044,n=-1,i=-1,a=0,p=0;Array.isArray(t)||Y(t)||u(t)?e=t:("data"in t&&(e=t.data),"usage"in t&&(r=Q[t.usage]),"primitive"in t&&(n=rt[t.primitive]),"count"in t&&(i=0|t.count),"type"in t&&(p=c[t.type]),"length"in t?a=0|t.length:(a=i,5123===p||5122===p?a*=2:5125!==p&&5124!==p||(a*=4))),o(h,e,r,n,i,a,p)}else l(),h.primType=4,h.vertCount=0,h.type=5121;return s}var l=r.create(null,34963,!0),h=new i(l._buffer);return n.elementsCount++,s(t),s._reglType="elements",s._elements=h,s.subdata=function(t,e){return l.subdata(t,e),s},s.destroy=function(){a(h)},s},createStream:function(t){var e=h.pop();return e||(e=new i(r.create(null,34963,!0,!1)._buffer)),o(e,t,35040,-1,-1,0,0),e},destroyStream:function(t){h.push(t)},getElements:function(t){return"function"==typeof t&&t._elements instanceof i?t._elements:null},clear:function(){Z(s).forEach(a)}}}function m(t){for(var e=H.allocType(5123,t.length),r=0;r<t.length;++r)if(isNaN(t[r]))e[r]=65535;else if(Infinity===t[r])e[r]=31744;else if(-Infinity===t[r])e[r]=64512;else{nt[0]=t[r];var n=(o=it[0])>>>31<<15,i=(o<<1>>>24)-127,o=o>>13&1023;e[r]=-24>i?n:-14>i?n+(o+1024>>-14-i):15<i?n+31744:n+(i+15<<10)+o}return e}function y(t){return Array.isArray(t)||Y(t)}function _(t){return"[object "+t+"]"}function g(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function v(t){return!(!Array.isArray(t)||0===t.length||!y(t[0]))}function x(t){return Object.prototype.toString.call(t)}function b(t){if(!t)return!1;var e=x(t);return 0<=ft.indexOf(e)||(g(t)||v(t)||u(t))}function w(t,e){36193===t.type?(t.data=m(e),H.freeType(e)):t.data=e}function E(t,e,r,n,i,o){if(t=void 0!==mt[t]?mt[t]:st[t]*dt[e],o&&(t*=6),i){for(n=0;1<=r;)n+=t*r*r,r/=2;return n}return t*r*n}function A(t,e,r,n,i,o,a){function s(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function l(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function c(t,e){if("object"==typeof e&&e){"premultiplyAlpha"in e&&(t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(t.flipY=e.flipY),"alignment"in e&&(t.unpackAlignment=e.alignment),"colorSpace"in e&&(t.colorSpace=G[e.colorSpace]),"type"in e&&(t.type=q[e.type]);var r=t.width,n=t.height,i=t.channels,o=!1;"shape"in e?(r=e.shape[0],n=e.shape[1],3===e.shape.length&&(i=e.shape[2],o=!0)):("radius"in e&&(r=n=e.radius),"width"in e&&(r=e.width),"height"in e&&(n=e.height),"channels"in e&&(i=e.channels,o=!0)),t.width=0|r,t.height=0|n,t.channels=0|i,r=!1,"format"in e&&(n=t.internalformat=X[r=e.format],t.format=ft[n],r in q&&!("type"in e)&&(t.type=q[r]),r in J&&(t.compressed=!0),r=!0),!o&&r?t.channels=st[t.format]:o&&!r&&t.channels!==at[t.format]&&(t.format=t.internalformat=at[t.channels])}}function h(e){t.pixelStorei(37440,e.flipY),t.pixelStorei(37441,e.premultiplyAlpha),t.pixelStorei(37443,e.colorSpace),t.pixelStorei(3317,e.unpackAlignment)}function p(){s.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function f(t,e){var r=null;if(b(e)?r=e:e&&(c(t,e),"x"in e&&(t.xOffset=0|e.x),"y"in e&&(t.yOffset=0|e.y),b(e.data)&&(r=e.data)),e.copy){var n=i.viewportWidth,o=i.viewportHeight;t.width=t.width||n-t.xOffset,t.height=t.height||o-t.yOffset,t.needsCopy=!0}else if(r){if(Y(r))t.channels=t.channels||4,t.data=r,"type"in e||5121!==t.type||(t.type=0|K[Object.prototype.toString.call(r)]);else if(g(r)){switch(t.channels=t.channels||4,o=(n=r).length,t.type){case 5121:case 5123:case 5125:case 5126:(o=H.allocType(t.type,o)).set(n),t.data=o;break;case 36193:t.data=m(n)}t.alignment=1,t.needsFree=!0}else if(u(r)){n=r.data,Array.isArray(n)||5121!==t.type||(t.type=0|K[Object.prototype.toString.call(n)]);var a,s,l,h,p=r.stride;3===(o=r.shape).length?(l=o[2],h=p[2]):h=l=1,a=o[0],s=o[1],o=p[0],p=p[1],t.alignment=1,t.width=a,t.height=s,t.channels=l,t.format=t.internalformat=at[l],t.needsFree=!0,a=h,r=r.offset;for(var f=H.allocType(36193===t.type?5126:t.type,(l=t.width)*(h=t.height)*(s=t.channels)),d=0,_=0;_<h;++_)for(var E=0;E<l;++E)for(var A=0;A<s;++A)f[d++]=n[o*E+p*_+a*A+r];w(t,f)}else if(x(r)===ut||x(r)===lt)t.element=x(r)===ut?r:r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(x(r)===ct)t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(x(r)===ht)t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(x(r)===pt)t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(v(r)){for(n=t.width||r[0].length,o=t.height||r.length,p=t.channels,p=y(r[0][0])?p||r[0][0].length:p||1,a=W.shape(r),l=1,h=0;h<a.length;++h)l*=a[h];l=H.allocType(36193===t.type?5126:t.type,l),W.flatten(r,a,"",l),w(t,l),t.alignment=1,t.width=n,t.height=o,t.channels=p,t.format=t.internalformat=at[p],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4}function d(e,r,i,o,a){var s=e.element,u=e.data,l=e.internalformat,c=e.format,p=e.type,f=e.width,d=e.height;h(e),s?t.texSubImage2D(r,a,i,o,c,p,s):e.compressed?t.compressedTexSubImage2D(r,a,i,o,l,f,d,u):e.needsCopy?(n(),t.copyTexSubImage2D(r,a,i,o,e.xOffset,e.yOffset,f,d)):t.texSubImage2D(r,a,i,o,f,d,c,p,u)}function _(){return dt.pop()||new p}function A(t){t.needsFree&&H.freeType(t.data),p.call(t),dt.push(t)}function T(){s.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function M(t,e,r){var n=t.images[0]=_();t.mipmask=1,n.width=t.width=e,n.height=t.height=r,n.channels=t.channels=4}function S(t,e){var r=null;if(b(e))l(r=t.images[0]=_(),t),f(r,e),t.mipmask=1;else if(c(t,e),Array.isArray(e.mipmap))for(var n=e.mipmap,i=0;i<n.length;++i)l(r=t.images[i]=_(),t),r.width>>=i,r.height>>=i,f(r,n[i]),t.mipmask|=1<<i;else l(r=t.images[0]=_(),t),f(r,e),t.mipmask=1;l(t,t.images[0])}function R(e,r){for(var i=e.images,o=0;o<i.length&&i[o];++o){var a=i[o],s=r,u=o,l=a.element,c=a.data,p=a.internalformat,f=a.format,d=a.type,m=a.width,y=a.height,_=a.channels;h(a),l?t.texImage2D(s,u,f,f,d,l):a.compressed?t.compressedTexImage2D(s,u,p,m,y,0,c):a.needsCopy?(n(),t.copyTexImage2D(s,u,f,a.xOffset,a.yOffset,m,y,0)):((a=!c)&&(c=H.zero.allocType(d,m*y*_)),t.texImage2D(s,u,f,m,y,0,f,d,c),a&&c&&H.zero.freeType(c))}}function I(){var t=mt.pop()||new T;s.call(t);for(var e=t.mipmask=0;16>e;++e)t.images[e]=null;return t}function C(t){for(var e=t.images,r=0;r<e.length;++r)e[r]&&A(e[r]),e[r]=null;mt.push(t)}function P(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function D(t,e){"min"in e&&(t.minFilter=j[e.min],0<=ot.indexOf(t.minFilter)&&!("faces"in e)&&(t.genMipmaps=!0)),"mag"in e&&(t.magFilter=V[e.mag]);var r=t.wrapS,n=t.wrapT;if("wrap"in e){var i=e.wrap;"string"==typeof i?r=n=z[i]:Array.isArray(i)&&(r=z[i[0]],n=z[i[1]])}else"wrapS"in e&&(r=z[e.wrapS]),"wrapT"in e&&(n=z[e.wrapT]);if(t.wrapS=r,t.wrapT=n,"anisotropic"in e&&(t.anisotropic=e.anisotropic),"mipmap"in e){switch(r=!1,typeof e.mipmap){case"string":t.mipmapHint=N[e.mipmap],r=t.genMipmaps=!0;break;case"boolean":r=t.genMipmaps=e.mipmap;break;case"object":t.genMipmaps=!1,r=!0}!r||"min"in e||(t.minFilter=9984)}}function L(r,n){t.texParameteri(n,10241,r.minFilter),t.texParameteri(n,10240,r.magFilter),t.texParameteri(n,10242,r.wrapS),t.texParameteri(n,10243,r.wrapT),e.ext_texture_filter_anisotropic&&t.texParameteri(n,34046,r.anisotropic),r.genMipmaps&&(t.hint(33170,r.mipmapHint),t.generateMipmap(n))}function O(e){s.call(this),this.mipmask=0,this.internalformat=6408,this.id=yt++,this.refCount=1,this.target=e,this.texture=t.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new P,a.profile&&(this.stats={size:0})}function k(e){t.activeTexture(33984),t.bindTexture(e.target,e.texture)}function F(){var e=vt[0];e?t.bindTexture(e.target,e.texture):t.bindTexture(3553,null)}function B(e){var r=e.texture,n=e.unit,i=e.target;0<=n&&(t.activeTexture(33984+n),t.bindTexture(i,null),vt[n]=null),t.deleteTexture(r),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete _t[e.id],o.textureCount--}var N={"don't care":4352,"dont care":4352,nice:4354,fast:4353},z={repeat:10497,clamp:33071,mirror:33648},V={nearest:9728,linear:9729},j=U({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},V),G={none:0,browser:37444},q={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},X={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},J={};e.ext_srgb&&(X.srgb=35904,X.srgba=35906),e.oes_texture_float&&(q.float32=q.float=5126),e.oes_texture_half_float&&(q.float16=q["half float"]=36193),e.webgl_depth_texture&&(U(X,{depth:6402,"depth stencil":34041}),U(q,{uint16:5123,uint32:5125,"depth stencil":34042})),e.webgl_compressed_texture_s3tc&&U(J,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),e.webgl_compressed_texture_atc&&U(J,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),e.webgl_compressed_texture_pvrtc&&U(J,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),e.webgl_compressed_texture_etc1&&(J["rgb etc1"]=36196);var Q=Array.prototype.slice.call(t.getParameter(34467));Object.keys(J).forEach(function(t){var e=J[t];0<=Q.indexOf(e)&&(X[t]=e)});var $=Object.keys(X);r.textureFormats=$;var tt=[];Object.keys(X).forEach(function(t){tt[X[t]]=t});var et=[];Object.keys(q).forEach(function(t){et[q[t]]=t});var rt=[];Object.keys(V).forEach(function(t){rt[V[t]]=t});var nt=[];Object.keys(j).forEach(function(t){nt[j[t]]=t});var it=[];Object.keys(z).forEach(function(t){it[z[t]]=t});var ft=$.reduce(function(t,e){var r=X[e];return t[r]=6409===r||6406===r||6409===r||6410===r||6402===r||34041===r?r:32855===r||0<=e.indexOf("rgba")?6408:6407,t},{}),dt=[],mt=[],yt=0,_t={},gt=r.maxTextureUnits,vt=Array(gt).map(function(){return null});return U(O.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(0>e){for(var r=0;r<gt;++r){var n=vt[r];if(n){if(0<n.bindCount)continue;n.unit=-1}vt[r]=this,e=r;break}a.profile&&o.maxTextureUnits<e+1&&(o.maxTextureUnits=e+1),this.unit=e,t.activeTexture(33984+e),t.bindTexture(this.target,this.texture)}return e},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&B(this)}}),a.profile&&(o.getTotalTextureSize=function(){var t=0;return Object.keys(_t).forEach(function(e){t+=_t[e].stats.size}),t}),{create2D:function(e,r){function n(t,e){var r=i.texInfo;P.call(r);var o=I();return"number"==typeof t?M(o,0|t,"number"==typeof e?0|e:0|t):t?(D(r,t),S(o,t)):M(o,1,1),r.genMipmaps&&(o.mipmask=(o.width<<1)-1),i.mipmask=o.mipmask,l(i,o),i.internalformat=o.internalformat,n.width=o.width,n.height=o.height,k(i),R(o,3553),L(r,3553),F(),C(o),a.profile&&(i.stats.size=E(i.internalformat,i.type,o.width,o.height,r.genMipmaps,!1)),n.format=tt[i.internalformat],n.type=et[i.type],n.mag=rt[r.magFilter],n.min=nt[r.minFilter],n.wrapS=it[r.wrapS],n.wrapT=it[r.wrapT],n}var i=new O(3553);return _t[i.id]=i,o.textureCount++,n(e,r),n.subimage=function(t,e,r,o){e|=0,r|=0,o|=0;var a=_();return l(a,i),a.width=0,a.height=0,f(a,t),a.width=a.width||(i.width>>o)-e,a.height=a.height||(i.height>>o)-r,k(i),d(a,3553,e,r,o),F(),A(a),n},n.resize=function(e,r){var o=0|e,s=0|r||o;if(o===i.width&&s===i.height)return n;n.width=i.width=o,n.height=i.height=s,k(i);for(var u,l=i.channels,c=i.type,h=0;i.mipmask>>h;++h){var p=o>>h,f=s>>h;if(!p||!f)break;u=H.zero.allocType(c,p*f*l),t.texImage2D(3553,h,i.format,p,f,0,i.format,i.type,u),u&&H.zero.freeType(u)}return F(),a.profile&&(i.stats.size=E(i.internalformat,i.type,o,s,!1,!1)),n},n._reglType="texture2d",n._texture=i,a.profile&&(n.stats=i.stats),n.destroy=function(){i.decRef()},n},createCube:function(e,r,n,i,s,u){function h(t,e,r,n,i,o){var s,u=p.texInfo;for(P.call(u),s=0;6>s;++s)m[s]=I();if("number"!=typeof t&&t){if("object"==typeof t)if(e)S(m[0],t),S(m[1],e),S(m[2],r),S(m[3],n),S(m[4],i),S(m[5],o);else if(D(u,t),c(p,t),"faces"in t)for(t=t.faces,s=0;6>s;++s)l(m[s],p),S(m[s],t[s]);else for(s=0;6>s;++s)S(m[s],t)}else for(t=0|t||1,s=0;6>s;++s)M(m[s],t,t);for(l(p,m[0]),p.mipmask=u.genMipmaps?(m[0].width<<1)-1:m[0].mipmask,p.internalformat=m[0].internalformat,h.width=m[0].width,h.height=m[0].height,k(p),s=0;6>s;++s)R(m[s],34069+s);for(L(u,34067),F(),a.profile&&(p.stats.size=E(p.internalformat,p.type,h.width,h.height,u.genMipmaps,!0)),h.format=tt[p.internalformat],h.type=et[p.type],h.mag=rt[u.magFilter],h.min=nt[u.minFilter],h.wrapS=it[u.wrapS],h.wrapT=it[u.wrapT],s=0;6>s;++s)C(m[s]);return h}var p=new O(34067);_t[p.id]=p,o.cubeCount++;var m=Array(6);return h(e,r,n,i,s,u),h.subimage=function(t,e,r,n,i){r|=0,n|=0,i|=0;var o=_();return l(o,p),o.width=0,o.height=0,f(o,e),o.width=o.width||(p.width>>i)-r,o.height=o.height||(p.height>>i)-n,k(p),d(o,34069+t,r,n,i),F(),A(o),h},h.resize=function(e){if((e|=0)!==p.width){h.width=p.width=e,h.height=p.height=e,k(p);for(var r=0;6>r;++r)for(var n=0;p.mipmask>>n;++n)t.texImage2D(34069+r,n,p.format,e>>n,e>>n,0,p.format,p.type,null);return F(),a.profile&&(p.stats.size=E(p.internalformat,p.type,h.width,h.height,!1,!0)),h}},h._reglType="textureCube",h._texture=p,a.profile&&(h.stats=p.stats),h.destroy=function(){p.decRef()},h},clear:function(){for(var e=0;e<gt;++e)t.activeTexture(33984+e),t.bindTexture(3553,null),vt[e]=null;Z(_t).forEach(B),o.cubeCount=0,o.textureCount=0},getTexture:function(t){return null},restore:function(){for(var e=0;e<gt;++e){var r=vt[e];r&&(r.bindCount=0,r.unit=-1,vt[e]=null)}Z(_t).forEach(function(e){e.texture=t.createTexture(),t.bindTexture(e.target,e.texture);for(var r=0;32>r;++r)if(0!=(e.mipmask&1<<r))if(3553===e.target)t.texImage2D(3553,r,e.internalformat,e.width>>r,e.height>>r,0,e.internalformat,e.type,null);else for(var n=0;6>n;++n)t.texImage2D(34069+n,r,e.internalformat,e.width>>r,e.height>>r,0,e.internalformat,e.type,null);L(e.texInfo,e.target)})}}}function T(t,e,r,n,i,o){function a(t,e,r){this.target=t,this.texture=e,this.renderbuffer=r;var n=t=0;e?(t=e.width,n=e.height):r&&(t=r.width,n=r.height),this.width=t,this.height=n}function s(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function u(t,e,r){t&&(t.texture?t.texture._texture.refCount+=1:t.renderbuffer._renderbuffer.refCount+=1)}function l(e,r){r&&(r.texture?t.framebufferTexture2D(36160,e,r.target,r.texture._texture.texture,0):t.framebufferRenderbuffer(36160,e,36161,r.renderbuffer._renderbuffer.renderbuffer))}function c(t){var e=3553,r=null,n=null,i=t;return"object"==typeof t&&(i=t.data,"target"in t&&(e=0|t.target)),"texture2d"===(t=i._reglType)?r=i:"textureCube"===t?r=i:"renderbuffer"===t&&(n=i,e=36161),new a(e,r,n)}function h(t,e,r,o,s){return r?((t=n.create2D({width:t,height:e,format:o,type:s}))._texture.refCount=0,new a(3553,t,null)):((t=i.create({width:t,height:e,format:o}))._renderbuffer.refCount=0,new a(36161,null,t))}function p(t){return t&&(t.texture||t.renderbuffer)}function f(t,e,r){t&&(t.texture?t.texture.resize(e,r):t.renderbuffer&&t.renderbuffer.resize(e,r),t.width=e,t.height=r)}function d(){this.id=E++,A[this.id]=this,this.framebuffer=t.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function m(t){t.colorAttachments.forEach(s),s(t.depthAttachment),s(t.stencilAttachment),s(t.depthStencilAttachment)}function y(e){t.deleteFramebuffer(e.framebuffer),e.framebuffer=null,o.framebufferCount--,delete A[e.id]}function _(e){var n;t.bindFramebuffer(36160,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)l(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(36160,36064+n,3553,null,0);t.framebufferTexture2D(36160,33306,3553,null,0),t.framebufferTexture2D(36160,36096,3553,null,0),t.framebufferTexture2D(36160,36128,3553,null,0),l(36096,e.depthAttachment),l(36128,e.stencilAttachment),l(33306,e.depthStencilAttachment),t.checkFramebufferStatus(36160),t.isContextLost(),t.bindFramebuffer(36160,v.next?v.next.framebuffer:null),v.cur=v.next,t.getError()}function g(t,e){function r(t,e){var i,o=0,a=0,s=!0,l=!0;i=null;var f=!0,d="rgba",y="uint8",g=1,v=null,w=null,E=null,A=!1;"number"==typeof t?(o=0|t,a=0|e||o):t?("shape"in t?(o=(a=t.shape)[0],a=a[1]):("radius"in t&&(o=a=t.radius),"width"in t&&(o=t.width),"height"in t&&(a=t.height)),("color"in t||"colors"in t)&&(i=t.color||t.colors,Array.isArray(i)),i||("colorCount"in t&&(g=0|t.colorCount),"colorTexture"in t&&(f=!!t.colorTexture,d="rgba4"),"colorType"in t&&(y=t.colorType,!f)&&("half float"===y||"float16"===y?d="rgba16f":"float"!==y&&"float32"!==y||(d="rgba32f")),"colorFormat"in t&&(0<=x.indexOf(d=t.colorFormat)?f=!0:0<=b.indexOf(d)&&(f=!1))),("depthTexture"in t||"depthStencilTexture"in t)&&(A=!(!t.depthTexture&&!t.depthStencilTexture)),"depth"in t&&("boolean"==typeof t.depth?s=t.depth:(v=t.depth,l=!1)),"stencil"in t&&("boolean"==typeof t.stencil?l=t.stencil:(w=t.stencil,s=!1)),"depthStencil"in t&&("boolean"==typeof t.depthStencil?s=l=t.depthStencil:(E=t.depthStencil,l=s=!1))):o=a=1;var T=null,M=null,S=null,R=null;if(Array.isArray(i))T=i.map(c);else if(i)T=[c(i)];else for(T=Array(g),i=0;i<g;++i)T[i]=h(o,a,f,d,y);for(o=o||T[0].width,a=a||T[0].height,v?M=c(v):s&&!l&&(M=h(o,a,A,"depth","uint32")),w?S=c(w):l&&!s&&(S=h(o,a,!1,"stencil","uint8")),E?R=c(E):!v&&!w&&l&&s&&(R=h(o,a,A,"depth stencil","depth stencil")),s=null,i=0;i<T.length;++i)u(T[i]),T[i]&&T[i].texture&&(l=gt[T[i].texture._texture.format]*vt[T[i].texture._texture.type],null===s&&(s=l));return u(M),u(S),u(R),m(n),n.width=o,n.height=a,n.colorAttachments=T,n.depthAttachment=M,n.stencilAttachment=S,n.depthStencilAttachment=R,r.color=T.map(p),r.depth=p(M),r.stencil=p(S),r.depthStencil=p(R),r.width=n.width,r.height=n.height,_(n),r}var n=new d;return o.framebufferCount++,r(t,e),U(r,{resize:function(t,e){var i=Math.max(0|t,1),o=Math.max(0|e||i,1);if(i===n.width&&o===n.height)return r;for(var a=n.colorAttachments,s=0;s<a.length;++s)f(a[s],i,o);return f(n.depthAttachment,i,o),f(n.stencilAttachment,i,o),f(n.depthStencilAttachment,i,o),n.width=r.width=i,n.height=r.height=o,_(n),r},_reglType:"framebuffer",_framebuffer:n,destroy:function(){y(n),m(n)},use:function(t){v.setFBO({framebuffer:r},t)}})}var v={cur:null,next:null,dirty:!1,setFBO:null},x=["rgba"],b=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&b.push("srgba"),e.ext_color_buffer_half_float&&b.push("rgba16f","rgb16f"),e.webgl_color_buffer_float&&b.push("rgba32f");var w=["uint8"];e.oes_texture_half_float&&w.push("half float","float16"),e.oes_texture_float&&w.push("float","float32");var E=0,A={};return U(v,{getFramebuffer:function(t){return"function"==typeof t&&"framebuffer"===t._reglType&&(t=t._framebuffer)instanceof d?t:null},create:g,createCube:function(t){function e(t){var i,o={color:null},a=0,s=null;i="rgba";var u="uint8",l=1;if("number"==typeof t?a=0|t:t?("shape"in t?a=t.shape[0]:("radius"in t&&(a=0|t.radius),"width"in t?a=0|t.width:"height"in t&&(a=0|t.height)),("color"in t||"colors"in t)&&(s=t.color||t.colors,Array.isArray(s)),s||("colorCount"in t&&(l=0|t.colorCount),"colorType"in t&&(u=t.colorType),"colorFormat"in t&&(i=t.colorFormat)),"depth"in t&&(o.depth=t.depth),"stencil"in t&&(o.stencil=t.stencil),"depthStencil"in t&&(o.depthStencil=t.depthStencil)):a=1,s)if(Array.isArray(s))for(t=[],i=0;i<s.length;++i)t[i]=s[i];else t=[s];else for(t=Array(l),s={radius:a,format:i,type:u},i=0;i<l;++i)t[i]=n.createCube(s);for(o.color=Array(t.length),i=0;i<t.length;++i)l=t[i],a=a||l.width,o.color[i]={target:34069,data:t[i]};for(i=0;6>i;++i){for(l=0;l<t.length;++l)o.color[l].target=34069+i;0<i&&(o.depth=r[0].depth,o.stencil=r[0].stencil,o.depthStencil=r[0].depthStencil),r[i]?r[i](o):r[i]=g(o)}return U(e,{width:a,height:a,color:t})}var r=Array(6);return e(t),U(e,{faces:r,resize:function(t){var n=0|t;if(n===e.width)return e;var i=e.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;6>t;++t)r[t].resize(n);return e.width=e.height=n,e},_reglType:"framebufferCube",destroy:function(){r.forEach(function(t){t.destroy()})}})},clear:function(){Z(A).forEach(y)},restore:function(){v.cur=null,v.next=null,v.dirty=!0,Z(A).forEach(function(e){e.framebuffer=t.createFramebuffer(),_(e)})}})}function M(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function S(t,e,r,n){function i(t,e,r,n){this.name=t,this.id=e,this.location=r,this.info=n}function o(t,e){for(var r=0;r<t.length;++r)if(t[r].id===e.id)return void(t[r].location=e.location);t.push(e)}function a(r,n,i){if(!(a=(i=35632===r?l:c)[n])){var o=e.str(n),a=t.createShader(r);t.shaderSource(a,o),t.compileShader(a),i[n]=a}return a}function s(t,e){this.id=f++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],n.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function u(r,s){var u,l;u=a(35632,r.fragId),l=a(35633,r.vertId);var c=r.program=t.createProgram();t.attachShader(c,u),t.attachShader(c,l),t.linkProgram(c);var h=t.getProgramParameter(c,35718);n.profile&&(r.stats.uniformsCount=h);var p=r.uniforms;for(u=0;u<h;++u)if(l=t.getActiveUniform(c,u))if(1<l.size)for(var f=0;f<l.size;++f){var d=l.name.replace("[0]","["+f+"]");o(p,new i(d,e.id(d),t.getUniformLocation(c,d),l))}else o(p,new i(l.name,e.id(l.name),t.getUniformLocation(c,l.name),l));for(h=t.getProgramParameter(c,35721),n.profile&&(r.stats.attributesCount=h),p=r.attributes,u=0;u<h;++u)(l=t.getActiveAttrib(c,u))&&o(p,new i(l.name,e.id(l.name),t.getAttribLocation(c,l.name),l))}var l={},c={},h={},p=[],f=0;return n.profile&&(r.getMaxUniformsCount=function(){var t=0;return p.forEach(function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)}),t},r.getMaxAttributesCount=function(){var t=0;return p.forEach(function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)}),t}),{clear:function(){var e=t.deleteShader.bind(t);Z(l).forEach(e),l={},Z(c).forEach(e),c={},p.forEach(function(e){t.deleteProgram(e.program)}),p.length=0,h={},r.shaderCount=0},program:function(t,e,n){var i=h[e];i||(i=h[e]={});var o=i[t];return o||(o=new s(e,t),r.shaderCount++,u(o),i[t]=o,p.push(o)),o},restore:function(){l={},c={};for(var t=0;t<p.length;++t)u(p[t])},shader:a,frag:-1,vert:-1}}function R(t,e,r,n,i,o,a){function s(i){var o;o=null===e.next?5121:e.next.colorAttachments[0].texture._texture.type;var a=0,s=0,u=n.framebufferWidth,l=n.framebufferHeight,c=null;return Y(i)?c=i:i&&(a=0|i.x,s=0|i.y,u=0|(i.width||n.framebufferWidth-a),l=0|(i.height||n.framebufferHeight-s),c=i.data||null),r(),i=u*l*4,c||(5121===o?c=new Uint8Array(i):5126===o&&(c=c||new Float32Array(i))),t.pixelStorei(3333,4),t.readPixels(a,s,u,l,6408,o,c),c}return function(t){return t&&"framebuffer"in t?function(t){var r;return e.setFBO({framebuffer:t.framebuffer},function(){r=s(t)}),r}(t):s(t)}}function I(t){return Array.prototype.slice.call(t)}function C(t){return I(t).join("")}function P(){function t(){var t=[],e=[];return U(function(){t.push.apply(t,I(arguments))},{def:function(){var n="v"+r++;return e.push(n),0<arguments.length&&(t.push(n,"="),t.push.apply(t,I(arguments)),t.push(";")),n},toString:function(){return C([0<e.length?"var "+e+";":"",C(t)])}})}function e(){function e(t,e){n(t,e,"=",r.def(t,e),";")}var r=t(),n=t(),i=r.toString,o=n.toString;return U(function(){r.apply(r,I(arguments))},{def:r.def,entry:r,exit:n,save:e,set:function(t,n,i){e(t,n),r(t,n,"=",i,";")},toString:function(){return i()+o()}})}var r=0,n=[],i=[],o=t(),a={};return{global:o,link:function(t){for(var e=0;e<i.length;++e)if(i[e]===t)return n[e];return e="g"+r++,n.push(e),i.push(t),e},block:t,proc:function(t,r){function n(){var t="a"+i.length;return i.push(t),t}var i=[];r=r||0;for(var o=0;o<r;++o)n();var s=(o=e()).toString;return a[t]=U(o,{arg:n,toString:function(){return C(["function(",i.join(),"){",s(),"}"])}})},scope:e,cond:function(){var t=C(arguments),r=e(),n=e(),i=r.toString,o=n.toString;return U(r,{then:function(){return r.apply(r,I(arguments)),this},else:function(){return n.apply(n,I(arguments)),this},toString:function(){var e=o();return e&&(e="else{"+e+"}"),C(["if(",t,"){",i(),"}",e])}})},compile:function(){var t=['"use strict";',o,"return {"];Object.keys(a).forEach(function(e){t.push('"',e,'":',a[e].toString(),",")}),t.push("}");var e=C(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(e)).apply(null,i)}}}function D(t){return Array.isArray(t)||Y(t)||u(t)}function L(t){return t.sort(function(t,e){return"viewport"===t?-1:"viewport"===e?1:t<e?-1:1})}function O(t,e,r,n){this.thisDep=t,this.contextDep=e,this.propDep=r,this.append=n}function k(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function F(t){return new O(!1,!1,!1,t)}function B(t,e){var r=t.type;return 0===r?new O(!0,1<=(r=t.data.length),2<=r,e):4===r?new O((r=t.data).thisDep,r.contextDep,r.propDep,e):new O(3===r,2===r,1===r,e)}function N(t,e,r,n,i,a,s,u,l,c,h,p,f,d,m){function _(t){return t.replace(".","_")}function g(t,e,r){var n=_(t);nt.push(t),et[n]=tt[n]=!!r,it[n]=e}function v(t,e,r){var n=_(t);nt.push(t),Array.isArray(r)?(tt[n]=r.slice(),et[n]=r.slice()):tt[n]=et[n]=r,ot[n]=e}function x(){var t=P(),r=t.link,n=t.global;t.id=ut++,t.batchId="0";var i=r(at),o=t.shared={props:"a0"};Object.keys(at).forEach(function(t){o[t]=n.def(i,".",t)});var a=t.next={},s=t.current={};Object.keys(ot).forEach(function(t){Array.isArray(tt[t])&&(a[t]=n.def(o.next,".",t),s[t]=n.def(o.current,".",t))});var u=t.constants={};Object.keys(st).forEach(function(t){u[t]=n.def(JSON.stringify(st[t]))}),t.invoke=function(e,n){switch(n.type){case 0:var i=["this",o.context,o.props,t.batchId];return e.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return e.def(o.props,n.data);case 2:return e.def(o.context,n.data);case 3:return e.def("this",n.data);case 4:return n.data.append(t,e),n.data.ref}},t.attribCache={};var l={};return t.scopeAttrib=function(t){if((t=e.id(t))in l)return l[t];var n=c.scope[t];return n||(n=c.scope[t]=new W),l[t]=r(n)},t}function b(t,e){var r=t.static,n=t.dynamic;if("framebuffer"in r){var i=r.framebuffer;return i?(i=u.getFramebuffer(i),F(function(t,e){var r=t.link(i),n=t.shared;return e.set(n.framebuffer,".next",r),e.set(n=n.context,".framebufferWidth",r+".width"),e.set(n,".framebufferHeight",r+".height"),r})):F(function(t,e){var r=t.shared;return e.set(r.framebuffer,".next","null"),e.set(r=r.context,".framebufferWidth",r+".drawingBufferWidth"),e.set(r,".framebufferHeight",r+".drawingBufferHeight"),"null"})}if("framebuffer"in n){var o=n.framebuffer;return B(o,function(t,e){var r=t.invoke(e,o),n=t.shared,i=n.framebuffer;r=e.def(i,".getFramebuffer(",r,")");return e.set(i,".next",r),e.set(n=n.context,".framebufferWidth",r+"?"+r+".width:"+n+".drawingBufferWidth"),e.set(n,".framebufferHeight",r+"?"+r+".height:"+n+".drawingBufferHeight"),r})}return null}function w(t){function r(t){if(t in n){var r=e.id(n[t]);return(t=F(function(){return r})).id=r,t}if(t in i){var o=i[t];return B(o,function(t,e){var r=t.invoke(e,o);return e.def(t.shared.strings,".id(",r,")")})}return null}var n=t.static,i=t.dynamic,o=r("frag"),a=r("vert"),s=null;return k(o)&&k(a)?(s=h.program(a.id,o.id),t=F(function(t,e){return t.link(s)})):t=new O(o&&o.thisDep||a&&a.thisDep,o&&o.contextDep||a&&a.contextDep,o&&o.propDep||a&&a.propDep,function(t,e){var r,n,i=t.shared.shader;return r=o?o.append(t,e):e.def(i,".","frag"),n=a?a.append(t,e):e.def(i,".","vert"),e.def(i+".program("+n+","+r+")")}),{frag:o,vert:a,progVar:t,program:s}}function E(t,e){function r(t,e){if(t in n){var r=0|n[t];return F(function(t,n){return e&&(t.OFFSET=r),r})}if(t in i){var a=i[t];return B(a,function(t,r){var n=t.invoke(r,a);return e&&(t.OFFSET=n),n})}return e&&o?F(function(t,e){return t.OFFSET="0",0}):null}var n=t.static,i=t.dynamic,o=function(){if("elements"in n){var t=n.elements;D(t)?t=a.getElements(a.create(t,!0)):t&&(t=a.getElements(t));var e=F(function(e,r){if(t){var n=e.link(t);return e.ELEMENTS=n}return e.ELEMENTS=null});return e.value=t,e}if("elements"in i){var r=i.elements;return B(r,function(t,e){var n=(i=t.shared).isBufferArgs,i=i.elements,o=t.invoke(e,r),a=e.def("null");n=e.def(n,"(",o,")"),o=t.cond(n).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return e.entry(o),e.exit(t.cond(n).then(i,".destroyStream(",a,");")),t.ELEMENTS=a})}return null}(),s=r("offset",!0);return{elements:o,primitive:function(){if("primitive"in n){var t=n.primitive;return F(function(e,r){return rt[t]})}if("primitive"in i){var e=i.primitive;return B(e,function(t,r){var n=t.constants.primTypes,i=t.invoke(r,e);return r.def(n,"[",i,"]")})}return o?k(o)?F(o.value?function(t,e){return e.def(t.ELEMENTS,".primType")}:function(){return 4}):new O(o.thisDep,o.contextDep,o.propDep,function(t,e){var r=t.ELEMENTS;return e.def(r,"?",r,".primType:",4)}):null}(),count:function(){if("count"in n){var t=0|n.count;return F(function(){return t})}if("count"in i){var e=i.count;return B(e,function(t,r){return t.invoke(r,e)})}return o?k(o)?o?s?new O(s.thisDep,s.contextDep,s.propDep,function(t,e){return e.def(t.ELEMENTS,".vertCount-",t.OFFSET)}):F(function(t,e){return e.def(t.ELEMENTS,".vertCount")}):F(function(){return-1}):new O(o.thisDep||s.thisDep,o.contextDep||s.contextDep,o.propDep||s.propDep,function(t,e){var r=t.ELEMENTS;return t.OFFSET?e.def(r,"?",r,".vertCount-",t.OFFSET,":-1"):e.def(r,"?",r,".vertCount:-1")}):null}(),instances:r("instances",!1),offset:s}}function A(t,r){var n=t.static,o=t.dynamic,a={};return Object.keys(n).forEach(function(t){var r=n[t],o=e.id(t),s=new W;if(D(r))s.state=1,s.buffer=i.getBuffer(i.create(r,34962,!1,!0)),s.type=0;else if(l=i.getBuffer(r))s.state=1,s.buffer=l,s.type=0;else if("constant"in r){var u=r.constant;s.buffer="null",s.state=2,"number"==typeof u?s.x=u:xt.forEach(function(t,e){e<u.length&&(s[t]=u[e])})}else{var l=D(r.buffer)?i.getBuffer(i.create(r.buffer,34962,!1,!0)):i.getBuffer(r.buffer),c=0|r.offset,h=0|r.stride,p=0|r.size,f=!!r.normalized,d=0;"type"in r&&(d=J[r.type]),r=0|r.divisor,s.buffer=l,s.state=1,s.size=p,s.normalized=f,s.type=d||l.dtype,s.offset=c,s.stride=h,s.divisor=r}a[t]=F(function(t,e){var r=t.attribCache;if(o in r)return r[o];var n={isStream:!1};return Object.keys(s).forEach(function(t){n[t]=s[t]}),s.buffer&&(n.buffer=t.link(s.buffer),n.type=n.type||n.buffer+".dtype"),r[o]=n})}),Object.keys(o).forEach(function(t){var e=o[t];a[t]=B(e,function(t,r){function n(t){r(u[t],"=",i,".",t,"|0;")}var i=t.invoke(r,e),o=t.shared,a=o.isBufferArgs,s=o.buffer,u={isStream:r.def(!1)},l=new W;l.state=1,Object.keys(l).forEach(function(t){u[t]=r.def(""+l[t])});var c=u.buffer,h=u.type;return r("if(",a,"(",i,")){",u.isStream,"=true;",c,"=",s,".createStream(",34962,",",i,");",h,"=",c,".dtype;","}else{",c,"=",s,".getBuffer(",i,");","if(",c,"){",h,"=",c,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",2,";","if(typeof "+i+'.constant === "number"){',u[xt[0]],"=",i,".constant;",xt.slice(1).map(function(t){return u[t]}).join("="),"=0;","}else{",xt.map(function(t,e){return u[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"}).join(""),"}}else{","if(",a,"(",i,".buffer)){",c,"=",s,".createStream(",34962,",",i,".buffer);","}else{",c,"=",s,".getBuffer(",i,".buffer);","}",h,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",c,".dtype;",u.normalized,"=!!",i,".normalized;"),n("size"),n("offset"),n("stride"),n("divisor"),r("}}"),r.exit("if(",u.isStream,"){",s,".destroyStream(",c,");","}"),u})}),a}function T(t,e,r,n,i){var a=b(t),s=function(t,e,r){function n(t){if(t in i){var r=i[t];t=!0;var n,a,s=0|r.x,u=0|r.y;return"width"in r?n=0|r.width:t=!1,"height"in r?a=0|r.height:t=!1,new O(!t&&e&&e.thisDep,!t&&e&&e.contextDep,!t&&e&&e.propDep,function(t,e){var i=t.shared.context,o=n;"width"in r||(o=e.def(i,".","framebufferWidth","-",s));var l=a;return"height"in r||(l=e.def(i,".","framebufferHeight","-",u)),[s,u,o,l]})}if(t in o){var l=o[t];return t=B(l,function(t,e){var r=t.invoke(e,l),n=t.shared.context,i=e.def(r,".x|0"),o=e.def(r,".y|0");return[i,o,e.def('"width" in ',r,"?",r,".width|0:","(",n,".","framebufferWidth","-",i,")"),r=e.def('"height" in ',r,"?",r,".height|0:","(",n,".","framebufferHeight","-",o,")")]}),e&&(t.thisDep=t.thisDep||e.thisDep,t.contextDep=t.contextDep||e.contextDep,t.propDep=t.propDep||e.propDep),t}return e?new O(e.thisDep,e.contextDep,e.propDep,function(t,e){var r=t.shared.context;return[0,0,e.def(r,".","framebufferWidth"),e.def(r,".","framebufferHeight")]}):null}var i=t.static,o=t.dynamic;if(t=n("viewport")){var a=t;t=new O(t.thisDep,t.contextDep,t.propDep,function(t,e){var r=a.append(t,e),n=t.shared.context;return e.set(n,".viewportWidth",r[2]),e.set(n,".viewportHeight",r[3]),r})}return{viewport:t,scissor_box:n("scissor.box")}}(t,a),u=E(t),l=function(t,e){var r=t.static,n=t.dynamic,i={};return nt.forEach(function(t){function e(e,o){if(t in r){var s=e(r[t]);i[a]=F(function(){return s})}else if(t in n){var u=n[t];i[a]=B(u,function(t,e){return o(t,e,t.invoke(e,u))})}}var a=_(t);switch(t){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return e(function(t){return t},function(t,e,r){return r});case"depth.func":return e(function(t){return Et[t]},function(t,e,r){return e.def(t.constants.compareFuncs,"[",r,"]")});case"depth.range":return e(function(t){return t},function(t,e,r){return[e.def("+",r,"[0]"),e=e.def("+",r,"[1]")]});case"blend.func":return e(function(t){return[wt["srcRGB"in t?t.srcRGB:t.src],wt["dstRGB"in t?t.dstRGB:t.dst],wt["srcAlpha"in t?t.srcAlpha:t.src],wt["dstAlpha"in t?t.dstAlpha:t.dst]]},function(t,e,r){function n(t,n){return e.def('"',t,n,'" in ',r,"?",r,".",t,n,":",r,".",t)}t=t.constants.blendFuncs;var i=n("src","RGB"),o=n("dst","RGB"),a=(i=e.def(t,"[",i,"]"),e.def(t,"[",n("src","Alpha"),"]"));return[i,o=e.def(t,"[",o,"]"),a,t=e.def(t,"[",n("dst","Alpha"),"]")]});case"blend.equation":return e(function(t){return"string"==typeof t?[K[t],K[t]]:"object"==typeof t?[K[t.rgb],K[t.alpha]]:void 0},function(t,e,r){var n=t.constants.blendEquations,i=e.def(),o=e.def();return(t=t.cond("typeof ",r,'==="string"')).then(i,"=",o,"=",n,"[",r,"];"),t.else(i,"=",n,"[",r,".rgb];",o,"=",n,"[",r,".alpha];"),e(t),[i,o]});case"blend.color":return e(function(t){return o(4,function(e){return+t[e]})},function(t,e,r){return o(4,function(t){return e.def("+",r,"[",t,"]")})});case"stencil.mask":return e(function(t){return 0|t},function(t,e,r){return e.def(r,"|0")});case"stencil.func":return e(function(t){return[Et[t.cmp||"keep"],t.ref||0,"mask"in t?t.mask:-1]},function(t,e,r){return[t=e.def('"cmp" in ',r,"?",t.constants.compareFuncs,"[",r,".cmp]",":",7680),e.def(r,".ref|0"),e=e.def('"mask" in ',r,"?",r,".mask|0:-1")]});case"stencil.opFront":case"stencil.opBack":return e(function(e){return["stencil.opBack"===t?1029:1028,At[e.fail||"keep"],At[e.zfail||"keep"],At[e.zpass||"keep"]]},function(e,r,n){function i(t){return r.def('"',t,'" in ',n,"?",o,"[",n,".",t,"]:",7680)}var o=e.constants.stencilOps;return["stencil.opBack"===t?1029:1028,i("fail"),i("zfail"),i("zpass")]});case"polygonOffset.offset":return e(function(t){return[0|t.factor,0|t.units]},function(t,e,r){return[e.def(r,".factor|0"),e=e.def(r,".units|0")]});case"cull.face":return e(function(t){var e=0;return"front"===t?e=1028:"back"===t&&(e=1029),e},function(t,e,r){return e.def(r,'==="front"?',1028,":",1029)});case"lineWidth":return e(function(t){return t},function(t,e,r){return r});case"frontFace":return e(function(t){return Tt[t]},function(t,e,r){return e.def(r+'==="cw"?2304:2305')});case"colorMask":return e(function(t){return t.map(function(t){return!!t})},function(t,e,r){return o(4,function(t){return"!!"+r+"["+t+"]"})});case"sample.coverage":return e(function(t){return["value"in t?t.value:1,!!t.invert]},function(t,e,r){return[e.def('"value" in ',r,"?+",r,".value:1"),e=e.def("!!",r,".invert")]})}}),i}(t),c=w(t),h=s.viewport;return h&&(l.viewport=h),(s=s[h=_("scissor.box")])&&(l[h]=s),(a={framebuffer:a,draw:u,shader:c,state:l,dirty:s=0<Object.keys(l).length}).profile=function(t){var e,r=t.static;if(t=t.dynamic,"profile"in r){var n=!!r.profile;(e=F(function(t,e){return n})).enable=n}else if("profile"in t){var i=t.profile;e=B(i,function(t,e){return t.invoke(e,i)})}return e}(t),a.uniforms=function(t,e){var r=t.static,n=t.dynamic,i={};return Object.keys(r).forEach(function(t){var e,n=r[t];if("number"==typeof n||"boolean"==typeof n)e=F(function(){return n});else if("function"==typeof n){var a=n._reglType;"texture2d"===a||"textureCube"===a?e=F(function(t){return t.link(n)}):"framebuffer"!==a&&"framebufferCube"!==a||(e=F(function(t){return t.link(n.color[0])}))}else y(n)&&(e=F(function(t){return t.global.def("[",o(n.length,function(t){return n[t]}),"]")}));e.value=n,i[t]=e}),Object.keys(n).forEach(function(t){var e=n[t];i[t]=B(e,function(t,r){return t.invoke(r,e)})}),i}(r),a.attributes=A(e),a.context=function(t){var e=t.static,r=t.dynamic,n={};return Object.keys(e).forEach(function(t){var r=e[t];n[t]=F(function(t,e){return"number"==typeof r||"boolean"==typeof r?""+r:t.link(r)})}),Object.keys(r).forEach(function(t){var e=r[t];n[t]=B(e,function(t,r){return t.invoke(r,e)})}),n}(n),a}function M(t,e,r){var n=t.shared.context,i=t.scope();Object.keys(r).forEach(function(o){e.save(n,"."+o),i(n,".",o,"=",r[o].append(t,e),";")}),e(i)}function S(t,e,r,n){var i,o=(s=t.shared).gl,a=s.framebuffer;$&&(i=e.def(s.extensions,".webgl_draw_buffers"));var s=(u=t.constants).drawBuffer,u=u.backBuffer;t=r?r.append(t,e):e.def(a,".next"),n||e("if(",t,"!==",a,".cur){"),e("if(",t,"){",o,".bindFramebuffer(",36160,",",t,".framebuffer);"),$&&e(i,".drawBuffersWEBGL(",s,"[",t,".colorAttachments.length]);"),e("}else{",o,".bindFramebuffer(",36160,",null);"),$&&e(i,".drawBuffersWEBGL(",u,");"),e("}",a,".cur=",t,";"),n||e("}")}function R(t,e,r){var n=t.shared,i=n.gl,a=t.current,s=t.next,u=n.current,l=n.next,c=t.cond(u,".dirty");nt.forEach(function(e){var n,h;if(!((e=_(e))in r.state))if(e in s){n=s[e],h=a[e];var p=o(tt[e].length,function(t){return c.def(n,"[",t,"]")});c(t.cond(p.map(function(t,e){return t+"!=="+h+"["+e+"]"}).join("||")).then(i,".",ot[e],"(",p,");",p.map(function(t,e){return h+"["+e+"]="+t}).join(";"),";"))}else n=c.def(l,".",e),p=t.cond(n,"!==",u,".",e),c(p),e in it?p(t.cond(n).then(i,".enable(",it[e],");").else(i,".disable(",it[e],");"),u,".",e,"=",n,";"):p(i,".",ot[e],"(",n,");",u,".",e,"=",n,";")}),0===Object.keys(r.state).length&&c(u,".dirty=false;"),e(c)}function I(t,e,r,n){var i=t.shared,o=t.current,a=i.current,s=i.gl;L(Object.keys(r)).forEach(function(i){var u=r[i];if(!n||n(u)){var l=u.append(t,e);if(it[i]){var c=it[i];k(u)?e(s,l?".enable(":".disable(",c,");"):e(t.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),e(a,".",i,"=",l,";")}else if(y(l)){var h=o[i];e(s,".",ot[i],"(",l,");",l.map(function(t,e){return h+"["+e+"]="+t}).join(";"),";")}else e(s,".",ot[i],"(",l,");",a,".",i,"=",l,";")}})}function C(t,e){Q&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function N(t,e,r,n,i){function o(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function a(t){t(l=e.def(),"=",o(),";"),"string"==typeof i?t(p,".count+=",i,";"):t(p,".count++;"),d&&(n?t(c=e.def(),"=",m,".getNumPendingQueries();"):t(m,".beginQuery(",p,");"))}function s(t){t(p,".cpuTime+=",o(),"-",l,";"),d&&(n?t(m,".pushScopeStats(",c,",",m,".getNumPendingQueries(),",p,");"):t(m,".endQuery();"))}function u(t){var r=e.def(f,".profile");e(f,".profile=",t,";"),e.exit(f,".profile=",r,";")}var l,c,h=t.shared,p=t.stats,f=h.current,m=h.timer;if(r=r.profile){if(k(r))return void(r.enable?(a(e),s(e.exit),u("true")):u("false"));u(r=r.append(t,e))}else r=e.def(f,".profile");a(h=t.block()),e("if(",r,"){",h,"}"),s(t=t.block()),e.exit("if(",r,"){",t,"}")}function z(t,e,r,n,i){function o(r,n,i){function o(){e("if(!",c,".buffer){",u,".enableVertexAttribArray(",l,");}");var r,o=i.type;r=i.size?e.def(i.size,"||",n):n,e("if(",c,".type!==",o,"||",c,".size!==",r,"||",f.map(function(t){return c+"."+t+"!=="+i[t]}).join("||"),"){",u,".bindBuffer(",34962,",",h,".buffer);",u,".vertexAttribPointer(",[l,r,o,i.normalized,i.stride,i.offset],");",c,".type=",o,";",c,".size=",r,";",f.map(function(t){return c+"."+t+"="+i[t]+";"}).join(""),"}"),Q&&e("if(",c,".divisor!==",o=i.divisor,"){",t.instancing,".vertexAttribDivisorANGLE(",[l,o],");",c,".divisor=",o,";}")}function s(){e("if(",c,".buffer){",u,".disableVertexAttribArray(",l,");","}if(",xt.map(function(t,e){return c+"."+t+"!=="+p[e]}).join("||"),"){",u,".vertexAttrib4f(",l,",",p,");",xt.map(function(t,e){return c+"."+t+"="+p[e]+";"}).join(""),"}")}var u=a.gl,l=e.def(r,".location"),c=e.def(a.attributes,"[",l,"]"),h=i.buffer,p=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];1===(r=i.state)?o():2===r?s():(e("if(",r,"===",1,"){"),o(),e("}else{"),s(),e("}"))}var a=t.shared;n.forEach(function(n){var a,s=n.name,u=r.attributes[s];if(u){if(!i(u))return;a=u.append(t,e)}else{if(!i(Mt))return;var l=t.scopeAttrib(s);a={},Object.keys(new W).forEach(function(t){a[t]=e.def(l,".",t)})}o(t.link(n),function(t){switch(t){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(n.info.type),a)})}function U(t,r,n,i,a){for(var s,u=t.shared,l=u.gl,c=0;c<i.length;++c){var h,p=(m=i[c]).name,f=m.info.type,d=n.uniforms[p],m=t.link(m)+".location";if(d){if(!a(d))continue;if(k(d)){if(p=d.value,35678===f||35680===f)r(l,".uniform1i(",m,",",(f=t.link(p._texture||p.color[0]._texture))+".bind());"),r.exit(f,".unbind();");else if(35674===f||35675===f||35676===f)d=2,35675===f?d=3:35676===f&&(d=4),r(l,".uniformMatrix",d,"fv(",m,",false,",p=t.global.def("new Float32Array(["+Array.prototype.slice.call(p)+"])"),");");else{switch(f){case 5126:s="1f";break;case 35664:s="2f";break;case 35665:s="3f";break;case 35666:s="4f";break;case 35670:case 5124:s="1i";break;case 35671:case 35667:s="2i";break;case 35672:case 35668:s="3i";break;case 35673:s="4i";break;case 35669:s="4i"}r(l,".uniform",s,"(",m,",",y(p)?Array.prototype.slice.call(p):p,");")}continue}h=d.append(t,r)}else{if(!a(Mt))continue;h=r.def(u.uniforms,"[",e.id(p),"]")}switch(35678===f?r("if(",h,"&&",h,'._reglType==="framebuffer"){',h,"=",h,".color[0];","}"):35680===f&&r("if(",h,"&&",h,'._reglType==="framebufferCube"){',h,"=",h,".color[0];","}"),p=1,f){case 35678:case 35680:f=r.def(h,"._texture"),r(l,".uniform1i(",m,",",f,".bind());"),r.exit(f,".unbind();");continue;case 5124:case 35670:s="1i";break;case 35667:case 35671:s="2i",p=2;break;case 35668:case 35672:s="3i",p=3;break;case 35669:case 35673:s="4i",p=4;break;case 5126:s="1f";break;case 35664:s="2f",p=2;break;case 35665:s="3f",p=3;break;case 35666:s="4f",p=4;break;case 35674:s="Matrix2fv";break;case 35675:s="Matrix3fv";break;case 35676:s="Matrix4fv"}if(r(l,".uniform",s,"(",m,","),"M"===s.charAt(0)){m=Math.pow(f-35674+2,2);var _=t.global.def("new Float32Array(",m,")");r("false,(Array.isArray(",h,")||",h," instanceof Float32Array)?",h,":(",o(m,function(t){return _+"["+t+"]="+h+"["+t+"]"}),",",_,")")}else r(1<p?o(p,function(t){return h+"["+t+"]"}):h);r(");")}}function V(t,e,r,n){function i(i){var o=p[i];return o?o.append(t,o.contextDep&&n.contextDynamic||o.propDep?r:e):e.def(h,".",i)}function o(){function t(){r(u,".drawElementsInstancedANGLE(",[d,y,_,m+"<<(("+_+"-5121)>>1)",s],");")}function e(){r(u,".drawArraysInstancedANGLE(",[d,m,y,s],");")}f?g?t():(r("if(",f,"){"),t(),r("}else{"),e(),r("}")):e()}function a(){function t(){r(c+".drawElements("+[d,y,_,m+"<<(("+_+"-5121)>>1)"]+");")}function e(){r(c+".drawArrays("+[d,m,y]+");")}f?g?t():(r("if(",f,"){"),t(),r("}else{"),e(),r("}")):e()}var s,u,l=t.shared,c=l.gl,h=l.draw,p=n.draw,f=function(){var i=p.elements,o=e;return i?((i.contextDep&&n.contextDynamic||i.propDep)&&(o=r),i=i.append(t,o)):i=o.def(h,".","elements"),i&&o("if("+i+")"+c+".bindBuffer(34963,"+i+".buffer.buffer);"),i}(),d=i("primitive"),m=i("offset"),y=function(){var i=p.count,o=e;return i?((i.contextDep&&n.contextDynamic||i.propDep)&&(o=r),i=i.append(t,o)):i=o.def(h,".","count"),i}();if("number"==typeof y){if(0===y)return}else r("if(",y,"){"),r.exit("}");Q&&(s=i("instances"),u=t.instancing);var _=f+".type",g=p.elements&&k(p.elements);Q&&("number"!=typeof s||0<=s)?"string"==typeof s?(r("if(",s,">0){"),o(),r("}else if(",s,"<0){"),a(),r("}")):o():a()}function G(t,e,r,n,i){return i=(e=x()).proc("body",i),Q&&(e.instancing=i.def(e.shared.extensions,".angle_instanced_arrays")),t(e,i,r,n),e.compile().body}function q(t,e,r,n){C(t,e),z(t,e,r,n.attributes,function(){return!0}),U(t,e,r,n.uniforms,function(){return!0}),V(t,e,e,r)}function H(t,e,r,n){function i(){return!0}t.batchId="a1",C(t,e),z(t,e,r,n.attributes,i),U(t,e,r,n.uniforms,i),V(t,e,e,r)}function X(t,e,r,n){function i(t){return t.contextDep&&a||t.propDep}function o(t){return!i(t)}C(t,e);var a=r.contextDep,s=e.def(),u=e.def();t.shared.props=u,t.batchId=s;var l=t.scope(),c=t.scope();e(l.entry,"for(",s,"=0;",s,"<","a1",";++",s,"){",u,"=","a0","[",s,"];",c,"}",l.exit),r.needsContext&&M(t,c,r.context),r.needsFramebuffer&&S(t,c,r.framebuffer),I(t,c,r.state,i),r.profile&&i(r.profile)&&N(t,c,r,!1,!0),n?(z(t,l,r,n.attributes,o),z(t,c,r,n.attributes,i),U(t,l,r,n.uniforms,o),U(t,c,r,n.uniforms,i),V(t,l,c,r)):(e=t.global.def("{}"),n=r.shader.progVar.append(t,c),u=c.def(n,".id"),l=c.def(e,"[",u,"]"),c(t.shared.gl,".useProgram(",n,".program);","if(!",l,"){",l,"=",e,"[",u,"]=",t.link(function(e){return G(H,t,r,e,2)}),"(",n,");}",l,".call(this,a0[",s,"],",s,");"))}function Y(t,r){function n(e){var n=r.shader[e];n&&i.set(o.shader,"."+e,n.append(t,i))}var i=t.proc("scope",3);t.batchId="a2";var o=t.shared,a=o.current;M(t,i,r.context),r.framebuffer&&r.framebuffer.append(t,i),L(Object.keys(r.state)).forEach(function(e){var n=r.state[e].append(t,i);y(n)?n.forEach(function(r,n){i.set(t.next[e],"["+n+"]",r)}):i.set(o.next,"."+e,n)}),N(t,i,r,!0,!0),["elements","offset","count","instances","primitive"].forEach(function(e){var n=r.draw[e];n&&i.set(o.draw,"."+e,""+n.append(t,i))}),Object.keys(r.uniforms).forEach(function(n){i.set(o.uniforms,"["+e.id(n)+"]",r.uniforms[n].append(t,i))}),Object.keys(r.attributes).forEach(function(e){var n=r.attributes[e].append(t,i),o=t.scopeAttrib(e);Object.keys(new W).forEach(function(t){i.set(o,"."+t,n[t])})}),n("vert"),n("frag"),0<Object.keys(r.state).length&&(i(a,".dirty=true;"),i.exit(a,".dirty=true;")),i("a1(",t.shared.context,",a0,",t.batchId,");")}function Z(t,e,r){var n=e.static[r];if(n&&function(t){if("object"==typeof t&&!y(t)){for(var e=Object.keys(t),r=0;r<e.length;++r)if(j.isDynamic(t[e[r]]))return!0;return!1}}(n)){var i=t.global,o=Object.keys(n),a=!1,s=!1,u=!1,l=t.global.def("{}");o.forEach(function(e){var r=n[e];if(j.isDynamic(r))"function"==typeof r&&(r=n[e]=j.unbox(r)),e=B(r,null),a=a||e.thisDep,u=u||e.propDep,s=s||e.contextDep;else{switch(i(l,".",e,"="),typeof r){case"number":i(r);break;case"string":i('"',r,'"');break;case"object":Array.isArray(r)&&i("[",r.join(),"]");break;default:i(t.link(r))}i(";")}}),e.dynamic[r]=new j.DynamicVariable(4,{thisDep:a,contextDep:s,propDep:u,ref:l,append:function(t,e){o.forEach(function(r){var i=n[r];j.isDynamic(i)&&(i=t.invoke(e,i),e(l,".",r,"=",i,";"))})}}),delete e.static[r]}}var W=c.Record,K={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(K.min=32775,K.max=32776);var Q=r.angle_instanced_arrays,$=r.webgl_draw_buffers,tt={dirty:!0,profile:m.profile},et={},nt=[],it={},ot={};g("dither",3024),g("blend.enable",3042),v("blend.color","blendColor",[0,0,0,0]),v("blend.equation","blendEquationSeparate",[32774,32774]),v("blend.func","blendFuncSeparate",[1,0,1,0]),g("depth.enable",2929,!0),v("depth.func","depthFunc",513),v("depth.range","depthRange",[0,1]),v("depth.mask","depthMask",!0),v("colorMask","colorMask",[!0,!0,!0,!0]),g("cull.enable",2884),v("cull.face","cullFace",1029),v("frontFace","frontFace",2305),v("lineWidth","lineWidth",1),g("polygonOffset.enable",32823),v("polygonOffset.offset","polygonOffset",[0,0]),g("sample.alpha",32926),g("sample.enable",32928),v("sample.coverage","sampleCoverage",[1,!1]),g("stencil.enable",2960),v("stencil.mask","stencilMask",-1),v("stencil.func","stencilFunc",[519,0,-1]),v("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),v("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),g("scissor.enable",3089),v("scissor.box","scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),v("viewport","viewport",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var at={gl:t,context:f,strings:e,next:et,current:tt,draw:p,elements:a,buffer:i,shader:h,attributes:c.state,uniforms:l,framebuffer:u,extensions:r,timer:d,isBufferArgs:D},st={primTypes:rt,compareFuncs:Et,blendFuncs:wt,blendEquations:K,stencilOps:At,glTypes:J,orientationType:Tt};$&&(st.backBuffer=[1029],st.drawBuffer=o(n.maxDrawbuffers,function(t){return 0===t?[0]:o(t,function(t){return 36064+t})}));var ut=0;return{next:et,current:tt,procs:function(){var t=x(),e=t.proc("poll"),r=t.proc("refresh"),i=t.block();e(i),r(i);var a,s=t.shared,u=s.gl,l=s.next,c=s.current;i(c,".dirty=false;"),S(t,e),S(t,r,null,!0),Q&&(a=t.link(Q));for(var h=0;h<n.maxAttributes;++h){var p=r.def(s.attributes,"[",h,"]"),f=t.cond(p,".buffer");f.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",34962,",",p,".buffer.buffer);",u,".vertexAttribPointer(",h,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;"),r(f),Q&&r(a,".vertexAttribDivisorANGLE(",h,",",p,".divisor);")}return Object.keys(it).forEach(function(n){var o=it[n],a=i.def(l,".",n),s=t.block();s("if(",a,"){",u,".enable(",o,")}else{",u,".disable(",o,")}",c,".",n,"=",a,";"),r(s),e("if(",a,"!==",c,".",n,"){",s,"}")}),Object.keys(ot).forEach(function(n){var a,s,h=ot[n],p=tt[n],f=t.block();f(u,".",h,"("),y(p)?(h=p.length,a=t.global.def(l,".",n),s=t.global.def(c,".",n),f(o(h,function(t){return a+"["+t+"]"}),");",o(h,function(t){return s+"["+t+"]="+a+"["+t+"];"}).join("")),e("if(",o(h,function(t){return a+"["+t+"]!=="+s+"["+t+"]"}).join("||"),"){",f,"}")):(a=i.def(l,".",n),s=i.def(c,".",n),f(a,");",c,".",n,"=",a,";"),e("if(",a,"!==",s,"){",f,"}")),r(f)}),t.compile()}(),compile:function(t,e,r,n,i){var o=x();return o.stats=o.link(i),Object.keys(e.static).forEach(function(t){Z(o,e,t)}),bt.forEach(function(e){Z(o,t,e)}),r=T(t,e,r,n),function(t,e){var r=t.proc("draw",1);C(t,r),M(t,r,e.context),S(t,r,e.framebuffer),R(t,r,e),I(t,r,e.state),N(t,r,e,!1,!0);var n=e.shader.progVar.append(t,r);if(r(t.shared.gl,".useProgram(",n,".program);"),e.shader.program)q(t,r,e,e.shader.program);else{var i=t.global.def("{}"),o=r.def(n,".id"),a=r.def(i,"[",o,"]");r(t.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",t.link(function(r){return G(q,t,e,r,1)}),"(",n,");",a,".call(this,a0);"))}0<Object.keys(e.state).length&&r(t.shared.current,".dirty=true;")}(o,r),Y(o,r),function(t,e){function r(t){return t.contextDep&&i||t.propDep}var n=t.proc("batch",2);t.batchId="0",C(t,n);var i=!1,o=!0;Object.keys(e.context).forEach(function(t){i=i||e.context[t].propDep}),i||(M(t,n,e.context),o=!1);var a=!1;if((s=e.framebuffer)?(s.propDep?i=a=!0:s.contextDep&&i&&(a=!0),a||S(t,n,s)):S(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(i=!0),R(t,n,e),I(t,n,e.state,function(t){return!r(t)}),e.profile&&r(e.profile)||N(t,n,e,!1,"a1"),e.contextDep=i,e.needsContext=o,e.needsFramebuffer=a,(o=e.shader.progVar).contextDep&&i||o.propDep)X(t,n,e,null);else if(o=o.append(t,n),n(t.shared.gl,".useProgram(",o,".program);"),e.shader.program)X(t,n,e,e.shader.program);else{var s=t.global.def("{}"),u=(a=n.def(o,".id"),n.def(s,"[",a,"]"));n(t.cond(u).then(u,".call(this,a0,a1);").else(u,"=",s,"[",a,"]=",t.link(function(r){return G(X,t,e,r,2)}),"(",o,");",u,".call(this,a0,a1);"))}0<Object.keys(e.state).length&&n(t.shared.current,".dirty=true;")}(o,r),o.compile()}}}function z(t,e){for(var r=0;r<t.length;++r)if(t[r]===e)return r;return-1}var U=function(t,e){for(var r=Object.keys(e),n=0;n<r.length;++n)t[r[n]]=e[r[n]];return t},V=0,j={DynamicVariable:t,define:function(r,n){return new t(r,e(n+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof t},unbox:function(e,r){return"function"==typeof e?new t(0,e):e},accessor:e},G={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},q="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},H=s();H.zero=s();var X=function(t,e){var r=1;e.ext_texture_filter_anisotropic&&(r=t.getParameter(34047));var n=1,i=1;e.webgl_draw_buffers&&(n=t.getParameter(34852),i=t.getParameter(36063));var o=!!e.oes_texture_float;if(o){o=t.createTexture(),t.bindTexture(3553,o),t.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var a=t.createFramebuffer();if(t.bindFramebuffer(36160,a),t.framebufferTexture2D(36160,36064,3553,o,0),t.bindTexture(3553,null),36053!==t.checkFramebufferStatus(36160))o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(16384);var s=H.allocType(5126,4);t.readPixels(0,0,1,1,6408,5126,s),t.getError()?o=!1:(t.deleteFramebuffer(a),t.deleteTexture(o),o=1===s[0]),H.freeType(s)}}return s=!0,"undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(s=t.createTexture(),a=H.allocType(5121,36),t.activeTexture(33984),t.bindTexture(34067,s),t.texImage2D(34069,0,6408,3,3,0,6408,5121,a),H.freeType(a),t.bindTexture(34067,null),t.deleteTexture(s),s=!t.getError()),{colorBits:[t.getParameter(3410),t.getParameter(3411),t.getParameter(3412),t.getParameter(3413)],depthBits:t.getParameter(3414),stencilBits:t.getParameter(3415),subpixelBits:t.getParameter(3408),extensions:Object.keys(e).filter(function(t){return!!e[t]}),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:i,pointSizeDims:t.getParameter(33901),lineWidthDims:t.getParameter(33902),maxViewportDims:t.getParameter(3386),maxCombinedTextureUnits:t.getParameter(35661),maxCubeMapSize:t.getParameter(34076),maxRenderbufferSize:t.getParameter(34024),maxTextureUnits:t.getParameter(34930),maxTextureSize:t.getParameter(3379),maxAttributes:t.getParameter(34921),maxVertexUniforms:t.getParameter(36347),maxVertexTextureUnits:t.getParameter(35660),maxVaryingVectors:t.getParameter(36348),maxFragmentUniforms:t.getParameter(36349),glsl:t.getParameter(35724),renderer:t.getParameter(7937),vendor:t.getParameter(7936),version:t.getParameter(7938),readFloat:o,npotTextureCube:s}},Y=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},Z=function(t){return Object.keys(t).map(function(e){return t[e]})},W={shape:function(t){for(var e=[];t.length;t=t[0])e.push(t.length);return e},flatten:function(t,e,r,n){var i=1;if(e.length)for(var o=0;o<e.length;++o)i*=e[o];else i=0;switch(r=n||H.allocType(r,i),e.length){case 0:break;case 1:for(n=e[0],e=0;e<n;++e)r[e]=t[e];break;case 2:for(n=e[0],e=e[1],o=i=0;o<n;++o)for(var a=t[o],s=0;s<e;++s)r[i++]=a[s];break;case 3:l(t,e[0],e[1],e[2],r,0);break;default:!function t(e,r,n,i,o){for(var a=1,s=n+1;s<r.length;++s)a*=r[s];var u=r[n];if(4==r.length-n){var c=r[n+1],h=r[n+2];for(r=r[n+3],s=0;s<u;++s)l(e[s],c,h,r,i,o),o+=a}else for(s=0;s<u;++s)t(e[s],r,n+1,i,o),o+=a}(t,e,0,r,0)}return r}},K={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},J={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Q={dynamic:35048,stream:35040,static:35044},$=W.flatten,tt=W.shape,et=[];et[5120]=1,et[5122]=2,et[5124]=4,et[5121]=1,et[5123]=2,et[5125]=4,et[5126]=4;var rt={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},nt=new Float32Array(1),it=new Uint32Array(nt.buffer),ot=[9984,9986,9985,9987],at=[0,6409,6410,6407,6408],st={};st[6409]=st[6406]=st[6402]=1,st[34041]=st[6410]=2,st[6407]=st[35904]=3,st[6408]=st[35906]=4;var ut=_("HTMLCanvasElement"),lt=_("CanvasRenderingContext2D"),ct=_("ImageBitmap"),ht=_("HTMLImageElement"),pt=_("HTMLVideoElement"),ft=Object.keys(K).concat([ut,lt,ct,ht,pt]),dt=[];dt[5121]=1,dt[5126]=4,dt[36193]=2,dt[5123]=2,dt[5125]=4;var mt=[];mt[32854]=2,mt[32855]=2,mt[36194]=2,mt[34041]=4,mt[33776]=.5,mt[33777]=.5,mt[33778]=1,mt[33779]=1,mt[35986]=.5,mt[35987]=1,mt[34798]=1,mt[35840]=.5,mt[35841]=.25,mt[35842]=.5,mt[35843]=.25,mt[36196]=.5;var yt=[];yt[32854]=2,yt[32855]=2,yt[36194]=2,yt[33189]=2,yt[36168]=1,yt[34041]=4,yt[35907]=4,yt[34836]=16,yt[34842]=8,yt[34843]=6;var _t=function(t,e,r,n,i){function o(t){this.id=l++,this.refCount=1,this.renderbuffer=t,this.format=32854,this.height=this.width=0,i.profile&&(this.stats={size:0})}function a(e){var r=e.renderbuffer;t.bindRenderbuffer(36161,null),t.deleteRenderbuffer(r),e.renderbuffer=null,e.refCount=0,delete c[e.id],n.renderbufferCount--}var s={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};e.ext_srgb&&(s.srgba=35907),e.ext_color_buffer_half_float&&(s.rgba16f=34842,s.rgb16f=34843),e.webgl_color_buffer_float&&(s.rgba32f=34836);var u=[];Object.keys(s).forEach(function(t){u[s[t]]=t});var l=0,c={};return o.prototype.decRef=function(){0>=--this.refCount&&a(this)},i.profile&&(n.getTotalRenderbufferSize=function(){var t=0;return Object.keys(c).forEach(function(e){t+=c[e].stats.size}),t}),{create:function(e,r){function a(e,r){var n=0,o=0,c=32854;if("object"==typeof e&&e?("shape"in e?(n=0|(o=e.shape)[0],o=0|o[1]):("radius"in e&&(n=o=0|e.radius),"width"in e&&(n=0|e.width),"height"in e&&(o=0|e.height)),"format"in e&&(c=s[e.format])):"number"==typeof e?(n=0|e,o="number"==typeof r?0|r:n):e||(n=o=1),n!==l.width||o!==l.height||c!==l.format)return a.width=l.width=n,a.height=l.height=o,l.format=c,t.bindRenderbuffer(36161,l.renderbuffer),t.renderbufferStorage(36161,c,n,o),i.profile&&(l.stats.size=yt[l.format]*l.width*l.height),a.format=u[l.format],a}var l=new o(t.createRenderbuffer());return c[l.id]=l,n.renderbufferCount++,a(e,r),a.resize=function(e,r){var n=0|e,o=0|r||n;return n===l.width&&o===l.height?a:(a.width=l.width=n,a.height=l.height=o,t.bindRenderbuffer(36161,l.renderbuffer),t.renderbufferStorage(36161,l.format,n,o),i.profile&&(l.stats.size=yt[l.format]*l.width*l.height),a)},a._reglType="renderbuffer",a._renderbuffer=l,i.profile&&(a.stats=l.stats),a.destroy=function(){l.decRef()},a},clear:function(){Z(c).forEach(a)},restore:function(){Z(c).forEach(function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,e.renderbuffer),t.renderbufferStorage(36161,e.format,e.width,e.height)}),t.bindRenderbuffer(36161,null)}}},gt=[];gt[6408]=4,gt[6407]=3;var vt=[];vt[5121]=1,vt[5126]=4,vt[36193]=2;var xt=["x","y","z","w"],bt="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),wt={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Et={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},At={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Tt={cw:2304,ccw:2305},Mt=new O(!1,!1,!1,function(){});return function(t){function e(){if(0===W.length)w&&w.update(),$=null;else{$=G.next(e),h();for(var t=W.length-1;0<=t;--t){var r=W[t];r&&r(C,null,0)}y.flush(),w&&w.update()}}function r(){!$&&0<W.length&&($=G.next(e))}function n(){$&&(G.cancel(e),$=null)}function o(t){t.preventDefault(),n(),K.forEach(function(t){t()})}function a(t){y.getError(),g.restore(),k.restore(),L.restore(),F.restore(),B.restore(),V.restore(),w&&w.restore(),H.procs.refresh(),r(),J.forEach(function(t){t()})}function s(t){function e(t){var e={},r={};return Object.keys(t).forEach(function(n){var i=t[n];j.isDynamic(i)?r[n]=j.unbox(i,n):e[n]=i}),{dynamic:r,static:e}}var r=e(t.context||{}),n=e(t.uniforms||{}),i=e(t.attributes||{}),o=e(function(t){function e(t){if(t in r){var e=r[t];delete r[t],Object.keys(e).forEach(function(n){r[t+"."+n]=e[n]})}}var r=U({},t);return delete r.uniforms,delete r.attributes,delete r.context,"stencil"in r&&r.stencil.op&&(r.stencil.opBack=r.stencil.opFront=r.stencil.op,delete r.stencil.op),e("blend"),e("depth"),e("cull"),e("stencil"),e("polygonOffset"),e("scissor"),e("sample"),r}(t)),a=(r=H.compile(o,i,n,r,t={gpuTime:0,cpuTime:0,count:0})).draw,s=r.batch,u=r.scope,l=[];return U(function(t,e){var r;if("function"==typeof t)return u.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(r=0;r<t;++r)u.call(this,null,e,r);else{if(!Array.isArray(t))return u.call(this,t,e,0);for(r=0;r<t.length;++r)u.call(this,t[r],e,r)}else if("number"==typeof t){if(0<t)return s.call(this,function(t){for(;l.length<t;)l.push(null);return l}(0|t),0|t)}else{if(!Array.isArray(t))return a.call(this,t);if(t.length)return s.call(this,t,t.length)}},{stats:t})}function u(t,e){var r=0;H.procs.poll();var n=e.color;n&&(y.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),r|=16384),"depth"in e&&(y.clearDepth(+e.depth),r|=256),"stencil"in e&&(y.clearStencil(0|e.stencil),r|=1024),y.clear(r)}function l(t){return W.push(t),r(),{cancel:function(){var e=z(W,t);W[e]=function t(){var e=z(W,t);W[e]=W[W.length-1],--W.length,0>=W.length&&n()}}}}function c(){var t=Y.viewport,e=Y.scissor_box;t[0]=t[1]=e[0]=e[1]=0,C.viewportWidth=C.framebufferWidth=C.drawingBufferWidth=t[2]=e[2]=y.drawingBufferWidth,C.viewportHeight=C.framebufferHeight=C.drawingBufferHeight=t[3]=e[3]=y.drawingBufferHeight}function h(){C.tick+=1,C.time=m(),c(),H.procs.poll()}function p(){c(),H.procs.refresh(),w&&w.update()}function m(){return(q()-E)/1e3}if(!(t=i(t)))return null;var y=t.gl,_=y.getContextAttributes();y.isContextLost();var g=function(t,e){function r(e){var r;e=e.toLowerCase();try{r=n[e]=t.getExtension(e)}catch(t){}return!!r}for(var n={},i=0;i<e.extensions.length;++i){var o=e.extensions[i];if(!r(o))return e.onDestroy(),e.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach(function(t){if(n[t]&&!r(t))throw Error("(regl): error restoring extension "+t)})}}}(y,t);if(!g)return null;var v=function(){var t={"":0},e=[""];return{id:function(r){var n=t[r];return n||(n=t[r]=e.length,e.push(r),n)},str:function(t){return e[t]}}}(),x={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},b=g.extensions,w=function(t,e){function r(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function n(t,e,n){var i=a.pop()||new r;i.startQueryIndex=t,i.endQueryIndex=e,i.sum=0,i.stats=n,s.push(i)}if(!e.ext_disjoint_timer_query)return null;var i=[],o=[],a=[],s=[],u=[],l=[];return{beginQuery:function(t){var r=i.pop()||e.ext_disjoint_timer_query.createQueryEXT();e.ext_disjoint_timer_query.beginQueryEXT(35007,r),o.push(r),n(o.length-1,o.length,t)},endQuery:function(){e.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:n,update:function(){var t,r;if(0!==(t=o.length)){l.length=Math.max(l.length,t+1),u.length=Math.max(u.length,t+1),u[0]=0;var n=l[0]=0;for(r=t=0;r<o.length;++r)e.ext_disjoint_timer_query.getQueryObjectEXT(c=o[r],34919)?(n+=e.ext_disjoint_timer_query.getQueryObjectEXT(c,34918),i.push(c)):o[t++]=c,u[r+1]=n,l[r+1]=t;for(o.length=t,r=t=0;r<s.length;++r){var c,h=(n=s[r]).startQueryIndex;n.sum+=u[c=n.endQueryIndex]-u[h],(c=l[c])===(h=l[h])?(n.stats.gpuTime+=n.sum/1e6,a.push(n)):(n.startQueryIndex=h,n.endQueryIndex=c,s[t++]=n)}s.length=t}},getNumPendingQueries:function(){return o.length},clear:function(){i.push.apply(i,o);for(var t=0;t<i.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(i[t]);o.length=0,i.length=0},restore:function(){o.length=0,i.length=0}}}(0,b),E=q(),I=y.drawingBufferHeight,C={tick:0,time:0,viewportWidth:D=y.drawingBufferWidth,viewportHeight:I,framebufferWidth:D,framebufferHeight:I,drawingBufferWidth:D,drawingBufferHeight:I,pixelRatio:t.pixelRatio},P=X(y,b),D=function(t,e,r,n){for(t=r.maxAttributes,e=Array(t),r=0;r<t;++r)e[r]=new M;return{Record:M,scope:{},state:e}}(y,b,P),L=f(y,x,t,D),O=d(y,b,L,x),k=S(y,v,x,t),F=A(y,b,P,function(){H.procs.poll()},C,x,t),B=_t(y,b,0,x,t),V=T(y,b,P,F,B,x),H=N(y,v,b,P,L,O,0,V,{},D,k,{elements:null,primitive:4,count:-1,offset:0,instances:-1},C,w,t),Y=(v=R(y,V,H.procs.poll,C),H.next),Z=y.canvas,W=[],K=[],J=[],Q=[t.onDestroy],$=null;Z&&(Z.addEventListener("webglcontextlost",o,!1),Z.addEventListener("webglcontextrestored",a,!1));var tt=V.setFBO=s({framebuffer:j.define.call(null,1,"framebuffer")});return p(),_=U(s,{clear:function(t){if("framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var e=0;6>e;++e)tt(U({framebuffer:t.framebuffer.faces[e]},t),u);else tt(t,u);else u(0,t)},prop:j.define.bind(null,1),context:j.define.bind(null,2),this:j.define.bind(null,3),draw:s({}),buffer:function(t){return L.create(t,34962,!1,!1)},elements:function(t){return O.create(t,!1)},texture:F.create2D,cube:F.createCube,renderbuffer:B.create,framebuffer:V.create,framebufferCube:V.createCube,attributes:_,frame:l,on:function(t,e){var r;switch(t){case"frame":return l(e);case"lost":r=K;break;case"restore":r=J;break;case"destroy":r=Q}return r.push(e),{cancel:function(){for(var t=0;t<r.length;++t)if(r[t]===e){r[t]=r[r.length-1],r.pop();break}}}},limits:P,hasExtension:function(t){return 0<=P.extensions.indexOf(t.toLowerCase())},read:v,destroy:function(){W.length=0,n(),Z&&(Z.removeEventListener("webglcontextlost",o),Z.removeEventListener("webglcontextrestored",a)),k.clear(),V.clear(),B.clear(),F.clear(),O.clear(),L.clear(),w&&w.clear(),Q.forEach(function(t){t()})},_gl:y,_refresh:p,poll:function(){h(),w&&w.update()},now:m,stats:x}),t.onDone(null,_),_}},"object"==typeof r&&void 0!==e?e.exports=i():"function"==typeof define&&define.amd?define(i):n.createREGL=i()},{}],205:[function(t,e,r){(function(t){e.exports=t.performance&&t.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],206:[function(t,e,r){(function(t){"use strict";var r=256,n=[],i=void 0===t?window:t,o=Math.pow(r,6),a=Math.pow(2,52),s=2*a,u=r-1,l=Math.random;function c(t){var e,n=t.length,i=this,o=0,a=i.i=i.j=0,s=i.S=[];for(n||(t=[n++]);o<r;)s[o]=o++;for(o=0;o<r;o++)s[o]=s[a=u&a+t[o%n]+(e=s[o])],s[a]=e;(i.g=function(t){for(var e,n=0,o=i.i,a=i.j,s=i.S;t--;)e=s[o=u&o+1],n=n*r+s[u&(s[o]=s[a=u&a+e])+(s[a]=e)];return i.i=o,i.j=a,n})(r)}function h(t,e){for(var r,n=t+"",i=0;i<n.length;)e[u&i]=u&(r^=19*e[u&i])+n.charCodeAt(i++);return p(e)}function p(t){return String.fromCharCode.apply(0,t)}e.exports=function(t,u){if(u&&!0===u.global)return u.global=!1,Math.random=e.exports(t,u),u.global=!0,Math.random;var l=[],f=(h(function t(e,r){var n,i=[],o=(typeof e)[0];if(r&&"o"==o)for(n in e)try{i.push(t(e[n],r-1))}catch(t){}return i.length?i:"s"==o?e:e+"\0"}(u&&u.entropy||!1?[t,p(n)]:0 in arguments?t:function(t){try{return i.crypto.getRandomValues(t=new Uint8Array(r)),p(t)}catch(t){return[+new Date,i,i.navigator&&i.navigator.plugins,i.screen,p(n)]}}(),3),l),new c(l));return h(p(f.S),n),function(){for(var t=f.g(6),e=o,n=0;t<a;)t=(t+n)*r,e*=r,n=f.g(1);for(;t>=s;)t/=2,e/=2,n>>>=1;return(t+n)/e}},e.exports.resetGlobal=function(){Math.random=l},h(Math.random(),n)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],207:[function(t,e,r){!function(){"use strict";var t=.5*(Math.sqrt(3)-1),n=(3-Math.sqrt(3))/6,i=1/6,o=(Math.sqrt(5)-1)/4,a=(5-Math.sqrt(5))/20;function s(t){var e;e="function"==typeof t?t:t?function(){var t=0,e=0,r=0,n=1,i=(o=4022871197,function(t){t=t.toString();for(var e=0;e<t.length;e++){var r=.02519603282416938*(o+=t.charCodeAt(e));r-=o=r>>>0,o=(r*=o)>>>0,o+=4294967296*(r-=o)}return 2.3283064365386963e-10*(o>>>0)});var o;t=i(" "),e=i(" "),r=i(" ");for(var a=0;a<arguments.length;a++)(t-=i(arguments[a]))<0&&(t+=1),(e-=i(arguments[a]))<0&&(e+=1),(r-=i(arguments[a]))<0&&(r+=1);return i=null,function(){var i=2091639*t+2.3283064365386963e-10*n;return t=e,e=r,r=i-(n=0|i)}}(t):Math.random,this.p=u(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var r=0;r<512;r++)this.perm[r]=this.p[255&r],this.permMod12[r]=this.perm[r]%12}function u(t){var e,r=new Uint8Array(256);for(e=0;e<256;e++)r[e]=e;for(e=0;e<255;e++){var n=e+~~(t()*(256-e)),i=r[e];r[e]=r[n],r[n]=i}return r}s.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(e,r){var i,o,a=this.permMod12,s=this.perm,u=this.grad3,l=0,c=0,h=0,p=(e+r)*t,f=Math.floor(e+p),d=Math.floor(r+p),m=(f+d)*n,y=e-(f-m),_=r-(d-m);y>_?(i=1,o=0):(i=0,o=1);var g=y-i+n,v=_-o+n,x=y-1+2*n,b=_-1+2*n,w=255&f,E=255&d,A=.5-y*y-_*_;if(A>=0){var T=3*a[w+s[E]];l=(A*=A)*A*(u[T]*y+u[T+1]*_)}var M=.5-g*g-v*v;if(M>=0){var S=3*a[w+i+s[E+o]];c=(M*=M)*M*(u[S]*g+u[S+1]*v)}var R=.5-x*x-b*b;if(R>=0){var I=3*a[w+1+s[E+1]];h=(R*=R)*R*(u[I]*x+u[I+1]*b)}return 70*(l+c+h)},noise3D:function(t,e,r){var n,o,a,s,u,l,c,h,p,f,d=this.permMod12,m=this.perm,y=this.grad3,_=(t+e+r)*(1/3),g=Math.floor(t+_),v=Math.floor(e+_),x=Math.floor(r+_),b=(g+v+x)*i,w=t-(g-b),E=e-(v-b),A=r-(x-b);w>=E?E>=A?(u=1,l=0,c=0,h=1,p=1,f=0):w>=A?(u=1,l=0,c=0,h=1,p=0,f=1):(u=0,l=0,c=1,h=1,p=0,f=1):E<A?(u=0,l=0,c=1,h=0,p=1,f=1):w<A?(u=0,l=1,c=0,h=0,p=1,f=1):(u=0,l=1,c=0,h=1,p=1,f=0);var T=w-u+i,M=E-l+i,S=A-c+i,R=w-h+2*i,I=E-p+2*i,C=A-f+2*i,P=w-1+.5,D=E-1+.5,L=A-1+.5,O=255&g,k=255&v,F=255&x,B=.6-w*w-E*E-A*A;if(B<0)n=0;else{var N=3*d[O+m[k+m[F]]];n=(B*=B)*B*(y[N]*w+y[N+1]*E+y[N+2]*A)}var z=.6-T*T-M*M-S*S;if(z<0)o=0;else{var U=3*d[O+u+m[k+l+m[F+c]]];o=(z*=z)*z*(y[U]*T+y[U+1]*M+y[U+2]*S)}var V=.6-R*R-I*I-C*C;if(V<0)a=0;else{var j=3*d[O+h+m[k+p+m[F+f]]];a=(V*=V)*V*(y[j]*R+y[j+1]*I+y[j+2]*C)}var G=.6-P*P-D*D-L*L;if(G<0)s=0;else{var q=3*d[O+1+m[k+1+m[F+1]]];s=(G*=G)*G*(y[q]*P+y[q+1]*D+y[q+2]*L)}return 32*(n+o+a+s)},noise4D:function(t,e,r,n){var i,s,u,l,c,h,p,f,d,m,y,_,g,v,x,b,w,E=this.perm,A=this.grad4,T=(t+e+r+n)*o,M=Math.floor(t+T),S=Math.floor(e+T),R=Math.floor(r+T),I=Math.floor(n+T),C=(M+S+R+I)*a,P=t-(M-C),D=e-(S-C),L=r-(R-C),O=n-(I-C),k=0,F=0,B=0,N=0;P>D?k++:F++,P>L?k++:B++,P>O?k++:N++,D>L?F++:B++,D>O?F++:N++,L>O?B++:N++;var z=P-(h=k>=3?1:0)+a,U=D-(p=F>=3?1:0)+a,V=L-(f=B>=3?1:0)+a,j=O-(d=N>=3?1:0)+a,G=P-(m=k>=2?1:0)+2*a,q=D-(y=F>=2?1:0)+2*a,H=L-(_=B>=2?1:0)+2*a,X=O-(g=N>=2?1:0)+2*a,Y=P-(v=k>=1?1:0)+3*a,Z=D-(x=F>=1?1:0)+3*a,W=L-(b=B>=1?1:0)+3*a,K=O-(w=N>=1?1:0)+3*a,J=P-1+4*a,Q=D-1+4*a,$=L-1+4*a,tt=O-1+4*a,et=255&M,rt=255&S,nt=255&R,it=255&I,ot=.6-P*P-D*D-L*L-O*O;if(ot<0)i=0;else{var at=E[et+E[rt+E[nt+E[it]]]]%32*4;i=(ot*=ot)*ot*(A[at]*P+A[at+1]*D+A[at+2]*L+A[at+3]*O)}var st=.6-z*z-U*U-V*V-j*j;if(st<0)s=0;else{var ut=E[et+h+E[rt+p+E[nt+f+E[it+d]]]]%32*4;s=(st*=st)*st*(A[ut]*z+A[ut+1]*U+A[ut+2]*V+A[ut+3]*j)}var lt=.6-G*G-q*q-H*H-X*X;if(lt<0)u=0;else{var ct=E[et+m+E[rt+y+E[nt+_+E[it+g]]]]%32*4;u=(lt*=lt)*lt*(A[ct]*G+A[ct+1]*q+A[ct+2]*H+A[ct+3]*X)}var ht=.6-Y*Y-Z*Z-W*W-K*K;if(ht<0)l=0;else{var pt=E[et+v+E[rt+x+E[nt+b+E[it+w]]]]%32*4;l=(ht*=ht)*ht*(A[pt]*Y+A[pt+1]*Z+A[pt+2]*W+A[pt+3]*K)}var ft=.6-J*J-Q*Q-$*$-tt*tt;if(ft<0)c=0;else{var dt=E[et+1+E[rt+1+E[nt+1+E[it+1]]]]%32*4;c=(ft*=ft)*ft*(A[dt]*J+A[dt+1]*Q+A[dt+2]*$+A[dt+3]*tt)}return 27*(i+s+u+l+c)}},s._buildPermutationTable=u,"undefined"!=typeof define&&define.amd&&define(function(){return s}),void 0!==r?r.SimplexNoise=s:"undefined"!=typeof window&&(window.SimplexNoise=s),void 0!==e&&(e.exports=s)}()},{}],208:[function(t,e,r){var n,i;n=this,i=function(t){"use strict";var e=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},r=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;a>0&&(a=1/Math.sqrt(a),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=o*a);return t},n=function(t,n){return n=n||1,t[0]=Math.random(),t[1]=Math.random(),t[2]=Math.random(),t[3]=Math.random(),r(t,t),e(t,t,n),t},i={create:function(){var t=new Float32Array(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},clone:function(t){var e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:function(t,e,r,n){var i=new Float32Array(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},set:function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},subtract:function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},multiply:function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},divide:function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},scale:e,scaleAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},distance:function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+n*n+i*i+o*o)},squaredDistance:function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return r*r+n*n+i*i+o*o},length:function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)},squaredLength:function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i},negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},normalize:r,dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},lerp:function(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t[3]=s+n*(r[3]-s),t},random:n,transformMat4:function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t},transformQuat:function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2],l=r[3],c=l*n+s*o-u*i,h=l*i+u*n-a*o,p=l*o+a*i-s*n,f=-a*n-s*i-u*o;return t[0]=c*l+f*-a+h*-u-p*-s,t[1]=h*l+f*-s+p*-a-c*-u,t[2]=p*l+f*-u+c*-s-h*-a,t[3]=e[3],t}};t.createSpring=function(t,e,r,n){n=n?n*n:Number.EPSILON;const o=Array.isArray(r),a=o?r.length:Number.isFinite(r)?1:null;if(!Number.isFinite(t)||!Number.isFinite(e))throw new Error("spring-animator: expected numbers for stiffness and dampening. (e.g. createSpring(0.003, 0.1, startingValue))");if(!a||a>4)throw new Error(`spring-animator: expected value \`${r}\` to be a scalar, vec2, vec3, or vec4`);function s(t=[],e){if(o!==Array.isArray(e)||o&&a!==e.length)throw new Error(`spring-animator: destination value type must match initial value type: ${o?a+"-component vector":"scalar"}`);if(Number.isFinite(e))return t[0]=e,t[1]=t[2]=t[3]=0,t;for(i.copy(t,e);t.length<4;)t.push(0);return t}r=s([],r);let u=i.copy([],r),l=i.copy([],r),c=[],h=[],p=[],f=[],d=[],m=[];return{setDestination:function(t,e=!0){s(l,t),e||(i.copy(r,l),i.copy(u,l))},getCurrentValue:function(t=[]){if(!o)return r[0];for(let e=0;e<a;e++)t[e]=r[e];return t},isAtDestination:y,tick:function(n=t,o=e){i.subtract(h,r,u),i.subtract(p,l,r),i.scale(f,p,n),i.scale(d,h,-o),i.add(m,f,d),i.add(h,h,m),i.add(c,h,r),i.copy(u,r),i.copy(r,c),y()&&(i.copy(r,l),i.copy(u,l))}};function y(t){return t=t?t*t:n,i.squaredDistance(r,l)<=t&&i.squaredDistance(r,u)<=t}},Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof r&&void 0!==e?i(r):"function"==typeof define&&define.amd?define(["exports"],i):i((n=n||self).SpringAnimator={})},{}],209:[function(t,e,r){"use strict";var n=t("parse-unit");e.exports=s;var i=a("in",document.body);function o(t,e){var r=n(getComputedStyle(t).getPropertyValue(e));return r[0]*s(r[1],t)}function a(t,e){var r=document.createElement("div");r.style.height="128"+t,e.appendChild(r);var n=o(r,"height")/128;return e.removeChild(r),n}function s(t,e){if(!t)return null;switch(e=e||document.body,t=(t+""||"px").trim().toLowerCase(),e!==window&&e!==document||(e=document.body),t){case"%":return e.clientHeight/100;case"ch":case"ex":return a(t,e);case"em":return o(e,"font-size");case"rem":return o(document.body,"font-size");case"vw":return window.innerWidth/100;case"vh":return window.innerHeight/100;case"vmin":return Math.min(window.innerWidth,window.innerHeight)/100;case"vmax":return Math.max(window.innerWidth,window.innerHeight)/100;case"in":return i;case"cm":return i/2.54;case"mm":return i/25.4;case"pt":return i/72;case"pc":return i/6;case"px":return 1}var r=n(t);if(!isNaN(r[0])&&r[1]){var u=s(r[1],e);return"number"==typeof u?r[0]*u:null}return null}},{"parse-unit":196}],210:[function(t,e,r){"use strict";e.exports=function(t){var e=(t=t||{}).center||[0,0,0],r=t.up||[0,1,0],n=t.right||h(r),i=t.radius||1,o=t.theta||0,c=t.phi||0;if(e=[].slice.call(e,0,3),r=[].slice.call(r,0,3),s(r,r),n=[].slice.call(n,0,3),s(n,n),"eye"in t){var f=t.eye,d=[f[0]-e[0],f[1]-e[1],f[2]-e[2]];a(n,d,r),l(n[0],n[1],n[2])<1e-6?n=h(r):s(n,n),i=l(d[0],d[1],d[2]);var m=u(r,d)/i,y=u(n,d)/i;c=Math.acos(m),o=Math.acos(y)}return i=Math.log(i),new p(t.zoomMin,t.zoomMax,e,r,n,i,o,c)};var n=t("filtered-vector"),i=t("gl-mat4/invert"),o=t("gl-mat4/rotate"),a=t("gl-vec3/cross"),s=t("gl-vec3/normalize"),u=t("gl-vec3/dot");function l(t,e,r){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2)+Math.pow(r,2))}function c(t){return Math.min(1,Math.max(-1,t))}function h(t){var e=Math.abs(t[0]),r=Math.abs(t[1]),n=Math.abs(t[2]),i=[0,0,0];e>Math.max(r,n)?i[2]=1:r>Math.max(e,n)?i[0]=1:i[1]=1;for(var o=0,a=0,u=0;u<3;++u)o+=t[u]*t[u],a+=i[u]*t[u];for(u=0;u<3;++u)i[u]-=a/o*t[u];return s(i,i),i}function p(t,e,r,i,o,a,s,u){this.center=n(r),this.up=n(i),this.right=n(o),this.radius=n([a]),this.angle=n([s,u]),this.angle.bounds=[[-Infinity,-Math.PI/2],[Infinity,Math.PI/2]],this.setDistanceLimits(t,e),this.computedCenter=this.center.curve(0),this.computedUp=this.up.curve(0),this.computedRight=this.right.curve(0),this.computedRadius=this.radius.curve(0),this.computedAngle=this.angle.curve(0),this.computedToward=[0,0,0],this.computedEye=[0,0,0],this.computedMatrix=new Array(16);for(var l=0;l<16;++l)this.computedMatrix[l]=.5;this.recalcMatrix(0)}var f=p.prototype;f.setDistanceLimits=function(t,e){t=t>0?Math.log(t):-Infinity,e=e>0?Math.log(e):Infinity,e=Math.max(e,t),this.radius.bounds[0][0]=t,this.radius.bounds[1][0]=e},f.getDistanceLimits=function(t){var e=this.radius.bounds[0];return t?(t[0]=Math.exp(e[0][0]),t[1]=Math.exp(e[1][0]),t):[Math.exp(e[0][0]),Math.exp(e[1][0])]},f.recalcMatrix=function(t){this.center.curve(t),this.up.curve(t),this.right.curve(t),this.radius.curve(t),this.angle.curve(t);for(var e=this.computedUp,r=this.computedRight,n=0,i=0,o=0;o<3;++o)i+=e[o]*r[o],n+=e[o]*e[o];var u=Math.sqrt(n),c=0;for(o=0;o<3;++o)r[o]-=e[o]*i/n,c+=r[o]*r[o],e[o]/=u;var h=Math.sqrt(c);for(o=0;o<3;++o)r[o]/=h;var p=this.computedToward;a(p,e,r),s(p,p);var f=Math.exp(this.computedRadius[0]),d=this.computedAngle[0],m=this.computedAngle[1],y=Math.cos(d),_=Math.sin(d),g=Math.cos(m),v=Math.sin(m),x=this.computedCenter,b=y*g,w=_*g,E=v,A=-y*v,T=-_*v,M=g,S=this.computedEye,R=this.computedMatrix;for(o=0;o<3;++o){var I=b*r[o]+w*p[o]+E*e[o];R[4*o+1]=A*r[o]+T*p[o]+M*e[o],R[4*o+2]=I,R[4*o+3]=0}var C=R[1],P=R[5],D=R[9],L=R[2],O=R[6],k=R[10],F=P*k-D*O,B=D*L-C*k,N=C*O-P*L,z=l(F,B,N);B/=z,N/=z,R[0]=F/=z,R[4]=B,R[8]=N;for(o=0;o<3;++o)S[o]=x[o]+R[2+4*o]*f;for(o=0;o<3;++o){c=0;for(var U=0;U<3;++U)c+=R[o+4*U]*S[U];R[12+o]=-c}R[15]=1},f.getMatrix=function(t,e){this.recalcMatrix(t);var r=this.computedMatrix;if(e){for(var n=0;n<16;++n)e[n]=r[n];return e}return r};var d=[0,0,0];f.rotate=function(t,e,r,n){if(this.angle.move(t,e,r),n){this.recalcMatrix(t);var i=this.computedMatrix;d[0]=i[2],d[1]=i[6],d[2]=i[10];for(var a=this.computedUp,s=this.computedRight,u=this.computedToward,l=0;l<3;++l)i[4*l]=a[l],i[4*l+1]=s[l],i[4*l+2]=u[l];o(i,i,n,d);for(l=0;l<3;++l)a[l]=i[4*l],s[l]=i[4*l+1];this.up.set(t,a[0],a[1],a[2]),this.right.set(t,s[0],s[1],s[2])}},f.pan=function(t,e,r,n){e=e||0,r=r||0,n=n||0,this.recalcMatrix(t);var i=this.computedMatrix,o=(Math.exp(this.computedRadius[0]),i[1]),a=i[5],s=i[9],u=l(o,a,s),c=i[0],h=i[4],p=i[8],f=c*(o/=u)+h*(a/=u)+p*(s/=u),d=l(c-=o*f,h-=a*f,p-=s*f);this.center.move(t,(c/=d)*e+o*r,(h/=d)*e+a*r,(p/=d)*e+s*r);var m=Math.exp(this.computedRadius[0]);m=Math.max(1e-4,m+n),this.radius.set(t,Math.log(m))},f.translate=function(t,e,r,n){this.center.move(t,e||0,r||0,n||0)},f.setMatrix=function(t,e,r,n){var o=1;"number"==typeof r&&(o=0|r),(o<0||o>3)&&(o=1);var a=(o+2)%3;e||(this.recalcMatrix(t),e=this.computedMatrix);var s=e[o],u=e[o+4],h=e[o+8];if(n){var p=Math.abs(s),f=Math.abs(u),d=Math.abs(h),m=Math.max(p,f,d);p===m?(s=s<0?-1:1,u=h=0):d===m?(h=h<0?-1:1,s=u=0):(u=u<0?-1:1,s=h=0)}else{var y=l(s,u,h);s/=y,u/=y,h/=y}var _,g,v=e[a],x=e[a+4],b=e[a+8],w=v*s+x*u+b*h,E=l(v-=s*w,x-=u*w,b-=h*w),A=u*(b/=E)-h*(x/=E),T=h*(v/=E)-s*b,M=s*x-u*v,S=l(A,T,M);if(A/=S,T/=S,M/=S,this.center.jump(t,j,G,q),this.radius.idle(t),this.up.jump(t,s,u,h),this.right.jump(t,v,x,b),2===o){var R=e[1],I=e[5],C=e[9];_=O<0?-Math.PI/2:Math.PI/2,g=Math.atan2(R*A+I*T+C*M,R*v+I*x+C*b)}else{var P=e[2],D=e[6],L=e[10],O=P*s+D*u+L*h,k=P*v+D*x+L*b,F=P*A+D*T+L*M;_=Math.asin(c(O)),g=Math.atan2(F,k)}this.angle.jump(t,g,_),this.recalcMatrix(t);var B=e[2],N=e[6],z=e[10],U=this.computedMatrix;i(U,e);var V=U[15],j=U[12]/V,G=U[13]/V,q=U[14]/V,H=Math.exp(this.computedRadius[0]);this.center.jump(t,j-B*H,G-N*H,q-z*H)},f.lastT=function(){return Math.max(this.center.lastT(),this.up.lastT(),this.right.lastT(),this.radius.lastT(),this.angle.lastT())},f.idle=function(t){this.center.idle(t),this.up.idle(t),this.right.idle(t),this.radius.idle(t),this.angle.idle(t)},f.flush=function(t){this.center.flush(t),this.up.flush(t),this.right.flush(t),this.radius.flush(t),this.angle.flush(t)},f.setDistance=function(t,e){e>0&&this.radius.set(t,Math.log(e))},f.lookAt=function(t,e,r,n){this.recalcMatrix(t),e=e||this.computedEye,r=r||this.computedCenter;var i=(n=n||this.computedUp)[0],o=n[1],a=n[2],s=l(i,o,a);if(!(s<1e-6)){i/=s,o/=s,a/=s;var u=e[0]-r[0],h=e[1]-r[1],p=e[2]-r[2],f=l(u,h,p);if(!(f<1e-6)){u/=f,h/=f,p/=f;var d=this.computedRight,m=d[0],y=d[1],_=d[2],g=i*m+o*y+a*_,v=l(m-=g*i,y-=g*o,_-=g*a);if(!(v<.01&&(v=l(m=o*p-a*h,y=a*u-i*p,_=i*h-o*u))<1e-6)){m/=v,y/=v,_/=v,this.up.set(t,i,o,a),this.right.set(t,m,y,_),this.center.set(t,r[0],r[1],r[2]),this.radius.set(t,Math.log(f));var x=o*_-a*y,b=a*m-i*_,w=i*y-o*m,E=l(x,b,w),A=m*u+y*h+_*p,T=(x/=E)*u+(b/=E)*h+(w/=E)*p,M=Math.asin(c(i*u+o*h+a*p)),S=Math.atan2(T,A),R=this.angle._state,I=R[R.length-1],C=R[R.length-2];I%=2*Math.PI;var P=Math.abs(I+2*Math.PI-S),D=Math.abs(I-S),L=Math.abs(I-2*Math.PI-S);P<D&&(I+=2*Math.PI),L<D&&(I-=2*Math.PI),this.angle.jump(this.angle.lastT(),I,C),this.angle.set(t,S,M)}}}}},{"filtered-vector":24,"gl-mat4/invert":47,"gl-mat4/rotate":53,"gl-vec3/cross":114,"gl-vec3/dot":119,"gl-vec3/normalize":136}],211:[function(t,e,r){e.exports=function(t){for(var e=0,r=0;r<t.length;r++)e+=t[r]*t[r];if(0===(e=Math.sqrt(e)))return Array.apply(null,new Array(t.length)).map(Number.prototype.valueOf,0);for(var r=0;r<t.length;r++)t[r]/=e;return t}},{}],212:[function(t,e,r){e.exports=function(t){if(0===t.length)return null;for(var e=t[0].length,r=new Array(e),n=new Array(e),i=0;i<e;i++)r[i]=Infinity,n[i]=-Infinity;return t.forEach(function(t){for(var i=0;i<e;i++)n[i]=t[i]>n[i]?t[i]:n[i],r[i]=t[i]<r[i]?t[i]:r[i]}),[r,n]}},{}],213:[function(t,e,r){const n=t("canvas-sketch"),i=t("canvas-sketch-util/random"),{createRico:o}=t("../lib/dlite/dlite-0.0.10"),{GUI:a}=t("dat-gui"),s=t("gl-mat4"),u=t("gl-vec3"),l=t("get-plane-normal"),c=t("3d-view-controls"),h=t("nice-color-palettes"),p=t("../lib/palette-animator/palette-animator-0.0.1"),f=t("../lib/noise-glsl/noise-glsl-0.0.1"),d=t("../lib/inject-glsl/inject-glsl-0.0.1"),m=t("../lib/clip-mesh-with-plane/clip-mesh-with-plane-0.0.1"),y=t("geo-ambient-occlusion"),_=t("primitive-icosphere")(10,{subdivisions:0}),g=_.positions.reduce((t,e)=>[t[0]+e[0]/_.positions.length,t[1]+e[1]/_.positions.length,t[2]+e[2]/_.positions.length],[0,0,0]),v=window.rico=o(),x={seed:5310,palette:70,primitive:"triangles",offset:0,cuts:3,rotationAmount:.01,translationAmount:.1,sampleCount:2048,resolution:512,bias:.04,aoPower:.8,lightFromInside:!1,cameraDist:45,roam:!0},b=new a;b.add(x,"seed",0,9999).step(1).onChange(I),b.add(x,"palette",0,100).step(1),b.add(x,"offset",0,2).onChange(I),b.add(x,"cuts",0,28).step(1).onChange(I),b.add(x,"rotationAmount",0,2),b.add(x,"translationAmount",0,10),b.add(x,"sampleCount",1,1e4).step(1).onChange(I),b.add(x,"resolution",1,2048).step(1).onChange(I),b.add(x,"bias",0,.5).step(.001).onChange(I),b.add(x,"aoPower",0,2),b.add(x,"lightFromInside"),b.add(x,"primitive",["points","lines","triangles"]),b.add(x,"cameraDist",0,100),b.add(x,"roam");const w=c(v.canvas,{zoomSpeed:4});w.lookAt([50,50,50],g,[0,0,1]);const E=v.createVertexArray();let A,T=i.createRandom(x.seed);h.unshift(["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"]);const M=p(h,.001,.1,[1,1,1]),{PALETTE_ANIMATOR_GLSL:S}=M,R=[];function I(){T=i.createRandom(x.seed);let t=[_.cells.map(t=>t.map(t=>_.positions[t]))];const e=T.onSphere(1);let r=x.cuts;for(;r--;){const r=T.insideSphere(10);t=t.map(t=>{const[n,i]=m(t,e,r),o=u.scale([],e,x.offset),a=u.scale([],e,-x.offset);return[n.map(t=>t.map(t=>u.add([],t,o))),i.map(t=>t.map(t=>u.add([],t,a)))]}).flat()}const n=[],o=[],a=[],s=[];for(const r of t){const t=e,i=P(r);for(const e of r){const r=l(R,...e);u.scale(r,r,.8),u.add(r,r,[.5,.5,.5]);for(const u of e)n.push(...u),o.push(...r),a.push(...t),s.push(...i)}}const c=y(n,{resolution:x.resolution,bias:x.bias,normals:o});for(let t=0;t<x.sampleCount;t++)c.sample();const h=c.report();c.dispose(),E.vertexAttributeBuffer(0,v.createVertexBuffer(v.gl.FLOAT,3,new Float32Array(n))).vertexAttributeBuffer(1,v.createVertexBuffer(v.gl.FLOAT,3,new Float32Array(o))).vertexAttributeBuffer(2,v.createVertexBuffer(v.gl.FLOAT,3,new Float32Array(a))).vertexAttributeBuffer(3,v.createVertexBuffer(v.gl.FLOAT,3,new Float32Array(s))).vertexAttributeBuffer(4,v.createVertexBuffer(v.gl.FLOAT,1,new Float32Array(h))),A=n.length/3}const C=v({depth:!0,vertexArray:E,vs:d(S,f,"#version 300 es\n  precision highp float;\n\n  layout(location=0) in vec3 position;\n  layout(location=1) in vec3 normal;\n  layout(location=2) in vec3 rotationAxis;\n  layout(location=3) in vec3 rotationOffset;\n  layout(location=4) in float ao;\n\n  out vec4 vColor;\n\n  uniform mat4 projection;\n  uniform mat4 view;\n  uniform float time;\n  uniform vec3 meshCenter;\n  uniform float rotationAmount;\n  uniform float translationAmount;\n  uniform bool lightFromInside;\n  uniform float aoPower;\n\n  vec4 makeQuaternion(float angle, vec3 axis) {\n    return vec4(cos(angle / 2.0), sin(angle / 2.0) * axis);\n  }\n\n  vec3 transform(vec3 p, vec4 q) {\n    return p + 2.0 * cross(cross(p, q.yzw) + q.x * p, q.yzw);\n  }\n\n  void main() {\n    float tOffset = random3(rotationOffset).x + 0.5;\n    float t = sin(time * 0.8) * 0.5 + 0.5;\n    t *= 1.0 + tOffset * 5.0;\n    t *= random3(rotationOffset).y * 2.0;\n    vec4 quat = makeQuaternion(3.1415 * t * rotationAmount, rotationAxis);\n    vec3 translation = normalize(rotationOffset - meshCenter);\n    vec3 offset = t * translationAmount * translation;\n    vec3 n = transform(normal, quat);\n    float average = clamp((n.x + n.y + n.z) / 3.0 + 0.05, 0.0, 1.0);\n    vec3 color = getColorFromPalette(average) + vec3(0.15);\n    float occ = lightFromInside ? ao + 0.1 : 1.0 - ao + 0.1;\n    color *= pow(occ, aoPower);\n    vColor = vec4(color, 1);\n    vec3 p = transform(position - rotationOffset, quat) + rotationOffset + offset;\n    gl_Position = projection * view * vec4(p, 1);\n    gl_PointSize = 2.0;\n  }\n  "),fs:"#version 300 es\n  precision highp float;\n  \n  in vec4 vColor;\n  out vec4 fragColor;\n\n  void main() {\n    fragColor = vColor;\n  }\n  "});function P(t){const e=3*t.length;if(!e)return null;const r=[0,0,0];for(const n of t)for(const t of n)r[0]+=t[0]/e,r[1]+=t[1]/e,r[2]+=t[2]/e;return r}n(()=>(I(),({width:t,height:e,time:r})=>{x.roam&&(w.up=[0,1,0],w.center=[x.cameraDist*Math.cos(r/5),0,x.cameraDist*Math.sin(r/5)]),w.tick(),M.tick(x.palette),x.lightFromInside?v.clear(.18,.18,.18,1):v.clear(.97,.98,.99,1);const n={view:w.matrix,projection:s.perspective([],Math.PI/4,t/e,.01,1e3)};C({primitive:x.primitive,count:A,uniforms:{...n,...M.uniforms(),meshCenter:g,time:r,rotationAmount:x.rotationAmount,translationAmount:x.translationAmount,lightFromInside:x.lightFromInside,aoPower:x.aoPower}})}),{canvas:v.canvas,context:"webgl2",pixelRatio:1,animate:!0})},{"../lib/clip-mesh-with-plane/clip-mesh-with-plane-0.0.1":1,"../lib/dlite/dlite-0.0.10":2,"../lib/inject-glsl/inject-glsl-0.0.1":3,"../lib/noise-glsl/noise-glsl-0.0.1":4,"../lib/palette-animator/palette-animator-0.0.1":5,"3d-view-controls":6,"canvas-sketch":13,"canvas-sketch-util/random":12,"dat-gui":17,"geo-ambient-occlusion":26,"get-plane-normal":30,"gl-mat4":46,"gl-vec3":126,"nice-color-palettes":192,"primitive-icosphere":199}],214:[function(t,e,r){(function(t){t.CANVAS_SKETCH_DEFAULT_STORAGE_KEY=window.location.href}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[213,214]);</script>